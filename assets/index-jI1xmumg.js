import{r as I,a as X0,u as gc,b as ir,L as Rt,O as Q0,H as Z0,R as ey,c as zt,N as ty,d as sy}from"./react-BFevp8nl.js";import{L as Ne,M as ny,X as St,a as Ff,U as Ci,b as xc,C as Gt,S as ss,P as ys,F as ry,c as yc,d as jt,e as Ws,f as Tr,B as vc,g as jr,h as iy,G as Js,i as Zs,j as Fo,k as Ps,l as Si,m as or,n as oy,o as Of,p as ay,q as hs,r as Ai,E as ya,s as Ri,t as Pi,u as zf,v as $t,w as bc,x as wc,y as kr,z as Bf,A as ly,D as zr,H as Oo,I as Dr,J as cy,T as st,K as dy,N as uy,O as va,Q as qf,R as Pt,V as gu,W as Qn,Y as xu,Z as Gf,_ as ms,$ as hy,a0 as yu,a1 as my,a2 as ba,a3 as Ks,a4 as $f,a5 as As,a6 as Bi,a7 as gi,a8 as fy,a9 as py,aa as gy,ab as xy,ac as yy,ad as zo,ae as Rs,af as Fs,ag as Jn,ah as Hf,ai as vy,aj as by,ak as wy,al as xi,am as _y,an as Ny,ao as vu,ap as Ey,aq as Wf,ar as Ty,as as Iy,at as Bo,au as Cy,av as Sy,aw as Ay,ax as yi,ay as Jf,az as Ry,aA as Py,aB as Kf,aC as jy,aD as ky,aE as Dy,aF as My,aG as Ly,aH as Vy,aI as Yf,aJ as Uy,aK as Fy}from"./vendor-DwIo-vgN.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}})();var Xf={exports:{}},wa={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oy=I,zy=Symbol.for("react.element"),By=Symbol.for("react.fragment"),qy=Object.prototype.hasOwnProperty,Gy=Oy.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$y={key:!0,ref:!0,__self:!0,__source:!0};function Qf(t,e,s){var n,r={},o=null,a=null;s!==void 0&&(o=""+s),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(a=e.ref);for(n in e)qy.call(e,n)&&!$y.hasOwnProperty(n)&&(r[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)r[n]===void 0&&(r[n]=e[n]);return{$$typeof:zy,type:t,key:o,ref:a,props:r,_owner:Gy.current}}wa.Fragment=By;wa.jsx=Qf;wa.jsxs=Qf;Xf.exports=wa;var i=Xf.exports,Zf,bu=X0;Zf=bu.createRoot,bu.hydrateRoot;const Hy=()=>{};var wu={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ep=function(t){const e=[];let s=0;for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);r<128?e[s++]=r:r<2048?(e[s++]=r>>6|192,e[s++]=r&63|128):(r&64512)===55296&&n+1<t.length&&(t.charCodeAt(n+1)&64512)===56320?(r=65536+((r&1023)<<10)+(t.charCodeAt(++n)&1023),e[s++]=r>>18|240,e[s++]=r>>12&63|128,e[s++]=r>>6&63|128,e[s++]=r&63|128):(e[s++]=r>>12|224,e[s++]=r>>6&63|128,e[s++]=r&63|128)}return e},Wy=function(t){const e=[];let s=0,n=0;for(;s<t.length;){const r=t[s++];if(r<128)e[n++]=String.fromCharCode(r);else if(r>191&&r<224){const o=t[s++];e[n++]=String.fromCharCode((r&31)<<6|o&63)}else if(r>239&&r<365){const o=t[s++],a=t[s++],l=t[s++],u=((r&7)<<18|(o&63)<<12|(a&63)<<6|l&63)-65536;e[n++]=String.fromCharCode(55296+(u>>10)),e[n++]=String.fromCharCode(56320+(u&1023))}else{const o=t[s++],a=t[s++];e[n++]=String.fromCharCode((r&15)<<12|(o&63)<<6|a&63)}}return e.join("")},tp={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let r=0;r<t.length;r+=3){const o=t[r],a=r+1<t.length,l=a?t[r+1]:0,u=r+2<t.length,d=u?t[r+2]:0,f=o>>2,p=(o&3)<<4|l>>4;let g=(l&15)<<2|d>>6,v=d&63;u||(v=64,a||(g=64)),n.push(s[f],s[p],s[g],s[v])}return n.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(ep(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Wy(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const s=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let r=0;r<t.length;){const o=s[t.charAt(r++)],l=r<t.length?s[t.charAt(r)]:0;++r;const d=r<t.length?s[t.charAt(r)]:64;++r;const p=r<t.length?s[t.charAt(r)]:64;if(++r,o==null||l==null||d==null||p==null)throw new Jy;const g=o<<2|l>>4;if(n.push(g),d!==64){const v=l<<4&240|d>>2;if(n.push(v),p!==64){const A=d<<6&192|p;n.push(A)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class Jy extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ky=function(t){const e=ep(t);return tp.encodeByteArray(e,!0)},qo=function(t){return Ky(t).replace(/\./g,"")},sp=function(t){try{return tp.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yy(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xy=()=>Yy().__FIREBASE_DEFAULTS__,Qy=()=>{if(typeof process>"u"||typeof wu>"u")return;const t=wu.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Zy=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&sp(t[1]);return e&&JSON.parse(e)},_a=()=>{try{return Hy()||Xy()||Qy()||Zy()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},np=t=>{var e,s;return(s=(e=_a())==null?void 0:e.emulatorHosts)==null?void 0:s[t]},rp=t=>{const e=np(t);if(!e)return;const s=e.lastIndexOf(":");if(s<=0||s+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(s+1),10);return e[0]==="["?[e.substring(1,s-1),n]:[e.substring(0,s),n]},ip=()=>{var t;return(t=_a())==null?void 0:t.config},op=t=>{var e;return(e=_a())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ev{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,s)=>{this.resolve=e,this.reject=s})}wrapCallback(e){return(s,n)=>{s?this.reject(s):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(s):e(s,n))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ar(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function _c(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ap(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},n=e||"demo-project",r=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...t};return[qo(JSON.stringify(s)),qo(JSON.stringify(a)),""].join(".")}const vi={};function tv(){const t={prod:[],emulator:[]};for(const e of Object.keys(vi))vi[e]?t.emulator.push(e):t.prod.push(e);return t}function sv(t){let e=document.getElementById(t),s=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),s=!0),{created:s,element:e}}let _u=!1;function Nc(t,e){if(typeof window>"u"||typeof document>"u"||!ar(window.location.host)||vi[t]===e||vi[t]||_u)return;vi[t]=e;function s(g){return`__firebase__banner__${g}`}const n="__firebase__banner",o=tv().prod.length>0;function a(){const g=document.getElementById(n);g&&g.remove()}function l(g){g.style.display="flex",g.style.background="#7faaf0",g.style.position="fixed",g.style.bottom="5px",g.style.left="5px",g.style.padding=".5em",g.style.borderRadius="5px",g.style.alignItems="center"}function u(g,v){g.setAttribute("width","24"),g.setAttribute("id",v),g.setAttribute("height","24"),g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("fill","none"),g.style.marginLeft="-6px"}function d(){const g=document.createElement("span");return g.style.cursor="pointer",g.style.marginLeft="16px",g.style.fontSize="24px",g.innerHTML=" &times;",g.onclick=()=>{_u=!0,a()},g}function f(g,v){g.setAttribute("id",v),g.innerText="Learn more",g.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",g.setAttribute("target","__blank"),g.style.paddingLeft="5px",g.style.textDecoration="underline"}function p(){const g=sv(n),v=s("text"),A=document.getElementById(v)||document.createElement("span"),k=s("learnmore"),S=document.getElementById(k)||document.createElement("a"),L=s("preprendIcon"),D=document.getElementById(L)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(g.created){const j=g.element;l(j),f(S,k);const F=d();u(D,L),j.append(D,A,S,F),document.body.appendChild(j)}o?(A.innerText="Preview backend disconnected.",D.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(D.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,A.innerText="Preview backend running in this workspace."),A.setAttribute("id",v)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function nv(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Qt())}function rv(){var e;const t=(e=_a())==null?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function iv(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function ov(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function av(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function lv(){const t=Qt();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function cv(){return!rv()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function dv(){try{return typeof indexedDB=="object"}catch{return!1}}function uv(){return new Promise((t,e)=>{try{let s=!0;const n="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(n);r.onsuccess=()=>{r.result.close(),s||self.indexedDB.deleteDatabase(n),t(!0)},r.onupgradeneeded=()=>{s=!1},r.onerror=()=>{var o;e(((o=r.error)==null?void 0:o.message)||"")}}catch(s){e(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hv="FirebaseError";class qs extends Error{constructor(e,s,n){super(s),this.code=e,this.customData=n,this.name=hv,Object.setPrototypeOf(this,qs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,qi.prototype.create)}}class qi{constructor(e,s,n){this.service=e,this.serviceName=s,this.errors=n}create(e,...s){const n=s[0]||{},r=`${this.service}/${e}`,o=this.errors[e],a=o?mv(o,n):"Error",l=`${this.serviceName}: ${a} (${r}).`;return new qs(r,l,n)}}function mv(t,e){return t.replace(fv,(s,n)=>{const r=e[n];return r!=null?String(r):`<${n}?>`})}const fv=/\{\$([^}]+)}/g;function pv(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Zn(t,e){if(t===e)return!0;const s=Object.keys(t),n=Object.keys(e);for(const r of s){if(!n.includes(r))return!1;const o=t[r],a=e[r];if(Nu(o)&&Nu(a)){if(!Zn(o,a))return!1}else if(o!==a)return!1}for(const r of n)if(!s.includes(r))return!1;return!0}function Nu(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gi(t){const e=[];for(const[s,n]of Object.entries(t))Array.isArray(n)?n.forEach(r=>{e.push(encodeURIComponent(s)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(s)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function ci(t){const e={};return t.replace(/^\?/,"").split("&").forEach(n=>{if(n){const[r,o]=n.split("=");e[decodeURIComponent(r)]=decodeURIComponent(o)}}),e}function di(t){const e=t.indexOf("?");if(!e)return"";const s=t.indexOf("#",e);return t.substring(e,s>0?s:void 0)}function gv(t,e){const s=new xv(t,e);return s.subscribe.bind(s)}class xv{constructor(e,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(s=>{s.next(e)})}error(e){this.forEachObserver(s=>{s.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,s,n){let r;if(e===void 0&&s===void 0&&n===void 0)throw new Error("Missing Observer.");yv(e,["next","error","complete"])?r=e:r={next:e,error:s,complete:n},r.next===void 0&&(r.next=fl),r.error===void 0&&(r.error=fl),r.complete===void 0&&(r.complete=fl);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,e)}sendOne(e,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{s(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function yv(t,e){if(typeof t!="object"||t===null)return!1;for(const s of e)if(s in t&&typeof t[s]=="function")return!0;return!1}function fl(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gt(t){return t&&t._delegate?t._delegate:t}class Sn{constructor(e,s,n){this.name=e,this.instanceFactory=s,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hn="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vv{constructor(e,s){this.name=e,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const s=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(s)){const n=new ev;if(this.instancesDeferred.set(s,n),this.isInitialized(s)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:s});r&&n.resolve(r)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(e){const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),n=(e==null?void 0:e.optional)??!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(r){if(n)return null;throw r}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(wv(e))try{this.getOrInitializeService({instanceIdentifier:Hn})}catch{}for(const[s,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(s);try{const o=this.getOrInitializeService({instanceIdentifier:r});n.resolve(o)}catch{}}}}clearInstance(e=Hn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...e.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Hn){return this.instances.has(e)}getOptions(e=Hn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:s={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:s});for(const[o,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(o);n===l&&a.resolve(r)}return r}onInit(e,s){const n=this.normalizeInstanceIdentifier(s),r=this.onInitCallbacks.get(n)??new Set;r.add(e),this.onInitCallbacks.set(n,r);const o=this.instances.get(n);return o&&e(o,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,s){const n=this.onInitCallbacks.get(s);if(n)for(const r of n)try{r(e,s)}catch{}}getOrInitializeService({instanceIdentifier:e,options:s={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:bv(e),options:s}),this.instances.set(e,n),this.instancesOptions.set(e,s),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Hn){return this.component?this.component.multipleInstances?e:Hn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function bv(t){return t===Hn?void 0:t}function wv(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _v{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const s=this.getProvider(e.name);if(s.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);s.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const s=new vv(e,this);return this.providers.set(e,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Oe;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Oe||(Oe={}));const Nv={debug:Oe.DEBUG,verbose:Oe.VERBOSE,info:Oe.INFO,warn:Oe.WARN,error:Oe.ERROR,silent:Oe.SILENT},Ev=Oe.INFO,Tv={[Oe.DEBUG]:"log",[Oe.VERBOSE]:"log",[Oe.INFO]:"info",[Oe.WARN]:"warn",[Oe.ERROR]:"error"},Iv=(t,e,...s)=>{if(e<t.logLevel)return;const n=new Date().toISOString(),r=Tv[e];if(r)console[r](`[${n}]  ${t.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Ec{constructor(e){this.name=e,this._logLevel=Ev,this._logHandler=Iv,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Oe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Nv[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Oe.DEBUG,...e),this._logHandler(this,Oe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Oe.VERBOSE,...e),this._logHandler(this,Oe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Oe.INFO,...e),this._logHandler(this,Oe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Oe.WARN,...e),this._logHandler(this,Oe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Oe.ERROR,...e),this._logHandler(this,Oe.ERROR,...e)}}const Cv=(t,e)=>e.some(s=>t instanceof s);let Eu,Tu;function Sv(){return Eu||(Eu=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Av(){return Tu||(Tu=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const lp=new WeakMap,Rl=new WeakMap,cp=new WeakMap,pl=new WeakMap,Tc=new WeakMap;function Rv(t){const e=new Promise((s,n)=>{const r=()=>{t.removeEventListener("success",o),t.removeEventListener("error",a)},o=()=>{s(En(t.result)),r()},a=()=>{n(t.error),r()};t.addEventListener("success",o),t.addEventListener("error",a)});return e.then(s=>{s instanceof IDBCursor&&lp.set(s,t)}).catch(()=>{}),Tc.set(e,t),e}function Pv(t){if(Rl.has(t))return;const e=new Promise((s,n)=>{const r=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",a),t.removeEventListener("abort",a)},o=()=>{s(),r()},a=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",o),t.addEventListener("error",a),t.addEventListener("abort",a)});Rl.set(t,e)}let Pl={get(t,e,s){if(t instanceof IDBTransaction){if(e==="done")return Rl.get(t);if(e==="objectStoreNames")return t.objectStoreNames||cp.get(t);if(e==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return En(t[e])},set(t,e,s){return t[e]=s,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function jv(t){Pl=t(Pl)}function kv(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...s){const n=t.call(gl(this),e,...s);return cp.set(n,e.sort?e.sort():[e]),En(n)}:Av().includes(t)?function(...e){return t.apply(gl(this),e),En(lp.get(this))}:function(...e){return En(t.apply(gl(this),e))}}function Dv(t){return typeof t=="function"?kv(t):(t instanceof IDBTransaction&&Pv(t),Cv(t,Sv())?new Proxy(t,Pl):t)}function En(t){if(t instanceof IDBRequest)return Rv(t);if(pl.has(t))return pl.get(t);const e=Dv(t);return e!==t&&(pl.set(t,e),Tc.set(e,t)),e}const gl=t=>Tc.get(t);function Mv(t,e,{blocked:s,upgrade:n,blocking:r,terminated:o}={}){const a=indexedDB.open(t,e),l=En(a);return n&&a.addEventListener("upgradeneeded",u=>{n(En(a.result),u.oldVersion,u.newVersion,En(a.transaction),u)}),s&&a.addEventListener("blocked",u=>s(u.oldVersion,u.newVersion,u)),l.then(u=>{o&&u.addEventListener("close",()=>o()),r&&u.addEventListener("versionchange",d=>r(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const Lv=["get","getKey","getAll","getAllKeys","count"],Vv=["put","add","delete","clear"],xl=new Map;function Iu(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(xl.get(e))return xl.get(e);const s=e.replace(/FromIndex$/,""),n=e!==s,r=Vv.includes(s);if(!(s in(n?IDBIndex:IDBObjectStore).prototype)||!(r||Lv.includes(s)))return;const o=async function(a,...l){const u=this.transaction(a,r?"readwrite":"readonly");let d=u.store;return n&&(d=d.index(l.shift())),(await Promise.all([d[s](...l),r&&u.done]))[0]};return xl.set(e,o),o}jv(t=>({...t,get:(e,s,n)=>Iu(e,s)||t.get(e,s,n),has:(e,s)=>!!Iu(e,s)||t.has(e,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uv{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(Fv(s)){const n=s.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(s=>s).join(" ")}}function Fv(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const jl="@firebase/app",Cu="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const en=new Ec("@firebase/app"),Ov="@firebase/app-compat",zv="@firebase/analytics-compat",Bv="@firebase/analytics",qv="@firebase/app-check-compat",Gv="@firebase/app-check",$v="@firebase/auth",Hv="@firebase/auth-compat",Wv="@firebase/database",Jv="@firebase/data-connect",Kv="@firebase/database-compat",Yv="@firebase/functions",Xv="@firebase/functions-compat",Qv="@firebase/installations",Zv="@firebase/installations-compat",eb="@firebase/messaging",tb="@firebase/messaging-compat",sb="@firebase/performance",nb="@firebase/performance-compat",rb="@firebase/remote-config",ib="@firebase/remote-config-compat",ob="@firebase/storage",ab="@firebase/storage-compat",lb="@firebase/firestore",cb="@firebase/ai",db="@firebase/firestore-compat",ub="firebase",hb="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kl="[DEFAULT]",mb={[jl]:"fire-core",[Ov]:"fire-core-compat",[Bv]:"fire-analytics",[zv]:"fire-analytics-compat",[Gv]:"fire-app-check",[qv]:"fire-app-check-compat",[$v]:"fire-auth",[Hv]:"fire-auth-compat",[Wv]:"fire-rtdb",[Jv]:"fire-data-connect",[Kv]:"fire-rtdb-compat",[Yv]:"fire-fn",[Xv]:"fire-fn-compat",[Qv]:"fire-iid",[Zv]:"fire-iid-compat",[eb]:"fire-fcm",[tb]:"fire-fcm-compat",[sb]:"fire-perf",[nb]:"fire-perf-compat",[rb]:"fire-rc",[ib]:"fire-rc-compat",[ob]:"fire-gcs",[ab]:"fire-gcs-compat",[lb]:"fire-fst",[db]:"fire-fst-compat",[cb]:"fire-vertex","fire-js":"fire-js",[ub]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Go=new Map,fb=new Map,Dl=new Map;function Su(t,e){try{t.container.addComponent(e)}catch(s){en.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,s)}}function er(t){const e=t.name;if(Dl.has(e))return en.debug(`There were multiple attempts to register component ${e}.`),!1;Dl.set(e,t);for(const s of Go.values())Su(s,t);for(const s of fb.values())Su(s,t);return!0}function Na(t,e){const s=t.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),t.container.getProvider(e)}function ds(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pb={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Tn=new qi("app","Firebase",pb);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gb{constructor(e,s,n){this._isDeleted=!1,this._options={...e},this._config={...s},this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Sn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Tn.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lr=hb;function dp(t,e={}){let s=t;typeof e!="object"&&(e={name:e});const n={name:kl,automaticDataCollectionEnabled:!0,...e},r=n.name;if(typeof r!="string"||!r)throw Tn.create("bad-app-name",{appName:String(r)});if(s||(s=ip()),!s)throw Tn.create("no-options");const o=Go.get(r);if(o){if(Zn(s,o.options)&&Zn(n,o.config))return o;throw Tn.create("duplicate-app",{appName:r})}const a=new _v(r);for(const u of Dl.values())a.addComponent(u);const l=new gb(s,n,a);return Go.set(r,l),l}function Ic(t=kl){const e=Go.get(t);if(!e&&t===kl&&ip())return dp();if(!e)throw Tn.create("no-app",{appName:t});return e}function js(t,e,s){let n=mb[t]??t;s&&(n+=`-${s}`);const r=n.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const a=[`Unable to register library "${n}" with version "${e}":`];r&&a.push(`library name "${n}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),en.warn(a.join(" "));return}er(new Sn(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xb="firebase-heartbeat-database",yb=1,ji="firebase-heartbeat-store";let yl=null;function up(){return yl||(yl=Mv(xb,yb,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(ji)}catch(s){console.warn(s)}}}}).catch(t=>{throw Tn.create("idb-open",{originalErrorMessage:t.message})})),yl}async function vb(t){try{const s=(await up()).transaction(ji),n=await s.objectStore(ji).get(hp(t));return await s.done,n}catch(e){if(e instanceof qs)en.warn(e.message);else{const s=Tn.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});en.warn(s.message)}}}async function Au(t,e){try{const n=(await up()).transaction(ji,"readwrite");await n.objectStore(ji).put(e,hp(t)),await n.done}catch(s){if(s instanceof qs)en.warn(s.message);else{const n=Tn.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});en.warn(n.message)}}}function hp(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bb=1024,wb=30;class _b{constructor(e){this.container=e,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new Eb(s),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,s;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Ru();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)==null?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(a=>a.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:r}),this._heartbeatsCache.heartbeats.length>wb){const a=Tb(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){en.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=Ru(),{heartbeatsToSend:n,unsentEntries:r}=Nb(this._heartbeatsCache.heartbeats),o=qo(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=s,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(s){return en.warn(s),""}}}function Ru(){return new Date().toISOString().substring(0,10)}function Nb(t,e=bb){const s=[];let n=t.slice();for(const r of t){const o=s.find(a=>a.agent===r.agent);if(o){if(o.dates.push(r.date),Pu(s)>e){o.dates.pop();break}}else if(s.push({agent:r.agent,dates:[r.date]}),Pu(s)>e){s.pop();break}n=n.slice(1)}return{heartbeatsToSend:s,unsentEntries:n}}class Eb{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return dv()?uv().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await vb(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return Au(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return Au(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}}function Pu(t){return qo(JSON.stringify({version:2,heartbeats:t})).length}function Tb(t){if(t.length===0)return-1;let e=0,s=t[0].date;for(let n=1;n<t.length;n++)t[n].date<s&&(s=t[n].date,e=n);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ib(t){er(new Sn("platform-logger",e=>new Uv(e),"PRIVATE")),er(new Sn("heartbeat",e=>new _b(e),"PRIVATE")),js(jl,Cu,t),js(jl,Cu,"esm2020"),js("fire-js","")}Ib("");var Cb="firebase",Sb="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */js(Cb,Sb,"app");var ju=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var In,mp;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(w,b){function _(){}_.prototype=b.prototype,w.F=b.prototype,w.prototype=new _,w.prototype.constructor=w,w.D=function(T,R,M){for(var C=Array(arguments.length-2),ge=2;ge<arguments.length;ge++)C[ge-2]=arguments[ge];return b.prototype[R].apply(T,C)}}function s(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(n,s),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(w,b,_){_||(_=0);const T=Array(16);if(typeof b=="string")for(var R=0;R<16;++R)T[R]=b.charCodeAt(_++)|b.charCodeAt(_++)<<8|b.charCodeAt(_++)<<16|b.charCodeAt(_++)<<24;else for(R=0;R<16;++R)T[R]=b[_++]|b[_++]<<8|b[_++]<<16|b[_++]<<24;b=w.g[0],_=w.g[1],R=w.g[2];let M=w.g[3],C;C=b+(M^_&(R^M))+T[0]+3614090360&4294967295,b=_+(C<<7&4294967295|C>>>25),C=M+(R^b&(_^R))+T[1]+3905402710&4294967295,M=b+(C<<12&4294967295|C>>>20),C=R+(_^M&(b^_))+T[2]+606105819&4294967295,R=M+(C<<17&4294967295|C>>>15),C=_+(b^R&(M^b))+T[3]+3250441966&4294967295,_=R+(C<<22&4294967295|C>>>10),C=b+(M^_&(R^M))+T[4]+4118548399&4294967295,b=_+(C<<7&4294967295|C>>>25),C=M+(R^b&(_^R))+T[5]+1200080426&4294967295,M=b+(C<<12&4294967295|C>>>20),C=R+(_^M&(b^_))+T[6]+2821735955&4294967295,R=M+(C<<17&4294967295|C>>>15),C=_+(b^R&(M^b))+T[7]+4249261313&4294967295,_=R+(C<<22&4294967295|C>>>10),C=b+(M^_&(R^M))+T[8]+1770035416&4294967295,b=_+(C<<7&4294967295|C>>>25),C=M+(R^b&(_^R))+T[9]+2336552879&4294967295,M=b+(C<<12&4294967295|C>>>20),C=R+(_^M&(b^_))+T[10]+4294925233&4294967295,R=M+(C<<17&4294967295|C>>>15),C=_+(b^R&(M^b))+T[11]+2304563134&4294967295,_=R+(C<<22&4294967295|C>>>10),C=b+(M^_&(R^M))+T[12]+1804603682&4294967295,b=_+(C<<7&4294967295|C>>>25),C=M+(R^b&(_^R))+T[13]+4254626195&4294967295,M=b+(C<<12&4294967295|C>>>20),C=R+(_^M&(b^_))+T[14]+2792965006&4294967295,R=M+(C<<17&4294967295|C>>>15),C=_+(b^R&(M^b))+T[15]+1236535329&4294967295,_=R+(C<<22&4294967295|C>>>10),C=b+(R^M&(_^R))+T[1]+4129170786&4294967295,b=_+(C<<5&4294967295|C>>>27),C=M+(_^R&(b^_))+T[6]+3225465664&4294967295,M=b+(C<<9&4294967295|C>>>23),C=R+(b^_&(M^b))+T[11]+643717713&4294967295,R=M+(C<<14&4294967295|C>>>18),C=_+(M^b&(R^M))+T[0]+3921069994&4294967295,_=R+(C<<20&4294967295|C>>>12),C=b+(R^M&(_^R))+T[5]+3593408605&4294967295,b=_+(C<<5&4294967295|C>>>27),C=M+(_^R&(b^_))+T[10]+38016083&4294967295,M=b+(C<<9&4294967295|C>>>23),C=R+(b^_&(M^b))+T[15]+3634488961&4294967295,R=M+(C<<14&4294967295|C>>>18),C=_+(M^b&(R^M))+T[4]+3889429448&4294967295,_=R+(C<<20&4294967295|C>>>12),C=b+(R^M&(_^R))+T[9]+568446438&4294967295,b=_+(C<<5&4294967295|C>>>27),C=M+(_^R&(b^_))+T[14]+3275163606&4294967295,M=b+(C<<9&4294967295|C>>>23),C=R+(b^_&(M^b))+T[3]+4107603335&4294967295,R=M+(C<<14&4294967295|C>>>18),C=_+(M^b&(R^M))+T[8]+1163531501&4294967295,_=R+(C<<20&4294967295|C>>>12),C=b+(R^M&(_^R))+T[13]+2850285829&4294967295,b=_+(C<<5&4294967295|C>>>27),C=M+(_^R&(b^_))+T[2]+4243563512&4294967295,M=b+(C<<9&4294967295|C>>>23),C=R+(b^_&(M^b))+T[7]+1735328473&4294967295,R=M+(C<<14&4294967295|C>>>18),C=_+(M^b&(R^M))+T[12]+2368359562&4294967295,_=R+(C<<20&4294967295|C>>>12),C=b+(_^R^M)+T[5]+4294588738&4294967295,b=_+(C<<4&4294967295|C>>>28),C=M+(b^_^R)+T[8]+2272392833&4294967295,M=b+(C<<11&4294967295|C>>>21),C=R+(M^b^_)+T[11]+1839030562&4294967295,R=M+(C<<16&4294967295|C>>>16),C=_+(R^M^b)+T[14]+4259657740&4294967295,_=R+(C<<23&4294967295|C>>>9),C=b+(_^R^M)+T[1]+2763975236&4294967295,b=_+(C<<4&4294967295|C>>>28),C=M+(b^_^R)+T[4]+1272893353&4294967295,M=b+(C<<11&4294967295|C>>>21),C=R+(M^b^_)+T[7]+4139469664&4294967295,R=M+(C<<16&4294967295|C>>>16),C=_+(R^M^b)+T[10]+3200236656&4294967295,_=R+(C<<23&4294967295|C>>>9),C=b+(_^R^M)+T[13]+681279174&4294967295,b=_+(C<<4&4294967295|C>>>28),C=M+(b^_^R)+T[0]+3936430074&4294967295,M=b+(C<<11&4294967295|C>>>21),C=R+(M^b^_)+T[3]+3572445317&4294967295,R=M+(C<<16&4294967295|C>>>16),C=_+(R^M^b)+T[6]+76029189&4294967295,_=R+(C<<23&4294967295|C>>>9),C=b+(_^R^M)+T[9]+3654602809&4294967295,b=_+(C<<4&4294967295|C>>>28),C=M+(b^_^R)+T[12]+3873151461&4294967295,M=b+(C<<11&4294967295|C>>>21),C=R+(M^b^_)+T[15]+530742520&4294967295,R=M+(C<<16&4294967295|C>>>16),C=_+(R^M^b)+T[2]+3299628645&4294967295,_=R+(C<<23&4294967295|C>>>9),C=b+(R^(_|~M))+T[0]+4096336452&4294967295,b=_+(C<<6&4294967295|C>>>26),C=M+(_^(b|~R))+T[7]+1126891415&4294967295,M=b+(C<<10&4294967295|C>>>22),C=R+(b^(M|~_))+T[14]+2878612391&4294967295,R=M+(C<<15&4294967295|C>>>17),C=_+(M^(R|~b))+T[5]+4237533241&4294967295,_=R+(C<<21&4294967295|C>>>11),C=b+(R^(_|~M))+T[12]+1700485571&4294967295,b=_+(C<<6&4294967295|C>>>26),C=M+(_^(b|~R))+T[3]+2399980690&4294967295,M=b+(C<<10&4294967295|C>>>22),C=R+(b^(M|~_))+T[10]+4293915773&4294967295,R=M+(C<<15&4294967295|C>>>17),C=_+(M^(R|~b))+T[1]+2240044497&4294967295,_=R+(C<<21&4294967295|C>>>11),C=b+(R^(_|~M))+T[8]+1873313359&4294967295,b=_+(C<<6&4294967295|C>>>26),C=M+(_^(b|~R))+T[15]+4264355552&4294967295,M=b+(C<<10&4294967295|C>>>22),C=R+(b^(M|~_))+T[6]+2734768916&4294967295,R=M+(C<<15&4294967295|C>>>17),C=_+(M^(R|~b))+T[13]+1309151649&4294967295,_=R+(C<<21&4294967295|C>>>11),C=b+(R^(_|~M))+T[4]+4149444226&4294967295,b=_+(C<<6&4294967295|C>>>26),C=M+(_^(b|~R))+T[11]+3174756917&4294967295,M=b+(C<<10&4294967295|C>>>22),C=R+(b^(M|~_))+T[2]+718787259&4294967295,R=M+(C<<15&4294967295|C>>>17),C=_+(M^(R|~b))+T[9]+3951481745&4294967295,w.g[0]=w.g[0]+b&4294967295,w.g[1]=w.g[1]+(R+(C<<21&4294967295|C>>>11))&4294967295,w.g[2]=w.g[2]+R&4294967295,w.g[3]=w.g[3]+M&4294967295}n.prototype.v=function(w,b){b===void 0&&(b=w.length);const _=b-this.blockSize,T=this.C;let R=this.h,M=0;for(;M<b;){if(R==0)for(;M<=_;)r(this,w,M),M+=this.blockSize;if(typeof w=="string"){for(;M<b;)if(T[R++]=w.charCodeAt(M++),R==this.blockSize){r(this,T),R=0;break}}else for(;M<b;)if(T[R++]=w[M++],R==this.blockSize){r(this,T),R=0;break}}this.h=R,this.o+=b},n.prototype.A=function(){var w=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);w[0]=128;for(var b=1;b<w.length-8;++b)w[b]=0;b=this.o*8;for(var _=w.length-8;_<w.length;++_)w[_]=b&255,b/=256;for(this.v(w),w=Array(16),b=0,_=0;_<4;++_)for(let T=0;T<32;T+=8)w[b++]=this.g[_]>>>T&255;return w};function o(w,b){var _=l;return Object.prototype.hasOwnProperty.call(_,w)?_[w]:_[w]=b(w)}function a(w,b){this.h=b;const _=[];let T=!0;for(let R=w.length-1;R>=0;R--){const M=w[R]|0;T&&M==b||(_[R]=M,T=!1)}this.g=_}var l={};function u(w){return-128<=w&&w<128?o(w,function(b){return new a([b|0],b<0?-1:0)}):new a([w|0],w<0?-1:0)}function d(w){if(isNaN(w)||!isFinite(w))return p;if(w<0)return S(d(-w));const b=[];let _=1;for(let T=0;w>=_;T++)b[T]=w/_|0,_*=4294967296;return new a(b,0)}function f(w,b){if(w.length==0)throw Error("number format error: empty string");if(b=b||10,b<2||36<b)throw Error("radix out of range: "+b);if(w.charAt(0)=="-")return S(f(w.substring(1),b));if(w.indexOf("-")>=0)throw Error('number format error: interior "-" character');const _=d(Math.pow(b,8));let T=p;for(let M=0;M<w.length;M+=8){var R=Math.min(8,w.length-M);const C=parseInt(w.substring(M,M+R),b);R<8?(R=d(Math.pow(b,R)),T=T.j(R).add(d(C))):(T=T.j(_),T=T.add(d(C)))}return T}var p=u(0),g=u(1),v=u(16777216);t=a.prototype,t.m=function(){if(k(this))return-S(this).m();let w=0,b=1;for(let _=0;_<this.g.length;_++){const T=this.i(_);w+=(T>=0?T:4294967296+T)*b,b*=4294967296}return w},t.toString=function(w){if(w=w||10,w<2||36<w)throw Error("radix out of range: "+w);if(A(this))return"0";if(k(this))return"-"+S(this).toString(w);const b=d(Math.pow(w,6));var _=this;let T="";for(;;){const R=F(_,b).g;_=L(_,R.j(b));let M=((_.g.length>0?_.g[0]:_.h)>>>0).toString(w);if(_=R,A(_))return M+T;for(;M.length<6;)M="0"+M;T=M+T}},t.i=function(w){return w<0?0:w<this.g.length?this.g[w]:this.h};function A(w){if(w.h!=0)return!1;for(let b=0;b<w.g.length;b++)if(w.g[b]!=0)return!1;return!0}function k(w){return w.h==-1}t.l=function(w){return w=L(this,w),k(w)?-1:A(w)?0:1};function S(w){const b=w.g.length,_=[];for(let T=0;T<b;T++)_[T]=~w.g[T];return new a(_,~w.h).add(g)}t.abs=function(){return k(this)?S(this):this},t.add=function(w){const b=Math.max(this.g.length,w.g.length),_=[];let T=0;for(let R=0;R<=b;R++){let M=T+(this.i(R)&65535)+(w.i(R)&65535),C=(M>>>16)+(this.i(R)>>>16)+(w.i(R)>>>16);T=C>>>16,M&=65535,C&=65535,_[R]=C<<16|M}return new a(_,_[_.length-1]&-2147483648?-1:0)};function L(w,b){return w.add(S(b))}t.j=function(w){if(A(this)||A(w))return p;if(k(this))return k(w)?S(this).j(S(w)):S(S(this).j(w));if(k(w))return S(this.j(S(w)));if(this.l(v)<0&&w.l(v)<0)return d(this.m()*w.m());const b=this.g.length+w.g.length,_=[];for(var T=0;T<2*b;T++)_[T]=0;for(T=0;T<this.g.length;T++)for(let R=0;R<w.g.length;R++){const M=this.i(T)>>>16,C=this.i(T)&65535,ge=w.i(R)>>>16,_e=w.i(R)&65535;_[2*T+2*R]+=C*_e,D(_,2*T+2*R),_[2*T+2*R+1]+=M*_e,D(_,2*T+2*R+1),_[2*T+2*R+1]+=C*ge,D(_,2*T+2*R+1),_[2*T+2*R+2]+=M*ge,D(_,2*T+2*R+2)}for(w=0;w<b;w++)_[w]=_[2*w+1]<<16|_[2*w];for(w=b;w<2*b;w++)_[w]=0;return new a(_,0)};function D(w,b){for(;(w[b]&65535)!=w[b];)w[b+1]+=w[b]>>>16,w[b]&=65535,b++}function j(w,b){this.g=w,this.h=b}function F(w,b){if(A(b))throw Error("division by zero");if(A(w))return new j(p,p);if(k(w))return b=F(S(w),b),new j(S(b.g),S(b.h));if(k(b))return b=F(w,S(b)),new j(S(b.g),b.h);if(w.g.length>30){if(k(w)||k(b))throw Error("slowDivide_ only works with positive integers.");for(var _=g,T=b;T.l(w)<=0;)_=q(_),T=q(T);var R=E(_,1),M=E(T,1);for(T=E(T,2),_=E(_,2);!A(T);){var C=M.add(T);C.l(w)<=0&&(R=R.add(_),M=C),T=E(T,1),_=E(_,1)}return b=L(w,R.j(b)),new j(R,b)}for(R=p;w.l(b)>=0;){for(_=Math.max(1,Math.floor(w.m()/b.m())),T=Math.ceil(Math.log(_)/Math.LN2),T=T<=48?1:Math.pow(2,T-48),M=d(_),C=M.j(b);k(C)||C.l(w)>0;)_-=T,M=d(_),C=M.j(b);A(M)&&(M=g),R=R.add(M),w=L(w,C)}return new j(R,w)}t.B=function(w){return F(this,w).h},t.and=function(w){const b=Math.max(this.g.length,w.g.length),_=[];for(let T=0;T<b;T++)_[T]=this.i(T)&w.i(T);return new a(_,this.h&w.h)},t.or=function(w){const b=Math.max(this.g.length,w.g.length),_=[];for(let T=0;T<b;T++)_[T]=this.i(T)|w.i(T);return new a(_,this.h|w.h)},t.xor=function(w){const b=Math.max(this.g.length,w.g.length),_=[];for(let T=0;T<b;T++)_[T]=this.i(T)^w.i(T);return new a(_,this.h^w.h)};function q(w){const b=w.g.length+1,_=[];for(let T=0;T<b;T++)_[T]=w.i(T)<<1|w.i(T-1)>>>31;return new a(_,w.h)}function E(w,b){const _=b>>5;b%=32;const T=w.g.length-_,R=[];for(let M=0;M<T;M++)R[M]=b>0?w.i(M+_)>>>b|w.i(M+_+1)<<32-b:w.i(M+_);return new a(R,w.h)}n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,mp=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,In=a}).apply(typeof ju<"u"?ju:typeof self<"u"?self:typeof window<"u"?window:{});var po=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var fp,ui,pp,Co,Ml,gp,xp,yp;(function(){var t,e=Object.defineProperty;function s(m){m=[typeof globalThis=="object"&&globalThis,m,typeof window=="object"&&window,typeof self=="object"&&self,typeof po=="object"&&po];for(var x=0;x<m.length;++x){var y=m[x];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var n=s(this);function r(m,x){if(x)e:{var y=n;m=m.split(".");for(var N=0;N<m.length-1;N++){var G=m[N];if(!(G in y))break e;y=y[G]}m=m[m.length-1],N=y[m],x=x(N),x!=N&&x!=null&&e(y,m,{configurable:!0,writable:!0,value:x})}}r("Symbol.dispose",function(m){return m||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(m){return m||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(m){return m||function(x){var y=[],N;for(N in x)Object.prototype.hasOwnProperty.call(x,N)&&y.push([N,x[N]]);return y}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(m){var x=typeof m;return x=="object"&&m!=null||x=="function"}function u(m,x,y){return m.call.apply(m.bind,arguments)}function d(m,x,y){return d=u,d.apply(null,arguments)}function f(m,x){var y=Array.prototype.slice.call(arguments,1);return function(){var N=y.slice();return N.push.apply(N,arguments),m.apply(this,N)}}function p(m,x){function y(){}y.prototype=x.prototype,m.Z=x.prototype,m.prototype=new y,m.prototype.constructor=m,m.Ob=function(N,G,J){for(var ae=Array(arguments.length-2),Me=2;Me<arguments.length;Me++)ae[Me-2]=arguments[Me];return x.prototype[G].apply(N,ae)}}var g=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?m=>m&&AsyncContext.Snapshot.wrap(m):m=>m;function v(m){const x=m.length;if(x>0){const y=Array(x);for(let N=0;N<x;N++)y[N]=m[N];return y}return[]}function A(m,x){for(let N=1;N<arguments.length;N++){const G=arguments[N];var y=typeof G;if(y=y!="object"?y:G?Array.isArray(G)?"array":y:"null",y=="array"||y=="object"&&typeof G.length=="number"){y=m.length||0;const J=G.length||0;m.length=y+J;for(let ae=0;ae<J;ae++)m[y+ae]=G[ae]}else m.push(G)}}class k{constructor(x,y){this.i=x,this.j=y,this.h=0,this.g=null}get(){let x;return this.h>0?(this.h--,x=this.g,this.g=x.next,x.next=null):x=this.i(),x}}function S(m){a.setTimeout(()=>{throw m},0)}function L(){var m=w;let x=null;return m.g&&(x=m.g,m.g=m.g.next,m.g||(m.h=null),x.next=null),x}class D{constructor(){this.h=this.g=null}add(x,y){const N=j.get();N.set(x,y),this.h?this.h.next=N:this.g=N,this.h=N}}var j=new k(()=>new F,m=>m.reset());class F{constructor(){this.next=this.g=this.h=null}set(x,y){this.h=x,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let q,E=!1,w=new D,b=()=>{const m=Promise.resolve(void 0);q=()=>{m.then(_)}};function _(){for(var m;m=L();){try{m.h.call(m.g)}catch(y){S(y)}var x=j;x.j(m),x.h<100&&(x.h++,m.next=x.g,x.g=m)}E=!1}function T(){this.u=this.u,this.C=this.C}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function R(m,x){this.type=m,this.g=this.target=x,this.defaultPrevented=!1}R.prototype.h=function(){this.defaultPrevented=!0};var M=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var m=!1,x=Object.defineProperty({},"passive",{get:function(){m=!0}});try{const y=()=>{};a.addEventListener("test",y,x),a.removeEventListener("test",y,x)}catch{}return m}();function C(m){return/^[\s\xa0]*$/.test(m)}function ge(m,x){R.call(this,m?m.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,m&&this.init(m,x)}p(ge,R),ge.prototype.init=function(m,x){const y=this.type=m.type,N=m.changedTouches&&m.changedTouches.length?m.changedTouches[0]:null;this.target=m.target||m.srcElement,this.g=x,x=m.relatedTarget,x||(y=="mouseover"?x=m.fromElement:y=="mouseout"&&(x=m.toElement)),this.relatedTarget=x,N?(this.clientX=N.clientX!==void 0?N.clientX:N.pageX,this.clientY=N.clientY!==void 0?N.clientY:N.pageY,this.screenX=N.screenX||0,this.screenY=N.screenY||0):(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0),this.button=m.button,this.key=m.key||"",this.ctrlKey=m.ctrlKey,this.altKey=m.altKey,this.shiftKey=m.shiftKey,this.metaKey=m.metaKey,this.pointerId=m.pointerId||0,this.pointerType=m.pointerType,this.state=m.state,this.i=m,m.defaultPrevented&&ge.Z.h.call(this)},ge.prototype.h=function(){ge.Z.h.call(this);const m=this.i;m.preventDefault?m.preventDefault():m.returnValue=!1};var _e="closure_listenable_"+(Math.random()*1e6|0),P=0;function Z(m,x,y,N,G){this.listener=m,this.proxy=null,this.src=x,this.type=y,this.capture=!!N,this.ha=G,this.key=++P,this.da=this.fa=!1}function B(m){m.da=!0,m.listener=null,m.proxy=null,m.src=null,m.ha=null}function $(m,x,y){for(const N in m)x.call(y,m[N],N,m)}function U(m,x){for(const y in m)x.call(void 0,m[y],y,m)}function te(m){const x={};for(const y in m)x[y]=m[y];return x}const re="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ie(m,x){let y,N;for(let G=1;G<arguments.length;G++){N=arguments[G];for(y in N)m[y]=N[y];for(let J=0;J<re.length;J++)y=re[J],Object.prototype.hasOwnProperty.call(N,y)&&(m[y]=N[y])}}function K(m){this.src=m,this.g={},this.h=0}K.prototype.add=function(m,x,y,N,G){const J=m.toString();m=this.g[J],m||(m=this.g[J]=[],this.h++);const ae=z(m,x,N,G);return ae>-1?(x=m[ae],y||(x.fa=!1)):(x=new Z(x,this.src,J,!!N,G),x.fa=y,m.push(x)),x};function ve(m,x){const y=x.type;if(y in m.g){var N=m.g[y],G=Array.prototype.indexOf.call(N,x,void 0),J;(J=G>=0)&&Array.prototype.splice.call(N,G,1),J&&(B(x),m.g[y].length==0&&(delete m.g[y],m.h--))}}function z(m,x,y,N){for(let G=0;G<m.length;++G){const J=m[G];if(!J.da&&J.listener==x&&J.capture==!!y&&J.ha==N)return G}return-1}var se="closure_lm_"+(Math.random()*1e6|0),le={};function be(m,x,y,N,G){if(Array.isArray(x)){for(let J=0;J<x.length;J++)be(m,x[J],y,N,G);return null}return y=H(y),m&&m[_e]?m.J(x,y,l(N)?!!N.capture:!1,G):qe(m,x,y,!1,N,G)}function qe(m,x,y,N,G,J){if(!x)throw Error("Invalid event type");const ae=l(G)?!!G.capture:!!G;let Me=mt(m);if(Me||(m[se]=Me=new K(m)),y=Me.add(x,y,N,ae,J),y.proxy)return y;if(N=Le(),y.proxy=N,N.src=m,N.listener=y,m.addEventListener)M||(G=ae),G===void 0&&(G=!1),m.addEventListener(x.toString(),N,G);else if(m.attachEvent)m.attachEvent(Fe(x.toString()),N);else if(m.addListener&&m.removeListener)m.addListener(N);else throw Error("addEventListener and attachEvent are unavailable.");return y}function Le(){function m(y){return x.call(m.src,m.listener,y)}const x=Je;return m}function ee(m,x,y,N,G){if(Array.isArray(x))for(var J=0;J<x.length;J++)ee(m,x[J],y,N,G);else N=l(N)?!!N.capture:!!N,y=H(y),m&&m[_e]?(m=m.i,J=String(x).toString(),J in m.g&&(x=m.g[J],y=z(x,y,N,G),y>-1&&(B(x[y]),Array.prototype.splice.call(x,y,1),x.length==0&&(delete m.g[J],m.h--)))):m&&(m=mt(m))&&(x=m.g[x.toString()],m=-1,x&&(m=z(x,y,N,G)),(y=m>-1?x[m]:null)&&xe(y))}function xe(m){if(typeof m!="number"&&m&&!m.da){var x=m.src;if(x&&x[_e])ve(x.i,m);else{var y=m.type,N=m.proxy;x.removeEventListener?x.removeEventListener(y,N,m.capture):x.detachEvent?x.detachEvent(Fe(y),N):x.addListener&&x.removeListener&&x.removeListener(N),(y=mt(x))?(ve(y,m),y.h==0&&(y.src=null,x[se]=null)):B(m)}}}function Fe(m){return m in le?le[m]:le[m]="on"+m}function Je(m,x){if(m.da)m=!0;else{x=new ge(x,this);const y=m.listener,N=m.ha||m.src;m.fa&&xe(m),m=y.call(N,x)}return m}function mt(m){return m=m[se],m instanceof K?m:null}var ft="__closure_events_fn_"+(Math.random()*1e9>>>0);function H(m){return typeof m=="function"?m:(m[ft]||(m[ft]=function(x){return m.handleEvent(x)}),m[ft])}function ce(){T.call(this),this.i=new K(this),this.M=this,this.G=null}p(ce,T),ce.prototype[_e]=!0,ce.prototype.removeEventListener=function(m,x,y,N){ee(this,m,x,y,N)};function de(m,x){var y,N=m.G;if(N)for(y=[];N;N=N.G)y.push(N);if(m=m.M,N=x.type||x,typeof x=="string")x=new R(x,m);else if(x instanceof R)x.target=x.target||m;else{var G=x;x=new R(N,m),ie(x,G)}G=!0;let J,ae;if(y)for(ae=y.length-1;ae>=0;ae--)J=x.g=y[ae],G=Ue(J,N,!0,x)&&G;if(J=x.g=m,G=Ue(J,N,!0,x)&&G,G=Ue(J,N,!1,x)&&G,y)for(ae=0;ae<y.length;ae++)J=x.g=y[ae],G=Ue(J,N,!1,x)&&G}ce.prototype.N=function(){if(ce.Z.N.call(this),this.i){var m=this.i;for(const x in m.g){const y=m.g[x];for(let N=0;N<y.length;N++)B(y[N]);delete m.g[x],m.h--}}this.G=null},ce.prototype.J=function(m,x,y,N){return this.i.add(String(m),x,!1,y,N)},ce.prototype.K=function(m,x,y,N){return this.i.add(String(m),x,!0,y,N)};function Ue(m,x,y,N){if(x=m.i.g[String(x)],!x)return!0;x=x.concat();let G=!0;for(let J=0;J<x.length;++J){const ae=x[J];if(ae&&!ae.da&&ae.capture==y){const Me=ae.listener,At=ae.ha||ae.src;ae.fa&&ve(m.i,ae),G=Me.call(At,N)!==!1&&G}}return G&&!N.defaultPrevented}function pt(m,x){if(typeof m!="function")if(m&&typeof m.handleEvent=="function")m=d(m.handleEvent,m);else throw Error("Invalid listener argument");return Number(x)>2147483647?-1:a.setTimeout(m,x||0)}function Ve(m){m.g=pt(()=>{m.g=null,m.i&&(m.i=!1,Ve(m))},m.l);const x=m.h;m.h=null,m.m.apply(null,x)}class Et extends T{constructor(x,y){super(),this.m=x,this.l=y,this.h=null,this.i=!1,this.g=null}j(x){this.h=arguments,this.g?this.i=!0:Ve(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Y(m){T.call(this),this.h=m,this.g={}}p(Y,T);var fe=[];function ye(m){$(m.g,function(x,y){this.g.hasOwnProperty(y)&&xe(x)},m),m.g={}}Y.prototype.N=function(){Y.Z.N.call(this),ye(this)},Y.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var De=a.JSON.stringify,Ae=a.JSON.parse,He=class{stringify(m){return a.JSON.stringify(m,void 0)}parse(m){return a.JSON.parse(m,void 0)}};function Ge(){}function Ze(){}var it={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function V(){R.call(this,"d")}p(V,R);function W(){R.call(this,"c")}p(W,R);var oe={},Te=null;function ot(){return Te=Te||new ce}oe.Ia="serverreachability";function Ke(m){R.call(this,oe.Ia,m)}p(Ke,R);function at(m){const x=ot();de(x,new Ke(x))}oe.STAT_EVENT="statevent";function Qe(m,x){R.call(this,oe.STAT_EVENT,m),this.stat=x}p(Qe,R);function dt(m){const x=ot();de(x,new Qe(x,m))}oe.Ja="timingevent";function ls(m,x){R.call(this,oe.Ja,m),this.size=x}p(ls,R);function Ot(m,x){if(typeof m!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){m()},x)}function et(){this.g=!0}et.prototype.ua=function(){this.g=!1};function O(m,x,y,N,G,J){m.info(function(){if(m.g)if(J){var ae="",Me=J.split("&");for(let lt=0;lt<Me.length;lt++){var At=Me[lt].split("=");if(At.length>1){const Dt=At[0];At=At[1];const Cs=Dt.split("_");ae=Cs.length>=2&&Cs[1]=="type"?ae+(Dt+"="+At+"&"):ae+(Dt+"=redacted&")}}}else ae=null;else ae=J;return"XMLHTTP REQ ("+N+") [attempt "+G+"]: "+x+`
`+y+`
`+ae})}function ne(m,x,y,N,G,J,ae){m.info(function(){return"XMLHTTP RESP ("+N+") [ attempt "+G+"]: "+x+`
`+y+`
`+J+" "+ae})}function Se(m,x,y,N){m.info(function(){return"XMLHTTP TEXT ("+x+"): "+tt(m,y)+(N?" "+N:"")})}function je(m,x){m.info(function(){return"TIMEOUT: "+x})}et.prototype.info=function(){};function tt(m,x){if(!m.g)return x;if(!x)return null;try{const J=JSON.parse(x);if(J){for(m=0;m<J.length;m++)if(Array.isArray(J[m])){var y=J[m];if(!(y.length<2)){var N=y[1];if(Array.isArray(N)&&!(N.length<1)){var G=N[0];if(G!="noop"&&G!="stop"&&G!="close")for(let ae=1;ae<N.length;ae++)N[ae]=""}}}}return De(J)}catch{return x}}var $e={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},zn={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},jd;function el(){}p(el,Ge),el.prototype.g=function(){return new XMLHttpRequest},jd=new el;function Yr(m){return encodeURIComponent(String(m))}function k0(m){var x=1;m=m.split(":");const y=[];for(;x>0&&m.length;)y.push(m.shift()),x--;return m.length&&y.push(m.join(":")),y}function un(m,x,y,N){this.j=m,this.i=x,this.l=y,this.S=N||1,this.V=new Y(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new kd}function kd(){this.i=null,this.g="",this.h=!1}var Dd={},tl={};function sl(m,x,y){m.M=1,m.A=oo(Is(x)),m.u=y,m.R=!0,Md(m,null)}function Md(m,x){m.F=Date.now(),io(m),m.B=Is(m.A);var y=m.B,N=m.S;Array.isArray(N)||(N=[String(N)]),Jd(y.i,"t",N),m.C=0,y=m.j.L,m.h=new kd,m.g=hu(m.j,y?x:null,!m.u),m.P>0&&(m.O=new Et(d(m.Y,m,m.g),m.P)),x=m.V,y=m.g,N=m.ba;var G="readystatechange";Array.isArray(G)||(G&&(fe[0]=G.toString()),G=fe);for(let J=0;J<G.length;J++){const ae=be(y,G[J],N||x.handleEvent,!1,x.h||x);if(!ae)break;x.g[ae.key]=ae}x=m.J?te(m.J):{},m.u?(m.v||(m.v="POST"),x["Content-Type"]="application/x-www-form-urlencoded",m.g.ea(m.B,m.v,m.u,x)):(m.v="GET",m.g.ea(m.B,m.v,null,x)),at(),O(m.i,m.v,m.B,m.l,m.S,m.u)}un.prototype.ba=function(m){m=m.target;const x=this.O;x&&fn(m)==3?x.j():this.Y(m)},un.prototype.Y=function(m){try{if(m==this.g)e:{const Me=fn(this.g),At=this.g.ya(),lt=this.g.ca();if(!(Me<3)&&(Me!=3||this.g&&(this.h.h||this.g.la()||tu(this.g)))){this.K||Me!=4||At==7||(At==8||lt<=0?at(3):at(2)),nl(this);var x=this.g.ca();this.X=x;var y=D0(this);if(this.o=x==200,ne(this.i,this.v,this.B,this.l,this.S,Me,x),this.o){if(this.U&&!this.L){t:{if(this.g){var N,G=this.g;if((N=G.g?G.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(N)){var J=N;break t}}J=null}if(m=J)Se(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,rl(this,m);else{this.o=!1,this.m=3,dt(12),Bn(this),Xr(this);break e}}if(this.R){m=!0;let Dt;for(;!this.K&&this.C<y.length;)if(Dt=M0(this,y),Dt==tl){Me==4&&(this.m=4,dt(14),m=!1),Se(this.i,this.l,null,"[Incomplete Response]");break}else if(Dt==Dd){this.m=4,dt(15),Se(this.i,this.l,y,"[Invalid Chunk]"),m=!1;break}else Se(this.i,this.l,Dt,null),rl(this,Dt);if(Ld(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Me!=4||y.length!=0||this.h.h||(this.m=1,dt(16),m=!1),this.o=this.o&&m,!m)Se(this.i,this.l,y,"[Invalid Chunked Response]"),Bn(this),Xr(this);else if(y.length>0&&!this.W){this.W=!0;var ae=this.j;ae.g==this&&ae.aa&&!ae.P&&(ae.j.info("Great, no buffering proxy detected. Bytes received: "+y.length),hl(ae),ae.P=!0,dt(11))}}else Se(this.i,this.l,y,null),rl(this,y);Me==4&&Bn(this),this.o&&!this.K&&(Me==4?lu(this.j,this):(this.o=!1,io(this)))}else K0(this.g),x==400&&y.indexOf("Unknown SID")>0?(this.m=3,dt(12)):(this.m=0,dt(13)),Bn(this),Xr(this)}}}catch{}finally{}};function D0(m){if(!Ld(m))return m.g.la();const x=tu(m.g);if(x==="")return"";let y="";const N=x.length,G=fn(m.g)==4;if(!m.h.i){if(typeof TextDecoder>"u")return Bn(m),Xr(m),"";m.h.i=new a.TextDecoder}for(let J=0;J<N;J++)m.h.h=!0,y+=m.h.i.decode(x[J],{stream:!(G&&J==N-1)});return x.length=0,m.h.g+=y,m.C=0,m.h.g}function Ld(m){return m.g?m.v=="GET"&&m.M!=2&&m.j.Aa:!1}function M0(m,x){var y=m.C,N=x.indexOf(`
`,y);return N==-1?tl:(y=Number(x.substring(y,N)),isNaN(y)?Dd:(N+=1,N+y>x.length?tl:(x=x.slice(N,N+y),m.C=N+y,x)))}un.prototype.cancel=function(){this.K=!0,Bn(this)};function io(m){m.T=Date.now()+m.H,Vd(m,m.H)}function Vd(m,x){if(m.D!=null)throw Error("WatchDog timer not null");m.D=Ot(d(m.aa,m),x)}function nl(m){m.D&&(a.clearTimeout(m.D),m.D=null)}un.prototype.aa=function(){this.D=null;const m=Date.now();m-this.T>=0?(je(this.i,this.B),this.M!=2&&(at(),dt(17)),Bn(this),this.m=2,Xr(this)):Vd(this,this.T-m)};function Xr(m){m.j.I==0||m.K||lu(m.j,m)}function Bn(m){nl(m);var x=m.O;x&&typeof x.dispose=="function"&&x.dispose(),m.O=null,ye(m.V),m.g&&(x=m.g,m.g=null,x.abort(),x.dispose())}function rl(m,x){try{var y=m.j;if(y.I!=0&&(y.g==m||il(y.h,m))){if(!m.L&&il(y.h,m)&&y.I==3){try{var N=y.Ba.g.parse(x)}catch{N=null}if(Array.isArray(N)&&N.length==3){var G=N;if(G[0]==0){e:if(!y.v){if(y.g)if(y.g.F+3e3<m.F)ho(y),co(y);else break e;ul(y),dt(18)}}else y.xa=G[1],0<y.xa-y.K&&G[2]<37500&&y.F&&y.A==0&&!y.C&&(y.C=Ot(d(y.Va,y),6e3));Od(y.h)<=1&&y.ta&&(y.ta=void 0)}else Gn(y,11)}else if((m.L||y.g==m)&&ho(y),!C(x))for(G=y.Ba.g.parse(x),x=0;x<G.length;x++){let lt=G[x];const Dt=lt[0];if(!(Dt<=y.K))if(y.K=Dt,lt=lt[1],y.I==2)if(lt[0]=="c"){y.M=lt[1],y.ba=lt[2];const Cs=lt[3];Cs!=null&&(y.ka=Cs,y.j.info("VER="+y.ka));const $n=lt[4];$n!=null&&(y.za=$n,y.j.info("SVER="+y.za));const pn=lt[5];pn!=null&&typeof pn=="number"&&pn>0&&(N=1.5*pn,y.O=N,y.j.info("backChannelRequestTimeoutMs_="+N)),N=y;const gn=m.g;if(gn){const fo=gn.g?gn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(fo){var J=N.h;J.g||fo.indexOf("spdy")==-1&&fo.indexOf("quic")==-1&&fo.indexOf("h2")==-1||(J.j=J.l,J.g=new Set,J.h&&(ol(J,J.h),J.h=null))}if(N.G){const ml=gn.g?gn.g.getResponseHeader("X-HTTP-Session-Id"):null;ml&&(N.wa=ml,ut(N.J,N.G,ml))}}y.I=3,y.l&&y.l.ra(),y.aa&&(y.T=Date.now()-m.F,y.j.info("Handshake RTT: "+y.T+"ms")),N=y;var ae=m;if(N.na=uu(N,N.L?N.ba:null,N.W),ae.L){zd(N.h,ae);var Me=ae,At=N.O;At&&(Me.H=At),Me.D&&(nl(Me),io(Me)),N.g=ae}else ou(N);y.i.length>0&&uo(y)}else lt[0]!="stop"&&lt[0]!="close"||Gn(y,7);else y.I==3&&(lt[0]=="stop"||lt[0]=="close"?lt[0]=="stop"?Gn(y,7):dl(y):lt[0]!="noop"&&y.l&&y.l.qa(lt),y.A=0)}}at(4)}catch{}}var L0=class{constructor(m,x){this.g=m,this.map=x}};function Ud(m){this.l=m||10,a.PerformanceNavigationTiming?(m=a.performance.getEntriesByType("navigation"),m=m.length>0&&(m[0].nextHopProtocol=="hq"||m[0].nextHopProtocol=="h2")):m=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=m?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Fd(m){return m.h?!0:m.g?m.g.size>=m.j:!1}function Od(m){return m.h?1:m.g?m.g.size:0}function il(m,x){return m.h?m.h==x:m.g?m.g.has(x):!1}function ol(m,x){m.g?m.g.add(x):m.h=x}function zd(m,x){m.h&&m.h==x?m.h=null:m.g&&m.g.has(x)&&m.g.delete(x)}Ud.prototype.cancel=function(){if(this.i=Bd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const m of this.g.values())m.cancel();this.g.clear()}};function Bd(m){if(m.h!=null)return m.i.concat(m.h.G);if(m.g!=null&&m.g.size!==0){let x=m.i;for(const y of m.g.values())x=x.concat(y.G);return x}return v(m.i)}var qd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function V0(m,x){if(m){m=m.split("&");for(let y=0;y<m.length;y++){const N=m[y].indexOf("=");let G,J=null;N>=0?(G=m[y].substring(0,N),J=m[y].substring(N+1)):G=m[y],x(G,J?decodeURIComponent(J.replace(/\+/g," ")):"")}}}function hn(m){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let x;m instanceof hn?(this.l=m.l,Qr(this,m.j),this.o=m.o,this.g=m.g,Zr(this,m.u),this.h=m.h,al(this,Kd(m.i)),this.m=m.m):m&&(x=String(m).match(qd))?(this.l=!1,Qr(this,x[1]||"",!0),this.o=ei(x[2]||""),this.g=ei(x[3]||"",!0),Zr(this,x[4]),this.h=ei(x[5]||"",!0),al(this,x[6]||"",!0),this.m=ei(x[7]||"")):(this.l=!1,this.i=new si(null,this.l))}hn.prototype.toString=function(){const m=[];var x=this.j;x&&m.push(ti(x,Gd,!0),":");var y=this.g;return(y||x=="file")&&(m.push("//"),(x=this.o)&&m.push(ti(x,Gd,!0),"@"),m.push(Yr(y).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.u,y!=null&&m.push(":",String(y))),(y=this.h)&&(this.g&&y.charAt(0)!="/"&&m.push("/"),m.push(ti(y,y.charAt(0)=="/"?O0:F0,!0))),(y=this.i.toString())&&m.push("?",y),(y=this.m)&&m.push("#",ti(y,B0)),m.join("")},hn.prototype.resolve=function(m){const x=Is(this);let y=!!m.j;y?Qr(x,m.j):y=!!m.o,y?x.o=m.o:y=!!m.g,y?x.g=m.g:y=m.u!=null;var N=m.h;if(y)Zr(x,m.u);else if(y=!!m.h){if(N.charAt(0)!="/")if(this.g&&!this.h)N="/"+N;else{var G=x.h.lastIndexOf("/");G!=-1&&(N=x.h.slice(0,G+1)+N)}if(G=N,G==".."||G==".")N="";else if(G.indexOf("./")!=-1||G.indexOf("/.")!=-1){N=G.lastIndexOf("/",0)==0,G=G.split("/");const J=[];for(let ae=0;ae<G.length;){const Me=G[ae++];Me=="."?N&&ae==G.length&&J.push(""):Me==".."?((J.length>1||J.length==1&&J[0]!="")&&J.pop(),N&&ae==G.length&&J.push("")):(J.push(Me),N=!0)}N=J.join("/")}else N=G}return y?x.h=N:y=m.i.toString()!=="",y?al(x,Kd(m.i)):y=!!m.m,y&&(x.m=m.m),x};function Is(m){return new hn(m)}function Qr(m,x,y){m.j=y?ei(x,!0):x,m.j&&(m.j=m.j.replace(/:$/,""))}function Zr(m,x){if(x){if(x=Number(x),isNaN(x)||x<0)throw Error("Bad port number "+x);m.u=x}else m.u=null}function al(m,x,y){x instanceof si?(m.i=x,q0(m.i,m.l)):(y||(x=ti(x,z0)),m.i=new si(x,m.l))}function ut(m,x,y){m.i.set(x,y)}function oo(m){return ut(m,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),m}function ei(m,x){return m?x?decodeURI(m.replace(/%25/g,"%2525")):decodeURIComponent(m):""}function ti(m,x,y){return typeof m=="string"?(m=encodeURI(m).replace(x,U0),y&&(m=m.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m):null}function U0(m){return m=m.charCodeAt(0),"%"+(m>>4&15).toString(16)+(m&15).toString(16)}var Gd=/[#\/\?@]/g,F0=/[#\?:]/g,O0=/[#\?]/g,z0=/[#\?@]/g,B0=/#/g;function si(m,x){this.h=this.g=null,this.i=m||null,this.j=!!x}function qn(m){m.g||(m.g=new Map,m.h=0,m.i&&V0(m.i,function(x,y){m.add(decodeURIComponent(x.replace(/\+/g," ")),y)}))}t=si.prototype,t.add=function(m,x){qn(this),this.i=null,m=pr(this,m);let y=this.g.get(m);return y||this.g.set(m,y=[]),y.push(x),this.h+=1,this};function $d(m,x){qn(m),x=pr(m,x),m.g.has(x)&&(m.i=null,m.h-=m.g.get(x).length,m.g.delete(x))}function Hd(m,x){return qn(m),x=pr(m,x),m.g.has(x)}t.forEach=function(m,x){qn(this),this.g.forEach(function(y,N){y.forEach(function(G){m.call(x,G,N,this)},this)},this)};function Wd(m,x){qn(m);let y=[];if(typeof x=="string")Hd(m,x)&&(y=y.concat(m.g.get(pr(m,x))));else for(m=Array.from(m.g.values()),x=0;x<m.length;x++)y=y.concat(m[x]);return y}t.set=function(m,x){return qn(this),this.i=null,m=pr(this,m),Hd(this,m)&&(this.h-=this.g.get(m).length),this.g.set(m,[x]),this.h+=1,this},t.get=function(m,x){return m?(m=Wd(this,m),m.length>0?String(m[0]):x):x};function Jd(m,x,y){$d(m,x),y.length>0&&(m.i=null,m.g.set(pr(m,x),v(y)),m.h+=y.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const m=[],x=Array.from(this.g.keys());for(let N=0;N<x.length;N++){var y=x[N];const G=Yr(y);y=Wd(this,y);for(let J=0;J<y.length;J++){let ae=G;y[J]!==""&&(ae+="="+Yr(y[J])),m.push(ae)}}return this.i=m.join("&")};function Kd(m){const x=new si;return x.i=m.i,m.g&&(x.g=new Map(m.g),x.h=m.h),x}function pr(m,x){return x=String(x),m.j&&(x=x.toLowerCase()),x}function q0(m,x){x&&!m.j&&(qn(m),m.i=null,m.g.forEach(function(y,N){const G=N.toLowerCase();N!=G&&($d(this,N),Jd(this,G,y))},m)),m.j=x}function G0(m,x){const y=new et;if(a.Image){const N=new Image;N.onload=f(mn,y,"TestLoadImage: loaded",!0,x,N),N.onerror=f(mn,y,"TestLoadImage: error",!1,x,N),N.onabort=f(mn,y,"TestLoadImage: abort",!1,x,N),N.ontimeout=f(mn,y,"TestLoadImage: timeout",!1,x,N),a.setTimeout(function(){N.ontimeout&&N.ontimeout()},1e4),N.src=m}else x(!1)}function $0(m,x){const y=new et,N=new AbortController,G=setTimeout(()=>{N.abort(),mn(y,"TestPingServer: timeout",!1,x)},1e4);fetch(m,{signal:N.signal}).then(J=>{clearTimeout(G),J.ok?mn(y,"TestPingServer: ok",!0,x):mn(y,"TestPingServer: server error",!1,x)}).catch(()=>{clearTimeout(G),mn(y,"TestPingServer: error",!1,x)})}function mn(m,x,y,N,G){try{G&&(G.onload=null,G.onerror=null,G.onabort=null,G.ontimeout=null),N(y)}catch{}}function H0(){this.g=new He}function ll(m){this.i=m.Sb||null,this.h=m.ab||!1}p(ll,Ge),ll.prototype.g=function(){return new ao(this.i,this.h)};function ao(m,x){ce.call(this),this.H=m,this.o=x,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}p(ao,ce),t=ao.prototype,t.open=function(m,x){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=m,this.D=x,this.readyState=1,ri(this)},t.send=function(m){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const x={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};m&&(x.body=m),(this.H||a).fetch(new Request(this.D,x)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,ni(this)),this.readyState=0},t.Pa=function(m){if(this.g&&(this.l=m,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=m.headers,this.readyState=2,ri(this)),this.g&&(this.readyState=3,ri(this),this.g)))if(this.responseType==="arraybuffer")m.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in m){if(this.j=m.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Yd(this)}else m.text().then(this.Oa.bind(this),this.ga.bind(this))};function Yd(m){m.j.read().then(m.Ma.bind(m)).catch(m.ga.bind(m))}t.Ma=function(m){if(this.g){if(this.o&&m.value)this.response.push(m.value);else if(!this.o){var x=m.value?m.value:new Uint8Array(0);(x=this.B.decode(x,{stream:!m.done}))&&(this.response=this.responseText+=x)}m.done?ni(this):ri(this),this.readyState==3&&Yd(this)}},t.Oa=function(m){this.g&&(this.response=this.responseText=m,ni(this))},t.Na=function(m){this.g&&(this.response=m,ni(this))},t.ga=function(){this.g&&ni(this)};function ni(m){m.readyState=4,m.l=null,m.j=null,m.B=null,ri(m)}t.setRequestHeader=function(m,x){this.A.append(m,x)},t.getResponseHeader=function(m){return this.h&&this.h.get(m.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const m=[],x=this.h.entries();for(var y=x.next();!y.done;)y=y.value,m.push(y[0]+": "+y[1]),y=x.next();return m.join(`\r
`)};function ri(m){m.onreadystatechange&&m.onreadystatechange.call(m)}Object.defineProperty(ao.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(m){this.m=m?"include":"same-origin"}});function Xd(m){let x="";return $(m,function(y,N){x+=N,x+=":",x+=y,x+=`\r
`}),x}function cl(m,x,y){e:{for(N in y){var N=!1;break e}N=!0}N||(y=Xd(y),typeof m=="string"?y!=null&&Yr(y):ut(m,x,y))}function vt(m){ce.call(this),this.headers=new Map,this.L=m||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}p(vt,ce);var W0=/^https?$/i,J0=["POST","PUT"];t=vt.prototype,t.Fa=function(m){this.H=m},t.ea=function(m,x,y,N){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+m);x=x?x.toUpperCase():"GET",this.D=m,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():jd.g(),this.g.onreadystatechange=g(d(this.Ca,this));try{this.B=!0,this.g.open(x,String(m),!0),this.B=!1}catch(J){Qd(this,J);return}if(m=y||"",y=new Map(this.headers),N)if(Object.getPrototypeOf(N)===Object.prototype)for(var G in N)y.set(G,N[G]);else if(typeof N.keys=="function"&&typeof N.get=="function")for(const J of N.keys())y.set(J,N.get(J));else throw Error("Unknown input type for opt_headers: "+String(N));N=Array.from(y.keys()).find(J=>J.toLowerCase()=="content-type"),G=a.FormData&&m instanceof a.FormData,!(Array.prototype.indexOf.call(J0,x,void 0)>=0)||N||G||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[J,ae]of y)this.g.setRequestHeader(J,ae);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(m),this.v=!1}catch(J){Qd(this,J)}};function Qd(m,x){m.h=!1,m.g&&(m.j=!0,m.g.abort(),m.j=!1),m.l=x,m.o=5,Zd(m),lo(m)}function Zd(m){m.A||(m.A=!0,de(m,"complete"),de(m,"error"))}t.abort=function(m){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=m||7,de(this,"complete"),de(this,"abort"),lo(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),lo(this,!0)),vt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?eu(this):this.Xa())},t.Xa=function(){eu(this)};function eu(m){if(m.h&&typeof o<"u"){if(m.v&&fn(m)==4)setTimeout(m.Ca.bind(m),0);else if(de(m,"readystatechange"),fn(m)==4){m.h=!1;try{const J=m.ca();e:switch(J){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var x=!0;break e;default:x=!1}var y;if(!(y=x)){var N;if(N=J===0){let ae=String(m.D).match(qd)[1]||null;!ae&&a.self&&a.self.location&&(ae=a.self.location.protocol.slice(0,-1)),N=!W0.test(ae?ae.toLowerCase():"")}y=N}if(y)de(m,"complete"),de(m,"success");else{m.o=6;try{var G=fn(m)>2?m.g.statusText:""}catch{G=""}m.l=G+" ["+m.ca()+"]",Zd(m)}}finally{lo(m)}}}}function lo(m,x){if(m.g){m.m&&(clearTimeout(m.m),m.m=null);const y=m.g;m.g=null,x||de(m,"ready");try{y.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function fn(m){return m.g?m.g.readyState:0}t.ca=function(){try{return fn(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(m){if(this.g){var x=this.g.responseText;return m&&x.indexOf(m)==0&&(x=x.substring(m.length)),Ae(x)}};function tu(m){try{if(!m.g)return null;if("response"in m.g)return m.g.response;switch(m.F){case"":case"text":return m.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in m.g)return m.g.mozResponseArrayBuffer}return null}catch{return null}}function K0(m){const x={};m=(m.g&&fn(m)>=2&&m.g.getAllResponseHeaders()||"").split(`\r
`);for(let N=0;N<m.length;N++){if(C(m[N]))continue;var y=k0(m[N]);const G=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const J=x[G]||[];x[G]=J,J.push(y)}U(x,function(N){return N.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function ii(m,x,y){return y&&y.internalChannelParams&&y.internalChannelParams[m]||x}function su(m){this.za=0,this.i=[],this.j=new et,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=ii("failFast",!1,m),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=ii("baseRetryDelayMs",5e3,m),this.Za=ii("retryDelaySeedMs",1e4,m),this.Ta=ii("forwardChannelMaxRetries",2,m),this.va=ii("forwardChannelRequestTimeoutMs",2e4,m),this.ma=m&&m.xmlHttpFactory||void 0,this.Ua=m&&m.Rb||void 0,this.Aa=m&&m.useFetchStreams||!1,this.O=void 0,this.L=m&&m.supportsCrossDomainXhr||!1,this.M="",this.h=new Ud(m&&m.concurrentRequestLimit),this.Ba=new H0,this.S=m&&m.fastHandshake||!1,this.R=m&&m.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=m&&m.Pb||!1,m&&m.ua&&this.j.ua(),m&&m.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&m&&m.detectBufferingProxy||!1,this.ia=void 0,m&&m.longPollingTimeout&&m.longPollingTimeout>0&&(this.ia=m.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=su.prototype,t.ka=8,t.I=1,t.connect=function(m,x,y,N){dt(0),this.W=m,this.H=x||{},y&&N!==void 0&&(this.H.OSID=y,this.H.OAID=N),this.F=this.X,this.J=uu(this,null,this.W),uo(this)};function dl(m){if(nu(m),m.I==3){var x=m.V++,y=Is(m.J);if(ut(y,"SID",m.M),ut(y,"RID",x),ut(y,"TYPE","terminate"),oi(m,y),x=new un(m,m.j,x),x.M=2,x.A=oo(Is(y)),y=!1,a.navigator&&a.navigator.sendBeacon)try{y=a.navigator.sendBeacon(x.A.toString(),"")}catch{}!y&&a.Image&&(new Image().src=x.A,y=!0),y||(x.g=hu(x.j,null),x.g.ea(x.A)),x.F=Date.now(),io(x)}du(m)}function co(m){m.g&&(hl(m),m.g.cancel(),m.g=null)}function nu(m){co(m),m.v&&(a.clearTimeout(m.v),m.v=null),ho(m),m.h.cancel(),m.m&&(typeof m.m=="number"&&a.clearTimeout(m.m),m.m=null)}function uo(m){if(!Fd(m.h)&&!m.m){m.m=!0;var x=m.Ea;q||b(),E||(q(),E=!0),w.add(x,m),m.D=0}}function Y0(m,x){return Od(m.h)>=m.h.j-(m.m?1:0)?!1:m.m?(m.i=x.G.concat(m.i),!0):m.I==1||m.I==2||m.D>=(m.Sa?0:m.Ta)?!1:(m.m=Ot(d(m.Ea,m,x),cu(m,m.D)),m.D++,!0)}t.Ea=function(m){if(this.m)if(this.m=null,this.I==1){if(!m){this.V=Math.floor(Math.random()*1e5),m=this.V++;const G=new un(this,this.j,m);let J=this.o;if(this.U&&(J?(J=te(J),ie(J,this.U)):J=this.U),this.u!==null||this.R||(G.J=J,J=null),this.S)e:{for(var x=0,y=0;y<this.i.length;y++){t:{var N=this.i[y];if("__data__"in N.map&&(N=N.map.__data__,typeof N=="string")){N=N.length;break t}N=void 0}if(N===void 0)break;if(x+=N,x>4096){x=y;break e}if(x===4096||y===this.i.length-1){x=y+1;break e}}x=1e3}else x=1e3;x=iu(this,G,x),y=Is(this.J),ut(y,"RID",m),ut(y,"CVER",22),this.G&&ut(y,"X-HTTP-Session-Id",this.G),oi(this,y),J&&(this.R?x="headers="+Yr(Xd(J))+"&"+x:this.u&&cl(y,this.u,J)),ol(this.h,G),this.Ra&&ut(y,"TYPE","init"),this.S?(ut(y,"$req",x),ut(y,"SID","null"),G.U=!0,sl(G,y,null)):sl(G,y,x),this.I=2}}else this.I==3&&(m?ru(this,m):this.i.length==0||Fd(this.h)||ru(this))};function ru(m,x){var y;x?y=x.l:y=m.V++;const N=Is(m.J);ut(N,"SID",m.M),ut(N,"RID",y),ut(N,"AID",m.K),oi(m,N),m.u&&m.o&&cl(N,m.u,m.o),y=new un(m,m.j,y,m.D+1),m.u===null&&(y.J=m.o),x&&(m.i=x.G.concat(m.i)),x=iu(m,y,1e3),y.H=Math.round(m.va*.5)+Math.round(m.va*.5*Math.random()),ol(m.h,y),sl(y,N,x)}function oi(m,x){m.H&&$(m.H,function(y,N){ut(x,N,y)}),m.l&&$({},function(y,N){ut(x,N,y)})}function iu(m,x,y){y=Math.min(m.i.length,y);const N=m.l?d(m.l.Ka,m.l,m):null;e:{var G=m.i;let Me=-1;for(;;){const At=["count="+y];Me==-1?y>0?(Me=G[0].g,At.push("ofs="+Me)):Me=0:At.push("ofs="+Me);let lt=!0;for(let Dt=0;Dt<y;Dt++){var J=G[Dt].g;const Cs=G[Dt].map;if(J-=Me,J<0)Me=Math.max(0,G[Dt].g-100),lt=!1;else try{J="req"+J+"_"||"";try{var ae=Cs instanceof Map?Cs:Object.entries(Cs);for(const[$n,pn]of ae){let gn=pn;l(pn)&&(gn=De(pn)),At.push(J+$n+"="+encodeURIComponent(gn))}}catch($n){throw At.push(J+"type="+encodeURIComponent("_badmap")),$n}}catch{N&&N(Cs)}}if(lt){ae=At.join("&");break e}}ae=void 0}return m=m.i.splice(0,y),x.G=m,ae}function ou(m){if(!m.g&&!m.v){m.Y=1;var x=m.Da;q||b(),E||(q(),E=!0),w.add(x,m),m.A=0}}function ul(m){return m.g||m.v||m.A>=3?!1:(m.Y++,m.v=Ot(d(m.Da,m),cu(m,m.A)),m.A++,!0)}t.Da=function(){if(this.v=null,au(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var m=4*this.T;this.j.info("BP detection timer enabled: "+m),this.B=Ot(d(this.Wa,this),m)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,dt(10),co(this),au(this))};function hl(m){m.B!=null&&(a.clearTimeout(m.B),m.B=null)}function au(m){m.g=new un(m,m.j,"rpc",m.Y),m.u===null&&(m.g.J=m.o),m.g.P=0;var x=Is(m.na);ut(x,"RID","rpc"),ut(x,"SID",m.M),ut(x,"AID",m.K),ut(x,"CI",m.F?"0":"1"),!m.F&&m.ia&&ut(x,"TO",m.ia),ut(x,"TYPE","xmlhttp"),oi(m,x),m.u&&m.o&&cl(x,m.u,m.o),m.O&&(m.g.H=m.O);var y=m.g;m=m.ba,y.M=1,y.A=oo(Is(x)),y.u=null,y.R=!0,Md(y,m)}t.Va=function(){this.C!=null&&(this.C=null,co(this),ul(this),dt(19))};function ho(m){m.C!=null&&(a.clearTimeout(m.C),m.C=null)}function lu(m,x){var y=null;if(m.g==x){ho(m),hl(m),m.g=null;var N=2}else if(il(m.h,x))y=x.G,zd(m.h,x),N=1;else return;if(m.I!=0){if(x.o)if(N==1){y=x.u?x.u.length:0,x=Date.now()-x.F;var G=m.D;N=ot(),de(N,new ls(N,y)),uo(m)}else ou(m);else if(G=x.m,G==3||G==0&&x.X>0||!(N==1&&Y0(m,x)||N==2&&ul(m)))switch(y&&y.length>0&&(x=m.h,x.i=x.i.concat(y)),G){case 1:Gn(m,5);break;case 4:Gn(m,10);break;case 3:Gn(m,6);break;default:Gn(m,2)}}}function cu(m,x){let y=m.Qa+Math.floor(Math.random()*m.Za);return m.isActive()||(y*=2),y*x}function Gn(m,x){if(m.j.info("Error code "+x),x==2){var y=d(m.bb,m),N=m.Ua;const G=!N;N=new hn(N||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Qr(N,"https"),oo(N),G?G0(N.toString(),y):$0(N.toString(),y)}else dt(2);m.I=0,m.l&&m.l.pa(x),du(m),nu(m)}t.bb=function(m){m?(this.j.info("Successfully pinged google.com"),dt(2)):(this.j.info("Failed to ping google.com"),dt(1))};function du(m){if(m.I=0,m.ja=[],m.l){const x=Bd(m.h);(x.length!=0||m.i.length!=0)&&(A(m.ja,x),A(m.ja,m.i),m.h.i.length=0,v(m.i),m.i.length=0),m.l.oa()}}function uu(m,x,y){var N=y instanceof hn?Is(y):new hn(y);if(N.g!="")x&&(N.g=x+"."+N.g),Zr(N,N.u);else{var G=a.location;N=G.protocol,x=x?x+"."+G.hostname:G.hostname,G=+G.port;const J=new hn(null);N&&Qr(J,N),x&&(J.g=x),G&&Zr(J,G),y&&(J.h=y),N=J}return y=m.G,x=m.wa,y&&x&&ut(N,y,x),ut(N,"VER",m.ka),oi(m,N),N}function hu(m,x,y){if(x&&!m.L)throw Error("Can't create secondary domain capable XhrIo object.");return x=m.Aa&&!m.ma?new vt(new ll({ab:y})):new vt(m.ma),x.Fa(m.L),x}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function mu(){}t=mu.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function mo(){}mo.prototype.g=function(m,x){return new cs(m,x)};function cs(m,x){ce.call(this),this.g=new su(x),this.l=m,this.h=x&&x.messageUrlParams||null,m=x&&x.messageHeaders||null,x&&x.clientProtocolHeaderRequired&&(m?m["X-Client-Protocol"]="webchannel":m={"X-Client-Protocol":"webchannel"}),this.g.o=m,m=x&&x.initMessageHeaders||null,x&&x.messageContentType&&(m?m["X-WebChannel-Content-Type"]=x.messageContentType:m={"X-WebChannel-Content-Type":x.messageContentType}),x&&x.sa&&(m?m["X-WebChannel-Client-Profile"]=x.sa:m={"X-WebChannel-Client-Profile":x.sa}),this.g.U=m,(m=x&&x.Qb)&&!C(m)&&(this.g.u=m),this.A=x&&x.supportsCrossDomainXhr||!1,this.v=x&&x.sendRawJson||!1,(x=x&&x.httpSessionIdParam)&&!C(x)&&(this.g.G=x,m=this.h,m!==null&&x in m&&(m=this.h,x in m&&delete m[x])),this.j=new gr(this)}p(cs,ce),cs.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},cs.prototype.close=function(){dl(this.g)},cs.prototype.o=function(m){var x=this.g;if(typeof m=="string"){var y={};y.__data__=m,m=y}else this.v&&(y={},y.__data__=De(m),m=y);x.i.push(new L0(x.Ya++,m)),x.I==3&&uo(x)},cs.prototype.N=function(){this.g.l=null,delete this.j,dl(this.g),delete this.g,cs.Z.N.call(this)};function fu(m){V.call(this),m.__headers__&&(this.headers=m.__headers__,this.statusCode=m.__status__,delete m.__headers__,delete m.__status__);var x=m.__sm__;if(x){e:{for(const y in x){m=y;break e}m=void 0}(this.i=m)&&(m=this.i,x=x!==null&&m in x?x[m]:void 0),this.data=x}else this.data=m}p(fu,V);function pu(){W.call(this),this.status=1}p(pu,W);function gr(m){this.g=m}p(gr,mu),gr.prototype.ra=function(){de(this.g,"a")},gr.prototype.qa=function(m){de(this.g,new fu(m))},gr.prototype.pa=function(m){de(this.g,new pu)},gr.prototype.oa=function(){de(this.g,"b")},mo.prototype.createWebChannel=mo.prototype.g,cs.prototype.send=cs.prototype.o,cs.prototype.open=cs.prototype.m,cs.prototype.close=cs.prototype.close,yp=function(){return new mo},xp=function(){return ot()},gp=oe,Ml={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},$e.NO_ERROR=0,$e.TIMEOUT=8,$e.HTTP_ERROR=6,Co=$e,zn.COMPLETE="complete",pp=zn,Ze.EventType=it,it.OPEN="a",it.CLOSE="b",it.ERROR="c",it.MESSAGE="d",ce.prototype.listen=ce.prototype.J,ui=Ze,vt.prototype.listenOnce=vt.prototype.K,vt.prototype.getLastError=vt.prototype.Ha,vt.prototype.getLastErrorCode=vt.prototype.ya,vt.prototype.getStatus=vt.prototype.ca,vt.prototype.getResponseJson=vt.prototype.La,vt.prototype.getResponseText=vt.prototype.la,vt.prototype.send=vt.prototype.ea,vt.prototype.setWithCredentials=vt.prototype.Fa,fp=vt}).apply(typeof po<"u"?po:typeof self<"u"?self:typeof window<"u"?window:{});const ku="@firebase/firestore",Du="4.9.3";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Kt.UNAUTHENTICATED=new Kt(null),Kt.GOOGLE_CREDENTIALS=new Kt("google-credentials-uid"),Kt.FIRST_PARTY=new Kt("first-party-uid"),Kt.MOCK_USER=new Kt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Br="12.7.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tr=new Ec("@firebase/firestore");function xr(){return tr.logLevel}function pe(t,...e){if(tr.logLevel<=Oe.DEBUG){const s=e.map(Cc);tr.debug(`Firestore (${Br}): ${t}`,...s)}}function tn(t,...e){if(tr.logLevel<=Oe.ERROR){const s=e.map(Cc);tr.error(`Firestore (${Br}): ${t}`,...s)}}function Mr(t,...e){if(tr.logLevel<=Oe.WARN){const s=e.map(Cc);tr.warn(`Firestore (${Br}): ${t}`,...s)}}function Cc(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(s){return JSON.stringify(s)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ce(t,e,s){let n="Unexpected state";typeof e=="string"?n=e:s=e,vp(t,n,s)}function vp(t,e,s){let n=`FIRESTORE (${Br}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(s!==void 0)try{n+=" CONTEXT: "+JSON.stringify(s)}catch{n+=" CONTEXT: "+s}throw tn(n),new Error(n)}function nt(t,e,s,n){let r="Unexpected state";typeof s=="string"?r=s:n=s,t||vp(e,r,n)}function ke(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ue extends qs{constructor(e,s){super(e,s),this.code=e,this.message=s,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys{constructor(){this.promise=new Promise((e,s)=>{this.resolve=e,this.reject=s})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bp{constructor(e,s){this.user=s,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Ab{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,s){e.enqueueRetryable(()=>s(Kt.UNAUTHENTICATED))}shutdown(){}}class Rb{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,s){this.changeListener=s,e.enqueueRetryable(()=>s(this.token.user))}shutdown(){this.changeListener=null}}class Pb{constructor(e){this.t=e,this.currentUser=Kt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,s){nt(this.o===void 0,42304);let n=this.i;const r=u=>this.i!==n?(n=this.i,s(u)):Promise.resolve();let o=new Ys;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Ys,e.enqueueRetryable(()=>r(this.currentUser))};const a=()=>{const u=o;e.enqueueRetryable(async()=>{await u.promise,await r(this.currentUser)})},l=u=>{pe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(u=>l(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?l(u):(pe("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Ys)}},0),a()}getToken(){const e=this.i,s=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(s).then(n=>this.i!==e?(pe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(nt(typeof n.accessToken=="string",31837,{l:n}),new bp(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return nt(e===null||typeof e=="string",2055,{h:e}),new Kt(e)}}class jb{constructor(e,s,n){this.P=e,this.T=s,this.I=n,this.type="FirstParty",this.user=Kt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class kb{constructor(e,s,n){this.P=e,this.T=s,this.I=n}getToken(){return Promise.resolve(new jb(this.P,this.T,this.I))}start(e,s){e.enqueueRetryable(()=>s(Kt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Mu{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Db{constructor(e,s){this.V=s,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ds(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,s){nt(this.o===void 0,3512);const n=o=>{o.error!=null&&pe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,pe("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?s(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>n(o))};const r=o=>{pe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>r(o)),setTimeout(()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?r(o):pe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Mu(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(s=>s?(nt(typeof s.token=="string",44558,{tokenResult:s}),this.m=s.token,new Mu(s.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mb(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),s=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(s);else for(let n=0;n<t;n++)s[n]=Math.floor(256*Math.random());return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sc{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const r=Mb(40);for(let o=0;o<r.length;++o)n.length<20&&r[o]<s&&(n+=e.charAt(r[o]%62))}return n}}function ze(t,e){return t<e?-1:t>e?1:0}function Ll(t,e){const s=Math.min(t.length,e.length);for(let n=0;n<s;n++){const r=t.charAt(n),o=e.charAt(n);if(r!==o)return vl(r)===vl(o)?ze(r,o):vl(r)?1:-1}return ze(t.length,e.length)}const Lb=55296,Vb=57343;function vl(t){const e=t.charCodeAt(0);return e>=Lb&&e<=Vb}function Lr(t,e,s){return t.length===e.length&&t.every((n,r)=>s(n,e[r]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lu="__name__";class Ss{constructor(e,s,n){s===void 0?s=0:s>e.length&&Ce(637,{offset:s,range:e.length}),n===void 0?n=e.length-s:n>e.length-s&&Ce(1746,{length:n,range:e.length-s}),this.segments=e,this.offset=s,this.len=n}get length(){return this.len}isEqual(e){return Ss.comparator(this,e)===0}child(e){const s=this.segments.slice(this.offset,this.limit());return e instanceof Ss?e.forEach(n=>{s.push(n)}):s.push(e),this.construct(s)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==e.get(s))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==e.get(s))return!1;return!0}forEach(e){for(let s=this.offset,n=this.limit();s<n;s++)e(this.segments[s])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,s){const n=Math.min(e.length,s.length);for(let r=0;r<n;r++){const o=Ss.compareSegments(e.get(r),s.get(r));if(o!==0)return o}return ze(e.length,s.length)}static compareSegments(e,s){const n=Ss.isNumericId(e),r=Ss.isNumericId(s);return n&&!r?-1:!n&&r?1:n&&r?Ss.extractNumericId(e).compare(Ss.extractNumericId(s)):Ll(e,s)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return In.fromString(e.substring(4,e.length-2))}}class ct extends Ss{construct(e,s,n){return new ct(e,s,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const s=[];for(const n of e){if(n.indexOf("//")>=0)throw new ue(X.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);s.push(...n.split("/").filter(r=>r.length>0))}return new ct(s)}static emptyPath(){return new ct([])}}const Ub=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class qt extends Ss{construct(e,s,n){return new qt(e,s,n)}static isValidIdentifier(e){return Ub.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),qt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Lu}static keyField(){return new qt([Lu])}static fromServerFormat(e){const s=[];let n="",r=0;const o=()=>{if(n.length===0)throw new ue(X.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);s.push(n),n=""};let a=!1;for(;r<e.length;){const l=e[r];if(l==="\\"){if(r+1===e.length)throw new ue(X.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[r+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new ue(X.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=u,r+=2}else l==="`"?(a=!a,r++):l!=="."||a?(n+=l,r++):(o(),r++)}if(o(),a)throw new ue(X.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new qt(s)}static emptyPath(){return new qt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class we{constructor(e){this.path=e}static fromPath(e){return new we(ct.fromString(e))}static fromName(e){return new we(ct.fromString(e).popFirst(5))}static empty(){return new we(ct.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ct.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,s){return ct.comparator(e.path,s.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new we(new ct(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wp(t,e,s){if(!s)throw new ue(X.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Fb(t,e,s,n){if(e===!0&&n===!0)throw new ue(X.INVALID_ARGUMENT,`${t} and ${s} cannot be used together.`)}function Vu(t){if(!we.isDocumentKey(t))throw new ue(X.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Uu(t){if(we.isDocumentKey(t))throw new ue(X.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function _p(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Ea(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Ce(12329,{type:typeof t})}function ns(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ue(X.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=Ea(t);throw new ue(X.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${s}`)}}return t}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ct(t,e){const s={typeString:t};return e&&(s.value=e),s}function $i(t,e){if(!_p(t))throw new ue(X.INVALID_ARGUMENT,"JSON must be an object");let s;for(const n in e)if(e[n]){const r=e[n].typeString,o="value"in e[n]?{value:e[n].value}:void 0;if(!(n in t)){s=`JSON missing required field: '${n}'`;break}const a=t[n];if(r&&typeof a!==r){s=`JSON field '${n}' must be a ${r}.`;break}if(o!==void 0&&a!==o.value){s=`Expected '${n}' field to equal '${o.value}'`;break}}if(s)throw new ue(X.INVALID_ARGUMENT,s);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fu=-62135596800,Ou=1e6;class ht{static now(){return ht.fromMillis(Date.now())}static fromDate(e){return ht.fromMillis(e.getTime())}static fromMillis(e){const s=Math.floor(e/1e3),n=Math.floor((e-1e3*s)*Ou);return new ht(s,n)}constructor(e,s){if(this.seconds=e,this.nanoseconds=s,s<0)throw new ue(X.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(s>=1e9)throw new ue(X.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(e<Fu)throw new ue(X.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ue(X.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Ou}_compareTo(e){return this.seconds===e.seconds?ze(this.nanoseconds,e.nanoseconds):ze(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ht._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if($i(e,ht._jsonSchema))return new ht(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Fu;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ht._jsonSchemaVersion="firestore/timestamp/1.0",ht._jsonSchema={type:Ct("string",ht._jsonSchemaVersion),seconds:Ct("number"),nanoseconds:Ct("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pe{static fromTimestamp(e){return new Pe(e)}static min(){return new Pe(new ht(0,0))}static max(){return new Pe(new ht(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ki=-1;function Ob(t,e){const s=t.toTimestamp().seconds,n=t.toTimestamp().nanoseconds+1,r=Pe.fromTimestamp(n===1e9?new ht(s+1,0):new ht(s,n));return new An(r,we.empty(),e)}function zb(t){return new An(t.readTime,t.key,ki)}class An{constructor(e,s,n){this.readTime=e,this.documentKey=s,this.largestBatchId=n}static min(){return new An(Pe.min(),we.empty(),ki)}static max(){return new An(Pe.max(),we.empty(),ki)}}function Bb(t,e){let s=t.readTime.compareTo(e.readTime);return s!==0?s:(s=we.comparator(t.documentKey,e.documentKey),s!==0?s:ze(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qb="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Gb{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qr(t){if(t.code!==X.FAILED_PRECONDITION||t.message!==qb)throw t;pe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(s=>{this.isDone=!0,this.result=s,this.nextCallback&&this.nextCallback(s)},s=>{this.isDone=!0,this.error=s,this.catchCallback&&this.catchCallback(s)})}catch(e){return this.next(void 0,e)}next(e,s){return this.callbackAttached&&Ce(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(e,this.result):new Q((n,r)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(n,r)},this.catchCallback=o=>{this.wrapFailure(s,o).next(n,r)}})}toPromise(){return new Promise((e,s)=>{this.next(e,s)})}wrapUserFunction(e){try{const s=e();return s instanceof Q?s:Q.resolve(s)}catch(s){return Q.reject(s)}}wrapSuccess(e,s){return e?this.wrapUserFunction(()=>e(s)):Q.resolve(s)}wrapFailure(e,s){return e?this.wrapUserFunction(()=>e(s)):Q.reject(s)}static resolve(e){return new Q((s,n)=>{s(e)})}static reject(e){return new Q((s,n)=>{n(e)})}static waitFor(e){return new Q((s,n)=>{let r=0,o=0,a=!1;e.forEach(l=>{++r,l.next(()=>{++o,a&&o===r&&s()},u=>n(u))}),a=!0,o===r&&s()})}static or(e){let s=Q.resolve(!1);for(const n of e)s=s.next(r=>r?Q.resolve(r):n());return s}static forEach(e,s){const n=[];return e.forEach((r,o)=>{n.push(s.call(this,r,o))}),this.waitFor(n)}static mapArray(e,s){return new Q((n,r)=>{const o=e.length,a=new Array(o);let l=0;for(let u=0;u<o;u++){const d=u;s(e[d]).next(f=>{a[d]=f,++l,l===o&&n(a)},f=>r(f))}})}static doWhile(e,s){return new Q((n,r)=>{const o=()=>{e()===!0?s().next(()=>{o()},r):n()};o()})}}function $b(t){const e=t.match(/Android ([\d.]+)/i),s=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(s)}function Gr(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ta{constructor(e,s){this.previousValue=e,s&&(s.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>s.writeSequenceNumber(n))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Ta.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ac=-1;function Ia(t){return t==null}function $o(t){return t===0&&1/t==-1/0}function Hb(t){return typeof t=="number"&&Number.isInteger(t)&&!$o(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Np="";function Wb(t){let e="";for(let s=0;s<t.length;s++)e.length>0&&(e=zu(e)),e=Jb(t.get(s),e);return zu(e)}function Jb(t,e){let s=e;const n=t.length;for(let r=0;r<n;r++){const o=t.charAt(r);switch(o){case"\0":s+="";break;case Np:s+="";break;default:s+=o}}return s}function zu(t){return t+Np+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bu(t){let e=0;for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&e++;return e}function Mn(t,e){for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&e(s,t[s])}function Ep(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xt{constructor(e,s){this.comparator=e,this.root=s||Bt.EMPTY}insert(e,s){return new xt(this.comparator,this.root.insert(e,s,this.comparator).copy(null,null,Bt.BLACK,null,null))}remove(e){return new xt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Bt.BLACK,null,null))}get(e){let s=this.root;for(;!s.isEmpty();){const n=this.comparator(e,s.key);if(n===0)return s.value;n<0?s=s.left:n>0&&(s=s.right)}return null}indexOf(e){let s=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return s+n.left.size;r<0?n=n.left:(s+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((s,n)=>(e(s,n),!1))}toString(){const e=[];return this.inorderTraversal((s,n)=>(e.push(`${s}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new go(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new go(this.root,e,this.comparator,!1)}getReverseIterator(){return new go(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new go(this.root,e,this.comparator,!0)}}class go{constructor(e,s,n,r){this.isReverse=r,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=s?n(e.key,s):1,s&&r&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const s={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return s}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Bt{constructor(e,s,n,r,o){this.key=e,this.value=s,this.color=n??Bt.RED,this.left=r??Bt.EMPTY,this.right=o??Bt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,s,n,r,o){return new Bt(e??this.key,s??this.value,n??this.color,r??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,s,n){let r=this;const o=n(e,r.key);return r=o<0?r.copy(null,null,null,r.left.insert(e,s,n),null):o===0?r.copy(null,s,null,null,null):r.copy(null,null,null,null,r.right.insert(e,s,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Bt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,s){let n,r=this;if(s(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,s),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),s(e,r.key)===0){if(r.right.isEmpty())return Bt.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,s))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Bt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Bt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,s)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ce(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ce(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ce(27949);return e+(this.isRed()?0:1)}}Bt.EMPTY=null,Bt.RED=!0,Bt.BLACK=!1;Bt.EMPTY=new class{constructor(){this.size=0}get key(){throw Ce(57766)}get value(){throw Ce(16141)}get color(){throw Ce(16727)}get left(){throw Ce(29726)}get right(){throw Ce(36894)}copy(e,s,n,r,o){return this}insert(e,s,n){return new Bt(e,s)}remove(e,s){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kt{constructor(e){this.comparator=e,this.data=new xt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((s,n)=>(e(s),!1))}forEachInRange(e,s){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;s(r.key)}}forEachWhile(e,s){let n;for(n=s!==void 0?this.data.getIteratorFrom(s):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const s=this.data.getIteratorFrom(e);return s.hasNext()?s.getNext().key:null}getIterator(){return new qu(this.data.getIterator())}getIteratorFrom(e){return new qu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let s=this;return s.size<e.size&&(s=e,e=this),e.forEach(n=>{s=s.add(n)}),s}isEqual(e){if(!(e instanceof kt)||this.size!==e.size)return!1;const s=this.data.getIterator(),n=e.data.getIterator();for(;s.hasNext();){const r=s.getNext().key,o=n.getNext().key;if(this.comparator(r,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(s=>{e.push(s)}),e}toString(){const e=[];return this.forEach(s=>e.push(s)),"SortedSet("+e.toString()+")"}copy(e){const s=new kt(this.comparator);return s.data=e,s}}class qu{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class us{constructor(e){this.fields=e,e.sort(qt.comparator)}static empty(){return new us([])}unionWith(e){let s=new kt(qt.comparator);for(const n of this.fields)s=s.add(n);for(const n of e)s=s.add(n);return new us(s.toArray())}covers(e){for(const s of this.fields)if(s.isPrefixOf(e))return!0;return!1}isEqual(e){return Lr(this.fields,e.fields,(s,n)=>s.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tp extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ht{constructor(e){this.binaryString=e}static fromBase64String(e){const s=function(r){try{return atob(r)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Tp("Invalid base64 string: "+o):o}}(e);return new Ht(s)}static fromUint8Array(e){const s=function(r){let o="";for(let a=0;a<r.length;++a)o+=String.fromCharCode(r[a]);return o}(e);return new Ht(s)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(s){return btoa(s)}(this.binaryString)}toUint8Array(){return function(s){const n=new Uint8Array(s.length);for(let r=0;r<s.length;r++)n[r]=s.charCodeAt(r);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ze(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ht.EMPTY_BYTE_STRING=new Ht("");const Kb=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Rn(t){if(nt(!!t,39018),typeof t=="string"){let e=0;const s=Kb.exec(t);if(nt(!!s,46558,{timestamp:t}),s[1]){let r=s[1];r=(r+"000000000").substr(0,9),e=Number(r)}const n=new Date(t);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:_t(t.seconds),nanos:_t(t.nanos)}}function _t(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Pn(t){return typeof t=="string"?Ht.fromBase64String(t):Ht.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ip="server_timestamp",Cp="__type__",Sp="__previous_value__",Ap="__local_write_time__";function Rc(t){var s,n;return((n=(((s=t==null?void 0:t.mapValue)==null?void 0:s.fields)||{})[Cp])==null?void 0:n.stringValue)===Ip}function Ca(t){const e=t.mapValue.fields[Sp];return Rc(e)?Ca(e):e}function Di(t){const e=Rn(t.mapValue.fields[Ap].timestampValue);return new ht(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yb{constructor(e,s,n,r,o,a,l,u,d,f){this.databaseId=e,this.appId=s,this.persistenceKey=n,this.host=r,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=d,this.isUsingEmulator=f}}const Ho="(default)";class Mi{constructor(e,s){this.projectId=e,this.database=s||Ho}static empty(){return new Mi("","")}get isDefaultDatabase(){return this.database===Ho}isEqual(e){return e instanceof Mi&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rp="__type__",Xb="__max__",xo={mapValue:{}},Pp="__vector__",Wo="value";function jn(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Rc(t)?4:Zb(t)?9007199254740991:Qb(t)?10:11:Ce(28295,{value:t})}function Os(t,e){if(t===e)return!0;const s=jn(t);if(s!==jn(e))return!1;switch(s){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Di(t).isEqual(Di(e));case 3:return function(r,o){if(typeof r.timestampValue=="string"&&typeof o.timestampValue=="string"&&r.timestampValue.length===o.timestampValue.length)return r.timestampValue===o.timestampValue;const a=Rn(r.timestampValue),l=Rn(o.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(r,o){return Pn(r.bytesValue).isEqual(Pn(o.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(r,o){return _t(r.geoPointValue.latitude)===_t(o.geoPointValue.latitude)&&_t(r.geoPointValue.longitude)===_t(o.geoPointValue.longitude)}(t,e);case 2:return function(r,o){if("integerValue"in r&&"integerValue"in o)return _t(r.integerValue)===_t(o.integerValue);if("doubleValue"in r&&"doubleValue"in o){const a=_t(r.doubleValue),l=_t(o.doubleValue);return a===l?$o(a)===$o(l):isNaN(a)&&isNaN(l)}return!1}(t,e);case 9:return Lr(t.arrayValue.values||[],e.arrayValue.values||[],Os);case 10:case 11:return function(r,o){const a=r.mapValue.fields||{},l=o.mapValue.fields||{};if(Bu(a)!==Bu(l))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(l[u]===void 0||!Os(a[u],l[u])))return!1;return!0}(t,e);default:return Ce(52216,{left:t})}}function Li(t,e){return(t.values||[]).find(s=>Os(s,e))!==void 0}function Vr(t,e){if(t===e)return 0;const s=jn(t),n=jn(e);if(s!==n)return ze(s,n);switch(s){case 0:case 9007199254740991:return 0;case 1:return ze(t.booleanValue,e.booleanValue);case 2:return function(o,a){const l=_t(o.integerValue||o.doubleValue),u=_t(a.integerValue||a.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1}(t,e);case 3:return Gu(t.timestampValue,e.timestampValue);case 4:return Gu(Di(t),Di(e));case 5:return Ll(t.stringValue,e.stringValue);case 6:return function(o,a){const l=Pn(o),u=Pn(a);return l.compareTo(u)}(t.bytesValue,e.bytesValue);case 7:return function(o,a){const l=o.split("/"),u=a.split("/");for(let d=0;d<l.length&&d<u.length;d++){const f=ze(l[d],u[d]);if(f!==0)return f}return ze(l.length,u.length)}(t.referenceValue,e.referenceValue);case 8:return function(o,a){const l=ze(_t(o.latitude),_t(a.latitude));return l!==0?l:ze(_t(o.longitude),_t(a.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return $u(t.arrayValue,e.arrayValue);case 10:return function(o,a){var g,v,A,k;const l=o.fields||{},u=a.fields||{},d=(g=l[Wo])==null?void 0:g.arrayValue,f=(v=u[Wo])==null?void 0:v.arrayValue,p=ze(((A=d==null?void 0:d.values)==null?void 0:A.length)||0,((k=f==null?void 0:f.values)==null?void 0:k.length)||0);return p!==0?p:$u(d,f)}(t.mapValue,e.mapValue);case 11:return function(o,a){if(o===xo.mapValue&&a===xo.mapValue)return 0;if(o===xo.mapValue)return 1;if(a===xo.mapValue)return-1;const l=o.fields||{},u=Object.keys(l),d=a.fields||{},f=Object.keys(d);u.sort(),f.sort();for(let p=0;p<u.length&&p<f.length;++p){const g=Ll(u[p],f[p]);if(g!==0)return g;const v=Vr(l[u[p]],d[f[p]]);if(v!==0)return v}return ze(u.length,f.length)}(t.mapValue,e.mapValue);default:throw Ce(23264,{he:s})}}function Gu(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return ze(t,e);const s=Rn(t),n=Rn(e),r=ze(s.seconds,n.seconds);return r!==0?r:ze(s.nanos,n.nanos)}function $u(t,e){const s=t.values||[],n=e.values||[];for(let r=0;r<s.length&&r<n.length;++r){const o=Vr(s[r],n[r]);if(o)return o}return ze(s.length,n.length)}function Ur(t){return Vl(t)}function Vl(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(s){const n=Rn(s);return`time(${n.seconds},${n.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(s){return Pn(s).toBase64()}(t.bytesValue):"referenceValue"in t?function(s){return we.fromName(s).toString()}(t.referenceValue):"geoPointValue"in t?function(s){return`geo(${s.latitude},${s.longitude})`}(t.geoPointValue):"arrayValue"in t?function(s){let n="[",r=!0;for(const o of s.values||[])r?r=!1:n+=",",n+=Vl(o);return n+"]"}(t.arrayValue):"mapValue"in t?function(s){const n=Object.keys(s.fields||{}).sort();let r="{",o=!0;for(const a of n)o?o=!1:r+=",",r+=`${a}:${Vl(s.fields[a])}`;return r+"}"}(t.mapValue):Ce(61005,{value:t})}function So(t){switch(jn(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ca(t);return e?16+So(e):16;case 5:return 2*t.stringValue.length;case 6:return Pn(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((r,o)=>r+So(o),0)}(t.arrayValue);case 10:case 11:return function(n){let r=0;return Mn(n.fields,(o,a)=>{r+=o.length+So(a)}),r}(t.mapValue);default:throw Ce(13486,{value:t})}}function Hu(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Ul(t){return!!t&&"integerValue"in t}function Pc(t){return!!t&&"arrayValue"in t}function Wu(t){return!!t&&"nullValue"in t}function Ju(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ao(t){return!!t&&"mapValue"in t}function Qb(t){var s,n;return((n=(((s=t==null?void 0:t.mapValue)==null?void 0:s.fields)||{})[Rp])==null?void 0:n.stringValue)===Pp}function bi(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Mn(t.mapValue.fields,(s,n)=>e.mapValue.fields[s]=bi(n)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let s=0;s<(t.arrayValue.values||[]).length;++s)e.arrayValue.values[s]=bi(t.arrayValue.values[s]);return e}return{...t}}function Zb(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===Xb}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as{constructor(e){this.value=e}static empty(){return new as({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let s=this.value;for(let n=0;n<e.length-1;++n)if(s=(s.mapValue.fields||{})[e.get(n)],!Ao(s))return null;return s=(s.mapValue.fields||{})[e.lastSegment()],s||null}}set(e,s){this.getFieldsMap(e.popLast())[e.lastSegment()]=bi(s)}setAll(e){let s=qt.emptyPath(),n={},r=[];e.forEach((a,l)=>{if(!s.isImmediateParentOf(l)){const u=this.getFieldsMap(s);this.applyChanges(u,n,r),n={},r=[],s=l.popLast()}a?n[l.lastSegment()]=bi(a):r.push(l.lastSegment())});const o=this.getFieldsMap(s);this.applyChanges(o,n,r)}delete(e){const s=this.field(e.popLast());Ao(s)&&s.mapValue.fields&&delete s.mapValue.fields[e.lastSegment()]}isEqual(e){return Os(this.value,e.value)}getFieldsMap(e){let s=this.value;s.mapValue.fields||(s.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=s.mapValue.fields[e.get(n)];Ao(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},s.mapValue.fields[e.get(n)]=r),s=r}return s.mapValue.fields}applyChanges(e,s,n){Mn(s,(r,o)=>e[r]=o);for(const r of n)delete e[r]}clone(){return new as(bi(this.value))}}function jp(t){const e=[];return Mn(t.fields,(s,n)=>{const r=new qt([s]);if(Ao(n)){const o=jp(n.mapValue).fields;if(o.length===0)e.push(r);else for(const a of o)e.push(r.child(a))}else e.push(r)}),new us(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yt{constructor(e,s,n,r,o,a,l){this.key=e,this.documentType=s,this.version=n,this.readTime=r,this.createTime=o,this.data=a,this.documentState=l}static newInvalidDocument(e){return new Yt(e,0,Pe.min(),Pe.min(),Pe.min(),as.empty(),0)}static newFoundDocument(e,s,n,r){return new Yt(e,1,s,Pe.min(),n,r,0)}static newNoDocument(e,s){return new Yt(e,2,s,Pe.min(),Pe.min(),as.empty(),0)}static newUnknownDocument(e,s){return new Yt(e,3,s,Pe.min(),Pe.min(),as.empty(),2)}convertToFoundDocument(e,s){return!this.createTime.isEqual(Pe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=s,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=as.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=as.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Pe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Yt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Yt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jo{constructor(e,s){this.position=e,this.inclusive=s}}function Ku(t,e,s){let n=0;for(let r=0;r<t.position.length;r++){const o=e[r],a=t.position[r];if(o.field.isKeyField()?n=we.comparator(we.fromName(a.referenceValue),s.key):n=Vr(a,s.data.field(o.field)),o.dir==="desc"&&(n*=-1),n!==0)break}return n}function Yu(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let s=0;s<t.position.length;s++)if(!Os(t.position[s],e.position[s]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi{constructor(e,s="asc"){this.field=e,this.dir=s}}function ew(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kp{}class It extends kp{constructor(e,s,n){super(),this.field=e,this.op=s,this.value=n}static create(e,s,n){return e.isKeyField()?s==="in"||s==="not-in"?this.createKeyFieldInFilter(e,s,n):new sw(e,s,n):s==="array-contains"?new iw(e,n):s==="in"?new ow(e,n):s==="not-in"?new aw(e,n):s==="array-contains-any"?new lw(e,n):new It(e,s,n)}static createKeyFieldInFilter(e,s,n){return s==="in"?new nw(e,n):new rw(e,n)}matches(e){const s=e.data.field(this.field);return this.op==="!="?s!==null&&s.nullValue===void 0&&this.matchesComparison(Vr(s,this.value)):s!==null&&jn(this.value)===jn(s)&&this.matchesComparison(Vr(s,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ce(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ns extends kp{constructor(e,s){super(),this.filters=e,this.op=s,this.Pe=null}static create(e,s){return new Ns(e,s)}matches(e){return Dp(this)?this.filters.find(s=>!s.matches(e))===void 0:this.filters.find(s=>s.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,s)=>e.concat(s.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Dp(t){return t.op==="and"}function Mp(t){return tw(t)&&Dp(t)}function tw(t){for(const e of t.filters)if(e instanceof Ns)return!1;return!0}function Fl(t){if(t instanceof It)return t.field.canonicalString()+t.op.toString()+Ur(t.value);if(Mp(t))return t.filters.map(e=>Fl(e)).join(",");{const e=t.filters.map(s=>Fl(s)).join(",");return`${t.op}(${e})`}}function Lp(t,e){return t instanceof It?function(n,r){return r instanceof It&&n.op===r.op&&n.field.isEqual(r.field)&&Os(n.value,r.value)}(t,e):t instanceof Ns?function(n,r){return r instanceof Ns&&n.op===r.op&&n.filters.length===r.filters.length?n.filters.reduce((o,a,l)=>o&&Lp(a,r.filters[l]),!0):!1}(t,e):void Ce(19439)}function Vp(t){return t instanceof It?function(s){return`${s.field.canonicalString()} ${s.op} ${Ur(s.value)}`}(t):t instanceof Ns?function(s){return s.op.toString()+" {"+s.getFilters().map(Vp).join(" ,")+"}"}(t):"Filter"}class sw extends It{constructor(e,s,n){super(e,s,n),this.key=we.fromName(n.referenceValue)}matches(e){const s=we.comparator(e.key,this.key);return this.matchesComparison(s)}}class nw extends It{constructor(e,s){super(e,"in",s),this.keys=Up("in",s)}matches(e){return this.keys.some(s=>s.isEqual(e.key))}}class rw extends It{constructor(e,s){super(e,"not-in",s),this.keys=Up("not-in",s)}matches(e){return!this.keys.some(s=>s.isEqual(e.key))}}function Up(t,e){var s;return(((s=e.arrayValue)==null?void 0:s.values)||[]).map(n=>we.fromName(n.referenceValue))}class iw extends It{constructor(e,s){super(e,"array-contains",s)}matches(e){const s=e.data.field(this.field);return Pc(s)&&Li(s.arrayValue,this.value)}}class ow extends It{constructor(e,s){super(e,"in",s)}matches(e){const s=e.data.field(this.field);return s!==null&&Li(this.value.arrayValue,s)}}class aw extends It{constructor(e,s){super(e,"not-in",s)}matches(e){if(Li(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const s=e.data.field(this.field);return s!==null&&s.nullValue===void 0&&!Li(this.value.arrayValue,s)}}class lw extends It{constructor(e,s){super(e,"array-contains-any",s)}matches(e){const s=e.data.field(this.field);return!(!Pc(s)||!s.arrayValue.values)&&s.arrayValue.values.some(n=>Li(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cw{constructor(e,s=null,n=[],r=[],o=null,a=null,l=null){this.path=e,this.collectionGroup=s,this.orderBy=n,this.filters=r,this.limit=o,this.startAt=a,this.endAt=l,this.Te=null}}function Xu(t,e=null,s=[],n=[],r=null,o=null,a=null){return new cw(t,e,s,n,r,o,a)}function jc(t){const e=ke(t);if(e.Te===null){let s=e.path.canonicalString();e.collectionGroup!==null&&(s+="|cg:"+e.collectionGroup),s+="|f:",s+=e.filters.map(n=>Fl(n)).join(","),s+="|ob:",s+=e.orderBy.map(n=>function(o){return o.field.canonicalString()+o.dir}(n)).join(","),Ia(e.limit)||(s+="|l:",s+=e.limit),e.startAt&&(s+="|lb:",s+=e.startAt.inclusive?"b:":"a:",s+=e.startAt.position.map(n=>Ur(n)).join(",")),e.endAt&&(s+="|ub:",s+=e.endAt.inclusive?"a:":"b:",s+=e.endAt.position.map(n=>Ur(n)).join(",")),e.Te=s}return e.Te}function kc(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let s=0;s<t.orderBy.length;s++)if(!ew(t.orderBy[s],e.orderBy[s]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let s=0;s<t.filters.length;s++)if(!Lp(t.filters[s],e.filters[s]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Yu(t.startAt,e.startAt)&&Yu(t.endAt,e.endAt)}function Ol(t){return we.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $r{constructor(e,s=null,n=[],r=[],o=null,a="F",l=null,u=null){this.path=e,this.collectionGroup=s,this.explicitOrderBy=n,this.filters=r,this.limit=o,this.limitType=a,this.startAt=l,this.endAt=u,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function dw(t,e,s,n,r,o,a,l){return new $r(t,e,s,n,r,o,a,l)}function Sa(t){return new $r(t)}function Qu(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function Fp(t){return t.collectionGroup!==null}function wi(t){const e=ke(t);if(e.Ie===null){e.Ie=[];const s=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),s.add(o.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new kt(qt.comparator);return a.filters.forEach(u=>{u.getFlattenedFilters().forEach(d=>{d.isInequality()&&(l=l.add(d.field))})}),l})(e).forEach(o=>{s.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Vi(o,n))}),s.has(qt.keyField().canonicalString())||e.Ie.push(new Vi(qt.keyField(),n))}return e.Ie}function ks(t){const e=ke(t);return e.Ee||(e.Ee=uw(e,wi(t))),e.Ee}function uw(t,e){if(t.limitType==="F")return Xu(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(r=>{const o=r.dir==="desc"?"asc":"desc";return new Vi(r.field,o)});const s=t.endAt?new Jo(t.endAt.position,t.endAt.inclusive):null,n=t.startAt?new Jo(t.startAt.position,t.startAt.inclusive):null;return Xu(t.path,t.collectionGroup,e,t.filters,t.limit,s,n)}}function zl(t,e){const s=t.filters.concat([e]);return new $r(t.path,t.collectionGroup,t.explicitOrderBy.slice(),s,t.limit,t.limitType,t.startAt,t.endAt)}function Bl(t,e,s){return new $r(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,s,t.startAt,t.endAt)}function Aa(t,e){return kc(ks(t),ks(e))&&t.limitType===e.limitType}function Op(t){return`${jc(ks(t))}|lt:${t.limitType}`}function yr(t){return`Query(target=${function(s){let n=s.path.canonicalString();return s.collectionGroup!==null&&(n+=" collectionGroup="+s.collectionGroup),s.filters.length>0&&(n+=`, filters: [${s.filters.map(r=>Vp(r)).join(", ")}]`),Ia(s.limit)||(n+=", limit: "+s.limit),s.orderBy.length>0&&(n+=`, orderBy: [${s.orderBy.map(r=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(r)).join(", ")}]`),s.startAt&&(n+=", startAt: ",n+=s.startAt.inclusive?"b:":"a:",n+=s.startAt.position.map(r=>Ur(r)).join(",")),s.endAt&&(n+=", endAt: ",n+=s.endAt.inclusive?"a:":"b:",n+=s.endAt.position.map(r=>Ur(r)).join(",")),`Target(${n})`}(ks(t))}; limitType=${t.limitType})`}function Ra(t,e){return e.isFoundDocument()&&function(n,r){const o=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(o):we.isDocumentKey(n.path)?n.path.isEqual(o):n.path.isImmediateParentOf(o)}(t,e)&&function(n,r){for(const o of wi(n))if(!o.field.isKeyField()&&r.data.field(o.field)===null)return!1;return!0}(t,e)&&function(n,r){for(const o of n.filters)if(!o.matches(r))return!1;return!0}(t,e)&&function(n,r){return!(n.startAt&&!function(a,l,u){const d=Ku(a,l,u);return a.inclusive?d<=0:d<0}(n.startAt,wi(n),r)||n.endAt&&!function(a,l,u){const d=Ku(a,l,u);return a.inclusive?d>=0:d>0}(n.endAt,wi(n),r))}(t,e)}function hw(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function zp(t){return(e,s)=>{let n=!1;for(const r of wi(t)){const o=mw(r,e,s);if(o!==0)return o;n=n||r.field.isKeyField()}return 0}}function mw(t,e,s){const n=t.field.isKeyField()?we.comparator(e.key,s.key):function(o,a,l){const u=a.data.field(o),d=l.data.field(o);return u!==null&&d!==null?Vr(u,d):Ce(42886)}(t.field,e,s);switch(t.dir){case"asc":return n;case"desc":return-1*n;default:return Ce(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cr{constructor(e,s){this.mapKeyFn=e,this.equalsFn=s,this.inner={},this.innerSize=0}get(e){const s=this.mapKeyFn(e),n=this.inner[s];if(n!==void 0){for(const[r,o]of n)if(this.equalsFn(r,e))return o}}has(e){return this.get(e)!==void 0}set(e,s){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return this.inner[n]=[[e,s]],void this.innerSize++;for(let o=0;o<r.length;o++)if(this.equalsFn(r[o][0],e))return void(r[o]=[e,s]);r.push([e,s]),this.innerSize++}delete(e){const s=this.mapKeyFn(e),n=this.inner[s];if(n===void 0)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return n.length===1?delete this.inner[s]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Mn(this.inner,(s,n)=>{for(const[r,o]of n)e(r,o)})}isEmpty(){return Ep(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fw=new xt(we.comparator);function sn(){return fw}const Bp=new xt(we.comparator);function hi(...t){let e=Bp;for(const s of t)e=e.insert(s.key,s);return e}function qp(t){let e=Bp;return t.forEach((s,n)=>e=e.insert(s,n.overlayedDocument)),e}function Kn(){return _i()}function Gp(){return _i()}function _i(){return new cr(t=>t.toString(),(t,e)=>t.isEqual(e))}const pw=new xt(we.comparator),gw=new kt(we.comparator);function Be(...t){let e=gw;for(const s of t)e=e.add(s);return e}const xw=new kt(ze);function yw(){return xw}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dc(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:$o(e)?"-0":e}}function $p(t){return{integerValue:""+t}}function vw(t,e){return Hb(e)?$p(e):Dc(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pa{constructor(){this._=void 0}}function bw(t,e,s){return t instanceof Ko?function(r,o){const a={fields:{[Cp]:{stringValue:Ip},[Ap]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return o&&Rc(o)&&(o=Ca(o)),o&&(a.fields[Sp]=o),{mapValue:a}}(s,e):t instanceof Ui?Wp(t,e):t instanceof Fi?Jp(t,e):function(r,o){const a=Hp(r,o),l=Zu(a)+Zu(r.Ae);return Ul(a)&&Ul(r.Ae)?$p(l):Dc(r.serializer,l)}(t,e)}function ww(t,e,s){return t instanceof Ui?Wp(t,e):t instanceof Fi?Jp(t,e):s}function Hp(t,e){return t instanceof Yo?function(n){return Ul(n)||function(o){return!!o&&"doubleValue"in o}(n)}(e)?e:{integerValue:0}:null}class Ko extends Pa{}class Ui extends Pa{constructor(e){super(),this.elements=e}}function Wp(t,e){const s=Kp(e);for(const n of t.elements)s.some(r=>Os(r,n))||s.push(n);return{arrayValue:{values:s}}}class Fi extends Pa{constructor(e){super(),this.elements=e}}function Jp(t,e){let s=Kp(e);for(const n of t.elements)s=s.filter(r=>!Os(r,n));return{arrayValue:{values:s}}}class Yo extends Pa{constructor(e,s){super(),this.serializer=e,this.Ae=s}}function Zu(t){return _t(t.integerValue||t.doubleValue)}function Kp(t){return Pc(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function _w(t,e){return t.field.isEqual(e.field)&&function(n,r){return n instanceof Ui&&r instanceof Ui||n instanceof Fi&&r instanceof Fi?Lr(n.elements,r.elements,Os):n instanceof Yo&&r instanceof Yo?Os(n.Ae,r.Ae):n instanceof Ko&&r instanceof Ko}(t.transform,e.transform)}class Nw{constructor(e,s){this.version=e,this.transformResults=s}}class rs{constructor(e,s){this.updateTime=e,this.exists=s}static none(){return new rs}static exists(e){return new rs(void 0,e)}static updateTime(e){return new rs(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ro(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class ja{}function Yp(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new ka(t.key,rs.none()):new Hi(t.key,t.data,rs.none());{const s=t.data,n=as.empty();let r=new kt(qt.comparator);for(let o of e.fields)if(!r.has(o)){let a=s.field(o);a===null&&o.length>1&&(o=o.popLast(),a=s.field(o)),a===null?n.delete(o):n.set(o,a),r=r.add(o)}return new Ln(t.key,n,new us(r.toArray()),rs.none())}}function Ew(t,e,s){t instanceof Hi?function(r,o,a){const l=r.value.clone(),u=th(r.fieldTransforms,o,a.transformResults);l.setAll(u),o.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(t,e,s):t instanceof Ln?function(r,o,a){if(!Ro(r.precondition,o))return void o.convertToUnknownDocument(a.version);const l=th(r.fieldTransforms,o,a.transformResults),u=o.data;u.setAll(Xp(r)),u.setAll(l),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(t,e,s):function(r,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,s)}function Ni(t,e,s,n){return t instanceof Hi?function(o,a,l,u){if(!Ro(o.precondition,a))return l;const d=o.value.clone(),f=sh(o.fieldTransforms,u,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(t,e,s,n):t instanceof Ln?function(o,a,l,u){if(!Ro(o.precondition,a))return l;const d=sh(o.fieldTransforms,u,a),f=a.data;return f.setAll(Xp(o)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(p=>p.field))}(t,e,s,n):function(o,a,l){return Ro(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(t,e,s)}function Tw(t,e){let s=null;for(const n of t.fieldTransforms){const r=e.data.field(n.field),o=Hp(n.transform,r||null);o!=null&&(s===null&&(s=as.empty()),s.set(n.field,o))}return s||null}function eh(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&Lr(n,r,(o,a)=>_w(o,a))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Hi extends ja{constructor(e,s,n,r=[]){super(),this.key=e,this.value=s,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Ln extends ja{constructor(e,s,n,r,o=[]){super(),this.key=e,this.data=s,this.fieldMask=n,this.precondition=r,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function Xp(t){const e=new Map;return t.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const n=t.data.field(s);e.set(s,n)}}),e}function th(t,e,s){const n=new Map;nt(t.length===s.length,32656,{Re:s.length,Ve:t.length});for(let r=0;r<s.length;r++){const o=t[r],a=o.transform,l=e.data.field(o.field);n.set(o.field,ww(a,l,s[r]))}return n}function sh(t,e,s){const n=new Map;for(const r of t){const o=r.transform,a=s.data.field(r.field);n.set(r.field,bw(o,a,e))}return n}class ka extends ja{constructor(e,s){super(),this.key=e,this.precondition=s,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Iw extends ja{constructor(e,s){super(),this.key=e,this.precondition=s,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cw{constructor(e,s,n,r){this.batchId=e,this.localWriteTime=s,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,s){const n=s.mutationResults;for(let r=0;r<this.mutations.length;r++){const o=this.mutations[r];o.key.isEqual(e.key)&&Ew(o,e,n[r])}}applyToLocalView(e,s){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(s=Ni(n,e,s,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(s=Ni(n,e,s,this.localWriteTime));return s}applyToLocalDocumentSet(e,s){const n=Gp();return this.mutations.forEach(r=>{const o=e.get(r.key),a=o.overlayedDocument;let l=this.applyToLocalView(a,o.mutatedFields);l=s.has(r.key)?null:l;const u=Yp(a,l);u!==null&&n.set(r.key,u),a.isValidDocument()||a.convertToNoDocument(Pe.min())}),n}keys(){return this.mutations.reduce((e,s)=>e.add(s.key),Be())}isEqual(e){return this.batchId===e.batchId&&Lr(this.mutations,e.mutations,(s,n)=>eh(s,n))&&Lr(this.baseMutations,e.baseMutations,(s,n)=>eh(s,n))}}class Mc{constructor(e,s,n,r){this.batch=e,this.commitVersion=s,this.mutationResults=n,this.docVersions=r}static from(e,s,n){nt(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=function(){return pw}();const o=e.mutations;for(let a=0;a<o.length;a++)r=r.insert(o[a].key,n[a].version);return new Mc(e,s,n,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sw{constructor(e,s){this.largestBatchId=e,this.mutation=s}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aw{constructor(e,s){this.count=e,this.unchangedNames=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Tt,We;function Rw(t){switch(t){case X.OK:return Ce(64938);case X.CANCELLED:case X.UNKNOWN:case X.DEADLINE_EXCEEDED:case X.RESOURCE_EXHAUSTED:case X.INTERNAL:case X.UNAVAILABLE:case X.UNAUTHENTICATED:return!1;case X.INVALID_ARGUMENT:case X.NOT_FOUND:case X.ALREADY_EXISTS:case X.PERMISSION_DENIED:case X.FAILED_PRECONDITION:case X.ABORTED:case X.OUT_OF_RANGE:case X.UNIMPLEMENTED:case X.DATA_LOSS:return!0;default:return Ce(15467,{code:t})}}function Qp(t){if(t===void 0)return tn("GRPC error has no .code"),X.UNKNOWN;switch(t){case Tt.OK:return X.OK;case Tt.CANCELLED:return X.CANCELLED;case Tt.UNKNOWN:return X.UNKNOWN;case Tt.DEADLINE_EXCEEDED:return X.DEADLINE_EXCEEDED;case Tt.RESOURCE_EXHAUSTED:return X.RESOURCE_EXHAUSTED;case Tt.INTERNAL:return X.INTERNAL;case Tt.UNAVAILABLE:return X.UNAVAILABLE;case Tt.UNAUTHENTICATED:return X.UNAUTHENTICATED;case Tt.INVALID_ARGUMENT:return X.INVALID_ARGUMENT;case Tt.NOT_FOUND:return X.NOT_FOUND;case Tt.ALREADY_EXISTS:return X.ALREADY_EXISTS;case Tt.PERMISSION_DENIED:return X.PERMISSION_DENIED;case Tt.FAILED_PRECONDITION:return X.FAILED_PRECONDITION;case Tt.ABORTED:return X.ABORTED;case Tt.OUT_OF_RANGE:return X.OUT_OF_RANGE;case Tt.UNIMPLEMENTED:return X.UNIMPLEMENTED;case Tt.DATA_LOSS:return X.DATA_LOSS;default:return Ce(39323,{code:t})}}(We=Tt||(Tt={}))[We.OK=0]="OK",We[We.CANCELLED=1]="CANCELLED",We[We.UNKNOWN=2]="UNKNOWN",We[We.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",We[We.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",We[We.NOT_FOUND=5]="NOT_FOUND",We[We.ALREADY_EXISTS=6]="ALREADY_EXISTS",We[We.PERMISSION_DENIED=7]="PERMISSION_DENIED",We[We.UNAUTHENTICATED=16]="UNAUTHENTICATED",We[We.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",We[We.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",We[We.ABORTED=10]="ABORTED",We[We.OUT_OF_RANGE=11]="OUT_OF_RANGE",We[We.UNIMPLEMENTED=12]="UNIMPLEMENTED",We[We.INTERNAL=13]="INTERNAL",We[We.UNAVAILABLE=14]="UNAVAILABLE",We[We.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pw(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jw=new In([4294967295,4294967295],0);function nh(t){const e=Pw().encode(t),s=new mp;return s.update(e),new Uint8Array(s.digest())}function rh(t){const e=new DataView(t.buffer),s=e.getUint32(0,!0),n=e.getUint32(4,!0),r=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new In([s,n],0),new In([r,o],0)]}class Lc{constructor(e,s,n){if(this.bitmap=e,this.padding=s,this.hashCount=n,s<0||s>=8)throw new mi(`Invalid padding: ${s}`);if(n<0)throw new mi(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new mi(`Invalid hash count: ${n}`);if(e.length===0&&s!==0)throw new mi(`Invalid padding when bitmap length is 0: ${s}`);this.ge=8*e.length-s,this.pe=In.fromNumber(this.ge)}ye(e,s,n){let r=e.add(s.multiply(In.fromNumber(n)));return r.compare(jw)===1&&(r=new In([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const s=nh(e),[n,r]=rh(s);for(let o=0;o<this.hashCount;o++){const a=this.ye(n,r,o);if(!this.we(a))return!1}return!0}static create(e,s,n){const r=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new Lc(o,r,s);return n.forEach(l=>a.insert(l)),a}insert(e){if(this.ge===0)return;const s=nh(e),[n,r]=rh(s);for(let o=0;o<this.hashCount;o++){const a=this.ye(n,r,o);this.Se(a)}}Se(e){const s=Math.floor(e/8),n=e%8;this.bitmap[s]|=1<<n}}class mi extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Da{constructor(e,s,n,r,o){this.snapshotVersion=e,this.targetChanges=s,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,s,n){const r=new Map;return r.set(e,Wi.createSynthesizedTargetChangeForCurrentChange(e,s,n)),new Da(Pe.min(),r,new xt(ze),sn(),Be())}}class Wi{constructor(e,s,n,r,o){this.resumeToken=e,this.current=s,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,s,n){return new Wi(n,s,Be(),Be(),Be())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Po{constructor(e,s,n,r){this.be=e,this.removedTargetIds=s,this.key=n,this.De=r}}class Zp{constructor(e,s){this.targetId=e,this.Ce=s}}class eg{constructor(e,s,n=Ht.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=s,this.resumeToken=n,this.cause=r}}class ih{constructor(){this.ve=0,this.Fe=oh(),this.Me=Ht.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Be(),s=Be(),n=Be();return this.Fe.forEach((r,o)=>{switch(o){case 0:e=e.add(r);break;case 2:s=s.add(r);break;case 1:n=n.add(r);break;default:Ce(38017,{changeType:o})}}),new Wi(this.Me,this.xe,e,s,n)}qe(){this.Oe=!1,this.Fe=oh()}Qe(e,s){this.Oe=!0,this.Fe=this.Fe.insert(e,s)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,nt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class kw{constructor(e){this.Ge=e,this.ze=new Map,this.je=sn(),this.Je=yo(),this.He=yo(),this.Ye=new xt(ze)}Ze(e){for(const s of e.be)e.De&&e.De.isFoundDocument()?this.Xe(s,e.De):this.et(s,e.key,e.De);for(const s of e.removedTargetIds)this.et(s,e.key,e.De)}tt(e){this.forEachTarget(e,s=>{const n=this.nt(s);switch(e.state){case 0:this.rt(s)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(s);break;case 3:this.rt(s)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(s)&&(this.it(s),n.Le(e.resumeToken));break;default:Ce(56790,{state:e.state})}})}forEachTarget(e,s){e.targetIds.length>0?e.targetIds.forEach(s):this.ze.forEach((n,r)=>{this.rt(r)&&s(r)})}st(e){const s=e.targetId,n=e.Ce.count,r=this.ot(s);if(r){const o=r.target;if(Ol(o))if(n===0){const a=new we(o.path);this.et(s,a,Yt.newNoDocument(a,Pe.min()))}else nt(n===1,20013,{expectedCount:n});else{const a=this._t(s);if(a!==n){const l=this.ut(e),u=l?this.ct(l,e,a):1;if(u!==0){this.it(s);const d=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(s,d)}}}}}ut(e){const s=e.Ce.unchangedNames;if(!s||!s.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:o=0}=s;let a,l;try{a=Pn(n).toUint8Array()}catch(u){if(u instanceof Tp)return Mr("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new Lc(a,r,o)}catch(u){return Mr(u instanceof mi?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.ge===0?null:l}ct(e,s,n){return s.Ce.count===n-this.Pt(e,s.targetId)?0:2}Pt(e,s){const n=this.Ge.getRemoteKeysForTarget(s);let r=0;return n.forEach(o=>{const a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(l)||(this.et(s,o,null),r++)}),r}Tt(e){const s=new Map;this.ze.forEach((o,a)=>{const l=this.ot(a);if(l){if(o.current&&Ol(l.target)){const u=new we(l.target.path);this.It(u).has(a)||this.Et(a,u)||this.et(a,u,Yt.newNoDocument(u,e))}o.Be&&(s.set(a,o.ke()),o.qe())}});let n=Be();this.He.forEach((o,a)=>{let l=!0;a.forEachWhile(u=>{const d=this.ot(u);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(n=n.add(o))}),this.je.forEach((o,a)=>a.setReadTime(e));const r=new Da(e,s,this.Ye,this.je,n);return this.je=sn(),this.Je=yo(),this.He=yo(),this.Ye=new xt(ze),r}Xe(e,s){if(!this.rt(e))return;const n=this.Et(e,s.key)?2:0;this.nt(e).Qe(s.key,n),this.je=this.je.insert(s.key,s),this.Je=this.Je.insert(s.key,this.It(s.key).add(e)),this.He=this.He.insert(s.key,this.dt(s.key).add(e))}et(e,s,n){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,s)?r.Qe(s,1):r.$e(s),this.He=this.He.insert(s,this.dt(s).delete(e)),this.He=this.He.insert(s,this.dt(s).add(e)),n&&(this.je=this.je.insert(s,n))}removeTarget(e){this.ze.delete(e)}_t(e){const s=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+s.addedDocuments.size-s.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let s=this.ze.get(e);return s||(s=new ih,this.ze.set(e,s)),s}dt(e){let s=this.He.get(e);return s||(s=new kt(ze),this.He=this.He.insert(e,s)),s}It(e){let s=this.Je.get(e);return s||(s=new kt(ze),this.Je=this.Je.insert(e,s)),s}rt(e){const s=this.ot(e)!==null;return s||pe("WatchChangeAggregator","Detected inactive target",e),s}ot(e){const s=this.ze.get(e);return s&&s.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new ih),this.Ge.getRemoteKeysForTarget(e).forEach(s=>{this.et(e,s,null)})}Et(e,s){return this.Ge.getRemoteKeysForTarget(e).has(s)}}function yo(){return new xt(we.comparator)}function oh(){return new xt(we.comparator)}const Dw={asc:"ASCENDING",desc:"DESCENDING"},Mw={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Lw={and:"AND",or:"OR"};class Vw{constructor(e,s){this.databaseId=e,this.useProto3Json=s}}function ql(t,e){return t.useProto3Json||Ia(e)?e:{value:e}}function Xo(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function tg(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Uw(t,e){return Xo(t,e.toTimestamp())}function Ds(t){return nt(!!t,49232),Pe.fromTimestamp(function(s){const n=Rn(s);return new ht(n.seconds,n.nanos)}(t))}function Vc(t,e){return Gl(t,e).canonicalString()}function Gl(t,e){const s=function(r){return new ct(["projects",r.projectId,"databases",r.database])}(t).child("documents");return e===void 0?s:s.child(e)}function sg(t){const e=ct.fromString(t);return nt(ag(e),10190,{key:e.toString()}),e}function $l(t,e){return Vc(t.databaseId,e.path)}function bl(t,e){const s=sg(e);if(s.get(1)!==t.databaseId.projectId)throw new ue(X.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+t.databaseId.projectId);if(s.get(3)!==t.databaseId.database)throw new ue(X.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+t.databaseId.database);return new we(rg(s))}function ng(t,e){return Vc(t.databaseId,e)}function Fw(t){const e=sg(t);return e.length===4?ct.emptyPath():rg(e)}function Hl(t){return new ct(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function rg(t){return nt(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function ah(t,e,s){return{name:$l(t,e),fields:s.value.mapValue.fields}}function Ow(t,e){let s;if("targetChange"in e){e.targetChange;const n=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:Ce(39313,{state:d})}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],o=function(d,f){return d.useProto3Json?(nt(f===void 0||typeof f=="string",58123),Ht.fromBase64String(f||"")):(nt(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Ht.fromUint8Array(f||new Uint8Array))}(t,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&function(d){const f=d.code===void 0?X.UNKNOWN:Qp(d.code);return new ue(f,d.message||"")}(a);s=new eg(n,r,o,l||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const r=bl(t,n.document.name),o=Ds(n.document.updateTime),a=n.document.createTime?Ds(n.document.createTime):Pe.min(),l=new as({mapValue:{fields:n.document.fields}}),u=Yt.newFoundDocument(r,o,a,l),d=n.targetIds||[],f=n.removedTargetIds||[];s=new Po(d,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const r=bl(t,n.document),o=n.readTime?Ds(n.readTime):Pe.min(),a=Yt.newNoDocument(r,o),l=n.removedTargetIds||[];s=new Po([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const r=bl(t,n.document),o=n.removedTargetIds||[];s=new Po([],o,r,null)}else{if(!("filter"in e))return Ce(11601,{Rt:e});{e.filter;const n=e.filter;n.targetId;const{count:r=0,unchangedNames:o}=n,a=new Aw(r,o),l=n.targetId;s=new Zp(l,a)}}return s}function zw(t,e){let s;if(e instanceof Hi)s={update:ah(t,e.key,e.value)};else if(e instanceof ka)s={delete:$l(t,e.key)};else if(e instanceof Ln)s={update:ah(t,e.key,e.data),updateMask:Yw(e.fieldMask)};else{if(!(e instanceof Iw))return Ce(16599,{Vt:e.type});s={verify:$l(t,e.key)}}return e.fieldTransforms.length>0&&(s.updateTransforms=e.fieldTransforms.map(n=>function(o,a){const l=a.transform;if(l instanceof Ko)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Ui)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Fi)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Yo)return{fieldPath:a.field.canonicalString(),increment:l.Ae};throw Ce(20930,{transform:a.transform})}(0,n))),e.precondition.isNone||(s.currentDocument=function(r,o){return o.updateTime!==void 0?{updateTime:Uw(r,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Ce(27497)}(t,e.precondition)),s}function Bw(t,e){return t&&t.length>0?(nt(e!==void 0,14353),t.map(s=>function(r,o){let a=r.updateTime?Ds(r.updateTime):Ds(o);return a.isEqual(Pe.min())&&(a=Ds(o)),new Nw(a,r.transformResults||[])}(s,e))):[]}function qw(t,e){return{documents:[ng(t,e.path)]}}function Gw(t,e){const s={structuredQuery:{}},n=e.path;let r;e.collectionGroup!==null?(r=n,s.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=n.popLast(),s.structuredQuery.from=[{collectionId:n.lastSegment()}]),s.parent=ng(t,r);const o=function(d){if(d.length!==0)return og(Ns.create(d,"and"))}(e.filters);o&&(s.structuredQuery.where=o);const a=function(d){if(d.length!==0)return d.map(f=>function(g){return{field:vr(g.field),direction:Ww(g.dir)}}(f))}(e.orderBy);a&&(s.structuredQuery.orderBy=a);const l=ql(t,e.limit);return l!==null&&(s.structuredQuery.limit=l),e.startAt&&(s.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(s.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{ft:s,parent:r}}function $w(t){let e=Fw(t.parent);const s=t.structuredQuery,n=s.from?s.from.length:0;let r=null;if(n>0){nt(n===1,65062);const f=s.from[0];f.allDescendants?r=f.collectionId:e=e.child(f.collectionId)}let o=[];s.where&&(o=function(p){const g=ig(p);return g instanceof Ns&&Mp(g)?g.getFilters():[g]}(s.where));let a=[];s.orderBy&&(a=function(p){return p.map(g=>function(A){return new Vi(br(A.field),function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(A.direction))}(g))}(s.orderBy));let l=null;s.limit&&(l=function(p){let g;return g=typeof p=="object"?p.value:p,Ia(g)?null:g}(s.limit));let u=null;s.startAt&&(u=function(p){const g=!!p.before,v=p.values||[];return new Jo(v,g)}(s.startAt));let d=null;return s.endAt&&(d=function(p){const g=!p.before,v=p.values||[];return new Jo(v,g)}(s.endAt)),dw(e,r,a,o,l,"F",u,d)}function Hw(t,e){const s=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ce(28987,{purpose:r})}}(e.purpose);return s==null?null:{"goog-listen-tags":s}}function ig(t){return t.unaryFilter!==void 0?function(s){switch(s.unaryFilter.op){case"IS_NAN":const n=br(s.unaryFilter.field);return It.create(n,"==",{doubleValue:NaN});case"IS_NULL":const r=br(s.unaryFilter.field);return It.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=br(s.unaryFilter.field);return It.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=br(s.unaryFilter.field);return It.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ce(61313);default:return Ce(60726)}}(t):t.fieldFilter!==void 0?function(s){return It.create(br(s.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ce(58110);default:return Ce(50506)}}(s.fieldFilter.op),s.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(s){return Ns.create(s.compositeFilter.filters.map(n=>ig(n)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return Ce(1026)}}(s.compositeFilter.op))}(t):Ce(30097,{filter:t})}function Ww(t){return Dw[t]}function Jw(t){return Mw[t]}function Kw(t){return Lw[t]}function vr(t){return{fieldPath:t.canonicalString()}}function br(t){return qt.fromServerFormat(t.fieldPath)}function og(t){return t instanceof It?function(s){if(s.op==="=="){if(Ju(s.value))return{unaryFilter:{field:vr(s.field),op:"IS_NAN"}};if(Wu(s.value))return{unaryFilter:{field:vr(s.field),op:"IS_NULL"}}}else if(s.op==="!="){if(Ju(s.value))return{unaryFilter:{field:vr(s.field),op:"IS_NOT_NAN"}};if(Wu(s.value))return{unaryFilter:{field:vr(s.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:vr(s.field),op:Jw(s.op),value:s.value}}}(t):t instanceof Ns?function(s){const n=s.getFilters().map(r=>og(r));return n.length===1?n[0]:{compositeFilter:{op:Kw(s.op),filters:n}}}(t):Ce(54877,{filter:t})}function Yw(t){const e=[];return t.fields.forEach(s=>e.push(s.canonicalString())),{fieldPaths:e}}function ag(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _n{constructor(e,s,n,r,o=Pe.min(),a=Pe.min(),l=Ht.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=s,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(e){return new _n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,s){return new _n(this.target,this.targetId,this.purpose,this.sequenceNumber,s,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new _n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new _n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xw{constructor(e){this.yt=e}}function Qw(t){const e=$w({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Bl(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zw{constructor(){this.Cn=new e_}addToCollectionParentIndex(e,s){return this.Cn.add(s),Q.resolve()}getCollectionParents(e,s){return Q.resolve(this.Cn.getEntries(s))}addFieldIndex(e,s){return Q.resolve()}deleteFieldIndex(e,s){return Q.resolve()}deleteAllFieldIndexes(e){return Q.resolve()}createTargetIndexes(e,s){return Q.resolve()}getDocumentsMatchingTarget(e,s){return Q.resolve(null)}getIndexType(e,s){return Q.resolve(0)}getFieldIndexes(e,s){return Q.resolve([])}getNextCollectionGroupToUpdate(e){return Q.resolve(null)}getMinOffset(e,s){return Q.resolve(An.min())}getMinOffsetFromCollectionGroup(e,s){return Q.resolve(An.min())}updateCollectionGroup(e,s,n){return Q.resolve()}updateIndexEntries(e,s){return Q.resolve()}}class e_{constructor(){this.index={}}add(e){const s=e.lastSegment(),n=e.popLast(),r=this.index[s]||new kt(ct.comparator),o=!r.has(n);return this.index[s]=r.add(n),o}has(e){const s=e.lastSegment(),n=e.popLast(),r=this.index[s];return r&&r.has(n)}getEntries(e){return(this.index[e]||new kt(ct.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},lg=41943040;class os{static withCacheSize(e){return new os(e,os.DEFAULT_COLLECTION_PERCENTILE,os.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,s,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=s,this.maximumSequenceNumbersToCollect=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */os.DEFAULT_COLLECTION_PERCENTILE=10,os.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,os.DEFAULT=new os(lg,os.DEFAULT_COLLECTION_PERCENTILE,os.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),os.DISABLED=new os(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fr{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Fr(0)}static cr(){return new Fr(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ch="LruGarbageCollector",t_=1048576;function dh([t,e],[s,n]){const r=ze(t,s);return r===0?ze(e,n):r}class s_{constructor(e){this.Ir=e,this.buffer=new kt(dh),this.Er=0}dr(){return++this.Er}Ar(e){const s=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(s);else{const n=this.buffer.last();dh(s,n)<0&&(this.buffer=this.buffer.delete(n).add(s))}}get maxValue(){return this.buffer.last()[0]}}class n_{constructor(e,s,n){this.garbageCollector=e,this.asyncQueue=s,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){pe(ch,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(s){Gr(s)?pe(ch,"Ignoring IndexedDB error during garbage collection: ",s):await qr(s)}await this.Vr(3e5)})}}class r_{constructor(e,s){this.mr=e,this.params=s}calculateTargetCount(e,s){return this.mr.gr(e).next(n=>Math.floor(s/100*n))}nthSequenceNumber(e,s){if(s===0)return Q.resolve(Ta.ce);const n=new s_(s);return this.mr.forEachTarget(e,r=>n.Ar(r.sequenceNumber)).next(()=>this.mr.pr(e,r=>n.Ar(r))).next(()=>n.maxValue)}removeTargets(e,s,n){return this.mr.removeTargets(e,s,n)}removeOrphanedDocuments(e,s){return this.mr.removeOrphanedDocuments(e,s)}collect(e,s){return this.params.cacheSizeCollectionThreshold===-1?(pe("LruGarbageCollector","Garbage collection skipped; disabled"),Q.resolve(lh)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(pe("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),lh):this.yr(e,s))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,s){let n,r,o,a,l,u,d;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(pe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),r=this.params.maximumSequenceNumbersToCollect):r=p,a=Date.now(),this.nthSequenceNumber(e,r))).next(p=>(n=p,l=Date.now(),this.removeTargets(e,n,s))).next(p=>(o=p,u=Date.now(),this.removeOrphanedDocuments(e,n))).next(p=>(d=Date.now(),xr()<=Oe.DEBUG&&pe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${r} in `+(l-a)+`ms
	Removed ${o} targets in `+(u-l)+`ms
	Removed ${p} documents in `+(d-u)+`ms
Total Duration: ${d-f}ms`),Q.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:o,documentsRemoved:p})))}}function i_(t,e){return new r_(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o_{constructor(){this.changes=new cr(e=>e.toString(),(e,s)=>e.isEqual(s)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,s){this.assertNotApplied(),this.changes.set(e,Yt.newInvalidDocument(e).setReadTime(s))}getEntry(e,s){this.assertNotApplied();const n=this.changes.get(s);return n!==void 0?Q.resolve(n):this.getFromCache(e,s)}getEntries(e,s){return this.getAllFromCache(e,s)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a_{constructor(e,s){this.overlayedDocument=e,this.mutatedFields=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l_{constructor(e,s,n,r){this.remoteDocumentCache=e,this.mutationQueue=s,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,s){let n=null;return this.documentOverlayCache.getOverlay(e,s).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,s))).next(r=>(n!==null&&Ni(n.mutation,r,us.empty(),ht.now()),r))}getDocuments(e,s){return this.remoteDocumentCache.getEntries(e,s).next(n=>this.getLocalViewOfDocuments(e,n,Be()).next(()=>n))}getLocalViewOfDocuments(e,s,n=Be()){const r=Kn();return this.populateOverlays(e,r,s).next(()=>this.computeViews(e,s,r,n).next(o=>{let a=hi();return o.forEach((l,u)=>{a=a.insert(l,u.overlayedDocument)}),a}))}getOverlayedDocuments(e,s){const n=Kn();return this.populateOverlays(e,n,s).next(()=>this.computeViews(e,s,n,Be()))}populateOverlays(e,s,n){const r=[];return n.forEach(o=>{s.has(o)||r.push(o)}),this.documentOverlayCache.getOverlays(e,r).next(o=>{o.forEach((a,l)=>{s.set(a,l)})})}computeViews(e,s,n,r){let o=sn();const a=_i(),l=function(){return _i()}();return s.forEach((u,d)=>{const f=n.get(d.key);r.has(d.key)&&(f===void 0||f.mutation instanceof Ln)?o=o.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),Ni(f.mutation,d,f.mutation.getFieldMask(),ht.now())):a.set(d.key,us.empty())}),this.recalculateAndSaveOverlays(e,o).next(u=>(u.forEach((d,f)=>a.set(d,f)),s.forEach((d,f)=>l.set(d,new a_(f,a.get(d)??null))),l))}recalculateAndSaveOverlays(e,s){const n=_i();let r=new xt((a,l)=>a-l),o=Be();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,s).next(a=>{for(const l of a)l.keys().forEach(u=>{const d=s.get(u);if(d===null)return;let f=n.get(u)||us.empty();f=l.applyToLocalView(d,f),n.set(u,f);const p=(r.get(l.batchId)||Be()).add(u);r=r.insert(l.batchId,p)})}).next(()=>{const a=[],l=r.getReverseIterator();for(;l.hasNext();){const u=l.getNext(),d=u.key,f=u.value,p=Gp();f.forEach(g=>{if(!o.has(g)){const v=Yp(s.get(g),n.get(g));v!==null&&p.set(g,v),o=o.add(g)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,p))}return Q.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,s){return this.remoteDocumentCache.getEntries(e,s).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,s,n,r){return function(a){return we.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(s)?this.getDocumentsMatchingDocumentQuery(e,s.path):Fp(s)?this.getDocumentsMatchingCollectionGroupQuery(e,s,n,r):this.getDocumentsMatchingCollectionQuery(e,s,n,r)}getNextDocuments(e,s,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,s,n,r).next(o=>{const a=r-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,s,n.largestBatchId,r-o.size):Q.resolve(Kn());let l=ki,u=o;return a.next(d=>Q.forEach(d,(f,p)=>(l<p.largestBatchId&&(l=p.largestBatchId),o.get(f)?Q.resolve():this.remoteDocumentCache.getEntry(e,f).next(g=>{u=u.insert(f,g)}))).next(()=>this.populateOverlays(e,d,o)).next(()=>this.computeViews(e,u,d,Be())).next(f=>({batchId:l,changes:qp(f)})))})}getDocumentsMatchingDocumentQuery(e,s){return this.getDocument(e,new we(s)).next(n=>{let r=hi();return n.isFoundDocument()&&(r=r.insert(n.key,n)),r})}getDocumentsMatchingCollectionGroupQuery(e,s,n,r){const o=s.collectionGroup;let a=hi();return this.indexManager.getCollectionParents(e,o).next(l=>Q.forEach(l,u=>{const d=function(p,g){return new $r(g,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(s,u.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,n,r).next(f=>{f.forEach((p,g)=>{a=a.insert(p,g)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,s,n,r){let o;return this.documentOverlayCache.getOverlaysForCollection(e,s.path,n.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,s,n,o,r))).next(a=>{o.forEach((u,d)=>{const f=d.getKey();a.get(f)===null&&(a=a.insert(f,Yt.newInvalidDocument(f)))});let l=hi();return a.forEach((u,d)=>{const f=o.get(u);f!==void 0&&Ni(f.mutation,d,us.empty(),ht.now()),Ra(s,d)&&(l=l.insert(u,d))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c_{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,s){return Q.resolve(this.Lr.get(s))}saveBundleMetadata(e,s){return this.Lr.set(s.id,function(r){return{id:r.id,version:r.version,createTime:Ds(r.createTime)}}(s)),Q.resolve()}getNamedQuery(e,s){return Q.resolve(this.kr.get(s))}saveNamedQuery(e,s){return this.kr.set(s.name,function(r){return{name:r.name,query:Qw(r.bundledQuery),readTime:Ds(r.readTime)}}(s)),Q.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d_{constructor(){this.overlays=new xt(we.comparator),this.qr=new Map}getOverlay(e,s){return Q.resolve(this.overlays.get(s))}getOverlays(e,s){const n=Kn();return Q.forEach(s,r=>this.getOverlay(e,r).next(o=>{o!==null&&n.set(r,o)})).next(()=>n)}saveOverlays(e,s,n){return n.forEach((r,o)=>{this.St(e,s,o)}),Q.resolve()}removeOverlaysForBatchId(e,s,n){const r=this.qr.get(n);return r!==void 0&&(r.forEach(o=>this.overlays=this.overlays.remove(o)),this.qr.delete(n)),Q.resolve()}getOverlaysForCollection(e,s,n){const r=Kn(),o=s.length+1,a=new we(s.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const u=l.getNext().value,d=u.getKey();if(!s.isPrefixOf(d.path))break;d.path.length===o&&u.largestBatchId>n&&r.set(u.getKey(),u)}return Q.resolve(r)}getOverlaysForCollectionGroup(e,s,n,r){let o=new xt((d,f)=>d-f);const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===s&&d.largestBatchId>n){let f=o.get(d.largestBatchId);f===null&&(f=Kn(),o=o.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}const l=Kn(),u=o.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((d,f)=>l.set(d,f)),!(l.size()>=r)););return Q.resolve(l)}St(e,s,n){const r=this.overlays.get(n.key);if(r!==null){const a=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Sw(s,n));let o=this.qr.get(s);o===void 0&&(o=Be(),this.qr.set(s,o)),this.qr.set(s,o.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u_{constructor(){this.sessionToken=Ht.EMPTY_BYTE_STRING}getSessionToken(e){return Q.resolve(this.sessionToken)}setSessionToken(e,s){return this.sessionToken=s,Q.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uc{constructor(){this.Qr=new kt(Mt.$r),this.Ur=new kt(Mt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,s){const n=new Mt(e,s);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,s){e.forEach(n=>this.addReference(n,s))}removeReference(e,s){this.Gr(new Mt(e,s))}zr(e,s){e.forEach(n=>this.removeReference(n,s))}jr(e){const s=new we(new ct([])),n=new Mt(s,e),r=new Mt(s,e+1),o=[];return this.Ur.forEachInRange([n,r],a=>{this.Gr(a),o.push(a.key)}),o}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const s=new we(new ct([])),n=new Mt(s,e),r=new Mt(s,e+1);let o=Be();return this.Ur.forEachInRange([n,r],a=>{o=o.add(a.key)}),o}containsKey(e){const s=new Mt(e,0),n=this.Qr.firstAfterOrEqual(s);return n!==null&&e.isEqual(n.key)}}class Mt{constructor(e,s){this.key=e,this.Yr=s}static $r(e,s){return we.comparator(e.key,s.key)||ze(e.Yr,s.Yr)}static Kr(e,s){return ze(e.Yr,s.Yr)||we.comparator(e.key,s.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h_{constructor(e,s){this.indexManager=e,this.referenceDelegate=s,this.mutationQueue=[],this.tr=1,this.Zr=new kt(Mt.$r)}checkEmpty(e){return Q.resolve(this.mutationQueue.length===0)}addMutationBatch(e,s,n,r){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Cw(o,s,n,r);this.mutationQueue.push(a);for(const l of r)this.Zr=this.Zr.add(new Mt(l.key,o)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return Q.resolve(a)}lookupMutationBatch(e,s){return Q.resolve(this.Xr(s))}getNextMutationBatchAfterBatchId(e,s){const n=s+1,r=this.ei(n),o=r<0?0:r;return Q.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return Q.resolve(this.mutationQueue.length===0?Ac:this.tr-1)}getAllMutationBatches(e){return Q.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,s){const n=new Mt(s,0),r=new Mt(s,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([n,r],a=>{const l=this.Xr(a.Yr);o.push(l)}),Q.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,s){let n=new kt(ze);return s.forEach(r=>{const o=new Mt(r,0),a=new Mt(r,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,a],l=>{n=n.add(l.Yr)})}),Q.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,s){const n=s.path,r=n.length+1;let o=n;we.isDocumentKey(o)||(o=o.child(""));const a=new Mt(new we(o),0);let l=new kt(ze);return this.Zr.forEachWhile(u=>{const d=u.key.path;return!!n.isPrefixOf(d)&&(d.length===r&&(l=l.add(u.Yr)),!0)},a),Q.resolve(this.ti(l))}ti(e){const s=[];return e.forEach(n=>{const r=this.Xr(n);r!==null&&s.push(r)}),s}removeMutationBatch(e,s){nt(this.ni(s.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return Q.forEach(s.mutations,r=>{const o=new Mt(r.key,s.batchId);return n=n.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,s){const n=new Mt(s,0),r=this.Zr.firstAfterOrEqual(n);return Q.resolve(s.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Q.resolve()}ni(e,s){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const s=this.ei(e);return s<0||s>=this.mutationQueue.length?null:this.mutationQueue[s]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m_{constructor(e){this.ri=e,this.docs=function(){return new xt(we.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,s){const n=s.key,r=this.docs.get(n),o=r?r.size:0,a=this.ri(s);return this.docs=this.docs.insert(n,{document:s.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const s=this.docs.get(e);s&&(this.docs=this.docs.remove(e),this.size-=s.size)}getEntry(e,s){const n=this.docs.get(s);return Q.resolve(n?n.document.mutableCopy():Yt.newInvalidDocument(s))}getEntries(e,s){let n=sn();return s.forEach(r=>{const o=this.docs.get(r);n=n.insert(r,o?o.document.mutableCopy():Yt.newInvalidDocument(r))}),Q.resolve(n)}getDocumentsMatchingQuery(e,s,n,r){let o=sn();const a=s.path,l=new we(a.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){const{key:d,value:{document:f}}=u.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Bb(zb(f),n)<=0||(r.has(f.key)||Ra(s,f))&&(o=o.insert(f.key,f.mutableCopy()))}return Q.resolve(o)}getAllFromCollectionGroup(e,s,n,r){Ce(9500)}ii(e,s){return Q.forEach(this.docs,n=>s(n))}newChangeBuffer(e){return new f_(this)}getSize(e){return Q.resolve(this.size)}}class f_ extends o_{constructor(e){super(),this.Nr=e}applyChanges(e){const s=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?s.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(n)}),Q.waitFor(s)}getFromCache(e,s){return this.Nr.getEntry(e,s)}getAllFromCache(e,s){return this.Nr.getEntries(e,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p_{constructor(e){this.persistence=e,this.si=new cr(s=>jc(s),kc),this.lastRemoteSnapshotVersion=Pe.min(),this.highestTargetId=0,this.oi=0,this._i=new Uc,this.targetCount=0,this.ai=Fr.ur()}forEachTarget(e,s){return this.si.forEach((n,r)=>s(r)),Q.resolve()}getLastRemoteSnapshotVersion(e){return Q.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Q.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),Q.resolve(this.highestTargetId)}setTargetsMetadata(e,s,n){return n&&(this.lastRemoteSnapshotVersion=n),s>this.oi&&(this.oi=s),Q.resolve()}Pr(e){this.si.set(e.target,e);const s=e.targetId;s>this.highestTargetId&&(this.ai=new Fr(s),this.highestTargetId=s),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,s){return this.Pr(s),this.targetCount+=1,Q.resolve()}updateTargetData(e,s){return this.Pr(s),Q.resolve()}removeTargetData(e,s){return this.si.delete(s.target),this._i.jr(s.targetId),this.targetCount-=1,Q.resolve()}removeTargets(e,s,n){let r=0;const o=[];return this.si.forEach((a,l)=>{l.sequenceNumber<=s&&n.get(l.targetId)===null&&(this.si.delete(a),o.push(this.removeMatchingKeysForTargetId(e,l.targetId)),r++)}),Q.waitFor(o).next(()=>r)}getTargetCount(e){return Q.resolve(this.targetCount)}getTargetData(e,s){const n=this.si.get(s)||null;return Q.resolve(n)}addMatchingKeys(e,s,n){return this._i.Wr(s,n),Q.resolve()}removeMatchingKeys(e,s,n){this._i.zr(s,n);const r=this.persistence.referenceDelegate,o=[];return r&&s.forEach(a=>{o.push(r.markPotentiallyOrphaned(e,a))}),Q.waitFor(o)}removeMatchingKeysForTargetId(e,s){return this._i.jr(s),Q.resolve()}getMatchingKeysForTargetId(e,s){const n=this._i.Hr(s);return Q.resolve(n)}containsKey(e,s){return Q.resolve(this._i.containsKey(s))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cg{constructor(e,s){this.ui={},this.overlays={},this.ci=new Ta(0),this.li=!1,this.li=!0,this.hi=new u_,this.referenceDelegate=e(this),this.Pi=new p_(this),this.indexManager=new Zw,this.remoteDocumentCache=function(r){return new m_(r)}(n=>this.referenceDelegate.Ti(n)),this.serializer=new Xw(s),this.Ii=new c_(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let s=this.overlays[e.toKey()];return s||(s=new d_,this.overlays[e.toKey()]=s),s}getMutationQueue(e,s){let n=this.ui[e.toKey()];return n||(n=new h_(s,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,s,n){pe("MemoryPersistence","Starting transaction:",e);const r=new g_(this.ci.next());return this.referenceDelegate.Ei(),n(r).next(o=>this.referenceDelegate.di(r).next(()=>o)).toPromise().then(o=>(r.raiseOnCommittedEvent(),o))}Ai(e,s){return Q.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,s)))}}class g_ extends Gb{constructor(e){super(),this.currentSequenceNumber=e}}class Fc{constructor(e){this.persistence=e,this.Ri=new Uc,this.Vi=null}static mi(e){return new Fc(e)}get fi(){if(this.Vi)return this.Vi;throw Ce(60996)}addReference(e,s,n){return this.Ri.addReference(n,s),this.fi.delete(n.toString()),Q.resolve()}removeReference(e,s,n){return this.Ri.removeReference(n,s),this.fi.add(n.toString()),Q.resolve()}markPotentiallyOrphaned(e,s){return this.fi.add(s.toString()),Q.resolve()}removeTarget(e,s){this.Ri.jr(s.targetId).forEach(r=>this.fi.add(r.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,s.targetId).next(r=>{r.forEach(o=>this.fi.add(o.toString()))}).next(()=>n.removeTargetData(e,s))}Ei(){this.Vi=new Set}di(e){const s=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Q.forEach(this.fi,n=>{const r=we.fromPath(n);return this.gi(e,r).next(o=>{o||s.removeEntry(r,Pe.min())})}).next(()=>(this.Vi=null,s.apply(e)))}updateLimboDocument(e,s){return this.gi(e,s).next(n=>{n?this.fi.delete(s.toString()):this.fi.add(s.toString())})}Ti(e){return 0}gi(e,s){return Q.or([()=>Q.resolve(this.Ri.containsKey(s)),()=>this.persistence.getTargetCache().containsKey(e,s),()=>this.persistence.Ai(e,s)])}}class Qo{constructor(e,s){this.persistence=e,this.pi=new cr(n=>Wb(n.path),(n,r)=>n.isEqual(r)),this.garbageCollector=i_(this,s)}static mi(e,s){return new Qo(e,s)}Ei(){}di(e){return Q.resolve()}forEachTarget(e,s){return this.persistence.getTargetCache().forEachTarget(e,s)}gr(e){const s=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>s.next(r=>n+r))}wr(e){let s=0;return this.pr(e,n=>{s++}).next(()=>s)}pr(e,s){return Q.forEach(this.pi,(n,r)=>this.br(e,n,r).next(o=>o?Q.resolve():s(r)))}removeTargets(e,s,n){return this.persistence.getTargetCache().removeTargets(e,s,n)}removeOrphanedDocuments(e,s){let n=0;const r=this.persistence.getRemoteDocumentCache(),o=r.newChangeBuffer();return r.ii(e,a=>this.br(e,a,s).next(l=>{l||(n++,o.removeEntry(a,Pe.min()))})).next(()=>o.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,s){return this.pi.set(s,e.currentSequenceNumber),Q.resolve()}removeTarget(e,s){const n=s.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,s,n){return this.pi.set(n,e.currentSequenceNumber),Q.resolve()}removeReference(e,s,n){return this.pi.set(n,e.currentSequenceNumber),Q.resolve()}updateLimboDocument(e,s){return this.pi.set(s,e.currentSequenceNumber),Q.resolve()}Ti(e){let s=e.key.toString().length;return e.isFoundDocument()&&(s+=So(e.data.value)),s}br(e,s,n){return Q.or([()=>this.persistence.Ai(e,s),()=>this.persistence.getTargetCache().containsKey(e,s),()=>{const r=this.pi.get(s);return Q.resolve(r!==void 0&&r>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oc{constructor(e,s,n,r){this.targetId=e,this.fromCache=s,this.Es=n,this.ds=r}static As(e,s){let n=Be(),r=Be();for(const o of s.docChanges)switch(o.type){case 0:n=n.add(o.doc.key);break;case 1:r=r.add(o.doc.key)}return new Oc(e,s.fromCache,n,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x_{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y_{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return cv()?8:$b(Qt())>0?6:4}()}initialize(e,s){this.ps=e,this.indexManager=s,this.Rs=!0}getDocumentsMatchingQuery(e,s,n,r){const o={result:null};return this.ys(e,s).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.ws(e,s,r,n).next(a=>{o.result=a})}).next(()=>{if(o.result)return;const a=new x_;return this.Ss(e,s,a).next(l=>{if(o.result=l,this.Vs)return this.bs(e,s,a,l.size)})}).next(()=>o.result)}bs(e,s,n,r){return n.documentReadCount<this.fs?(xr()<=Oe.DEBUG&&pe("QueryEngine","SDK will not create cache indexes for query:",yr(s),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Q.resolve()):(xr()<=Oe.DEBUG&&pe("QueryEngine","Query:",yr(s),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(xr()<=Oe.DEBUG&&pe("QueryEngine","The SDK decides to create cache indexes for query:",yr(s),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ks(s))):Q.resolve())}ys(e,s){if(Qu(s))return Q.resolve(null);let n=ks(s);return this.indexManager.getIndexType(e,n).next(r=>r===0?null:(s.limit!==null&&r===1&&(s=Bl(s,null,"F"),n=ks(s)),this.indexManager.getDocumentsMatchingTarget(e,n).next(o=>{const a=Be(...o);return this.ps.getDocuments(e,a).next(l=>this.indexManager.getMinOffset(e,n).next(u=>{const d=this.Ds(s,l);return this.Cs(s,d,a,u.readTime)?this.ys(e,Bl(s,null,"F")):this.vs(e,d,s,u)}))})))}ws(e,s,n,r){return Qu(s)||r.isEqual(Pe.min())?Q.resolve(null):this.ps.getDocuments(e,n).next(o=>{const a=this.Ds(s,o);return this.Cs(s,a,n,r)?Q.resolve(null):(xr()<=Oe.DEBUG&&pe("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),yr(s)),this.vs(e,a,s,Ob(r,ki)).next(l=>l))})}Ds(e,s){let n=new kt(zp(e));return s.forEach((r,o)=>{Ra(e,o)&&(n=n.add(o))}),n}Cs(e,s,n,r){if(e.limit===null)return!1;if(n.size!==s.size)return!0;const o=e.limitType==="F"?s.last():s.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(r)>0)}Ss(e,s,n){return xr()<=Oe.DEBUG&&pe("QueryEngine","Using full collection scan to execute query:",yr(s)),this.ps.getDocumentsMatchingQuery(e,s,An.min(),n)}vs(e,s,n,r){return this.ps.getDocumentsMatchingQuery(e,n,r).next(o=>(s.forEach(a=>{o=o.insert(a.key,a)}),o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zc="LocalStore",v_=3e8;class b_{constructor(e,s,n,r){this.persistence=e,this.Fs=s,this.serializer=r,this.Ms=new xt(ze),this.xs=new cr(o=>jc(o),kc),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new l_(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",s=>e.collect(s,this.Ms))}}function w_(t,e,s,n){return new b_(t,e,s,n)}async function dg(t,e){const s=ke(t);return await s.persistence.runTransaction("Handle user change","readonly",n=>{let r;return s.mutationQueue.getAllMutationBatches(n).next(o=>(r=o,s.Bs(e),s.mutationQueue.getAllMutationBatches(n))).next(o=>{const a=[],l=[];let u=Be();for(const d of r){a.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}for(const d of o){l.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}return s.localDocuments.getDocuments(n,u).next(d=>({Ls:d,removedBatchIds:a,addedBatchIds:l}))})})}function __(t,e){const s=ke(t);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const r=e.batch.keys(),o=s.Ns.newChangeBuffer({trackRemovals:!0});return function(l,u,d,f){const p=d.batch,g=p.keys();let v=Q.resolve();return g.forEach(A=>{v=v.next(()=>f.getEntry(u,A)).next(k=>{const S=d.docVersions.get(A);nt(S!==null,48541),k.version.compareTo(S)<0&&(p.applyToRemoteDocument(k,d),k.isValidDocument()&&(k.setReadTime(d.commitVersion),f.addEntry(k)))})}),v.next(()=>l.mutationQueue.removeMutationBatch(u,p))}(s,n,e,o).next(()=>o.apply(n)).next(()=>s.mutationQueue.performConsistencyCheck(n)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(n,r,e.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(l){let u=Be();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(u=u.add(l.batch.mutations[d].key));return u}(e))).next(()=>s.localDocuments.getDocuments(n,r))})}function ug(t){const e=ke(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",s=>e.Pi.getLastRemoteSnapshotVersion(s))}function N_(t,e){const s=ke(t),n=e.snapshotVersion;let r=s.Ms;return s.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const a=s.Ns.newChangeBuffer({trackRemovals:!0});r=s.Ms;const l=[];e.targetChanges.forEach((f,p)=>{const g=r.get(p);if(!g)return;l.push(s.Pi.removeMatchingKeys(o,f.removedDocuments,p).next(()=>s.Pi.addMatchingKeys(o,f.addedDocuments,p)));let v=g.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(p)!==null?v=v.withResumeToken(Ht.EMPTY_BYTE_STRING,Pe.min()).withLastLimboFreeSnapshotVersion(Pe.min()):f.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(f.resumeToken,n)),r=r.insert(p,v),function(k,S,L){return k.resumeToken.approximateByteSize()===0||S.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=v_?!0:L.addedDocuments.size+L.modifiedDocuments.size+L.removedDocuments.size>0}(g,v,f)&&l.push(s.Pi.updateTargetData(o,v))});let u=sn(),d=Be();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&l.push(s.persistence.referenceDelegate.updateLimboDocument(o,f))}),l.push(E_(o,a,e.documentUpdates).next(f=>{u=f.ks,d=f.qs})),!n.isEqual(Pe.min())){const f=s.Pi.getLastRemoteSnapshotVersion(o).next(p=>s.Pi.setTargetsMetadata(o,o.currentSequenceNumber,n));l.push(f)}return Q.waitFor(l).next(()=>a.apply(o)).next(()=>s.localDocuments.getLocalViewOfDocuments(o,u,d)).next(()=>u)}).then(o=>(s.Ms=r,o))}function E_(t,e,s){let n=Be(),r=Be();return s.forEach(o=>n=n.add(o)),e.getEntries(t,n).next(o=>{let a=sn();return s.forEach((l,u)=>{const d=o.get(l);u.isFoundDocument()!==d.isFoundDocument()&&(r=r.add(l)),u.isNoDocument()&&u.version.isEqual(Pe.min())?(e.removeEntry(l,u.readTime),a=a.insert(l,u)):!d.isValidDocument()||u.version.compareTo(d.version)>0||u.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(u),a=a.insert(l,u)):pe(zc,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",u.version)}),{ks:a,qs:r}})}function T_(t,e){const s=ke(t);return s.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=Ac),s.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function I_(t,e){const s=ke(t);return s.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return s.Pi.getTargetData(n,e).next(o=>o?(r=o,Q.resolve(r)):s.Pi.allocateTargetId(n).next(a=>(r=new _n(e,a,"TargetPurposeListen",n.currentSequenceNumber),s.Pi.addTargetData(n,r).next(()=>r))))}).then(n=>{const r=s.Ms.get(n.targetId);return(r===null||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(s.Ms=s.Ms.insert(n.targetId,n),s.xs.set(e,n.targetId)),n})}async function Wl(t,e,s){const n=ke(t),r=n.Ms.get(e),o=s?"readwrite":"readwrite-primary";try{s||await n.persistence.runTransaction("Release target",o,a=>n.persistence.referenceDelegate.removeTarget(a,r))}catch(a){if(!Gr(a))throw a;pe(zc,`Failed to update sequence numbers for target ${e}: ${a}`)}n.Ms=n.Ms.remove(e),n.xs.delete(r.target)}function uh(t,e,s){const n=ke(t);let r=Pe.min(),o=Be();return n.persistence.runTransaction("Execute query","readwrite",a=>function(u,d,f){const p=ke(u),g=p.xs.get(f);return g!==void 0?Q.resolve(p.Ms.get(g)):p.Pi.getTargetData(d,f)}(n,a,ks(e)).next(l=>{if(l)return r=l.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(a,l.targetId).next(u=>{o=u})}).next(()=>n.Fs.getDocumentsMatchingQuery(a,e,s?r:Pe.min(),s?o:Be())).next(l=>(C_(n,hw(e),l),{documents:l,Qs:o})))}function C_(t,e,s){let n=t.Os.get(e)||Pe.min();s.forEach((r,o)=>{o.readTime.compareTo(n)>0&&(n=o.readTime)}),t.Os.set(e,n)}class hh{constructor(){this.activeTargetIds=yw()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class S_{constructor(){this.Mo=new hh,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,s,n){}addLocalQueryTarget(e,s=!0){return s&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,s,n){this.xo[e]=s}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new hh,Promise.resolve()}handleUserChange(e,s,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A_{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mh="ConnectivityMonitor";class fh{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){pe(mh,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){pe(mh,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vo=null;function Jl(){return vo===null?vo=function(){return 268435456+Math.round(2147483648*Math.random())}():vo++,"0x"+vo.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wl="RestConnection",R_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class P_{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const s=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=s+"://"+e.host,this.Ko=`projects/${n}/databases/${r}`,this.Wo=this.databaseId.database===Ho?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Go(e,s,n,r,o){const a=Jl(),l=this.zo(e,s.toUriEncodedString());pe(wl,`Sending RPC '${e}' ${a}:`,l,n);const u={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(u,r,o);const{host:d}=new URL(l),f=ar(d);return this.Jo(e,l,u,n,f).then(p=>(pe(wl,`Received RPC '${e}' ${a}: `,p),p),p=>{throw Mr(wl,`RPC '${e}' ${a} failed with error: `,p,"url: ",l,"request:",n),p})}Ho(e,s,n,r,o,a){return this.Go(e,s,n,r,o)}jo(e,s,n){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Br}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((r,o)=>e[o]=r),n&&n.headers.forEach((r,o)=>e[o]=r)}zo(e,s){const n=R_[e];return`${this.Uo}/v1/${s}:${n}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j_{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jt="WebChannelConnection";class k_ extends P_{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,s,n,r,o){const a=Jl();return new Promise((l,u)=>{const d=new fp;d.setWithCredentials(!0),d.listenOnce(pp.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Co.NO_ERROR:const p=d.getResponseJson();pe(Jt,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(p)),l(p);break;case Co.TIMEOUT:pe(Jt,`RPC '${e}' ${a} timed out`),u(new ue(X.DEADLINE_EXCEEDED,"Request time out"));break;case Co.HTTP_ERROR:const g=d.getStatus();if(pe(Jt,`RPC '${e}' ${a} failed with status:`,g,"response text:",d.getResponseText()),g>0){let v=d.getResponseJson();Array.isArray(v)&&(v=v[0]);const A=v==null?void 0:v.error;if(A&&A.status&&A.message){const k=function(L){const D=L.toLowerCase().replace(/_/g,"-");return Object.values(X).indexOf(D)>=0?D:X.UNKNOWN}(A.status);u(new ue(k,A.message))}else u(new ue(X.UNKNOWN,"Server responded with status "+d.getStatus()))}else u(new ue(X.UNAVAILABLE,"Connection failed."));break;default:Ce(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{pe(Jt,`RPC '${e}' ${a} completed.`)}});const f=JSON.stringify(r);pe(Jt,`RPC '${e}' ${a} sending request:`,r),d.send(s,"POST",f,n,15)})}T_(e,s,n){const r=Jl(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=yp(),l=xp(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.jo(u.initMessageHeaders,s,n),u.encodeInitMessageHeaders=!0;const f=o.join("");pe(Jt,`Creating RPC '${e}' stream ${r}: ${f}`,u);const p=a.createWebChannel(f,u);this.I_(p);let g=!1,v=!1;const A=new j_({Yo:S=>{v?pe(Jt,`Not sending because RPC '${e}' stream ${r} is closed:`,S):(g||(pe(Jt,`Opening RPC '${e}' stream ${r} transport.`),p.open(),g=!0),pe(Jt,`RPC '${e}' stream ${r} sending:`,S),p.send(S))},Zo:()=>p.close()}),k=(S,L,D)=>{S.listen(L,j=>{try{D(j)}catch(F){setTimeout(()=>{throw F},0)}})};return k(p,ui.EventType.OPEN,()=>{v||(pe(Jt,`RPC '${e}' stream ${r} transport opened.`),A.o_())}),k(p,ui.EventType.CLOSE,()=>{v||(v=!0,pe(Jt,`RPC '${e}' stream ${r} transport closed`),A.a_(),this.E_(p))}),k(p,ui.EventType.ERROR,S=>{v||(v=!0,Mr(Jt,`RPC '${e}' stream ${r} transport errored. Name:`,S.name,"Message:",S.message),A.a_(new ue(X.UNAVAILABLE,"The operation could not be completed")))}),k(p,ui.EventType.MESSAGE,S=>{var L;if(!v){const D=S.data[0];nt(!!D,16349);const j=D,F=(j==null?void 0:j.error)||((L=j[0])==null?void 0:L.error);if(F){pe(Jt,`RPC '${e}' stream ${r} received error:`,F);const q=F.status;let E=function(_){const T=Tt[_];if(T!==void 0)return Qp(T)}(q),w=F.message;E===void 0&&(E=X.INTERNAL,w="Unknown error status: "+q+" with message "+F.message),v=!0,A.a_(new ue(E,w)),p.close()}else pe(Jt,`RPC '${e}' stream ${r} received:`,D),A.u_(D)}}),k(l,gp.STAT_EVENT,S=>{S.stat===Ml.PROXY?pe(Jt,`RPC '${e}' stream ${r} detected buffering proxy`):S.stat===Ml.NOPROXY&&pe(Jt,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{A.__()},0),A}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(s=>s===e)}}function _l(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ma(t){return new Vw(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hg{constructor(e,s,n=1e3,r=1.5,o=6e4){this.Mi=e,this.timerId=s,this.d_=n,this.A_=r,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const s=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,s-n);r>0&&pe("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${s} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ph="PersistentStream";class mg{constructor(e,s,n,r,o,a,l,u){this.Mi=e,this.S_=n,this.b_=r,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new hg(e,s)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,s){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():s&&s.code===X.RESOURCE_EXHAUSTED?(tn(s.toString()),tn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):s&&s.code===X.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(s)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),s=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,r])=>{this.D_===s&&this.G_(n,r)},n=>{e(()=>{const r=new ue(X.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(r)})})}G_(e,s){const n=this.W_(this.D_);this.stream=this.j_(e,s),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(r=>{n(()=>this.z_(r))}),this.stream.onMessage(r=>{n(()=>++this.F_==1?this.J_(r):this.onNext(r))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return pe(ph,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return s=>{this.Mi.enqueueAndForget(()=>this.D_===e?s():(pe(ph,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class D_ extends mg{constructor(e,s,n,r,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",s,n,r,a),this.serializer=o}j_(e,s){return this.connection.T_("Listen",e,s)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const s=Ow(this.serializer,e),n=function(o){if(!("targetChange"in o))return Pe.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?Pe.min():a.readTime?Ds(a.readTime):Pe.min()}(e);return this.listener.H_(s,n)}Y_(e){const s={};s.database=Hl(this.serializer),s.addTarget=function(o,a){let l;const u=a.target;if(l=Ol(u)?{documents:qw(o,u)}:{query:Gw(o,u).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=tg(o,a.resumeToken);const d=ql(o,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(Pe.min())>0){l.readTime=Xo(o,a.snapshotVersion.toTimestamp());const d=ql(o,a.expectedCount);d!==null&&(l.expectedCount=d)}return l}(this.serializer,e);const n=Hw(this.serializer,e);n&&(s.labels=n),this.q_(s)}Z_(e){const s={};s.database=Hl(this.serializer),s.removeTarget=e,this.q_(s)}}class M_ extends mg{constructor(e,s,n,r,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",s,n,r,a),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,s){return this.connection.T_("Write",e,s)}J_(e){return nt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,nt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){nt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const s=Bw(e.writeResults,e.commitTime),n=Ds(e.commitTime);return this.listener.na(n,s)}ra(){const e={};e.database=Hl(this.serializer),this.q_(e)}ea(e){const s={streamToken:this.lastStreamToken,writes:e.map(n=>zw(this.serializer,n))};this.q_(s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L_{}class V_ extends L_{constructor(e,s,n,r){super(),this.authCredentials=e,this.appCheckCredentials=s,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new ue(X.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,s,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Go(e,Gl(s,n),r,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===X.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new ue(X.UNKNOWN,o.toString())})}Ho(e,s,n,r,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.Ho(e,Gl(s,n),r,a,l,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===X.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new ue(X.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class U_{constructor(e,s){this.asyncQueue=e,this.onlineStateHandler=s,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const s=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(tn(s),this.aa=!1):pe("OnlineStateTracker",s)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sr="RemoteStore";class F_{constructor(e,s,n,r,o){this.localStore=e,this.datastore=s,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo(a=>{n.enqueueAndForget(async()=>{dr(this)&&(pe(sr,"Restarting streams for network reachability change."),await async function(u){const d=ke(u);d.Ea.add(4),await Ji(d),d.Ra.set("Unknown"),d.Ea.delete(4),await La(d)}(this))})}),this.Ra=new U_(n,r)}}async function La(t){if(dr(t))for(const e of t.da)await e(!0)}async function Ji(t){for(const e of t.da)await e(!1)}function fg(t,e){const s=ke(t);s.Ia.has(e.targetId)||(s.Ia.set(e.targetId,e),$c(s)?Gc(s):Hr(s).O_()&&qc(s,e))}function Bc(t,e){const s=ke(t),n=Hr(s);s.Ia.delete(e),n.O_()&&pg(s,e),s.Ia.size===0&&(n.O_()?n.L_():dr(s)&&s.Ra.set("Unknown"))}function qc(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Pe.min())>0){const s=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(s)}Hr(t).Y_(e)}function pg(t,e){t.Va.Ue(e),Hr(t).Z_(e)}function Gc(t){t.Va=new kw({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),Hr(t).start(),t.Ra.ua()}function $c(t){return dr(t)&&!Hr(t).x_()&&t.Ia.size>0}function dr(t){return ke(t).Ea.size===0}function gg(t){t.Va=void 0}async function O_(t){t.Ra.set("Online")}async function z_(t){t.Ia.forEach((e,s)=>{qc(t,e)})}async function B_(t,e){gg(t),$c(t)?(t.Ra.ha(e),Gc(t)):t.Ra.set("Unknown")}async function q_(t,e,s){if(t.Ra.set("Online"),e instanceof eg&&e.state===2&&e.cause)try{await async function(r,o){const a=o.cause;for(const l of o.targetIds)r.Ia.has(l)&&(await r.remoteSyncer.rejectListen(l,a),r.Ia.delete(l),r.Va.removeTarget(l))}(t,e)}catch(n){pe(sr,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Zo(t,n)}else if(e instanceof Po?t.Va.Ze(e):e instanceof Zp?t.Va.st(e):t.Va.tt(e),!s.isEqual(Pe.min()))try{const n=await ug(t.localStore);s.compareTo(n)>=0&&await function(o,a){const l=o.Va.Tt(a);return l.targetChanges.forEach((u,d)=>{if(u.resumeToken.approximateByteSize()>0){const f=o.Ia.get(d);f&&o.Ia.set(d,f.withResumeToken(u.resumeToken,a))}}),l.targetMismatches.forEach((u,d)=>{const f=o.Ia.get(u);if(!f)return;o.Ia.set(u,f.withResumeToken(Ht.EMPTY_BYTE_STRING,f.snapshotVersion)),pg(o,u);const p=new _n(f.target,u,d,f.sequenceNumber);qc(o,p)}),o.remoteSyncer.applyRemoteEvent(l)}(t,s)}catch(n){pe(sr,"Failed to raise snapshot:",n),await Zo(t,n)}}async function Zo(t,e,s){if(!Gr(e))throw e;t.Ea.add(1),await Ji(t),t.Ra.set("Offline"),s||(s=()=>ug(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{pe(sr,"Retrying IndexedDB access"),await s(),t.Ea.delete(1),await La(t)})}function xg(t,e){return e().catch(s=>Zo(t,s,e))}async function Va(t){const e=ke(t),s=kn(e);let n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Ac;for(;G_(e);)try{const r=await T_(e.localStore,n);if(r===null){e.Ta.length===0&&s.L_();break}n=r.batchId,$_(e,r)}catch(r){await Zo(e,r)}yg(e)&&vg(e)}function G_(t){return dr(t)&&t.Ta.length<10}function $_(t,e){t.Ta.push(e);const s=kn(t);s.O_()&&s.X_&&s.ea(e.mutations)}function yg(t){return dr(t)&&!kn(t).x_()&&t.Ta.length>0}function vg(t){kn(t).start()}async function H_(t){kn(t).ra()}async function W_(t){const e=kn(t);for(const s of t.Ta)e.ea(s.mutations)}async function J_(t,e,s){const n=t.Ta.shift(),r=Mc.from(n,e,s);await xg(t,()=>t.remoteSyncer.applySuccessfulWrite(r)),await Va(t)}async function K_(t,e){e&&kn(t).X_&&await async function(n,r){if(function(a){return Rw(a)&&a!==X.ABORTED}(r.code)){const o=n.Ta.shift();kn(n).B_(),await xg(n,()=>n.remoteSyncer.rejectFailedWrite(o.batchId,r)),await Va(n)}}(t,e),yg(t)&&vg(t)}async function gh(t,e){const s=ke(t);s.asyncQueue.verifyOperationInProgress(),pe(sr,"RemoteStore received new credentials");const n=dr(s);s.Ea.add(3),await Ji(s),n&&s.Ra.set("Unknown"),await s.remoteSyncer.handleCredentialChange(e),s.Ea.delete(3),await La(s)}async function Y_(t,e){const s=ke(t);e?(s.Ea.delete(2),await La(s)):e||(s.Ea.add(2),await Ji(s),s.Ra.set("Unknown"))}function Hr(t){return t.ma||(t.ma=function(s,n,r){const o=ke(s);return o.sa(),new D_(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,r)}(t.datastore,t.asyncQueue,{Xo:O_.bind(null,t),t_:z_.bind(null,t),r_:B_.bind(null,t),H_:q_.bind(null,t)}),t.da.push(async e=>{e?(t.ma.B_(),$c(t)?Gc(t):t.Ra.set("Unknown")):(await t.ma.stop(),gg(t))})),t.ma}function kn(t){return t.fa||(t.fa=function(s,n,r){const o=ke(s);return o.sa(),new M_(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,r)}(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:H_.bind(null,t),r_:K_.bind(null,t),ta:W_.bind(null,t),na:J_.bind(null,t)}),t.da.push(async e=>{e?(t.fa.B_(),await Va(t)):(await t.fa.stop(),t.Ta.length>0&&(pe(sr,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))})),t.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hc{constructor(e,s,n,r,o){this.asyncQueue=e,this.timerId=s,this.targetTimeMs=n,this.op=r,this.removalCallback=o,this.deferred=new Ys,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,s,n,r,o){const a=Date.now()+n,l=new Hc(e,s,a,r,o);return l.start(n),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ue(X.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Wc(t,e){if(tn("AsyncQueue",`${e}: ${t}`),Gr(t))return new ue(X.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ir{static emptySet(e){return new Ir(e.comparator)}constructor(e){this.comparator=e?(s,n)=>e(s,n)||we.comparator(s.key,n.key):(s,n)=>we.comparator(s.key,n.key),this.keyedMap=hi(),this.sortedSet=new xt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const s=this.keyedMap.get(e);return s?this.sortedSet.indexOf(s):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((s,n)=>(e(s),!1))}add(e){const s=this.delete(e.key);return s.copy(s.keyedMap.insert(e.key,e),s.sortedSet.insert(e,null))}delete(e){const s=this.get(e);return s?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(s)):this}isEqual(e){if(!(e instanceof Ir)||this.size!==e.size)return!1;const s=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;s.hasNext();){const r=s.getNext().key,o=n.getNext().key;if(!r.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach(s=>{e.push(s.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,s){const n=new Ir;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=s,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xh{constructor(){this.ga=new xt(we.comparator)}track(e){const s=e.doc.key,n=this.ga.get(s);n?e.type!==0&&n.type===3?this.ga=this.ga.insert(s,e):e.type===3&&n.type!==1?this.ga=this.ga.insert(s,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.ga=this.ga.insert(s,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.ga=this.ga.insert(s,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.ga=this.ga.remove(s):e.type===1&&n.type===2?this.ga=this.ga.insert(s,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.ga=this.ga.insert(s,{type:2,doc:e.doc}):Ce(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(s,e)}ya(){const e=[];return this.ga.inorderTraversal((s,n)=>{e.push(n)}),e}}class Or{constructor(e,s,n,r,o,a,l,u,d){this.query=e,this.docs=s,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=d}static fromInitialDocuments(e,s,n,r,o){const a=[];return s.forEach(l=>{a.push({type:0,doc:l})}),new Or(e,s,Ir.emptySet(s),a,n,r,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Aa(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const s=this.docChanges,n=e.docChanges;if(s.length!==n.length)return!1;for(let r=0;r<s.length;r++)if(s[r].type!==n[r].type||!s[r].doc.isEqual(n[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X_{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class Q_{constructor(){this.queries=yh(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(s,n){const r=ke(s),o=r.queries;r.queries=yh(),o.forEach((a,l)=>{for(const u of l.Sa)u.onError(n)})})(this,new ue(X.ABORTED,"Firestore shutting down"))}}function yh(){return new cr(t=>Op(t),Aa)}async function Jc(t,e){const s=ke(t);let n=3;const r=e.query;let o=s.queries.get(r);o?!o.ba()&&e.Da()&&(n=2):(o=new X_,n=e.Da()?0:1);try{switch(n){case 0:o.wa=await s.onListen(r,!0);break;case 1:o.wa=await s.onListen(r,!1);break;case 2:await s.onFirstRemoteStoreListen(r)}}catch(a){const l=Wc(a,`Initialization of query '${yr(e.query)}' failed`);return void e.onError(l)}s.queries.set(r,o),o.Sa.push(e),e.va(s.onlineState),o.wa&&e.Fa(o.wa)&&Yc(s)}async function Kc(t,e){const s=ke(t),n=e.query;let r=3;const o=s.queries.get(n);if(o){const a=o.Sa.indexOf(e);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?r=e.Da()?0:1:!o.ba()&&e.Da()&&(r=2))}switch(r){case 0:return s.queries.delete(n),s.onUnlisten(n,!0);case 1:return s.queries.delete(n),s.onUnlisten(n,!1);case 2:return s.onLastRemoteStoreUnlisten(n);default:return}}function Z_(t,e){const s=ke(t);let n=!1;for(const r of e){const o=r.query,a=s.queries.get(o);if(a){for(const l of a.Sa)l.Fa(r)&&(n=!0);a.wa=r}}n&&Yc(s)}function eN(t,e,s){const n=ke(t),r=n.queries.get(e);if(r)for(const o of r.Sa)o.onError(s);n.queries.delete(e)}function Yc(t){t.Ca.forEach(e=>{e.next()})}var Kl,vh;(vh=Kl||(Kl={})).Ma="default",vh.Cache="cache";class Xc{constructor(e,s,n){this.query=e,this.xa=s,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const n=[];for(const r of e.docChanges)r.type!==3&&n.push(r);e=new Or(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let s=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),s=!0):this.La(e,this.onlineState)&&(this.ka(e),s=!0),this.Na=e,s}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let s=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),s=!0),s}La(e,s){if(!e.fromCache||!this.Da())return!0;const n=s!=="Offline";return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||s==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const s=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!s)&&this.options.includeMetadataChanges===!0}ka(e){e=Or.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Kl.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bg{constructor(e){this.key=e}}class wg{constructor(e){this.key=e}}class tN{constructor(e,s){this.query=e,this.Ya=s,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Be(),this.mutatedKeys=Be(),this.eu=zp(e),this.tu=new Ir(this.eu)}get nu(){return this.Ya}ru(e,s){const n=s?s.iu:new xh,r=s?s.tu:this.tu;let o=s?s.mutatedKeys:this.mutatedKeys,a=r,l=!1;const u=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,d=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((f,p)=>{const g=r.get(f),v=Ra(this.query,p)?p:null,A=!!g&&this.mutatedKeys.has(g.key),k=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let S=!1;g&&v?g.data.isEqual(v.data)?A!==k&&(n.track({type:3,doc:v}),S=!0):this.su(g,v)||(n.track({type:2,doc:v}),S=!0,(u&&this.eu(v,u)>0||d&&this.eu(v,d)<0)&&(l=!0)):!g&&v?(n.track({type:0,doc:v}),S=!0):g&&!v&&(n.track({type:1,doc:g}),S=!0,(u||d)&&(l=!0)),S&&(v?(a=a.add(v),o=k?o.add(f):o.delete(f)):(a=a.delete(f),o=o.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),o=o.delete(f.key),n.track({type:1,doc:f})}return{tu:a,iu:n,Cs:l,mutatedKeys:o}}su(e,s){return e.hasLocalMutations&&s.hasCommittedMutations&&!s.hasLocalMutations}applyChanges(e,s,n,r){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort((f,p)=>function(v,A){const k=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ce(20277,{Rt:S})}};return k(v)-k(A)}(f.type,p.type)||this.eu(f.doc,p.doc)),this.ou(n),r=r??!1;const l=s&&!r?this._u():[],u=this.Xa.size===0&&this.current&&!r?1:0,d=u!==this.Za;return this.Za=u,a.length!==0||d?{snapshot:new Or(this.query,e.tu,o,a,e.mutatedKeys,u===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new xh,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(s=>this.Ya=this.Ya.add(s)),e.modifiedDocuments.forEach(s=>{}),e.removedDocuments.forEach(s=>this.Ya=this.Ya.delete(s)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Be(),this.tu.forEach(n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))});const s=[];return e.forEach(n=>{this.Xa.has(n)||s.push(new wg(n))}),this.Xa.forEach(n=>{e.has(n)||s.push(new bg(n))}),s}cu(e){this.Ya=e.Qs,this.Xa=Be();const s=this.ru(e.documents);return this.applyChanges(s,!0)}lu(){return Or.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Qc="SyncEngine";class sN{constructor(e,s,n){this.query=e,this.targetId=s,this.view=n}}class nN{constructor(e){this.key=e,this.hu=!1}}class rN{constructor(e,s,n,r,o,a){this.localStore=e,this.remoteStore=s,this.eventManager=n,this.sharedClientState=r,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new cr(l=>Op(l),Aa),this.Iu=new Map,this.Eu=new Set,this.du=new xt(we.comparator),this.Au=new Map,this.Ru=new Uc,this.Vu={},this.mu=new Map,this.fu=Fr.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function iN(t,e,s=!0){const n=Cg(t);let r;const o=n.Tu.get(e);return o?(n.sharedClientState.addLocalQueryTarget(o.targetId),r=o.view.lu()):r=await _g(n,e,s,!0),r}async function oN(t,e){const s=Cg(t);await _g(s,e,!0,!1)}async function _g(t,e,s,n){const r=await I_(t.localStore,ks(e)),o=r.targetId,a=t.sharedClientState.addLocalQueryTarget(o,s);let l;return n&&(l=await aN(t,e,o,a==="current",r.resumeToken)),t.isPrimaryClient&&s&&fg(t.remoteStore,r),l}async function aN(t,e,s,n,r){t.pu=(p,g,v)=>async function(k,S,L,D){let j=S.view.ru(L);j.Cs&&(j=await uh(k.localStore,S.query,!1).then(({documents:w})=>S.view.ru(w,j)));const F=D&&D.targetChanges.get(S.targetId),q=D&&D.targetMismatches.get(S.targetId)!=null,E=S.view.applyChanges(j,k.isPrimaryClient,F,q);return wh(k,S.targetId,E.au),E.snapshot}(t,p,g,v);const o=await uh(t.localStore,e,!0),a=new tN(e,o.Qs),l=a.ru(o.documents),u=Wi.createSynthesizedTargetChangeForCurrentChange(s,n&&t.onlineState!=="Offline",r),d=a.applyChanges(l,t.isPrimaryClient,u);wh(t,s,d.au);const f=new sN(e,s,a);return t.Tu.set(e,f),t.Iu.has(s)?t.Iu.get(s).push(e):t.Iu.set(s,[e]),d.snapshot}async function lN(t,e,s){const n=ke(t),r=n.Tu.get(e),o=n.Iu.get(r.targetId);if(o.length>1)return n.Iu.set(r.targetId,o.filter(a=>!Aa(a,e))),void n.Tu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Wl(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),s&&Bc(n.remoteStore,r.targetId),Yl(n,r.targetId)}).catch(qr)):(Yl(n,r.targetId),await Wl(n.localStore,r.targetId,!0))}async function cN(t,e){const s=ke(t),n=s.Tu.get(e),r=s.Iu.get(n.targetId);s.isPrimaryClient&&r.length===1&&(s.sharedClientState.removeLocalQueryTarget(n.targetId),Bc(s.remoteStore,n.targetId))}async function dN(t,e,s){const n=xN(t);try{const r=await function(a,l){const u=ke(a),d=ht.now(),f=l.reduce((v,A)=>v.add(A.key),Be());let p,g;return u.persistence.runTransaction("Locally write mutations","readwrite",v=>{let A=sn(),k=Be();return u.Ns.getEntries(v,f).next(S=>{A=S,A.forEach((L,D)=>{D.isValidDocument()||(k=k.add(L))})}).next(()=>u.localDocuments.getOverlayedDocuments(v,A)).next(S=>{p=S;const L=[];for(const D of l){const j=Tw(D,p.get(D.key).overlayedDocument);j!=null&&L.push(new Ln(D.key,j,jp(j.value.mapValue),rs.exists(!0)))}return u.mutationQueue.addMutationBatch(v,d,L,l)}).next(S=>{g=S;const L=S.applyToLocalDocumentSet(p,k);return u.documentOverlayCache.saveOverlays(v,S.batchId,L)})}).then(()=>({batchId:g.batchId,changes:qp(p)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(r.batchId),function(a,l,u){let d=a.Vu[a.currentUser.toKey()];d||(d=new xt(ze)),d=d.insert(l,u),a.Vu[a.currentUser.toKey()]=d}(n,r.batchId,s),await Ki(n,r.changes),await Va(n.remoteStore)}catch(r){const o=Wc(r,"Failed to persist write");s.reject(o)}}async function Ng(t,e){const s=ke(t);try{const n=await N_(s.localStore,e);e.targetChanges.forEach((r,o)=>{const a=s.Au.get(o);a&&(nt(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?a.hu=!0:r.modifiedDocuments.size>0?nt(a.hu,14607):r.removedDocuments.size>0&&(nt(a.hu,42227),a.hu=!1))}),await Ki(s,n,e)}catch(n){await qr(n)}}function bh(t,e,s){const n=ke(t);if(n.isPrimaryClient&&s===0||!n.isPrimaryClient&&s===1){const r=[];n.Tu.forEach((o,a)=>{const l=a.view.va(e);l.snapshot&&r.push(l.snapshot)}),function(a,l){const u=ke(a);u.onlineState=l;let d=!1;u.queries.forEach((f,p)=>{for(const g of p.Sa)g.va(l)&&(d=!0)}),d&&Yc(u)}(n.eventManager,e),r.length&&n.Pu.H_(r),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function uN(t,e,s){const n=ke(t);n.sharedClientState.updateQueryState(e,"rejected",s);const r=n.Au.get(e),o=r&&r.key;if(o){let a=new xt(we.comparator);a=a.insert(o,Yt.newNoDocument(o,Pe.min()));const l=Be().add(o),u=new Da(Pe.min(),new Map,new xt(ze),a,l);await Ng(n,u),n.du=n.du.remove(o),n.Au.delete(e),Zc(n)}else await Wl(n.localStore,e,!1).then(()=>Yl(n,e,s)).catch(qr)}async function hN(t,e){const s=ke(t),n=e.batch.batchId;try{const r=await __(s.localStore,e);Tg(s,n,null),Eg(s,n),s.sharedClientState.updateMutationState(n,"acknowledged"),await Ki(s,r)}catch(r){await qr(r)}}async function mN(t,e,s){const n=ke(t);try{const r=await function(a,l){const u=ke(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return u.mutationQueue.lookupMutationBatch(d,l).next(p=>(nt(p!==null,37113),f=p.keys(),u.mutationQueue.removeMutationBatch(d,p))).next(()=>u.mutationQueue.performConsistencyCheck(d)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(d,f,l)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>u.localDocuments.getDocuments(d,f))})}(n.localStore,e);Tg(n,e,s),Eg(n,e),n.sharedClientState.updateMutationState(e,"rejected",s),await Ki(n,r)}catch(r){await qr(r)}}function Eg(t,e){(t.mu.get(e)||[]).forEach(s=>{s.resolve()}),t.mu.delete(e)}function Tg(t,e,s){const n=ke(t);let r=n.Vu[n.currentUser.toKey()];if(r){const o=r.get(e);o&&(s?o.reject(s):o.resolve(),r=r.remove(e)),n.Vu[n.currentUser.toKey()]=r}}function Yl(t,e,s=null){t.sharedClientState.removeLocalQueryTarget(e);for(const n of t.Iu.get(e))t.Tu.delete(n),s&&t.Pu.yu(n,s);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach(n=>{t.Ru.containsKey(n)||Ig(t,n)})}function Ig(t,e){t.Eu.delete(e.path.canonicalString());const s=t.du.get(e);s!==null&&(Bc(t.remoteStore,s),t.du=t.du.remove(e),t.Au.delete(s),Zc(t))}function wh(t,e,s){for(const n of s)n instanceof bg?(t.Ru.addReference(n.key,e),fN(t,n)):n instanceof wg?(pe(Qc,"Document no longer in limbo: "+n.key),t.Ru.removeReference(n.key,e),t.Ru.containsKey(n.key)||Ig(t,n.key)):Ce(19791,{wu:n})}function fN(t,e){const s=e.key,n=s.path.canonicalString();t.du.get(s)||t.Eu.has(n)||(pe(Qc,"New document in limbo: "+s),t.Eu.add(n),Zc(t))}function Zc(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const s=new we(ct.fromString(e)),n=t.fu.next();t.Au.set(n,new nN(s)),t.du=t.du.insert(s,n),fg(t.remoteStore,new _n(ks(Sa(s.path)),n,"TargetPurposeLimboResolution",Ta.ce))}}async function Ki(t,e,s){const n=ke(t),r=[],o=[],a=[];n.Tu.isEmpty()||(n.Tu.forEach((l,u)=>{a.push(n.pu(u,e,s).then(d=>{var f;if((d||s)&&n.isPrimaryClient){const p=d?!d.fromCache:(f=s==null?void 0:s.targetChanges.get(u.targetId))==null?void 0:f.current;n.sharedClientState.updateQueryState(u.targetId,p?"current":"not-current")}if(d){r.push(d);const p=Oc.As(u.targetId,d);o.push(p)}}))}),await Promise.all(a),n.Pu.H_(r),await async function(u,d){const f=ke(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>Q.forEach(d,g=>Q.forEach(g.Es,v=>f.persistence.referenceDelegate.addReference(p,g.targetId,v)).next(()=>Q.forEach(g.ds,v=>f.persistence.referenceDelegate.removeReference(p,g.targetId,v)))))}catch(p){if(!Gr(p))throw p;pe(zc,"Failed to update sequence numbers: "+p)}for(const p of d){const g=p.targetId;if(!p.fromCache){const v=f.Ms.get(g),A=v.snapshotVersion,k=v.withLastLimboFreeSnapshotVersion(A);f.Ms=f.Ms.insert(g,k)}}}(n.localStore,o))}async function pN(t,e){const s=ke(t);if(!s.currentUser.isEqual(e)){pe(Qc,"User change. New user:",e.toKey());const n=await dg(s.localStore,e);s.currentUser=e,function(o,a){o.mu.forEach(l=>{l.forEach(u=>{u.reject(new ue(X.CANCELLED,a))})}),o.mu.clear()}(s,"'waitForPendingWrites' promise is rejected due to a user change."),s.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await Ki(s,n.Ls)}}function gN(t,e){const s=ke(t),n=s.Au.get(e);if(n&&n.hu)return Be().add(n.key);{let r=Be();const o=s.Iu.get(e);if(!o)return r;for(const a of o){const l=s.Tu.get(a);r=r.unionWith(l.view.nu)}return r}}function Cg(t){const e=ke(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ng.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=gN.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=uN.bind(null,e),e.Pu.H_=Z_.bind(null,e.eventManager),e.Pu.yu=eN.bind(null,e.eventManager),e}function xN(t){const e=ke(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=hN.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=mN.bind(null,e),e}class ea{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Ma(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,s){return null}Mu(e,s){return null}vu(e){return w_(this.persistence,new y_,e.initialUser,this.serializer)}Cu(e){return new cg(Fc.mi,this.serializer)}Du(e){return new S_}async terminate(){var e,s;(e=this.gcScheduler)==null||e.stop(),(s=this.indexBackfillerScheduler)==null||s.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ea.provider={build:()=>new ea};class yN extends ea{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,s){nt(this.persistence.referenceDelegate instanceof Qo,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new n_(n,e.asyncQueue,s)}Cu(e){const s=this.cacheSizeBytes!==void 0?os.withCacheSize(this.cacheSizeBytes):os.DEFAULT;return new cg(n=>Qo.mi(n,s),this.serializer)}}class Xl{async initialize(e,s){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(s),this.remoteStore=this.createRemoteStore(s),this.eventManager=this.createEventManager(s),this.syncEngine=this.createSyncEngine(s,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>bh(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=pN.bind(null,this.syncEngine),await Y_(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Q_}()}createDatastore(e){const s=Ma(e.databaseInfo.databaseId),n=function(o){return new k_(o)}(e.databaseInfo);return function(o,a,l,u){return new V_(o,a,l,u)}(e.authCredentials,e.appCheckCredentials,n,s)}createRemoteStore(e){return function(n,r,o,a,l){return new F_(n,r,o,a,l)}(this.localStore,this.datastore,e.asyncQueue,s=>bh(this.syncEngine,s,0),function(){return fh.v()?new fh:new A_}())}createSyncEngine(e,s){return function(r,o,a,l,u,d,f){const p=new rN(r,o,a,l,u,d);return f&&(p.gu=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,s)}async terminate(){var e,s;await async function(r){const o=ke(r);pe(sr,"RemoteStore shutting down."),o.Ea.add(5),await Ji(o),o.Aa.shutdown(),o.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(s=this.eventManager)==null||s.terminate()}}Xl.provider={build:()=>new Xl};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ed{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):tn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,s){setTimeout(()=>{this.muted||e(s)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dn="FirestoreClient";class vN{constructor(e,s,n,r,o){this.authCredentials=e,this.appCheckCredentials=s,this.asyncQueue=n,this.databaseInfo=r,this.user=Kt.UNAUTHENTICATED,this.clientId=Sc.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(n,async a=>{pe(Dn,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(n,a=>(pe(Dn,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ys;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(s){const n=Wc(s,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Nl(t,e){t.asyncQueue.verifyOperationInProgress(),pe(Dn,"Initializing OfflineComponentProvider");const s=t.configuration;await e.initialize(s);let n=s.initialUser;t.setCredentialChangeListener(async r=>{n.isEqual(r)||(await dg(e.localStore,r),n=r)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function _h(t,e){t.asyncQueue.verifyOperationInProgress();const s=await bN(t);pe(Dn,"Initializing OnlineComponentProvider"),await e.initialize(s,t.configuration),t.setCredentialChangeListener(n=>gh(e.remoteStore,n)),t.setAppCheckTokenChangeListener((n,r)=>gh(e.remoteStore,r)),t._onlineComponents=e}async function bN(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){pe(Dn,"Using user provided OfflineComponentProvider");try{await Nl(t,t._uninitializedComponentsProvider._offline)}catch(e){const s=e;if(!function(r){return r.name==="FirebaseError"?r.code===X.FAILED_PRECONDITION||r.code===X.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(s))throw s;Mr("Error using user provided cache. Falling back to memory cache: "+s),await Nl(t,new ea)}}else pe(Dn,"Using default OfflineComponentProvider"),await Nl(t,new yN(void 0));return t._offlineComponents}async function Sg(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(pe(Dn,"Using user provided OnlineComponentProvider"),await _h(t,t._uninitializedComponentsProvider._online)):(pe(Dn,"Using default OnlineComponentProvider"),await _h(t,new Xl))),t._onlineComponents}function wN(t){return Sg(t).then(e=>e.syncEngine)}async function ta(t){const e=await Sg(t),s=e.eventManager;return s.onListen=iN.bind(null,e.syncEngine),s.onUnlisten=lN.bind(null,e.syncEngine),s.onFirstRemoteStoreListen=oN.bind(null,e.syncEngine),s.onLastRemoteStoreUnlisten=cN.bind(null,e.syncEngine),s}function _N(t,e,s={}){const n=new Ys;return t.asyncQueue.enqueueAndForget(async()=>function(o,a,l,u,d){const f=new ed({next:g=>{f.Nu(),a.enqueueAndForget(()=>Kc(o,p));const v=g.docs.has(l);!v&&g.fromCache?d.reject(new ue(X.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&g.fromCache&&u&&u.source==="server"?d.reject(new ue(X.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(g)},error:g=>d.reject(g)}),p=new Xc(Sa(l.path),f,{includeMetadataChanges:!0,qa:!0});return Jc(o,p)}(await ta(t),t.asyncQueue,e,s,n)),n.promise}function NN(t,e,s={}){const n=new Ys;return t.asyncQueue.enqueueAndForget(async()=>function(o,a,l,u,d){const f=new ed({next:g=>{f.Nu(),a.enqueueAndForget(()=>Kc(o,p)),g.fromCache&&u.source==="server"?d.reject(new ue(X.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(g)},error:g=>d.reject(g)}),p=new Xc(l,f,{includeMetadataChanges:!0,qa:!0});return Jc(o,p)}(await ta(t),t.asyncQueue,e,s,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ag(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nh=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rg="firestore.googleapis.com",Eh=!0;class Th{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new ue(X.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Rg,this.ssl=Eh}else this.host=e.host,this.ssl=e.ssl??Eh;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=lg;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<t_)throw new ue(X.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Fb("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ag(e.experimentalLongPollingOptions??{}),function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new ue(X.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new ue(X.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new ue(X.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,r){return n.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ua{constructor(e,s,n,r){this._authCredentials=e,this._appCheckCredentials=s,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Th({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ue(X.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ue(X.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Th(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new Ab;switch(n.type){case"firstParty":return new kb(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new ue(X.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(s){const n=Nh.get(s);n&&(pe("ComponentProvider","Removing Datastore"),Nh.delete(s),n.terminate())}(this),Promise.resolve()}}function EN(t,e,s,n={}){var d;t=ns(t,Ua);const r=ar(e),o=t._getSettings(),a={...o,emulatorOptions:t._getEmulatorOptions()},l=`${e}:${s}`;r&&(_c(`https://${l}`),Nc("Firestore",!0)),o.host!==Rg&&o.host!==l&&Mr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...o,host:l,ssl:r,emulatorOptions:n};if(!Zn(u,a)&&(t._setSettings(u),n.mockUserToken)){let f,p;if(typeof n.mockUserToken=="string")f=n.mockUserToken,p=Kt.MOCK_USER;else{f=ap(n.mockUserToken,(d=t._app)==null?void 0:d.options.projectId);const g=n.mockUserToken.sub||n.mockUserToken.user_id;if(!g)throw new ue(X.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Kt(g)}t._authCredentials=new Rb(new bp(f,p))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vn{constructor(e,s,n){this.converter=s,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Vn(this.firestore,e,this._query)}}class bt{constructor(e,s,n){this.converter=s,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Cn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new bt(this.firestore,e,this._key)}toJSON(){return{type:bt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,s,n){if($i(s,bt._jsonSchema))return new bt(e,n||null,new we(ct.fromString(s.referencePath)))}}bt._jsonSchemaVersion="firestore/documentReference/1.0",bt._jsonSchema={type:Ct("string",bt._jsonSchemaVersion),referencePath:Ct("string")};class Cn extends Vn{constructor(e,s,n){super(e,s,Sa(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new bt(this.firestore,null,new we(e))}withConverter(e){return new Cn(this.firestore,e,this._path)}}function Ee(t,e,...s){if(t=gt(t),wp("collection","path",e),t instanceof Ua){const n=ct.fromString(e,...s);return Uu(n),new Cn(t,null,n)}{if(!(t instanceof bt||t instanceof Cn))throw new ue(X.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t._path.child(ct.fromString(e,...s));return Uu(n),new Cn(t.firestore,null,n)}}function yt(t,e,...s){if(t=gt(t),arguments.length===1&&(e=Sc.newId()),wp("doc","path",e),t instanceof Ua){const n=ct.fromString(e,...s);return Vu(n),new bt(t,null,new we(n))}{if(!(t instanceof bt||t instanceof Cn))throw new ue(X.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t._path.child(ct.fromString(e,...s));return Vu(n),new bt(t.firestore,t instanceof Cn?t.converter:null,new we(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ih="AsyncQueue";class Ch{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new hg(this,"async_queue_retry"),this._c=()=>{const n=_l();n&&pe(Ih,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=e;const s=_l();s&&typeof s.addEventListener=="function"&&s.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const s=_l();s&&typeof s.removeEventListener=="function"&&s.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const s=new Ys;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(s.resolve,s.reject),s.promise)).then(()=>s.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Gr(e))throw e;pe(Ih,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const s=this.ac.then(()=>(this.rc=!0,e().catch(n=>{throw this.nc=n,this.rc=!1,tn("INTERNAL UNHANDLED ERROR: ",Sh(n)),n}).then(n=>(this.rc=!1,n))));return this.ac=s,s}enqueueAfterDelay(e,s,n){this.uc(),this.oc.indexOf(e)>-1&&(s=0);const r=Hc.createAndSchedule(this,e,s,n,o=>this.hc(o));return this.tc.push(r),r}uc(){this.nc&&Ce(47125,{Pc:Sh(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const s of this.tc)if(s.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((s,n)=>s.targetTimeMs-n.targetTimeMs);for(const s of this.tc)if(s.skipDelay(),e!=="all"&&s.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const s=this.tc.indexOf(e);this.tc.splice(s,1)}}function Sh(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ah(t){return function(s,n){if(typeof s!="object"||s===null)return!1;const r=s;for(const o of n)if(o in r&&typeof r[o]=="function")return!0;return!1}(t,["next","error","complete"])}class zs extends Ua{constructor(e,s,n,r){super(e,s,n,r),this.type="firestore",this._queue=new Ch,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Ch(e),this._firestoreClient=void 0,await e}}}function TN(t,e){const s=typeof t=="object"?t:Ic(),n=typeof t=="string"?t:Ho,r=Na(s,"firestore").getImmediate({identifier:n});if(!r._initialized){const o=rp("firestore");o&&EN(r,...o)}return r}function Yi(t){if(t._terminated)throw new ue(X.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||IN(t),t._firestoreClient}function IN(t){var n,r,o;const e=t._freezeSettings(),s=function(l,u,d,f){return new Yb(l,u,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,Ag(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)}(t._databaseId,((n=t._app)==null?void 0:n.options.appId)||"",t._persistenceKey,e);t._componentsProvider||(r=e.localCache)!=null&&r._offlineComponentProvider&&((o=e.localCache)!=null&&o._onlineComponentProvider)&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new vN(t._authCredentials,t._appCheckCredentials,t._queue,s,t._componentsProvider&&function(l){const u=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(u),_online:u}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ps{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ps(Ht.fromBase64String(e))}catch(s){throw new ue(X.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+s)}}static fromUint8Array(e){return new ps(Ht.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:ps._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if($i(e,ps._jsonSchema))return ps.fromBase64String(e.bytes)}}ps._jsonSchemaVersion="firestore/bytes/1.0",ps._jsonSchema={type:Ct("string",ps._jsonSchemaVersion),bytes:Ct("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xi{constructor(...e){for(let s=0;s<e.length;++s)if(e[s].length===0)throw new ue(X.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new qt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class td{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ms{constructor(e,s){if(!isFinite(e)||e<-90||e>90)throw new ue(X.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(s)||s<-180||s>180)throw new ue(X.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+s);this._lat=e,this._long=s}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ze(this._lat,e._lat)||ze(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ms._jsonSchemaVersion}}static fromJSON(e){if($i(e,Ms._jsonSchema))return new Ms(e.latitude,e.longitude)}}Ms._jsonSchemaVersion="firestore/geoPoint/1.0",Ms._jsonSchema={type:Ct("string",Ms._jsonSchemaVersion),latitude:Ct("number"),longitude:Ct("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ls{constructor(e){this._values=(e||[]).map(s=>s)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,r){if(n.length!==r.length)return!1;for(let o=0;o<n.length;++o)if(n[o]!==r[o])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Ls._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if($i(e,Ls._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(s=>typeof s=="number"))return new Ls(e.vectorValues);throw new ue(X.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ls._jsonSchemaVersion="firestore/vectorValue/1.0",Ls._jsonSchema={type:Ct("string",Ls._jsonSchemaVersion),vectorValues:Ct("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CN=/^__.*__$/;class SN{constructor(e,s,n){this.data=e,this.fieldMask=s,this.fieldTransforms=n}toMutation(e,s){return this.fieldMask!==null?new Ln(e,this.data,this.fieldMask,s,this.fieldTransforms):new Hi(e,this.data,s,this.fieldTransforms)}}class Pg{constructor(e,s,n){this.data=e,this.fieldMask=s,this.fieldTransforms=n}toMutation(e,s){return new Ln(e,this.data,this.fieldMask,s,this.fieldTransforms)}}function jg(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ce(40011,{Ac:t})}}class sd{constructor(e,s,n,r,o,a){this.settings=e,this.databaseId=s,this.serializer=n,this.ignoreUndefinedProperties=r,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new sd({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var r;const s=(r=this.path)==null?void 0:r.child(e),n=this.Vc({path:s,fc:!1});return n.gc(e),n}yc(e){var r;const s=(r=this.path)==null?void 0:r.child(e),n=this.Vc({path:s,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return sa(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(s=>e.isPrefixOf(s))!==void 0||this.fieldTransforms.find(s=>e.isPrefixOf(s.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(jg(this.Ac)&&CN.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class AN{constructor(e,s,n){this.databaseId=e,this.ignoreUndefinedProperties=s,this.serializer=n||Ma(e)}Cc(e,s,n,r=!1){return new sd({Ac:e,methodName:s,Dc:n,path:qt.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Qi(t){const e=t._freezeSettings(),s=Ma(t._databaseId);return new AN(t._databaseId,!!e.ignoreUndefinedProperties,s)}function nd(t,e,s,n,r,o={}){const a=t.Cc(o.merge||o.mergeFields?2:0,e,s,r);rd("Data must be an object, but it was:",a,n);const l=Mg(n,a);let u,d;if(o.merge)u=new us(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){const f=[];for(const p of o.mergeFields){const g=Ql(e,p,s);if(!a.contains(g))throw new ue(X.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);Vg(f,g)||f.push(g)}u=new us(f),d=a.fieldTransforms.filter(p=>u.covers(p.field))}else u=null,d=a.fieldTransforms;return new SN(new as(l),u,d)}class Fa extends td{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Fa}}function kg(t,e,s,n){const r=t.Cc(1,e,s);rd("Data must be an object, but it was:",r,n);const o=[],a=as.empty();Mn(n,(u,d)=>{const f=id(e,u,s);d=gt(d);const p=r.yc(f);if(d instanceof Fa)o.push(f);else{const g=Zi(d,p);g!=null&&(o.push(f),a.set(f,g))}});const l=new us(o);return new Pg(a,l,r.fieldTransforms)}function Dg(t,e,s,n,r,o){const a=t.Cc(1,e,s),l=[Ql(e,n,s)],u=[r];if(o.length%2!=0)throw new ue(X.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<o.length;g+=2)l.push(Ql(e,o[g])),u.push(o[g+1]);const d=[],f=as.empty();for(let g=l.length-1;g>=0;--g)if(!Vg(d,l[g])){const v=l[g];let A=u[g];A=gt(A);const k=a.yc(v);if(A instanceof Fa)d.push(v);else{const S=Zi(A,k);S!=null&&(d.push(v),f.set(v,S))}}const p=new us(d);return new Pg(f,p,a.fieldTransforms)}function RN(t,e,s,n=!1){return Zi(s,t.Cc(n?4:3,e))}function Zi(t,e){if(Lg(t=gt(t)))return rd("Unsupported field value:",e,t),Mg(t,e);if(t instanceof td)return function(n,r){if(!jg(r.Ac))throw r.Sc(`${n._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Sc(`${n._methodName}() is not currently supported inside arrays`);const o=n._toFieldTransform(r);o&&r.fieldTransforms.push(o)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(n,r){const o=[];let a=0;for(const l of n){let u=Zi(l,r.wc(a));u==null&&(u={nullValue:"NULL_VALUE"}),o.push(u),a++}return{arrayValue:{values:o}}}(t,e)}return function(n,r){if((n=gt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return vw(r.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const o=ht.fromDate(n);return{timestampValue:Xo(r.serializer,o)}}if(n instanceof ht){const o=new ht(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Xo(r.serializer,o)}}if(n instanceof Ms)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof ps)return{bytesValue:tg(r.serializer,n._byteString)};if(n instanceof bt){const o=r.databaseId,a=n.firestore._databaseId;if(!a.isEqual(o))throw r.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Vc(n.firestore._databaseId||r.databaseId,n._key.path)}}if(n instanceof Ls)return function(a,l){return{mapValue:{fields:{[Rp]:{stringValue:Pp},[Wo]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw l.Sc("VectorValues must only contain numeric values.");return Dc(l.serializer,d)})}}}}}}(n,r);throw r.Sc(`Unsupported field value: ${Ea(n)}`)}(t,e)}function Mg(t,e){const s={};return Ep(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Mn(t,(n,r)=>{const o=Zi(r,e.mc(n));o!=null&&(s[n]=o)}),{mapValue:{fields:s}}}function Lg(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof ht||t instanceof Ms||t instanceof ps||t instanceof bt||t instanceof td||t instanceof Ls)}function rd(t,e,s){if(!Lg(s)||!_p(s)){const n=Ea(s);throw n==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+n)}}function Ql(t,e,s){if((e=gt(e))instanceof Xi)return e._internalPath;if(typeof e=="string")return id(t,e);throw sa("Field path arguments must be of type string or ",t,!1,void 0,s)}const PN=new RegExp("[~\\*/\\[\\]]");function id(t,e,s){if(e.search(PN)>=0)throw sa(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,s);try{return new Xi(...e.split("."))._internalPath}catch{throw sa(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,s)}}function sa(t,e,s,n,r){const o=n&&!n.isEmpty(),a=r!==void 0;let l=`Function ${e}() called with invalid data`;s&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(o||a)&&(u+=" (found",o&&(u+=` in field ${n}`),a&&(u+=` in document ${r}`),u+=")"),new ue(X.INVALID_ARGUMENT,l+t+u)}function Vg(t,e){return t.some(s=>s.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ug{constructor(e,s,n,r,o){this._firestore=e,this._userDataWriter=s,this._key=n,this._document=r,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new bt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new jN(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const s=this._document.data.field(Oa("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s)}}}class jN extends Ug{data(){return super.data()}}function Oa(t,e){return typeof e=="string"?id(t,e):e instanceof Xi?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fg(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new ue(X.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class od{}class Og extends od{}function Nt(t,e,...s){let n=[];e instanceof od&&n.push(e),n=n.concat(s),function(o){const a=o.filter(u=>u instanceof ad).length,l=o.filter(u=>u instanceof za).length;if(a>1||a>0&&l>0)throw new ue(X.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const r of n)t=r._apply(t);return t}class za extends Og{constructor(e,s,n){super(),this._field=e,this._op=s,this._value=n,this.type="where"}static _create(e,s,n){return new za(e,s,n)}_apply(e){const s=this._parse(e);return zg(e._query,s),new Vn(e.firestore,e.converter,zl(e._query,s))}_parse(e){const s=Qi(e.firestore);return function(o,a,l,u,d,f,p){let g;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new ue(X.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){Ph(p,f);const A=[];for(const k of p)A.push(Rh(u,o,k));g={arrayValue:{values:A}}}else g=Rh(u,o,p)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||Ph(p,f),g=RN(l,a,p,f==="in"||f==="not-in");return It.create(d,f,g)}(e._query,"where",s,e.firestore._databaseId,this._field,this._op,this._value)}}function Lt(t,e,s){const n=e,r=Oa("where",t);return za._create(r,n,s)}class ad extends od{constructor(e,s){super(),this.type=e,this._queryConstraints=s}static _create(e,s){return new ad(e,s)}_parse(e){const s=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return s.length===1?s[0]:Ns.create(s,this._getOperator())}_apply(e){const s=this._parse(e);return s.getFilters().length===0?e:(function(r,o){let a=r;const l=o.getFlattenedFilters();for(const u of l)zg(a,u),a=zl(a,u)}(e._query,s),new Vn(e.firestore,e.converter,zl(e._query,s)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class ld extends Og{constructor(e,s){super(),this._field=e,this._direction=s,this.type="orderBy"}static _create(e,s){return new ld(e,s)}_apply(e){const s=function(r,o,a){if(r.startAt!==null)throw new ue(X.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new ue(X.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Vi(o,a)}(e._query,this._field,this._direction);return new Vn(e.firestore,e.converter,function(r,o){const a=r.explicitOrderBy.concat([o]);return new $r(r.path,r.collectionGroup,a,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,s))}}function ur(t,e="asc"){const s=e,n=Oa("orderBy",t);return ld._create(n,s)}function Rh(t,e,s){if(typeof(s=gt(s))=="string"){if(s==="")throw new ue(X.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Fp(e)&&s.indexOf("/")!==-1)throw new ue(X.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${s}' contains a '/' character.`);const n=e.path.child(ct.fromString(s));if(!we.isDocumentKey(n))throw new ue(X.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Hu(t,new we(n))}if(s instanceof bt)return Hu(t,s._key);throw new ue(X.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ea(s)}.`)}function Ph(t,e){if(!Array.isArray(t)||t.length===0)throw new ue(X.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function zg(t,e){const s=function(r,o){for(const a of r)for(const l of a.getFlattenedFilters())if(o.indexOf(l.op)>=0)return l.op;return null}(t.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(s!==null)throw s===e.op?new ue(X.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ue(X.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${s.toString()}' filters.`)}class kN{convertValue(e,s="none"){switch(jn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return _t(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,s);case 5:return e.stringValue;case 6:return this.convertBytes(Pn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,s);case 11:return this.convertObject(e.mapValue,s);case 10:return this.convertVectorValue(e.mapValue);default:throw Ce(62114,{value:e})}}convertObject(e,s){return this.convertObjectMap(e.fields,s)}convertObjectMap(e,s="none"){const n={};return Mn(e,(r,o)=>{n[r]=this.convertValue(o,s)}),n}convertVectorValue(e){var n,r,o;const s=(o=(r=(n=e.fields)==null?void 0:n[Wo].arrayValue)==null?void 0:r.values)==null?void 0:o.map(a=>_t(a.doubleValue));return new Ls(s)}convertGeoPoint(e){return new Ms(_t(e.latitude),_t(e.longitude))}convertArray(e,s){return(e.values||[]).map(n=>this.convertValue(n,s))}convertServerTimestamp(e,s){switch(s){case"previous":const n=Ca(e);return n==null?null:this.convertValue(n,s);case"estimate":return this.convertTimestamp(Di(e));default:return null}}convertTimestamp(e){const s=Rn(e);return new ht(s.seconds,s.nanos)}convertDocumentKey(e,s){const n=ct.fromString(e);nt(ag(n),9688,{name:e});const r=new Mi(n.get(1),n.get(3)),o=new we(n.popFirst(5));return r.isEqual(s)||tn(`Document ${o} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${s.projectId}/${s.database}) instead.`),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cd(t,e,s){let n;return n=t?s&&(s.merge||s.mergeFields)?t.toFirestore(e,s):t.toFirestore(e):e,n}class fi{constructor(e,s){this.hasPendingWrites=e,this.fromCache=s}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Yn extends Ug{constructor(e,s,n,r,o,a){super(e,s,n,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const s=new jo(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(s,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,s={}){if(this._document){const n=this._document.data.field(Oa("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,s.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new ue(X.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,s={};return s.type=Yn._jsonSchemaVersion,s.bundle="",s.bundleSource="DocumentSnapshot",s.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?s:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),s.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),s)}}Yn._jsonSchemaVersion="firestore/documentSnapshot/1.0",Yn._jsonSchema={type:Ct("string",Yn._jsonSchemaVersion),bundleSource:Ct("string","DocumentSnapshot"),bundleName:Ct("string"),bundle:Ct("string")};class jo extends Yn{data(e={}){return super.data(e)}}class Xn{constructor(e,s,n,r){this._firestore=e,this._userDataWriter=s,this._snapshot=r,this.metadata=new fi(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(s=>e.push(s)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,s){this._snapshot.docs.forEach(n=>{e.call(s,new jo(this._firestore,this._userDataWriter,n.key,n,new fi(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const s=!!e.includeMetadataChanges;if(s&&this._snapshot.excludesMetadataChanges)throw new ue(X.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===s||(this._cachedChanges=function(r,o){if(r._snapshot.oldDocs.isEmpty()){let a=0;return r._snapshot.docChanges.map(l=>{const u=new jo(r._firestore,r._userDataWriter,l.doc.key,l.doc,new fi(r._snapshot.mutatedKeys.has(l.doc.key),r._snapshot.fromCache),r.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}})}{let a=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(l=>o||l.type!==3).map(l=>{const u=new jo(r._firestore,r._userDataWriter,l.doc.key,l.doc,new fi(r._snapshot.mutatedKeys.has(l.doc.key),r._snapshot.fromCache),r.query.converter);let d=-1,f=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),f=a.indexOf(l.doc.key)),{type:DN(l.type),doc:u,oldIndex:d,newIndex:f}})}}(this,s),this._cachedChangesIncludeMetadataChanges=s),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new ue(X.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Xn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Sc.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const s=[],n=[],r=[];return this.docs.forEach(o=>{o._document!==null&&(s.push(o._document),n.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),r.push(o.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function DN(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ce(61501,{type:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MN(t){t=ns(t,bt);const e=ns(t.firestore,zs);return _N(Yi(e),t._key).then(s=>Gg(e,t,s))}Xn._jsonSchemaVersion="firestore/querySnapshot/1.0",Xn._jsonSchema={type:Ct("string",Xn._jsonSchemaVersion),bundleSource:Ct("string","QuerySnapshot"),bundleName:Ct("string"),bundle:Ct("string")};class dd extends kN{constructor(e){super(),this.firestore=e}convertBytes(e){return new ps(e)}convertReference(e){const s=this.convertDocumentKey(e,this.firestore._databaseId);return new bt(this.firestore,null,s)}}function Vt(t){t=ns(t,Vn);const e=ns(t.firestore,zs),s=Yi(e),n=new dd(e);return Fg(t._query),NN(s,t._query).then(r=>new Xn(e,n,t,r))}function Bg(t,e,s){t=ns(t,bt);const n=ns(t.firestore,zs),r=cd(t.converter,e,s);return eo(n,[nd(Qi(n),"setDoc",t._key,r,t.converter!==null,s).toMutation(t._key,rs.none())])}function Wt(t,e,s,...n){t=ns(t,bt);const r=ns(t.firestore,zs),o=Qi(r);let a;return a=typeof(e=gt(e))=="string"||e instanceof Xi?Dg(o,"updateDoc",t._key,e,s,n):kg(o,"updateDoc",t._key,e),eo(r,[a.toMutation(t._key,rs.exists(!0))])}function qg(t){return eo(ns(t.firestore,zs),[new ka(t._key,rs.none())])}function Zt(t,e){const s=ns(t.firestore,zs),n=yt(t),r=cd(t.converter,e);return eo(s,[nd(Qi(t.firestore),"addDoc",n._key,r,t.converter!==null,{}).toMutation(n._key,rs.exists(!1))]).then(()=>n)}function es(t,...e){var u,d,f;t=gt(t);let s={includeMetadataChanges:!1,source:"default"},n=0;typeof e[n]!="object"||Ah(e[n])||(s=e[n++]);const r={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Ah(e[n])){const p=e[n];e[n]=(u=p.next)==null?void 0:u.bind(p),e[n+1]=(d=p.error)==null?void 0:d.bind(p),e[n+2]=(f=p.complete)==null?void 0:f.bind(p)}let o,a,l;if(t instanceof bt)a=ns(t.firestore,zs),l=Sa(t._key.path),o={next:p=>{e[n]&&e[n](Gg(a,t,p))},error:e[n+1],complete:e[n+2]};else{const p=ns(t,Vn);a=ns(p.firestore,zs),l=p._query;const g=new dd(a);o={next:v=>{e[n]&&e[n](new Xn(a,g,p,v))},error:e[n+1],complete:e[n+2]},Fg(t._query)}return function(g,v,A,k){const S=new ed(k),L=new Xc(v,S,A);return g.asyncQueue.enqueueAndForget(async()=>Jc(await ta(g),L)),()=>{S.Nu(),g.asyncQueue.enqueueAndForget(async()=>Kc(await ta(g),L))}}(Yi(a),l,r,o)}function eo(t,e){return function(n,r){const o=new Ys;return n.asyncQueue.enqueueAndForget(async()=>dN(await wN(n),r,o)),o.promise}(Yi(t),e)}function Gg(t,e,s){const n=s.docs.get(e._key),r=new dd(t);return new Yn(t,r,e._key,n,new fi(s.hasPendingWrites,s.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LN{constructor(e,s){this._firestore=e,this._commitHandler=s,this._mutations=[],this._committed=!1,this._dataReader=Qi(e)}set(e,s,n){this._verifyNotCommitted();const r=El(e,this._firestore),o=cd(r.converter,s,n),a=nd(this._dataReader,"WriteBatch.set",r._key,o,r.converter!==null,n);return this._mutations.push(a.toMutation(r._key,rs.none())),this}update(e,s,n,...r){this._verifyNotCommitted();const o=El(e,this._firestore);let a;return a=typeof(s=gt(s))=="string"||s instanceof Xi?Dg(this._dataReader,"WriteBatch.update",o._key,s,n,r):kg(this._dataReader,"WriteBatch.update",o._key,s),this._mutations.push(a.toMutation(o._key,rs.exists(!0))),this}delete(e){this._verifyNotCommitted();const s=El(e,this._firestore);return this._mutations=this._mutations.concat(new ka(s._key,rs.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new ue(X.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function El(t,e){if((t=gt(t)).firestore!==e)throw new ue(X.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VN(t){return Yi(t=ns(t,zs)),new LN(t,e=>eo(t,e))}(function(e,s=!0){(function(r){Br=r})(lr),er(new Sn("firestore",(n,{instanceIdentifier:r,options:o})=>{const a=n.getProvider("app").getImmediate(),l=new zs(new Pb(n.getProvider("auth-internal")),new Db(a,n.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new ue(X.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Mi(d.options.projectId,f)}(a,r),a);return o={useFetchStreams:s,...o},l._setSettings(o),l},"PUBLIC").setMultipleInstances(!0)),js(ku,Du,e),js(ku,Du,"esm2020")})();function $g(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const UN=$g,Hg=new qi("auth","Firebase",$g());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const na=new Ec("@firebase/auth");function FN(t,...e){na.logLevel<=Oe.WARN&&na.warn(`Auth (${lr}): ${t}`,...e)}function ko(t,...e){na.logLevel<=Oe.ERROR&&na.error(`Auth (${lr}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Es(t,...e){throw ud(t,...e)}function Vs(t,...e){return ud(t,...e)}function Wg(t,e,s){const n={...UN(),[e]:s};return new qi("auth","Firebase",n).create(e,{appName:t.name})}function Xs(t){return Wg(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ud(t,...e){if(typeof t!="string"){const s=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=t.name),t._errorFactory.create(s,...n)}return Hg.create(t,...e)}function Ie(t,e,...s){if(!t)throw ud(e,...s)}function $s(t){const e="INTERNAL ASSERTION FAILED: "+t;throw ko(e),new Error(e)}function nn(t,e){t||$s(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zl(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function ON(){return jh()==="http:"||jh()==="https:"}function jh(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zN(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(ON()||ov()||"connection"in navigator)?navigator.onLine:!0}function BN(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class to{constructor(e,s){this.shortDelay=e,this.longDelay=s,nn(s>e,"Short delay should be less than long delay!"),this.isMobile=nv()||av()}get(){return zN()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hd(t,e){nn(t.emulator,"Emulator should always be set here");const{url:s}=t.emulator;return e?`${s}${e.startsWith("/")?e.slice(1):e}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jg{static initialize(e,s,n){this.fetchImpl=e,s&&(this.headersImpl=s),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;$s("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;$s("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;$s("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qN={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GN=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],$N=new to(3e4,6e4);function on(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function an(t,e,s,n,r={}){return Kg(t,r,async()=>{let o={},a={};n&&(e==="GET"?a=n:o={body:JSON.stringify(n)});const l=Gi({key:t.config.apiKey,...a}).slice(1),u=await t._getAdditionalHeaders();u["Content-Type"]="application/json",t.languageCode&&(u["X-Firebase-Locale"]=t.languageCode);const d={method:e,headers:u,...o};return iv()||(d.referrerPolicy="no-referrer"),t.emulatorConfig&&ar(t.emulatorConfig.host)&&(d.credentials="include"),Jg.fetch()(await Yg(t,t.config.apiHost,s,l),d)})}async function Kg(t,e,s){t._canInitEmulator=!1;const n={...qN,...e};try{const r=new WN(t),o=await Promise.race([s(),r.promise]);r.clearNetworkTimeout();const a=await o.json();if("needConfirmation"in a)throw bo(t,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{const l=o.ok?a.errorMessage:a.error.message,[u,d]=l.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw bo(t,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw bo(t,"email-already-in-use",a);if(u==="USER_DISABLED")throw bo(t,"user-disabled",a);const f=n[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Wg(t,f,d);Es(t,f)}}catch(r){if(r instanceof qs)throw r;Es(t,"network-request-failed",{message:String(r)})}}async function so(t,e,s,n,r={}){const o=await an(t,e,s,n,r);return"mfaPendingCredential"in o&&Es(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function Yg(t,e,s,n){const r=`${e}${s}?${n}`,o=t,a=o.config.emulator?hd(t.config,r):`${t.config.apiScheme}://${r}`;return GN.includes(s)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(a).toString():a}function HN(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class WN{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((s,n)=>{this.timer=setTimeout(()=>n(Vs(this.auth,"network-request-failed")),$N.get())})}}function bo(t,e,s){const n={appName:t.name};s.email&&(n.email=s.email),s.phoneNumber&&(n.phoneNumber=s.phoneNumber);const r=Vs(t,e,n);return r.customData._tokenResponse=s,r}function kh(t){return t!==void 0&&t.enterprise!==void 0}class JN{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===e)return HN(s.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function KN(t,e){return an(t,"GET","/v2/recaptchaConfig",on(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YN(t,e){return an(t,"POST","/v1/accounts:delete",e)}async function ra(t,e){return an(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ei(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function XN(t,e=!1){const s=gt(t),n=await s.getIdToken(e),r=md(n);Ie(r&&r.exp&&r.auth_time&&r.iat,s.auth,"internal-error");const o=typeof r.firebase=="object"?r.firebase:void 0,a=o==null?void 0:o.sign_in_provider;return{claims:r,token:n,authTime:Ei(Tl(r.auth_time)),issuedAtTime:Ei(Tl(r.iat)),expirationTime:Ei(Tl(r.exp)),signInProvider:a||null,signInSecondFactor:(o==null?void 0:o.sign_in_second_factor)||null}}function Tl(t){return Number(t)*1e3}function md(t){const[e,s,n]=t.split(".");if(e===void 0||s===void 0||n===void 0)return ko("JWT malformed, contained fewer than 3 sections"),null;try{const r=sp(s);return r?JSON.parse(r):(ko("Failed to decode base64 JWT payload"),null)}catch(r){return ko("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function Dh(t){const e=md(t);return Ie(e,"internal-error"),Ie(typeof e.exp<"u","internal-error"),Ie(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Oi(t,e,s=!1){if(s)return e;try{return await e}catch(n){throw n instanceof qs&&QN(n)&&t.auth.currentUser===t&&await t.auth.signOut(),n}}function QN({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZN{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const n=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,n)}}schedule(e=!1){if(!this.isRunning)return;const s=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec{constructor(e,s){this.createdAt=e,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ei(this.lastLoginAt),this.creationTime=Ei(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ia(t){var p;const e=t.auth,s=await t.getIdToken(),n=await Oi(t,ra(e,{idToken:s}));Ie(n==null?void 0:n.users.length,e,"internal-error");const r=n.users[0];t._notifyReloadListener(r);const o=(p=r.providerUserInfo)!=null&&p.length?Xg(r.providerUserInfo):[],a=tE(t.providerData,o),l=t.isAnonymous,u=!(t.email&&r.passwordHash)&&!(a!=null&&a.length),d=l?u:!1,f={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new ec(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(t,f)}async function eE(t){const e=gt(t);await ia(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function tE(t,e){return[...t.filter(n=>!e.some(r=>r.providerId===n.providerId)),...e]}function Xg(t){return t.map(({providerId:e,...s})=>({providerId:e,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sE(t,e){const s=await Kg(t,{},async()=>{const n=Gi({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:o}=t.config,a=await Yg(t,r,"/v1/token",`key=${o}`),l=await t._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:l,body:n};return t.emulatorConfig&&ar(t.emulatorConfig.host)&&(u.credentials="include"),Jg.fetch()(a,u)});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function nE(t,e){return an(t,"POST","/v2/accounts:revokeToken",on(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cr{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ie(e.idToken,"internal-error"),Ie(typeof e.idToken<"u","internal-error"),Ie(typeof e.refreshToken<"u","internal-error");const s="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Dh(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,s)}updateFromIdToken(e){Ie(e.length!==0,"internal-error");const s=Dh(e);this.updateTokensAndExpiration(e,null,s)}async getToken(e,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(Ie(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,s){const{accessToken:n,refreshToken:r,expiresIn:o}=await sE(e,s);this.updateTokensAndExpiration(n,r,Number(o))}updateTokensAndExpiration(e,s,n){this.refreshToken=s||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,s){const{refreshToken:n,accessToken:r,expirationTime:o}=s,a=new Cr;return n&&(Ie(typeof n=="string","internal-error",{appName:e}),a.refreshToken=n),r&&(Ie(typeof r=="string","internal-error",{appName:e}),a.accessToken=r),o&&(Ie(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Cr,this.toJSON())}_performRefresh(){return $s("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xn(t,e){Ie(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class vs{constructor({uid:e,auth:s,stsTokenManager:n,...r}){this.providerId="firebase",this.proactiveRefresh=new ZN(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=s,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new ec(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const s=await Oi(this,this.stsTokenManager.getToken(this.auth,e));return Ie(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(e){return XN(this,e)}reload(){return eE(this)}_assign(e){this!==e&&(Ie(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(s=>({...s})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const s=new vs({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return s.metadata._copy(this.metadata),s}_onReload(e){Ie(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,s=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),s&&await ia(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ds(this.auth.app))return Promise.reject(Xs(this.auth));const e=await this.getIdToken();return await Oi(this,YN(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,s){const n=s.displayName??void 0,r=s.email??void 0,o=s.phoneNumber??void 0,a=s.photoURL??void 0,l=s.tenantId??void 0,u=s._redirectEventId??void 0,d=s.createdAt??void 0,f=s.lastLoginAt??void 0,{uid:p,emailVerified:g,isAnonymous:v,providerData:A,stsTokenManager:k}=s;Ie(p&&k,e,"internal-error");const S=Cr.fromJSON(this.name,k);Ie(typeof p=="string",e,"internal-error"),xn(n,e.name),xn(r,e.name),Ie(typeof g=="boolean",e,"internal-error"),Ie(typeof v=="boolean",e,"internal-error"),xn(o,e.name),xn(a,e.name),xn(l,e.name),xn(u,e.name),xn(d,e.name),xn(f,e.name);const L=new vs({uid:p,auth:e,email:r,emailVerified:g,displayName:n,isAnonymous:v,photoURL:a,phoneNumber:o,tenantId:l,stsTokenManager:S,createdAt:d,lastLoginAt:f});return A&&Array.isArray(A)&&(L.providerData=A.map(D=>({...D}))),u&&(L._redirectEventId=u),L}static async _fromIdTokenResponse(e,s,n=!1){const r=new Cr;r.updateFromServerResponse(s);const o=new vs({uid:s.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await ia(o),o}static async _fromGetAccountInfoResponse(e,s,n){const r=s.users[0];Ie(r.localId!==void 0,"internal-error");const o=r.providerUserInfo!==void 0?Xg(r.providerUserInfo):[],a=!(r.email&&r.passwordHash)&&!(o!=null&&o.length),l=new Cr;l.updateFromIdToken(n);const u=new vs({uid:r.localId,auth:e,stsTokenManager:l,isAnonymous:a}),d={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new ec(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(o!=null&&o.length)};return Object.assign(u,d),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mh=new Map;function Hs(t){nn(t instanceof Function,"Expected a class definition");let e=Mh.get(t);return e?(nn(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Mh.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qg{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,s){this.storage[e]=s}async _get(e){const s=this.storage[e];return s===void 0?null:s}async _remove(e){delete this.storage[e]}_addListener(e,s){}_removeListener(e,s){}}Qg.type="NONE";const Lh=Qg;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Do(t,e,s){return`firebase:${t}:${e}:${s}`}class Sr{constructor(e,s,n){this.persistence=e,this.auth=s,this.userKey=n;const{config:r,name:o}=this.auth;this.fullUserKey=Do(this.userKey,r.apiKey,o),this.fullPersistenceKey=Do("persistence",r.apiKey,o),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const s=await ra(this.auth,{idToken:e}).catch(()=>{});return s?vs._fromGetAccountInfoResponse(this.auth,s,e):null}return vs._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,s,n="authUser"){if(!s.length)return new Sr(Hs(Lh),e,n);const r=(await Promise.all(s.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let o=r[0]||Hs(Lh);const a=Do(n,e.config.apiKey,e.name);let l=null;for(const d of s)try{const f=await d._get(a);if(f){let p;if(typeof f=="string"){const g=await ra(e,{idToken:f}).catch(()=>{});if(!g)break;p=await vs._fromGetAccountInfoResponse(e,g,f)}else p=vs._fromJSON(e,f);d!==o&&(l=p),o=d;break}}catch{}const u=r.filter(d=>d._shouldAllowMigration);return!o._shouldAllowMigration||!u.length?new Sr(o,e,n):(o=u[0],l&&await o._set(a,l.toJSON()),await Promise.all(s.map(async d=>{if(d!==o)try{await d._remove(a)}catch{}})),new Sr(o,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vh(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(sx(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Zg(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(rx(e))return"Blackberry";if(ix(e))return"Webos";if(ex(e))return"Safari";if((e.includes("chrome/")||tx(e))&&!e.includes("edge/"))return"Chrome";if(nx(e))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=t.match(s);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function Zg(t=Qt()){return/firefox\//i.test(t)}function ex(t=Qt()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function tx(t=Qt()){return/crios\//i.test(t)}function sx(t=Qt()){return/iemobile/i.test(t)}function nx(t=Qt()){return/android/i.test(t)}function rx(t=Qt()){return/blackberry/i.test(t)}function ix(t=Qt()){return/webos/i.test(t)}function fd(t=Qt()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function rE(t=Qt()){var e;return fd(t)&&!!((e=window.navigator)!=null&&e.standalone)}function iE(){return lv()&&document.documentMode===10}function ox(t=Qt()){return fd(t)||nx(t)||ix(t)||rx(t)||/windows phone/i.test(t)||sx(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ax(t,e=[]){let s;switch(t){case"Browser":s=Vh(Qt());break;case"Worker":s=`${Vh(Qt())}-${t}`;break;default:s=t}const n=e.length?e.join(","):"FirebaseCore-web";return`${s}/JsCore/${lr}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oE{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,s){const n=o=>new Promise((a,l)=>{try{const u=e(o);a(u)}catch(u){l(u)}});n.onAbort=s,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const s=[];try{for(const n of this.queue)await n(e),n.onAbort&&s.push(n.onAbort)}catch(n){s.reverse();for(const r of s)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aE(t,e={}){return an(t,"GET","/v2/passwordPolicy",on(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lE=6;class cE{constructor(e){var n;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=s.minPasswordLength??lE,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),s.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),s.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),s.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),s.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((n=e.allowedNonAlphanumericCharacters)==null?void 0:n.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const s={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,s),this.validatePasswordCharacterOptions(e,s),s.isValid&&(s.isValid=s.meetsMinPasswordLength??!0),s.isValid&&(s.isValid=s.meetsMaxPasswordLength??!0),s.isValid&&(s.isValid=s.containsLowercaseLetter??!0),s.isValid&&(s.isValid=s.containsUppercaseLetter??!0),s.isValid&&(s.isValid=s.containsNumericCharacter??!0),s.isValid&&(s.isValid=s.containsNonAlphanumericCharacter??!0),s}validatePasswordLengthOptions(e,s){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(s.meetsMinPasswordLength=e.length>=n),r&&(s.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let n;for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(s,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,s,n,r,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dE{constructor(e,s,n,r){this.app=e,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Uh(this),this.idTokenSubscription=new Uh(this),this.beforeStateQueue=new oE(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Hg,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,s){return s&&(this._popupRedirectResolver=Hs(s)),this._initializationPromise=this.queue(async()=>{var n,r,o;if(!this._deleted&&(this.persistenceManager=await Sr.create(this,e),(n=this._resolvePersistenceManagerAvailable)==null||n.call(this),!this._deleted)){if((r=this._popupRedirectResolver)!=null&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((o=this.currentUser)==null?void 0:o.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const s=await ra(this,{idToken:e}),n=await vs._fromGetAccountInfoResponse(this,s,e);await this.directlySetCurrentUser(n)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var o;if(ds(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(l,l))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let n=s,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(o=this.redirectUser)==null?void 0:o._redirectEventId,l=n==null?void 0:n._redirectEventId,u=await this.tryRedirectSignIn(e);(!a||a===l)&&(u!=null&&u.user)&&(n=u.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(a){n=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return Ie(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(e){try{await ia(e)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=BN()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ds(this.app))return Promise.reject(Xs(this));const s=e?gt(e):null;return s&&Ie(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(e,s=!1){if(!this._deleted)return e&&Ie(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ds(this.app)?Promise.reject(Xs(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ds(this.app)?Promise.reject(Xs(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Hs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await aE(this),s=new cE(e);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new qi("auth","Firebase",e())}onAuthStateChanged(e,s,n){return this.registerStateListener(this.authStateSubscription,e,s,n)}beforeAuthStateChanged(e,s){return this.beforeStateQueue.pushCallback(e,s)}onIdTokenChanged(e,s,n){return this.registerStateListener(this.idTokenSubscription,e,s,n)}authStateReady(){return new Promise((e,s)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},s)}})}async revokeAccessToken(e){if(this.currentUser){const s=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:s};this.tenantId!=null&&(n.tenantId=this.tenantId),await nE(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,s){const n=await this.getOrInitRedirectPersistenceManager(s);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const s=e&&Hs(e)||this._popupRedirectResolver;Ie(s,this,"argument-error"),this.redirectPersistenceManager=await Sr.create(this,[Hs(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var s,n;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)==null?void 0:s._redirectEventId)===e?this._currentUser:((n=this.redirectUser)==null?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((s=this.currentUser)==null?void 0:s.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,s,n,r){if(this._deleted)return()=>{};const o=typeof s=="function"?s:s.next.bind(s);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ie(l,this,"internal-error"),l.then(()=>{a||o(this.currentUser)}),typeof s=="function"){const u=e.addObserver(s,n,r);return()=>{a=!0,u()}}else{const u=e.addObserver(s);return()=>{a=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ie(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ax(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var r;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const s=await((r=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:r.getHeartbeatsHeader());s&&(e["X-Firebase-Client"]=s);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){var s;if(ds(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((s=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getToken());return e!=null&&e.error&&FN(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Un(t){return gt(t)}class Uh{constructor(e){this.auth=e,this.observer=null,this.addObserver=gv(s=>this.observer=s)}get next(){return Ie(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ba={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function uE(t){Ba=t}function lx(t){return Ba.loadJS(t)}function hE(){return Ba.recaptchaEnterpriseScript}function mE(){return Ba.gapiScript}function fE(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class pE{constructor(){this.enterprise=new gE}ready(e){e()}execute(e,s){return Promise.resolve("token")}render(e,s){return""}}class gE{ready(e){e()}execute(e,s){return Promise.resolve("token")}render(e,s){return""}}const xE="recaptcha-enterprise",cx="NO_RECAPTCHA";class yE{constructor(e){this.type=xE,this.auth=Un(e)}async verify(e="verify",s=!1){async function n(o){if(!s){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(a,l)=>{KN(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new JN(u);return o.tenantId==null?o._agentRecaptchaConfig=d:o._tenantRecaptchaConfigs[o.tenantId]=d,a(d.siteKey)}}).catch(u=>{l(u)})})}function r(o,a,l){const u=window.grecaptcha;kh(u)?u.enterprise.ready(()=>{u.enterprise.execute(o,{action:e}).then(d=>{a(d)}).catch(()=>{a(cx)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new pE().execute("siteKey",{action:"verify"}):new Promise((o,a)=>{n(this.auth).then(l=>{if(!s&&kh(window.grecaptcha))r(l,o,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let u=hE();u.length!==0&&(u+=l),lx(u).then(()=>{r(l,o,a)}).catch(d=>{a(d)})}}).catch(l=>{a(l)})})}}async function Fh(t,e,s,n=!1,r=!1){const o=new yE(t);let a;if(r)a=cx;else try{a=await o.verify(s)}catch{a=await o.verify(s,!0)}const l={...e};if(s==="mfaSmsEnrollment"||s==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const u=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const u=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return n?Object.assign(l,{captchaResp:a}):Object.assign(l,{captchaResponse:a}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function oa(t,e,s,n,r){var o;if((o=t._getRecaptchaConfig())!=null&&o.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await Fh(t,e,s,s==="getOobCode");return n(t,a)}else return n(t,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await Fh(t,e,s,s==="getOobCode");return n(t,l)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vE(t,e){const s=Na(t,"auth");if(s.isInitialized()){const r=s.getImmediate(),o=s.getOptions();if(Zn(o,e??{}))return r;Es(r,"already-initialized")}return s.initialize({options:e})}function bE(t,e){const s=(e==null?void 0:e.persistence)||[],n=(Array.isArray(s)?s:[s]).map(Hs);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(n,e==null?void 0:e.popupRedirectResolver)}function wE(t,e,s){const n=Un(t);Ie(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const r=!1,o=dx(e),{host:a,port:l}=_E(e),u=l===null?"":`:${l}`,d={url:`${o}//${a}${u}/`},f=Object.freeze({host:a,port:l,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!n._canInitEmulator){Ie(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),Ie(Zn(d,n.config.emulator)&&Zn(f,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=d,n.emulatorConfig=f,n.settings.appVerificationDisabledForTesting=!0,ar(a)?(_c(`${o}//${a}${u}`),Nc("Auth",!0)):NE()}function dx(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function _E(t){const e=dx(t),s=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!s)return{host:"",port:null};const n=s[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(n);if(r){const o=r[1];return{host:o,port:Oh(n.substr(o.length+1))}}else{const[o,a]=n.split(":");return{host:o,port:Oh(a)}}}function Oh(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function NE(){function t(){const e=document.createElement("p"),s=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pd{constructor(e,s){this.providerId=e,this.signInMethod=s}toJSON(){return $s("not implemented")}_getIdTokenResponse(e){return $s("not implemented")}_linkToIdToken(e,s){return $s("not implemented")}_getReauthenticationResolver(e){return $s("not implemented")}}async function EE(t,e){return an(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TE(t,e){return so(t,"POST","/v1/accounts:signInWithPassword",on(t,e))}async function IE(t,e){return an(t,"POST","/v1/accounts:sendOobCode",on(t,e))}async function CE(t,e){return IE(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SE(t,e){return so(t,"POST","/v1/accounts:signInWithEmailLink",on(t,e))}async function AE(t,e){return so(t,"POST","/v1/accounts:signInWithEmailLink",on(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi extends pd{constructor(e,s,n,r=null){super("password",n),this._email=e,this._password=s,this._tenantId=r}static _fromEmailAndPassword(e,s){return new zi(e,s,"password")}static _fromEmailAndCode(e,s,n=null){return new zi(e,s,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const s=typeof e=="string"?JSON.parse(e):e;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return oa(e,s,"signInWithPassword",TE);case"emailLink":return SE(e,{email:this._email,oobCode:this._password});default:Es(e,"internal-error")}}async _linkToIdToken(e,s){switch(this.signInMethod){case"password":const n={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return oa(e,n,"signUpPassword",EE);case"emailLink":return AE(e,{idToken:s,email:this._email,oobCode:this._password});default:Es(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ar(t,e){return so(t,"POST","/v1/accounts:signInWithIdp",on(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RE="http://localhost";class nr extends pd{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const s=new nr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(s.idToken=e.idToken),e.accessToken&&(s.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(s.nonce=e.nonce),e.pendingToken&&(s.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(s.accessToken=e.oauthToken,s.secret=e.oauthTokenSecret):Es("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const s=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:r,...o}=s;if(!n||!r)return null;const a=new nr(n,r);return a.idToken=o.idToken||void 0,a.accessToken=o.accessToken||void 0,a.secret=o.secret,a.nonce=o.nonce,a.pendingToken=o.pendingToken||null,a}_getIdTokenResponse(e){const s=this.buildRequest();return Ar(e,s)}_linkToIdToken(e,s){const n=this.buildRequest();return n.idToken=s,Ar(e,n)}_getReauthenticationResolver(e){const s=this.buildRequest();return s.autoCreate=!1,Ar(e,s)}buildRequest(){const e={requestUri:RE,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),e.postBody=Gi(s)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PE(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function jE(t){const e=ci(di(t)).link,s=e?ci(di(e)).deep_link_id:null,n=ci(di(t)).deep_link_id;return(n?ci(di(n)).link:null)||n||s||e||t}class gd{constructor(e){const s=ci(di(e)),n=s.apiKey??null,r=s.oobCode??null,o=PE(s.mode??null);Ie(n&&r&&o,"argument-error"),this.apiKey=n,this.operation=o,this.code=r,this.continueUrl=s.continueUrl??null,this.languageCode=s.lang??null,this.tenantId=s.tenantId??null}static parseLink(e){const s=jE(e);try{return new gd(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hr{constructor(){this.providerId=hr.PROVIDER_ID}static credential(e,s){return zi._fromEmailAndPassword(e,s)}static credentialWithLink(e,s){const n=gd.parseLink(s);return Ie(n,"argument-error"),zi._fromEmailAndCode(e,n.code,n.tenantId)}}hr.PROVIDER_ID="password";hr.EMAIL_PASSWORD_SIGN_IN_METHOD="password";hr.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ux{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class no extends ux{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yn extends no{constructor(){super("facebook.com")}static credential(e){return nr._fromParams({providerId:yn.PROVIDER_ID,signInMethod:yn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return yn.credentialFromTaggedObject(e)}static credentialFromError(e){return yn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return yn.credential(e.oauthAccessToken)}catch{return null}}}yn.FACEBOOK_SIGN_IN_METHOD="facebook.com";yn.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vn extends no{constructor(){super("google.com"),this.addScope("profile")}static credential(e,s){return nr._fromParams({providerId:vn.PROVIDER_ID,signInMethod:vn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:s})}static credentialFromResult(e){return vn.credentialFromTaggedObject(e)}static credentialFromError(e){return vn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:s,oauthAccessToken:n}=e;if(!s&&!n)return null;try{return vn.credential(s,n)}catch{return null}}}vn.GOOGLE_SIGN_IN_METHOD="google.com";vn.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn extends no{constructor(){super("github.com")}static credential(e){return nr._fromParams({providerId:bn.PROVIDER_ID,signInMethod:bn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return bn.credentialFromTaggedObject(e)}static credentialFromError(e){return bn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return bn.credential(e.oauthAccessToken)}catch{return null}}}bn.GITHUB_SIGN_IN_METHOD="github.com";bn.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wn extends no{constructor(){super("twitter.com")}static credential(e,s){return nr._fromParams({providerId:wn.PROVIDER_ID,signInMethod:wn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:s})}static credentialFromResult(e){return wn.credentialFromTaggedObject(e)}static credentialFromError(e){return wn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:s,oauthTokenSecret:n}=e;if(!s||!n)return null;try{return wn.credential(s,n)}catch{return null}}}wn.TWITTER_SIGN_IN_METHOD="twitter.com";wn.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kE(t,e){return so(t,"POST","/v1/accounts:signUp",on(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,s,n,r=!1){const o=await vs._fromIdTokenResponse(e,n,r),a=zh(n);return new rr({user:o,providerId:a,_tokenResponse:n,operationType:s})}static async _forOperation(e,s,n){await e._updateTokensIfNecessary(n,!0);const r=zh(n);return new rr({user:e,providerId:r,_tokenResponse:n,operationType:s})}}function zh(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa extends qs{constructor(e,s,n,r){super(s.code,s.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,aa.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:s.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,s,n,r){return new aa(e,s,n,r)}}function hx(t,e,s,n){return(e==="reauthenticate"?s._getReauthenticationResolver(t):s._getIdTokenResponse(t)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?aa._fromErrorAndOperation(t,o,e,n):o})}async function DE(t,e,s=!1){const n=await Oi(t,e._linkToIdToken(t.auth,await t.getIdToken()),s);return rr._forOperation(t,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mx(t,e,s=!1){const{auth:n}=t;if(ds(n.app))return Promise.reject(Xs(n));const r="reauthenticate";try{const o=await Oi(t,hx(n,r,e,t),s);Ie(o.idToken,n,"internal-error");const a=md(o.idToken);Ie(a,n,"internal-error");const{sub:l}=a;return Ie(t.uid===l,n,"user-mismatch"),rr._forOperation(t,r,o)}catch(o){throw(o==null?void 0:o.code)==="auth/user-not-found"&&Es(n,"user-mismatch"),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fx(t,e,s=!1){if(ds(t.app))return Promise.reject(Xs(t));const n="signIn",r=await hx(t,n,e),o=await rr._fromIdTokenResponse(t,n,r);return s||await t._updateCurrentUser(o.user),o}async function ME(t,e){return fx(Un(t),e)}async function LE(t,e){return mx(gt(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function px(t){const e=Un(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function VE(t,e,s){const n=Un(t);await oa(n,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",CE)}async function UE(t,e,s){if(ds(t.app))return Promise.reject(Xs(t));const n=Un(t),a=await oa(n,{returnSecureToken:!0,email:e,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",kE).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&px(t),u}),l=await rr._fromIdTokenResponse(n,"signIn",a);return await n._updateCurrentUser(l.user),l}function FE(t,e,s){return ds(t.app)?Promise.reject(Xs(t)):ME(gt(t),hr.credential(e,s)).catch(async n=>{throw n.code==="auth/password-does-not-meet-requirements"&&px(t),n})}function OE(t,e,s,n){return gt(t).onIdTokenChanged(e,s,n)}function zE(t,e,s){return gt(t).beforeAuthStateChanged(e,s)}function BE(t,e,s,n){return gt(t).onAuthStateChanged(e,s,n)}function qE(t){return gt(t).signOut()}const la="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gx{constructor(e,s){this.storageRetriever=e,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(la,"1"),this.storage.removeItem(la),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,s){return this.storage.setItem(e,JSON.stringify(s)),Promise.resolve()}_get(e){const s=this.storage.getItem(e);return Promise.resolve(s?JSON.parse(s):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GE=1e3,$E=10;class xx extends gx{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,s)=>this.onStorageEvent(e,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ox(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const s of Object.keys(this.listeners)){const n=this.storage.getItem(s),r=this.localCache[s];n!==r&&e(s,r,n)}}onStorageEvent(e,s=!1){if(!e.key){this.forAllChangedKeys((a,l,u)=>{this.notifyListeners(a,u)});return}const n=e.key;s?this.detachListener():this.stopPolling();const r=()=>{const a=this.storage.getItem(n);!s&&this.localCache[n]===a||this.notifyListeners(n,a)},o=this.storage.getItem(n);iE()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,$E):r()}notifyListeners(e,s){this.localCache[e]=s;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,s,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:s,newValue:n}),!0)})},GE)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(s)}_removeListener(e,s){this.listeners[e]&&(this.listeners[e].delete(s),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,s){await super._set(e,s),this.localCache[e]=JSON.stringify(s)}async _get(e){const s=await super._get(e);return this.localCache[e]=JSON.stringify(s),s}async _remove(e){await super._remove(e),delete this.localCache[e]}}xx.type="LOCAL";const HE=xx;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yx extends gx{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,s){}_removeListener(e,s){}}yx.type="SESSION";const vx=yx;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WE(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const s=this.receivers.find(r=>r.isListeningto(e));if(s)return s;const n=new qa(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const s=e,{eventId:n,eventType:r,data:o}=s.data,a=this.handlersMap[r];if(!(a!=null&&a.size))return;s.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const l=Array.from(a).map(async d=>d(s.origin,o)),u=await WE(l);s.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:u})}_subscribe(e,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(s)}_unsubscribe(e,s){this.handlersMap[e]&&s&&this.handlersMap[e].delete(s),(!s||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}qa.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xd(t="",e=10){let s="";for(let n=0;n<e;n++)s+=Math.floor(Math.random()*10);return t+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JE{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,s,n=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let o,a;return new Promise((l,u)=>{const d=xd("",20);r.port1.start();const f=setTimeout(()=>{u(new Error("unsupported_event"))},n);a={messageChannel:r,onMessage(p){const g=p;if(g.data.eventId===d)switch(g.data.status){case"ack":clearTimeout(f),o=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),l(g.data.response);break;default:clearTimeout(f),clearTimeout(o),u(new Error("invalid_response"));break}}},this.handlers.add(a),r.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:s},[r.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Us(){return window}function KE(t){Us().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bx(){return typeof Us().WorkerGlobalScope<"u"&&typeof Us().importScripts=="function"}async function YE(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function XE(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function QE(){return bx()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wx="firebaseLocalStorageDb",ZE=1,ca="firebaseLocalStorage",_x="fbase_key";class ro{constructor(e){this.request=e}toPromise(){return new Promise((e,s)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function Ga(t,e){return t.transaction([ca],e?"readwrite":"readonly").objectStore(ca)}function eT(){const t=indexedDB.deleteDatabase(wx);return new ro(t).toPromise()}function tc(){const t=indexedDB.open(wx,ZE);return new Promise((e,s)=>{t.addEventListener("error",()=>{s(t.error)}),t.addEventListener("upgradeneeded",()=>{const n=t.result;try{n.createObjectStore(ca,{keyPath:_x})}catch(r){s(r)}}),t.addEventListener("success",async()=>{const n=t.result;n.objectStoreNames.contains(ca)?e(n):(n.close(),await eT(),e(await tc()))})})}async function Bh(t,e,s){const n=Ga(t,!0).put({[_x]:e,value:s});return new ro(n).toPromise()}async function tT(t,e){const s=Ga(t,!1).get(e),n=await new ro(s).toPromise();return n===void 0?null:n.value}function qh(t,e){const s=Ga(t,!0).delete(e);return new ro(s).toPromise()}const sT=800,nT=3;class Nx{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await tc(),this.db)}async _withRetries(e){let s=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(s++>nT)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return bx()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=qa._getInstance(QE()),this.receiver._subscribe("keyChanged",async(e,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(e,s)=>["keyChanged"])}async initializeSender(){var s,n;if(this.activeServiceWorker=await YE(),!this.activeServiceWorker)return;this.sender=new JE(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(s=e[0])!=null&&s.fulfilled&&(n=e[0])!=null&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||XE()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await tc();return await Bh(e,la,"1"),await qh(e,la),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,s){return this._withPendingWrite(async()=>(await this._withRetries(n=>Bh(n,e,s)),this.localCache[e]=s,this.notifyServiceWorker(e)))}async _get(e){const s=await this._withRetries(n=>tT(n,e));return this.localCache[e]=s,s}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(s=>qh(s,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const o=Ga(r,!1).getAll();return new ro(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const s=[],n=new Set;if(e.length!==0)for(const{fbase_key:r,value:o}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(o)&&(this.notifyListeners(r,o),s.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),s.push(r));return s}notifyListeners(e,s){this.localCache[e]=s;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),sT)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(s)}_removeListener(e,s){this.listeners[e]&&(this.listeners[e].delete(s),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Nx.type="LOCAL";const rT=Nx;new to(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iT(t,e){return e?Hs(e):(Ie(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yd extends pd{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ar(e,this._buildIdpRequest())}_linkToIdToken(e,s){return Ar(e,this._buildIdpRequest(s))}_getReauthenticationResolver(e){return Ar(e,this._buildIdpRequest())}_buildIdpRequest(e){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(s.idToken=e),s}}function oT(t){return fx(t.auth,new yd(t),t.bypassAuthState)}function aT(t){const{auth:e,user:s}=t;return Ie(s,e,"internal-error"),mx(s,new yd(t),t.bypassAuthState)}async function lT(t){const{auth:e,user:s}=t;return Ie(s,e,"internal-error"),DE(s,new yd(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ex{constructor(e,s,n,r,o=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(e,s)=>{this.pendingPromise={resolve:e,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:s,sessionId:n,postBody:r,tenantId:o,error:a,type:l}=e;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:s,sessionId:n,tenantId:o||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(u))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return oT;case"linkViaPopup":case"linkViaRedirect":return lT;case"reauthViaPopup":case"reauthViaRedirect":return aT;default:Es(this.auth,"internal-error")}}resolve(e){nn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){nn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cT=new to(2e3,1e4);class _r extends Ex{constructor(e,s,n,r,o){super(e,s,r,o),this.provider=n,this.authWindow=null,this.pollId=null,_r.currentPopupAction&&_r.currentPopupAction.cancel(),_r.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ie(e,this.auth,"internal-error"),e}async onExecution(){nn(this.filter.length===1,"Popup operations only handle one event");const e=xd();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(Vs(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Vs(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,_r.currentPopupAction=null}pollUserCancellation(){const e=()=>{var s,n;if((n=(s=this.authWindow)==null?void 0:s.window)!=null&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Vs(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,cT.get())};e()}}_r.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dT="pendingRedirect",Mo=new Map;class uT extends Ex{constructor(e,s,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,n),this.eventId=null}async execute(){let e=Mo.get(this.auth._key());if(!e){try{const n=await hT(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(s){e=()=>Promise.reject(s)}Mo.set(this.auth._key(),e)}return this.bypassAuthState||Mo.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const s=await this.auth._redirectUserForId(e.eventId);if(s)return this.user=s,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function hT(t,e){const s=pT(e),n=fT(t);if(!await n._isAvailable())return!1;const r=await n._get(s)==="true";return await n._remove(s),r}function mT(t,e){Mo.set(t._key(),e)}function fT(t){return Hs(t._redirectPersistence)}function pT(t){return Do(dT,t.config.apiKey,t.name)}async function gT(t,e,s=!1){if(ds(t.app))return Promise.reject(Xs(t));const n=Un(t),r=iT(n,e),a=await new uT(n,r,s).execute();return a&&!s&&(delete a.user._redirectEventId,await n._persistUserIfCurrent(a.user),await n._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xT=10*60*1e3;class yT{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let s=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(s=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!vT(e)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=e,s=!0)),s}sendToConsumer(e,s){var n;if(e.error&&!Tx(e)){const r=((n=e.error.code)==null?void 0:n.split("auth/")[1])||"internal-error";s.onError(Vs(this.auth,r))}else s.onAuthEvent(e)}isEventForConsumer(e,s){const n=s.eventId===null||!!e.eventId&&e.eventId===s.eventId;return s.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=xT&&this.cachedEventUids.clear(),this.cachedEventUids.has(Gh(e))}saveEventToCache(e){this.cachedEventUids.add(Gh(e)),this.lastProcessedEventTime=Date.now()}}function Gh(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function Tx({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function vT(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Tx(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bT(t,e={}){return an(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wT=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,_T=/^https?/;async function NT(t){if(t.config.emulator)return;const{authorizedDomains:e}=await bT(t);for(const s of e)try{if(ET(s))return}catch{}Es(t,"unauthorized-domain")}function ET(t){const e=Zl(),{protocol:s,hostname:n}=new URL(e);if(t.startsWith("chrome-extension://")){const a=new URL(t);return a.hostname===""&&n===""?s==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):s==="chrome-extension:"&&a.hostname===n}if(!_T.test(s))return!1;if(wT.test(t))return n===t;const r=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TT=new to(3e4,6e4);function $h(){const t=Us().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let s=0;s<t.CP.length;s++)t.CP[s]=null}}function IT(t){return new Promise((e,s)=>{var r,o,a;function n(){$h(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{$h(),s(Vs(t,"network-request-failed"))},timeout:TT.get()})}if((o=(r=Us().gapi)==null?void 0:r.iframes)!=null&&o.Iframe)e(gapi.iframes.getContext());else if((a=Us().gapi)!=null&&a.load)n();else{const l=fE("iframefcb");return Us()[l]=()=>{gapi.load?n():s(Vs(t,"network-request-failed"))},lx(`${mE()}?onload=${l}`).catch(u=>s(u))}}).catch(e=>{throw Lo=null,e})}let Lo=null;function CT(t){return Lo=Lo||IT(t),Lo}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ST=new to(5e3,15e3),AT="__/auth/iframe",RT="emulator/auth/iframe",PT={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},jT=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function kT(t){const e=t.config;Ie(e.authDomain,t,"auth-domain-config-required");const s=e.emulator?hd(e,RT):`https://${t.config.authDomain}/${AT}`,n={apiKey:e.apiKey,appName:t.name,v:lr},r=jT.get(t.config.apiHost);r&&(n.eid=r);const o=t._getFrameworks();return o.length&&(n.fw=o.join(",")),`${s}?${Gi(n).slice(1)}`}async function DT(t){const e=await CT(t),s=Us().gapi;return Ie(s,t,"internal-error"),e.open({where:document.body,url:kT(t),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:PT,dontclear:!0},n=>new Promise(async(r,o)=>{await n.restyle({setHideOnLeave:!1});const a=Vs(t,"network-request-failed"),l=Us().setTimeout(()=>{o(a)},ST.get());function u(){Us().clearTimeout(l),r(n)}n.ping(u).then(u,()=>{o(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MT={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},LT=500,VT=600,UT="_blank",FT="http://localhost";class Hh{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function OT(t,e,s,n=LT,r=VT){const o=Math.max((window.screen.availHeight-r)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString();let l="";const u={...MT,width:n.toString(),height:r.toString(),top:o,left:a},d=Qt().toLowerCase();s&&(l=tx(d)?UT:s),Zg(d)&&(e=e||FT,u.scrollbars="yes");const f=Object.entries(u).reduce((g,[v,A])=>`${g}${v}=${A},`,"");if(rE(d)&&l!=="_self")return zT(e||"",l),new Hh(null);const p=window.open(e||"",l,f);Ie(p,t,"popup-blocked");try{p.focus()}catch{}return new Hh(p)}function zT(t,e){const s=document.createElement("a");s.href=t,s.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BT="__/auth/handler",qT="emulator/auth/handler",GT=encodeURIComponent("fac");async function Wh(t,e,s,n,r,o){Ie(t.config.authDomain,t,"auth-domain-config-required"),Ie(t.config.apiKey,t,"invalid-api-key");const a={apiKey:t.config.apiKey,appName:t.name,authType:s,redirectUrl:n,v:lr,eventId:r};if(e instanceof ux){e.setDefaultLanguage(t.languageCode),a.providerId=e.providerId||"",pv(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,p]of Object.entries({}))a[f]=p}if(e instanceof no){const f=e.getScopes().filter(p=>p!=="");f.length>0&&(a.scopes=f.join(","))}t.tenantId&&(a.tid=t.tenantId);const l=a;for(const f of Object.keys(l))l[f]===void 0&&delete l[f];const u=await t._getAppCheckToken(),d=u?`#${GT}=${encodeURIComponent(u)}`:"";return`${$T(t)}?${Gi(l).slice(1)}${d}`}function $T({config:t}){return t.emulator?hd(t,qT):`https://${t.authDomain}/${BT}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Il="webStorageSupport";class HT{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=vx,this._completeRedirectFn=gT,this._overrideRedirectResult=mT}async _openPopup(e,s,n,r){var a;nn((a=this.eventManagers[e._key()])==null?void 0:a.manager,"_initialize() not called before _openPopup()");const o=await Wh(e,s,n,Zl(),r);return OT(e,o,xd())}async _openRedirect(e,s,n,r){await this._originValidation(e);const o=await Wh(e,s,n,Zl(),r);return KE(o),new Promise(()=>{})}_initialize(e){const s=e._key();if(this.eventManagers[s]){const{manager:r,promise:o}=this.eventManagers[s];return r?Promise.resolve(r):(nn(o,"If manager is not set, promise should be"),o)}const n=this.initAndGetManager(e);return this.eventManagers[s]={promise:n},n.catch(()=>{delete this.eventManagers[s]}),n}async initAndGetManager(e){const s=await DT(e),n=new yT(e);return s.register("authEvent",r=>(Ie(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:n.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=s,n}_isIframeWebStorageSupported(e,s){this.iframes[e._key()].send(Il,{type:Il},r=>{var a;const o=(a=r==null?void 0:r[0])==null?void 0:a[Il];o!==void 0&&s(!!o),Es(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const s=e._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=NT(e)),this.originValidationPromises[s]}get _shouldInitProactively(){return ox()||ex()||fd()}}const WT=HT;var Jh="@firebase/auth",Kh="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JT{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const s=this.auth.onIdTokenChanged(n=>{e((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,s),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const s=this.internalListeners.get(e);s&&(this.internalListeners.delete(e),s(),this.updateProactiveRefresh())}assertAuthConfigured(){Ie(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KT(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function YT(t){er(new Sn("auth",(e,{options:s})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=n.options;Ie(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});const u={apiKey:a,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ax(t)},d=new dE(n,r,o,u);return bE(d,s),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,s,n)=>{e.getProvider("auth-internal").initialize()})),er(new Sn("auth-internal",e=>{const s=Un(e.getProvider("auth").getImmediate());return(n=>new JT(n))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),js(Jh,Kh,KT(t)),js(Jh,Kh,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XT=5*60,QT=op("authIdTokenMaxAge")||XT;let Yh=null;const ZT=t=>async e=>{const s=e&&await e.getIdTokenResult(),n=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(n&&n>QT)return;const r=s==null?void 0:s.token;Yh!==r&&(Yh=r,await fetch(t,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function eI(t=Ic()){const e=Na(t,"auth");if(e.isInitialized())return e.getImmediate();const s=vE(t,{popupRedirectResolver:WT,persistence:[rT,HE,vx]}),n=op("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(n,location.origin);if(location.origin===o.origin){const a=ZT(o.toString());zE(s,a,()=>a(s.currentUser)),OE(s,l=>a(l))}}const r=np("auth");return r&&wE(s,`http://${r}`),s}function tI(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}uE({loadJS(t){return new Promise((e,s)=>{const n=document.createElement("script");n.setAttribute("src",t),n.onload=e,n.onerror=r=>{const o=Vs("internal-error");o.customData=r,s(o)},n.type="text/javascript",n.charset="UTF-8",tI().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});YT("Browser");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ix="firebasestorage.googleapis.com",sI="storageBucket",nI=2*60*1e3,rI=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs extends qs{constructor(e,s,n=0){super(Cl(e),`Firebase Storage: ${s} (${Cl(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Gs.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Cl(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Bs;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Bs||(Bs={}));function Cl(t){return"storage/"+t}function iI(){const t="An unknown error occurred, please check the error payload for server response.";return new Gs(Bs.UNKNOWN,t)}function oI(){return new Gs(Bs.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function aI(){return new Gs(Bs.CANCELED,"User canceled the upload/download.")}function lI(t){return new Gs(Bs.INVALID_URL,"Invalid URL '"+t+"'.")}function cI(t){return new Gs(Bs.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function Xh(t){return new Gs(Bs.INVALID_ARGUMENT,t)}function Cx(){return new Gs(Bs.APP_DELETED,"The Firebase app was deleted.")}function dI(t){return new Gs(Bs.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bs{constructor(e,s){this.bucket=e,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,s){let n;try{n=bs.makeFromUrl(e,s)}catch{return new bs(e,"")}if(n.path==="")return n;throw cI(e)}static makeFromUrl(e,s){let n=null;const r="([A-Za-z0-9.\\-_]+)";function o(F){F.path.charAt(F.path.length-1)==="/"&&(F.path_=F.path_.slice(0,-1))}const a="(/(.*))?$",l=new RegExp("^gs://"+r+a,"i"),u={bucket:1,path:3};function d(F){F.path_=decodeURIComponent(F.path)}const f="v[A-Za-z0-9_]+",p=s.replace(/[.]/g,"\\."),g="(/([^?#]*).*)?$",v=new RegExp(`^https?://${p}/${f}/b/${r}/o${g}`,"i"),A={bucket:1,path:3},k=s===Ix?"(?:storage.googleapis.com|storage.cloud.google.com)":s,S="([^?#]*)",L=new RegExp(`^https?://${k}/${r}/${S}`,"i"),j=[{regex:l,indices:u,postModify:o},{regex:v,indices:A,postModify:d},{regex:L,indices:{bucket:1,path:2},postModify:d}];for(let F=0;F<j.length;F++){const q=j[F],E=q.regex.exec(e);if(E){const w=E[q.indices.bucket];let b=E[q.indices.path];b||(b=""),n=new bs(w,b),q.postModify(n);break}}if(n==null)throw lI(e);return n}}class uI{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hI(t,e,s){let n=1,r=null,o=null,a=!1,l=0;function u(){return l===2}let d=!1;function f(...S){d||(d=!0,e.apply(null,S))}function p(S){r=setTimeout(()=>{r=null,t(v,u())},S)}function g(){o&&clearTimeout(o)}function v(S,...L){if(d){g();return}if(S){g(),f.call(null,S,...L);return}if(u()||a){g(),f.call(null,S,...L);return}n<64&&(n*=2);let j;l===1?(l=2,j=0):j=(n+Math.random())*1e3,p(j)}let A=!1;function k(S){A||(A=!0,g(),!d&&(r!==null?(S||(l=2),clearTimeout(r),p(0)):S||(l=1)))}return p(0),o=setTimeout(()=>{a=!0,k(!0)},s),k}function mI(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fI(t){return t!==void 0}function Qh(t,e,s,n){if(n<e)throw Xh(`Invalid value for '${t}'. Expected ${e} or greater.`);if(n>s)throw Xh(`Invalid value for '${t}'. Expected ${s} or less.`)}function pI(t){const e=encodeURIComponent;let s="?";for(const n in t)if(t.hasOwnProperty(n)){const r=e(n)+"="+e(t[n]);s=s+r+"&"}return s=s.slice(0,-1),s}var da;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(da||(da={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gI(t,e){const s=t>=500&&t<600,r=[408,429].indexOf(t)!==-1,o=e.indexOf(t)!==-1;return s||r||o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xI{constructor(e,s,n,r,o,a,l,u,d,f,p,g=!0,v=!1){this.url_=e,this.method_=s,this.headers_=n,this.body_=r,this.successCodes_=o,this.additionalRetryCodes_=a,this.callback_=l,this.errorCallback_=u,this.timeout_=d,this.progressCallback_=f,this.connectionFactory_=p,this.retry=g,this.isUsingEmulator=v,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((A,k)=>{this.resolve_=A,this.reject_=k,this.start_()})}start_(){const e=(n,r)=>{if(r){n(!1,new wo(!1,null,!0));return}const o=this.connectionFactory_();this.pendingConnection_=o;const a=l=>{const u=l.loaded,d=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(u,d)};this.progressCallback_!==null&&o.addUploadProgressListener(a),o.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&o.removeUploadProgressListener(a),this.pendingConnection_=null;const l=o.getErrorCode()===da.NO_ERROR,u=o.getStatus();if(!l||gI(u,this.additionalRetryCodes_)&&this.retry){const f=o.getErrorCode()===da.ABORT;n(!1,new wo(!1,null,f));return}const d=this.successCodes_.indexOf(u)!==-1;n(!0,new wo(d,o))})},s=(n,r)=>{const o=this.resolve_,a=this.reject_,l=r.connection;if(r.wasSuccessCode)try{const u=this.callback_(l,l.getResponse());fI(u)?o(u):o()}catch(u){a(u)}else if(l!==null){const u=iI();u.serverResponse=l.getErrorText(),this.errorCallback_?a(this.errorCallback_(l,u)):a(u)}else if(r.canceled){const u=this.appDelete_?Cx():aI();a(u)}else{const u=oI();a(u)}};this.canceled_?s(!1,new wo(!1,null,!0)):this.backoffId_=hI(e,s,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&mI(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class wo{constructor(e,s,n){this.wasSuccessCode=e,this.connection=s,this.canceled=!!n}}function yI(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function vI(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function bI(t,e){e&&(t["X-Firebase-GMPID"]=e)}function wI(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function _I(t,e,s,n,r,o,a=!0,l=!1){const u=pI(t.urlParams),d=t.url+u,f=Object.assign({},t.headers);return bI(f,e),yI(f,s),vI(f,o),wI(f,n),new xI(d,t.method,f,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,r,a,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NI(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function EI(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ua{constructor(e,s){this._service=e,s instanceof bs?this._location=s:this._location=bs.makeFromUrl(s,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,s){return new ua(e,s)}get root(){const e=new bs(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return EI(this._location.path)}get storage(){return this._service}get parent(){const e=NI(this._location.path);if(e===null)return null;const s=new bs(this._location.bucket,e);return new ua(this._service,s)}_throwIfRoot(e){if(this._location.path==="")throw dI(e)}}function Zh(t,e){const s=e==null?void 0:e[sI];return s==null?null:bs.makeFromBucketSpec(s,t)}function TI(t,e,s,n={}){t.host=`${e}:${s}`;const r=ar(e);r&&(_c(`https://${t.host}/b`),Nc("Storage",!0)),t._isUsingEmulator=!0,t._protocol=r?"https":"http";const{mockUserToken:o}=n;o&&(t._overrideAuthToken=typeof o=="string"?o:ap(o,t.app.options.projectId))}class II{constructor(e,s,n,r,o,a=!1){this.app=e,this._authProvider=s,this._appCheckProvider=n,this._url=r,this._firebaseVersion=o,this._isUsingEmulator=a,this._bucket=null,this._host=Ix,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=nI,this._maxUploadRetryTime=rI,this._requests=new Set,r!=null?this._bucket=bs.makeFromBucketSpec(r,this._host):this._bucket=Zh(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=bs.makeFromBucketSpec(this._url,e):this._bucket=Zh(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Qh("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Qh("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const s=await e.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){if(ds(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ua(this,e)}_makeRequest(e,s,n,r,o=!0){if(this._deleted)return new uI(Cx());{const a=_I(e,this._appId,n,r,s,this._firebaseVersion,o,this._isUsingEmulator);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(e,s){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,s,n,r).getPromise()}}const em="@firebase/storage",tm="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sx="storage";function CI(t=Ic(),e){t=gt(t);const n=Na(t,Sx).getImmediate({identifier:e}),r=rp("storage");return r&&SI(n,...r),n}function SI(t,e,s,n={}){TI(t,e,s,n)}function AI(t,{instanceIdentifier:e}){const s=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),r=t.getProvider("app-check-internal");return new II(s,n,r,e,lr)}function RI(){er(new Sn(Sx,AI,"PUBLIC").setMultipleInstances(!0)),js(em,tm,""),js(em,tm,"esm2020")}RI();const PI={apiKey:"AIzaSyDa_qvmvyVyJVe936hW5QoDtviIrITcvDI",authDomain:"ramais-63a73.firebaseapp.com",projectId:"ramais-63a73",storageBucket:"ramais-63a73.firebasestorage.app",messagingSenderId:"695161860787",appId:"1:695161860787:web:98e73e5fc79a5cbb2f76c6",measurementId:"G-X3121MPE65"},vd=dp(PI),he=TN(vd),Ti=eI(vd);CI(vd);var wt=(t=>(t.MASTER="MASTER",t.ADMIN="ADMIN",t.COMMUNICATION="COMMUNICATION",t.USER="USER",t))(wt||{}),Ye=(t=>(t.TODO="TODO",t.IN_PROGRESS="IN_PROGRESS",t.DONE="DONE",t))(Ye||{});const Ax=I.createContext({currentUser:null,user:null,loading:!0,logout:async()=>{},isAdmin:!1,isMaster:!1,isCommunication:!1,refreshUser:async()=>{},globalSettings:null}),Ut=()=>I.useContext(Ax),jI=({children:t})=>{const[e,s]=I.useState(null),[n,r]=I.useState(null),[o,a]=I.useState(null),[l,u]=I.useState(!0);I.useEffect(()=>{const A=es(yt(he,"settings","general"),L=>{L.exists()?a(L.data()):a({publicDirectory:!0,showBirthdaysPublicly:!0,showRoomsPublicly:!0,showNewsPublicly:!0,showRolePublicly:!0,showWelcomeSection:!0,dashboardShowRooms:!0,dashboardShowNews:!0,dashboardShowBirthdays:!0,showRoleInternal:!0})});let k=null;const S=BE(Ti,async L=>{if(s(L),L){k&&k();const D=Nt(Ee(he,"people"),Lt("uid","==",L.uid));k=es(D,j=>{if(j.empty)r({id:"temp",uid:L.uid,name:L.displayName||"Usurio",email:L.email||"",role:"No identificado",systemRole:wt.USER,department:"Geral",extension:"",whatsapp:"",avatar:L.photoURL||"",birthday:"",signatureImage:""});else{const F=j.docs[0].data();r({id:j.docs[0].id,uid:F.uid,name:F.name,role:F.role,systemRole:F.systemRole||wt.USER,department:F.department||F.sector,unit:F.unit,extension:F.extension,whatsapp:F.whatsapp||"",email:F.email,avatar:F.photoBase64||F.photoUrl||`https://ui-avatars.com/api/?name=${encodeURIComponent(F.name)}&background=0d9488&color=fff`,birthday:F.birthday,showRole:F.showRole??!0,showInPublicDirectory:F.showInPublicDirectory??!0,signatureImage:F.signatureImage||""})}u(!1)},j=>{console.error("Error fetching user profile:",j),u(!1)})}else r(null),u(!1)});return()=>{A(),S(),k&&k()}},[]);const d=async()=>{await qE(Ti),r(null),s(null)},f=I.useCallback(async()=>{console.log("User refresh requested (handled by realtime listener)")},[]),p=(n==null?void 0:n.systemRole)===wt.MASTER,g=(n==null?void 0:n.systemRole)===wt.ADMIN||p,v=(n==null?void 0:n.systemRole)===wt.COMMUNICATION||g;return l?i.jsxs("div",{className:"h-screen flex flex-col items-center justify-center bg-slate-50 gap-4",children:[i.jsx(Ne,{className:"animate-spin text-emerald-600",size:48}),i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsx("p",{className:"text-slate-700 font-semibold text-lg",children:"Iniciando iRamais Hub..."}),i.jsx("p",{className:"text-slate-400 text-sm",children:"Conectando ao sistema"})]})]}):i.jsx(Ax.Provider,{value:{currentUser:n,user:e,loading:l,logout:d,isAdmin:g,isMaster:p,isCommunication:v,refreshUser:f,globalSettings:o},children:t})},Qs=({className:t="h-10"})=>{const{globalSettings:e}=Ut(),s="http://intermaritima.com.br/images/logo2.png",n=(e==null?void 0:e.companyLogo)||s;return i.jsx("img",{src:n,alt:"Empresa Logo",className:`${t} object-contain transition-all duration-300`,onError:r=>{r.target.src=s}})},Rx=(t,e)=>t.photoBase64?t.photoBase64:t.photoUrl?t.photoUrl:`https://ui-avatars.com/api/?name=${encodeURIComponent(e)}&background=0d9488&color=fff`,rt=t=>{if(t===void 0||t===null)return null;if(Array.isArray(t))return t.map(e=>rt(e));if(typeof t=="object"){const e={};return Object.keys(t).forEach(s=>{e[s]=rt(t[s])}),e}return t},fs=async(t,e)=>{if(!e||typeof e!="string")throw new Error("ID do registro invlido.");try{const s=yt(he,t,e.trim());return await qg(s),!0}catch(s){throw s}},kI=()=>{const t="0123456789ABCDEF";let e="";for(let s=0;s<24;s++)e+=t.charAt(Math.floor(Math.random()*t.length)),(s+1)%6===0&&s!==23&&(e+="-");return e},DI=t=>es(Ee(he,"term_templates"),e=>{t(e.docs.map(s=>({id:s.id,...s.data()})))}),Px=(t,e)=>{const s=e?Nt(Ee(he,"terms"),Lt("employeeId","==",e)):Nt(Ee(he,"terms"),ur("createdAt","desc"));return es(s,n=>{let r=n.docs.map(o=>({id:o.id,...o.data()}));e&&r.sort((o,a)=>new Date(a.createdAt).getTime()-new Date(o.createdAt).getTime()),t(r)})},MI=t=>es(Ee(he,"units"),e=>{t(e.docs.map(s=>({id:s.id,...s.data()})))}),LI=t=>es(Ee(he,"sectors"),e=>{t(e.docs.map(s=>({id:s.id,name:s.data().name})))}),VI=t=>es(Ee(he,"people"),e=>{t(e.docs.map(s=>{const n=s.data();return{id:s.id,uid:n.uid,name:n.name||"",role:n.role||"Colaborador",systemRole:n.systemRole||wt.USER,department:n.sector||n.department||"Geral",unit:n.unit||"",extension:n.extension||"",whatsapp:n.whatsapp||"",email:n.email||"",avatar:Rx(n,n.name||"User"),birthday:n.birthday||"",showRole:n.showRole!==void 0?n.showRole:!0,showInPublicDirectory:n.showInPublicDirectory!==void 0?n.showInPublicDirectory:!0,signatureImage:n.signatureImage||""}}))}),UI=t=>es(Ee(he,"systems"),e=>{t(e.docs.map(s=>({id:s.id,...s.data()})))}),jx=t=>es(Ee(he,"units_assinatura"),e=>{t(e.docs.map(s=>({id:s.id,...s.data()})))}),FI=t=>es(Ee(he,"sectors_assinatura"),e=>{t(e.docs.map(s=>({id:s.id,name:s.data().name,description:s.data().description||""})))}),kx=(t,e)=>{const s=e?Nt(Ee(he,"signature_requests"),Lt("userId","==",e)):Nt(Ee(he,"signature_requests"),ur("createdAt","desc"));return es(s,n=>{let r=n.docs.map(o=>({id:o.id,...o.data()}));e&&r.sort((o,a)=>new Date(a.createdAt).getTime()-new Date(o.createdAt).getTime()),t(r)})},OI=t=>{const e=Nt(Ee(he,"signature_logs"),ur("createdAt","desc"));return es(e,s=>{t(s.docs.map(n=>({id:n.id,...n.data()})))})},zI=async()=>{try{const t=yt(he,"settings","general"),e=await MN(t);return e.exists()?e.data():{publicDirectory:!0,showBirthdaysPublicly:!0,showRoomsPublicly:!0,showNewsPublicly:!0,showRolePublicly:!0,showWelcomeSection:!0,dashboardShowRooms:!0,dashboardShowNews:!0,dashboardShowBirthdays:!0,showRoleInternal:!0}}catch{return{publicDirectory:!0,showBirthdaysPublicly:!0,showRoomsPublicly:!0,showNewsPublicly:!0,showRolePublicly:!0,showWelcomeSection:!0,dashboardShowRooms:!0,dashboardShowNews:!0,dashboardShowBirthdays:!0,showRoleInternal:!0}}},Dx=async t=>{const e=yt(he,"settings","general");await Bg(e,rt(t),{merge:!0})},Fn=async()=>{try{const t=Nt(Ee(he,"people"));return(await Vt(t)).docs.map(s=>{const n=s.data();return{id:s.id,uid:n.uid,name:n.name||"",role:n.role||"Colaborador",systemRole:n.systemRole||wt.USER,department:n.sector||n.department||"Geral",unit:n.unit||"",extension:n.extension||"",whatsapp:n.whatsapp||"",email:n.email||"",avatar:Rx(n,n.name||"User"),birthday:n.birthday||"",showRole:n.showRole!==void 0?n.showRole:!0,showInPublicDirectory:n.showInPublicDirectory!==void 0?n.showInPublicDirectory:!0,signatureImage:n.signatureImage||""}})}catch{return[]}},Mx=async(t,e)=>{const s=rt({...t,photoBase64:e||null,createdAt:new Date().toISOString()});await Zt(Ee(he,"people"),s)},bd=async(t,e,s)=>{const n=yt(he,"people",t),r=rt({...e,photoBase64:s||void 0,updatedAt:new Date().toISOString()});await Wt(n,r)},BI=async t=>{await fs("people",t)},$a=async t=>{try{await Zt(Ee(he,"notifications"),rt({...t,read:!1,createdAt:new Date().toISOString()}))}catch(e){console.error("Erro ao criar notificao:",e)}},Lx=async t=>{await Wt(yt(he,"notifications",t),{read:!0})},Vx=async t=>{const e=Nt(Ee(he,"notifications"),Lt("userId","==",t)),n=(await Vt(e)).docs.map(r=>qg(r.ref));await Promise.all(n)},qI=async(t,e,s,n)=>{await Zt(Ee(he,"messages"),rt({senderId:t,receiverId:e,text:s,timestamp:new Date().toISOString(),read:!1,deleted:!1,participants:[t,e]})),await $a({userId:e,type:"chat",title:`Nova mensagem de ${n}`,message:s.substring(0,50)+(s.length>50?"...":""),read:!1,createdAt:new Date().toISOString(),link:"/directory",senderId:t})},GI=async(t,e)=>{const s=Nt(Ee(he,"messages"),Lt("receiverId","==",t),Lt("senderId","==",e),Lt("read","==",!1)),n=await Vt(s),r=VN(he);n.docs.forEach(o=>{r.update(o.ref,{read:!0})}),await r.commit()},$I=async t=>{await Wt(yt(he,"messages",t),{deleted:!0})},ln=async()=>(await Vt(Ee(he,"units"))).docs.map(e=>({id:e.id,...e.data()})),HI=async t=>await Zt(Ee(he,"units"),rt(t)),WI=async t=>{const{id:e,...s}=t;await Wt(yt(he,"units",e),rt(s))},JI=async t=>await fs("units",t),mr=async()=>(await Vt(Ee(he,"sectors"))).docs.map(e=>({id:e.id,name:e.data().name})),KI=async t=>await Zt(Ee(he,"sectors"),{name:t.name}),YI=async t=>await Wt(yt(he,"sectors",t.id),{name:t.name}),XI=async t=>await fs("sectors",t),QI=async()=>(await Vt(Ee(he,"term_templates"))).docs.map(e=>({id:e.id,...e.data()})),ZI=async t=>{await Zt(Ee(he,"term_templates"),rt({...t,createdAt:new Date().toISOString()}))},eC=async(t,e)=>{await Wt(yt(he,"term_templates",t),rt(e))},tC=async t=>{const e=kI(),s=await Zt(Ee(he,"terms"),rt({...t,status:"PENDENTE",token:e,createdAt:new Date().toISOString()}));return await $a({userId:t.employeeId,type:"term",title:"Novo Termo para Assinatura",message:`Um novo termo de ${t.type} foi emitido para voc.`,read:!1,createdAt:new Date().toISOString(),link:"/signatures"}),s.id},sC=async(t,e,s)=>{await Wt(yt(he,"terms",t),{status:"ASSINADO",employeeCpf:e,signatureImage:s,signedAt:new Date().toISOString()})},nC=async t=>await fs("terms",t),rC=async t=>{const{id:e,...s}=t;return await Zt(Ee(he,"units_assinatura"),rt(s))},iC=async(t,e)=>{await Wt(yt(he,"units_assinatura",t),rt(e))},oC=async t=>await fs("units_assinatura",t),aC=async t=>await Zt(Ee(he,"sectors_assinatura"),rt({name:t.name,description:t.description||""})),lC=async(t,e)=>{await Wt(yt(he,"sectors_assinatura",t),rt(e))},cC=async t=>await fs("sectors_assinatura",t),sm=async t=>{await Zt(Ee(he,"signature_logs"),rt(t))},dC=async t=>await fs("signature_logs",t),uC=async t=>{const e=await Zt(Ee(he,"signature_requests"),rt({...t,status:"PENDING",createdAt:new Date().toISOString()}));await Zt(Ee(he,"tasks"),rt({title:`Assinatura: ${t.userName}`,description:`Solicitao de assinatura de e-mail iniciada por ${t.userName}. Notas: ${t.notes||"Sem observaes"}`,assigneeId:"",status:Ye.TODO,dueDate:new Date(Date.now()+2*24*60*60*1e3).toISOString().split("T")[0],creatorId:t.userId,creatorDepartment:"TI",createdAt:new Date().toISOString(),signatureRequestId:e.id}));const s=Nt(Ee(he,"people"),Lt("department","==","TI"));(await Vt(s)).forEach(r=>{$a({userId:r.id,type:"system",title:"Nova Solicitao de Assinatura",message:`${t.userName} solicitou uma assinatura de e-mail.`,read:!1,createdAt:new Date().toISOString(),link:"/admin-signatures"})})},hC=async(t,e,s,n,r)=>{if(!t)throw new Error("ID invlido");const o=yt(he,"signature_requests",t);await Wt(o,rt({status:e,completedAt:new Date().toISOString(),completedBy:s,signatureData:r||null}));try{const a=Nt(Ee(he,"tasks"),Lt("signatureRequestId","==",t)),l=await Vt(a);if(!l.empty){const u=l.docs[0],d=Nt(Ee(he,"people"),Lt("name","==",s)),f=await Vt(d),p=f.empty?null:f.docs[0].id;await Wt(yt(he,"tasks",u.id),{status:Ye.DONE,completedAt:new Date().toISOString(),completedBy:p})}}catch(a){console.error("Erro ao fechar tarefa de assinatura:",a)}n&&await $a({userId:n,type:"system",title:"Assinatura Concluda",message:"Sua assinatura de e-mail est pronta.",read:!1,createdAt:new Date().toISOString(),link:"/signatures"})},mC=async t=>await fs("signature_requests",t),Ux=async()=>(await Vt(Ee(he,"tasks"))).docs.map(e=>({id:e.id,...e.data()})),fC=async t=>{await Zt(Ee(he,"tasks"),rt({...t,completedAt:null,completedBy:null,createdAt:new Date().toISOString()}))},nm=async(t,e)=>{await Wt(yt(he,"tasks",t),rt(e))},pC=async t=>{await fs("tasks",t)},Fx=async()=>(await Vt(Ee(he,"systems"))).docs.map(e=>({id:e.id,...e.data()})),gC=async()=>(await Vt(Ee(he,"equipments"))).docs.map(e=>({id:e.id,...e.data()})),xC=async t=>{await Zt(Ee(he,"systems"),rt(t))},yC=async(t,e)=>{await Wt(yt(he,"systems",t),rt(e))},vC=async t=>{await fs("systems",t)},wd=async()=>{const t=Nt(Ee(he,"news"),ur("date","desc"));return(await Vt(t)).docs.map(s=>({id:s.id,...s.data()}))},bC=async t=>{await Zt(Ee(he,"news"),rt({...t,createdAt:new Date().toISOString()}))},wC=async(t,e)=>{await Wt(yt(he,"news",t),rt(e))},_C=async t=>{await fs("news",t)},Ha=async()=>(await Vt(Ee(he,"meetingRooms"))).docs.map(e=>({id:e.id,...e.data()})),NC=async t=>{await Zt(Ee(he,"meetingRooms"),rt({...t,capacity:Number(t.capacity)}))},EC=async(t,e)=>{await Wt(yt(he,"meetingRooms",t),rt({...e,capacity:Number(e.capacity)}))},TC=async t=>{await fs("meetingRooms",t)},IC=async t=>{const e=`${t.roomId}_${t.date}_${t.time.replace(":","-")}`;await Bg(yt(he,"appointments",e),rt({...t,createdAt:new Date().toISOString()}))},CC=async(t,e)=>{await Wt(yt(he,"appointments",t),rt(e))},SC=async t=>{await fs("appointments",t)},AC=t=>{if(!t)return"";const e=["de","do","da","dos","das","e","em","com","para"],s=["i","ii","iii","iv","v","vi","vii","viii","ix","x"],n=["ti","rh","sesmt","dp","it","ceo","cfo","coo","cto","adm","qhse","comex"];return t.toLowerCase().split(" ").filter(r=>r.length>0).map((r,o)=>o>0&&e.includes(r)?r:s.includes(r)||n.includes(r)?r.toUpperCase():r.charAt(0).toUpperCase()+r.slice(1)).join(" ")},RC=()=>{var re,ie;const[t,e]=I.useState(!1),s=gc(),n=ir(),{currentUser:r,logout:o,isAdmin:a,isCommunication:l,user:u,isMaster:d,globalSettings:f}=Ut(),[p,g]=I.useState([]),[v,A]=I.useState(!1),k=I.useRef(null),S=I.useRef(new Set),L=I.useRef(!0),[D,j]=I.useState(!1),[F,q]=I.useState(!1),[E,w]=I.useState({name:"",extension:"",whatsapp:"",birthday:"",avatar:"",signatureImage:""}),[b,_]=I.useState(void 0),[T,R]=I.useState(void 0),M=K=>s.pathname===K;I.useEffect(()=>{if(!r)return;const K=Nt(Ee(he,"notifications"),Lt("userId","==",r.id),ur("createdAt","desc")),ve=es(K,se=>{const le=se.docs.map(be=>({id:be.id,...be.data()}));if(L.current)le.forEach(be=>S.current.add(be.id)),L.current=!1;else{const be=le.filter(qe=>!qe.read&&!S.current.has(qe.id));be.length>0&&S.current.add(be[0].id)}g(le)}),z=se=>{k.current&&!k.current.contains(se.target)&&A(!1)};return document.addEventListener("mousedown",z),()=>{ve(),document.removeEventListener("mousedown",z)}},[r]);const C=p.filter(K=>!K.read).length,ge=async K=>{K.read||await Lx(K.id),A(!1),K.link&&(K.type==="chat"&&K.senderId?n(K.link,{state:{openChatWith:K.senderId}}):n(K.link))},_e=async()=>{if(r)try{await Vx(r.id)}catch(K){console.error("Erro ao limpar notificaes:",K)}},P=async()=>{n("/"),setTimeout(async()=>{await o()},100)},Z=()=>{r&&(w({name:r.name,extension:r.extension,whatsapp:r.whatsapp||"",birthday:r.birthday||"",avatar:r.avatar,signatureImage:r.signatureImage||""}),_(void 0),R(void 0),j(!0),e(!1))},B=(K,ve)=>{var se;const z=(se=K.target.files)==null?void 0:se[0];if(z){const le=new FileReader;le.onload=be=>{var Le;const qe=new Image;qe.onload=()=>{const ee=document.createElement("canvas");let xe=qe.width,Fe=qe.height;const Je=ve==="avatar"?300:600;xe>Fe?xe>Je&&(Fe*=Je/xe,xe=Je):Fe>Je&&(xe*=Je/Fe,Fe=Je),ee.width=xe,ee.height=Fe;const mt=ee.getContext("2d");mt==null||mt.drawImage(qe,0,0,xe,Fe);const ft=ee.toDataURL("image/png",.8);ve==="avatar"?(_(ft),w(H=>({...H,avatar:ft}))):(R(ft),w(H=>({...H,signatureImage:ft})))},qe.src=(Le=be.target)==null?void 0:Le.result},le.readAsDataURL(z)}},$=async()=>{if(r){if(!E.name)return alert("O nome  obrigatrio.");q(!0);try{const K={name:E.name,extension:E.extension,whatsapp:E.whatsapp,birthday:E.birthday,uid:u==null?void 0:u.uid,signatureImage:E.signatureImage};r.id==="temp"||!r.id?await Mx(K,b):await bd(r.id,K,b),alert("Perfil atualizado com sucesso!"),j(!1)}catch{alert("Erro ao atualizar perfil.")}finally{q(!1)}}};if(!r)return null;const U=[{path:"/dashboard",label:"Dashboard",icon:Ff},{path:"/directory",label:"Ramais & Pessoas",icon:Ci},{path:"/systems",label:"Sistemas & Links",icon:xc},{path:"/meeting-rooms",label:"Salas de Reunio",icon:Gt},{path:"/tasks",label:"Tarefas",icon:ss},{path:"/signatures",label:"Assinaturas & Termos",icon:ys}],te=d||a||((ie=(re=f==null?void 0:f.termsDeptPermissions)==null?void 0:re[r.department])==null?void 0:ie.enabled);return i.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col md:flex-row font-sans text-slate-900 relative overflow-x-hidden",children:[i.jsxs("div",{className:"md:hidden flex items-center justify-between p-4 bg-white border-b shadow-sm z-30 relative sticky top-0",children:[i.jsx("div",{className:"flex items-center gap-2",children:i.jsx(Qs,{className:"h-8 w-auto"})}),i.jsx("button",{onClick:()=>e(!0),className:"p-2 text-slate-600 hover:bg-slate-100 rounded-lg",children:i.jsx(ny,{})})]}),t&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-40 md:hidden backdrop-blur-sm transition-opacity",onClick:()=>e(!1)}),i.jsxs("aside",{className:`fixed inset-y-0 left-0 z-50 w-72 bg-slate-900 text-slate-300 transition-transform duration-300 ease-in-out transform ${t?"translate-x-0":"-translate-x-full"} md:translate-x-0 md:static md:h-screen flex flex-col shadow-2xl md:shadow-none`,children:[i.jsxs("div",{className:"flex md:hidden items-center justify-between p-4 border-b border-slate-800",children:[i.jsx(Qs,{className:"h-8 w-auto brightness-0 invert"}),i.jsx("button",{onClick:()=>e(!1),className:"p-2 text-slate-400 hover:text-white rounded-lg",children:i.jsx(St,{size:24})})]}),i.jsx("div",{className:"p-6 hidden md:flex items-center justify-center",children:i.jsx(Qs,{className:"w-52 h-auto"})}),i.jsxs("nav",{className:"flex-1 px-4 py-6 space-y-6 overflow-y-auto custom-scrollbar",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("p",{className:"px-4 text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2",children:"Menu Principal"}),U.map(K=>i.jsxs(Rt,{to:K.path,onClick:()=>e(!1),className:`flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 ${M(K.path)?"bg-emerald-600 text-white shadow-md shadow-emerald-900/20":"hover:bg-slate-800 hover:text-white"}`,children:[i.jsx(K.icon,{size:20}),i.jsx("span",{className:"font-medium",children:K.label})]},K.path)),l&&i.jsxs(Rt,{to:"/news-editor",onClick:()=>e(!1),className:`flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 ${M("/news-editor")?"bg-emerald-600 text-white shadow-md shadow-emerald-900/20":"hover:bg-slate-800 hover:text-white"}`,children:[i.jsx(ry,{size:20}),i.jsx("span",{className:"font-medium",children:"Criar Postagem"})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("p",{className:"px-4 text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-1",children:[i.jsx(yc,{size:12})," Administrativo"]}),d&&i.jsxs(Rt,{to:"/admin-users",onClick:()=>e(!1),className:`flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 ${M("/admin-users")?"bg-slate-700 text-white border-l-4 border-emerald-500":"hover:bg-slate-800 hover:text-white"}`,children:[i.jsx(jt,{size:20})," ",i.jsx("span",{children:"Gesto de Usurios"})]}),a&&i.jsxs(i.Fragment,{children:[i.jsxs(Rt,{to:"/admin-employees",onClick:()=>e(!1),className:`flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 ${M("/admin-employees")?"bg-slate-700 text-white border-l-4 border-emerald-500":"hover:bg-slate-800 hover:text-white"}`,children:[i.jsx(Ci,{size:20})," ",i.jsx("span",{children:"Gesto Colaboradores"})]}),i.jsxs(Rt,{to:"/admin-systems",onClick:()=>e(!1),className:`flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 ${M("/admin-systems")?"bg-slate-700 text-white border-l-4 border-emerald-500":"hover:bg-slate-800 hover:text-white"}`,children:[i.jsx(Ws,{size:20})," ",i.jsx("span",{children:"Gesto de Sistemas & Links"})]}),i.jsxs(Rt,{to:"/admin-rooms",onClick:()=>e(!1),className:`flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 ${M("/admin-rooms")?"bg-slate-700 text-white border-l-4 border-emerald-500":"hover:bg-slate-800 hover:text-white"}`,children:[i.jsx(Tr,{size:20})," ",i.jsx("span",{children:"Gesto Salas"})]}),i.jsxs(Rt,{to:"/admin-org",onClick:()=>e(!1),className:`flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 ${M("/admin-org")?"bg-slate-700 text-white border-l-4 border-emerald-500":"hover:bg-slate-800 hover:text-white"}`,children:[i.jsx(vc,{size:20})," ",i.jsx("span",{children:"Gesto Organizacional"})]}),i.jsxs(Rt,{to:"/admin-signatures",onClick:()=>e(!1),className:`flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 ${M("/admin-signatures")?"bg-slate-700 text-white border-l-4 border-emerald-500":"hover:bg-slate-800 hover:text-white"}`,children:[i.jsx(ys,{size:20})," ",i.jsx("span",{children:"Assinaturas de E-mail"})]})]}),te&&i.jsxs(Rt,{to:"/admin-terms",onClick:()=>e(!1),className:`flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 ${M("/admin-terms")?"bg-slate-700 text-white border-l-4 border-emerald-500":"hover:bg-slate-800 hover:text-white"}`,children:[i.jsx(jr,{size:20})," ",i.jsx("span",{children:"Gesto de Termos"})]})]})]}),i.jsxs("div",{className:"p-4 border-t border-slate-800 bg-slate-900",children:[i.jsxs("div",{className:"flex items-center gap-3 px-2 mb-4 group cursor-pointer",onClick:Z,children:[i.jsxs("div",{className:"relative shrink-0",children:[i.jsx("img",{src:r.avatar,className:"w-10 h-10 rounded-full border-2 border-emerald-500 object-cover group-hover:border-white transition-colors"}),i.jsx("div",{className:"absolute -bottom-1 -right-1 bg-slate-700 rounded-full p-0.5 border border-slate-900 opacity-0 group-hover:opacity-100 transition-opacity",children:i.jsx(Ws,{size:10,className:"text-white"})})]}),i.jsxs("div",{className:"flex-1 min-w-0 flex flex-col",children:[i.jsx("div",{className:"flex items-center justify-between",children:i.jsx("p",{className:"text-sm font-semibold text-white leading-tight truncate group-hover:text-emerald-400 transition-colors",children:r.name.split(" ")[0]})}),i.jsxs("div",{className:"flex flex-col gap-0.5 mt-1",children:[i.jsx("span",{className:"text-[10px] bg-slate-800 px-1.5 py-0.5 rounded text-slate-300 border border-slate-700 inline-block truncate w-fit max-w-full",children:AC(r.role)}),i.jsx("span",{className:"text-[10px] text-slate-400 truncate leading-tight pl-0.5",children:r.department}),r.unit&&i.jsx("span",{className:"text-[9px] text-slate-500 truncate leading-tight pl-0.5",children:r.unit})]})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsxs("button",{onClick:Z,className:"flex items-center justify-center gap-2 px-3 py-2 text-xs font-medium text-slate-400 hover:text-white bg-slate-800 hover:bg-slate-700 rounded-lg transition-colors",children:[i.jsx(Ws,{size:14}),i.jsx("span",{children:"Editar"})]}),i.jsxs("button",{onClick:P,className:"flex items-center justify-center gap-2 px-3 py-2 text-xs font-medium text-slate-400 hover:text-red-400 bg-slate-800 hover:bg-slate-700 rounded-lg transition-colors",children:[i.jsx(iy,{size:14}),i.jsx("span",{children:"Sair"})]})]})]})]}),i.jsxs("main",{className:`flex-1 flex flex-col h-[calc(100vh-64px)] md:h-screen transition-all ${t?"overflow-hidden":"overflow-y-auto"}`,children:[i.jsxs("header",{className:"sticky top-0 z-20 bg-white/80 backdrop-blur-md border-b border-slate-200 px-6 py-4 flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("h1",{className:"text-xl font-bold text-slate-800 hidden md:block",children:"iRamais Hub"}),i.jsxs(Rt,{to:"/",className:"flex items-center gap-2 text-xs md:text-sm font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 px-3 py-1.5 rounded-lg transition-colors border border-emerald-100",children:[i.jsx(Js,{size:16}),i.jsx("span",{className:"hidden sm:inline",children:"Portal do Visitante"}),i.jsx("span",{className:"sm:hidden",children:"Incio"})]})]}),i.jsxs("div",{className:"flex items-center gap-4 w-full md:w-auto justify-end",children:[i.jsxs("div",{className:"relative hidden md:block",children:[i.jsx(Zs,{className:"absolute left-3 top-2.5 text-slate-400 w-4 h-4"}),i.jsx("input",{type:"text",placeholder:"Pesquisar no iRamais Hub...",className:"pl-9 pr-4 py-2 bg-slate-100 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 w-64"})]}),i.jsxs("div",{className:"relative",ref:k,children:[i.jsxs("button",{onClick:()=>A(!v),className:`relative p-2 transition-colors rounded-full ${v?"bg-emerald-50 text-emerald-600":"text-slate-500 hover:text-emerald-600"}`,children:[i.jsx(Fo,{size:20}),C>0&&i.jsx("span",{className:"absolute top-1 right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white animate-pulse"})]}),v&&i.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-xl border border-slate-200 z-50 overflow-hidden animate-fade-in",children:[i.jsxs("div",{className:"p-3 border-b border-slate-100 flex justify-between items-center bg-slate-50",children:[i.jsx("h3",{className:"font-bold text-slate-700 text-sm",children:"Notificaes"}),p.length>0&&i.jsx("button",{onClick:_e,className:"text-[10px] text-slate-500 hover:text-red-500 font-medium",children:"Limpar tudo"})]}),i.jsx("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar",children:p.length>0?p.map(K=>i.jsx("div",{onClick:()=>ge(K),className:`p-3 border-b border-slate-50 cursor-pointer hover:bg-slate-50 transition-colors ${K.read?"":"bg-blue-50/30"}`,children:i.jsxs("div",{className:"flex gap-3",children:[i.jsx("div",{className:`mt-1.5 w-2 h-2 rounded-full shrink-0 ${K.read?"bg-slate-300":K.type==="term"?"bg-emerald-500":"bg-blue-500"}`}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsx("p",{className:`text-sm ${K.read?"text-slate-600":"font-bold text-slate-800"}`,children:K.title}),i.jsx("span",{className:"text-[10px] text-slate-400 whitespace-nowrap ml-2",children:new Date(K.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),i.jsx("p",{className:"text-xs text-slate-500 mt-0.5 line-clamp-2",children:K.message}),K.type==="term"&&i.jsx("span",{className:"inline-block mt-1 text-[10px] bg-emerald-100 text-emerald-700 px-1.5 py-0.5 rounded",children:"Termo de Responsabilidade"})]})]})},K.id)):i.jsxs("div",{className:"p-8 text-center text-slate-400",children:[i.jsx(Fo,{size:24,className:"mx-auto mb-2 opacity-20"}),i.jsx("p",{className:"text-xs",children:"Nenhuma notificao."})]})}),i.jsx("div",{className:"p-2 bg-slate-50 text-center border-t border-slate-100",children:i.jsx(Rt,{to:"/tasks",onClick:()=>A(!1),className:"text-xs font-medium text-emerald-600 hover:underline",children:"Ver todas as tarefas"})})]})]})]})]}),i.jsx("div",{className:"p-4 md:p-8 max-w-7xl mx-auto w-full",children:i.jsx(Q0,{})})]}),D&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-[60] flex items-center justify-center p-4",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-lg overflow-hidden animate-fade-in custom-scrollbar overflow-y-auto max-h-[95vh]",children:[i.jsxs("div",{className:"p-6 border-b border-slate-100 flex items-center justify-between bg-slate-50 sticky top-0 z-10",children:[i.jsxs("h3",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[i.jsx(Ps,{className:"text-emerald-600",size:20})," Minha Conta"]}),i.jsx("button",{onClick:()=>j(!1),className:"text-slate-400 hover:text-slate-600 p-1 hover:bg-slate-200 rounded-full transition-colors",children:i.jsx(St,{size:20})})]}),i.jsxs("div",{className:"p-6 space-y-8",children:[i.jsxs("div",{className:"flex flex-col items-center gap-3",children:[i.jsxs("div",{className:"relative group",children:[i.jsx("div",{className:"w-24 h-24 rounded-full bg-slate-100 flex items-center justify-center overflow-hidden border-4 border-white shadow-md",children:E.avatar?i.jsx("img",{src:E.avatar,className:"w-full h-full object-cover"}):i.jsx(Ps,{className:"text-slate-400",size:32})}),i.jsxs("label",{className:"absolute bottom-0 right-0 bg-emerald-600 text-white p-2 rounded-full cursor-pointer hover:bg-emerald-700 transition-colors shadow-sm",children:[i.jsx(Si,{size:14}),i.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:K=>B(K,"avatar")})]})]}),i.jsx("p",{className:"text-xs text-slate-400",children:"Foto de Perfil (Avatar)"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1",children:"Nome Completo"}),i.jsxs("div",{className:"relative",children:[i.jsx(Ps,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),i.jsx("input",{type:"text",value:E.name,onChange:K=>w({...E,name:K.target.value}),className:"w-full pl-9 p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900 text-sm"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1",children:"Ramal"}),i.jsxs("div",{className:"relative",children:[i.jsx(or,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),i.jsx("input",{type:"text",value:E.extension,onChange:K=>w({...E,extension:K.target.value}),className:"w-full pl-9 p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900 text-sm"})]})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1",children:"WhatsApp"}),i.jsxs("div",{className:"relative",children:[i.jsx(oy,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),i.jsx("input",{type:"text",value:E.whatsapp,onChange:K=>w({...E,whatsapp:K.target.value}),className:"w-full pl-9 p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900 text-sm",placeholder:"5571..."})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1",children:"Data de Nascimento"}),i.jsxs("div",{className:"relative",children:[i.jsx(Gt,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),i.jsx("input",{type:"date",value:E.birthday,onChange:K=>w({...E,birthday:K.target.value}),className:"w-full pl-9 p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900 text-sm"})]})]})]})]}),i.jsxs("div",{className:"border-t pt-8",children:[i.jsxs("h4",{className:"text-sm font-bold text-slate-700 flex items-center gap-2 mb-4",children:[i.jsx(Of,{size:18,className:"text-emerald-600"})," Assinatura para Documentos Digital"]}),i.jsx("p",{className:"text-xs text-slate-500 mb-4 leading-relaxed",children:"Esta assinatura ser utilizada nos termos e outros documentos oficiais que voc assinar digitalmente atravs do sistema."}),i.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6 bg-slate-50 p-6 rounded-2xl border border-slate-100",children:[i.jsxs("div",{className:"relative shrink-0 group",children:[i.jsx("div",{className:"w-48 h-24 bg-white border-2 border-dashed border-slate-300 rounded-xl flex items-center justify-center overflow-hidden shadow-inner p-2 group-hover:border-emerald-400 transition-colors",children:E.signatureImage?i.jsx("img",{src:E.signatureImage,className:"max-w-full max-h-full object-contain mix-blend-multiply"}):i.jsxs("div",{className:"text-slate-300 flex flex-col items-center",children:[i.jsx(ys,{size:24,className:"opacity-20 mb-1"}),i.jsx("span",{className:"text-[10px] font-black uppercase",children:"Sem Assinatura"})]})}),i.jsxs("label",{className:"absolute -bottom-2 -right-2 bg-emerald-600 text-white p-2 rounded-full cursor-pointer hover:bg-emerald-700 transition-all shadow-md group-hover:scale-110",children:[i.jsx(ay,{size:14}),i.jsx("input",{type:"file",accept:"image/png, image/jpeg",className:"hidden",onChange:K=>B(K,"signature")})]})]}),i.jsxs("div",{className:"flex-1 space-y-2",children:[i.jsx("p",{className:"text-[10px] font-black text-emerald-600 uppercase tracking-widest",children:"Recomendao:"}),i.jsxs("ul",{className:"text-[10px] text-slate-500 space-y-1",children:[i.jsx("li",{children:" Use papel branco liso com caneta preta ou azul forte."}),i.jsx("li",{children:" Tire uma foto bem iluminada e recorte apenas a assinatura."}),i.jsx("li",{children:" Formato ideal: **PNG com fundo transparente**."})]}),E.signatureImage&&i.jsx("button",{onClick:()=>w(K=>({...K,signatureImage:""})),className:"text-[10px] font-bold text-red-500 hover:underline flex items-center gap-1 mt-2",children:"Remover Assinatura"})]})]})]}),i.jsx("div",{className:"p-4 bg-amber-50 rounded-xl border border-amber-100 text-[10px] text-amber-800 leading-relaxed",children:i.jsxs("p",{children:[i.jsx("strong",{children:"IMPORTANTE:"})," Para sua segurana, a assinatura manuscrita (opcional) ser estampada junto a uma chave criptogrfica (hash) e seus dados de CPF/Senha validados no ato da assinatura de cada termo."]})})]}),i.jsxs("div",{className:"p-4 bg-slate-50 border-t border-slate-100 flex justify-end gap-3 sticky bottom-0 z-10",children:[i.jsx("button",{onClick:()=>j(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-200 rounded-lg font-medium text-sm",disabled:F,children:"Cancelar"}),i.jsxs("button",{onClick:$,className:"px-6 py-2 bg-emerald-600 text-white rounded-lg font-medium hover:bg-emerald-700 flex items-center gap-2 text-sm disabled:opacity-50",disabled:F,children:[F?i.jsx(Ne,{className:"animate-spin",size:16}):i.jsx(hs,{size:16})," Salvar Perfil"]})]})]})})]})},PC=()=>{const t=[];for(let e=8;e<=17;e++)t.push(`${String(e).padStart(2,"0")}:00`),t.push(`${String(e).padStart(2,"0")}:30`);return t},jC=PC(),kC=()=>{const{currentUser:t,globalSettings:e}=Ut(),[s,n]=I.useState([]),[r,o]=I.useState([]),[a,l]=I.useState([]),[u,d]=I.useState([]),[f,p]=I.useState([]),[g,v]=I.useState([]),[A,k]=I.useState(!0),[S,L]=I.useState(null),[D,j]=I.useState(new Date().getMonth()),[F,q]=I.useState(new Set),E=["Janeiro","Fevereiro","Maro","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];I.useEffect(()=>{(async()=>{k(!0);try{const $=new Date().toISOString().split("T")[0],[U,te,re,ie,K]=await Promise.all([wd(),Fn(),Ux(),Ha(),ln()]),ve=Nt(Ee(he,"appointments"),Lt("date","==",$)),se=(await Vt(ve)).docs.map(le=>({id:le.id,...le.data()}));n(U.filter(le=>le.published)),o(te),l(re),d(ie),p(K),v(se)}catch($){console.error("Erro ao carregar dashboard:",$)}finally{k(!1)}})()},[]);const w=()=>j(B=>B===0?11:B-1),b=()=>j(B=>B===11?0:B+1),_=B=>{q($=>{const U=new Set($);return U.has(B)?U.delete(B):U.add(B),U})},T=I.useMemo(()=>{if(!(t!=null&&t.birthday))return!1;const B=new Date,[$,U,te]=t.birthday.split("-").map(Number);return B.getMonth()+1===U&&B.getDate()===te},[t]),R=I.useMemo(()=>{const B=new Date,$=B.getDate(),U=B.getMonth(),te=r.filter(ie=>ie.birthday?parseInt(ie.birthday.split("-")[1])===D+1:!1).sort((ie,K)=>{const ve=parseInt(ie.birthday.split("-")[2]),z=parseInt(K.birthday.split("-")[2]);return ve-z}),re=D===U;return re?{isCurrentMonth:re,todaysBirthdays:te.filter(ie=>parseInt(ie.birthday.split("-")[2])===$),pastBirthdays:te.filter(ie=>parseInt(ie.birthday.split("-")[2])<$),upcomingBirthdays:te.filter(ie=>parseInt(ie.birthday.split("-")[2])>$)}:{isCurrentMonth:re,todaysBirthdays:[],pastBirthdays:[],upcomingBirthdays:te}},[r,D]),M=I.useMemo(()=>t?a.filter(B=>B.assigneeId===t.id&&B.status!==Ye.DONE).length:0,[a,t]),C=I.useMemo(()=>t?a.filter(B=>B.status!==Ye.DONE&&B.creatorDepartment===t.department).length:0,[a,t]),ge=B=>{const $=new Date,U=$.getDay(),te=$.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit",hour12:!1}),re=U===6,ie=U===0,K=!!B.worksSaturday,ve=!!B.worksSunday,z=re&&!K||ie&&!ve,se=te<(B.startTime||"08:00")||te>=(B.endTime||"18:00"),le=z||se,be=g.filter(Le=>Le.roomId===B.id).sort((Le,ee)=>{const[xe,Fe]=Le.time.split(":").map(Number),[Je,mt]=ee.time.split(":").map(Number);return xe*60+Fe-(Je*60+mt)}),qe=be.find(Le=>{const[ee,xe]=Le.time.split(":").map(Number),Fe=new Date;Fe.setHours(ee,xe,0,0);const Je=new Date(Fe);return Je.setMinutes(Fe.getMinutes()+30),$>=Fe&&$<Je});return{isOccupied:!!qe&&!le,isClosed:le,currentMeeting:qe,schedule:be}},_e=B=>B?new Date(B).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}):"",P=B=>{var $;switch(B.type){case"header":return i.jsx("h3",{className:"text-xl md:text-2xl font-black text-slate-800 mt-6 mb-3 leading-tight",children:B.content},B.id);case"image":return i.jsx("img",{src:B.content,alt:"",className:"w-full rounded-2xl shadow-md my-6"},B.id);case"quote":return i.jsxs("blockquote",{className:"border-l-4 border-emerald-500 pl-4 py-3 italic my-6 bg-slate-50 text-lg text-slate-600 rounded-r-xl",children:['"',B.content,'"']},B.id);case"button":return i.jsx("div",{className:"my-8 text-center",children:i.jsx("a",{href:B.url,target:"_blank",rel:"noopener noreferrer",className:"inline-block transition-all hover:scale-105 shadow-lg hover:shadow-xl px-8 py-3 font-bold uppercase tracking-wider bg-emerald-600 text-white rounded-xl text-sm no-underline",children:B.content})},B.id);case"side-by-side":return i.jsxs("div",{className:`flex flex-col md:flex-row gap-6 items-center my-8 ${(($=B.style)==null?void 0:$.layoutDirection)==="row-reverse"?"md:flex-row-reverse":""}`,children:[i.jsx("div",{className:"w-full md:w-1/2",children:i.jsx("img",{src:B.url,alt:"",className:"w-full rounded-xl shadow-sm object-cover"})}),i.jsx("div",{className:"w-full md:w-1/2 text-slate-600 leading-relaxed text-base",children:B.content})]},B.id);default:return i.jsx("p",{className:"text-base md:text-lg leading-relaxed text-slate-600 whitespace-pre-wrap mb-4",children:B.content},B.id)}};if(A)return i.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-200px)]",children:i.jsxs("div",{className:"flex flex-col items-center gap-2 text-emerald-600",children:[i.jsx(Ne,{className:"animate-spin",size:48}),i.jsx("span",{className:"font-medium",children:"Carregando dashboard..."})]})});const Z=(e==null?void 0:e.dashboardShowRooms)||(e==null?void 0:e.dashboardShowBirthdays);return i.jsxs("div",{className:"space-y-6 animate-fade-in relative",children:[i.jsxs("div",{className:"bg-gradient-to-r from-emerald-600 to-teal-600 rounded-3xl p-8 text-white shadow-xl relative overflow-hidden",children:[i.jsxs("div",{className:"relative z-10",children:[i.jsxs("h2",{className:"text-3xl font-bold mb-2",children:["Bem-vindo(a), ",t==null?void 0:t.name.split(" ")[0],"!"]}),i.jsxs("p",{className:"text-emerald-100 max-w-2xl text-lg leading-relaxed",children:["Voc tem ",i.jsxs("span",{className:"font-bold text-white border-b border-emerald-400",children:[M," tarefas"]})," atribudas a voc.",i.jsxs("span",{className:"block sm:inline sm:ml-2",children:["No setor ",i.jsx("span",{className:"font-bold text-white",children:t==null?void 0:t.department}),", existem ",i.jsxs("span",{className:"font-bold text-white",children:[C," pendncias"]})," no total."]})]}),T&&i.jsxs("div",{className:"mt-8 flex flex-col md:flex-row items-center md:items-start gap-6 bg-white/15 backdrop-blur-xl p-6 md:p-8 rounded-[2rem] border border-white/30 animate-fade-in shadow-2xl max-w-4xl ring-1 ring-white/20",children:[i.jsxs("div",{className:"relative shrink-0",children:[i.jsx("div",{className:"w-24 h-24 md:w-32 md:h-32 rounded-full border-4 border-white shadow-2xl overflow-hidden relative z-10",children:i.jsx("img",{src:t==null?void 0:t.avatar,alt:t==null?void 0:t.name,className:"w-full h-full object-cover"})}),i.jsx("div",{className:"absolute -top-4 -right-2 text-5xl md:text-6xl drop-shadow-lg z-20 animate-bounce select-none",title:"Feliz Aniversrio!",children:""}),i.jsx("div",{className:"absolute -top-6 -left-2 text-4xl drop-shadow-md z-20 animate-pulse select-none opacity-80",children:""}),i.jsx("div",{className:"absolute inset-0 bg-pink-400/30 blur-2xl rounded-full animate-pulse"})]}),i.jsxs("div",{className:"text-center md:text-left space-y-4",children:[i.jsx("h3",{className:"text-2xl md:text-3xl font-black text-white tracking-tight drop-shadow-sm",children:" Feliz aniversrio! "}),i.jsx("div",{className:"space-y-4 text-emerald-50 text-sm md:text-base leading-relaxed font-medium",children:i.jsx("p",{children:"Desejamos um novo ciclo cheio de sade, realizaes e crescimento pessoal e profissional. Conte com a Intermartima para seguir construindo grandes resultados juntos. "})})]})]})]}),i.jsx("div",{className:"absolute top-0 right-0 -mt-10 -mr-10 w-64 h-64 bg-white/10 rounded-full blur-3xl"}),i.jsx("div",{className:"absolute bottom-0 left-0 -mb-10 -ml-10 w-40 h-40 bg-white/10 rounded-full blur-2xl"})]}),i.jsxs("div",{className:`grid grid-cols-1 ${Z?"lg:grid-cols-3":"lg:grid-cols-1"} gap-6`,children:[(e==null?void 0:e.dashboardShowNews)&&i.jsxs("div",{className:`${Z?"lg:col-span-2":"lg:col-span-1"} space-y-6`,children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("h3",{className:"text-xl font-bold text-slate-800 flex items-center gap-2",children:[i.jsx(Ai,{className:"text-emerald-600",size:24})," Mural de Notcias"]}),i.jsx(Rt,{to:"/news-editor",className:"text-sm text-emerald-600 font-medium hover:underline",children:"Ver todas / Criar"})]}),i.jsx("div",{className:"space-y-4",children:s.length>0?s.map(B=>{var re;const $=S===B.id,U=r.find(ie=>ie.name===B.author),te=B.authorAvatar||(U==null?void 0:U.avatar)||`https://ui-avatars.com/api/?name=${encodeURIComponent(B.author)}&background=0d9488&color=fff`;return i.jsxs("div",{className:`bg-white rounded-2xl p-0 shadow-sm border transition-all duration-500 overflow-hidden ${$?"border-emerald-200 ring-1 ring-emerald-50":"border-slate-100 hover:shadow-md"}`,children:[i.jsxs("div",{className:`flex flex-col md:flex-row ${$?"bg-slate-50/50":""}`,children:[i.jsxs("div",{className:`h-48 md:h-auto md:w-1/3 bg-slate-200 relative shrink-0 transition-all duration-500 ${$?"md:h-64":""}`,children:[i.jsx("img",{src:B.thumbnail,alt:B.title,className:"w-full h-full object-cover"}),$&&i.jsx("div",{className:"absolute inset-0 bg-black/20 flex items-center justify-center md:hidden",children:i.jsx("span",{className:"bg-white/90 px-4 py-2 rounded-full text-xs font-bold text-slate-800",children:"Visualizando Comunicado"})})]}),i.jsxs("div",{className:"p-6 md:w-2/3 flex flex-col justify-center",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 mb-2",children:[i.jsx("span",{className:"bg-emerald-50 text-emerald-700 px-2 py-0.5 rounded font-bold uppercase tracking-wider text-[10px]",children:B.category}),i.jsx("span",{children:_e(B.date)})]}),i.jsx("h4",{className:`text-lg font-bold text-slate-900 leading-tight mb-2 transition-all ${$?"text-xl md:text-2xl":""}`,children:B.title}),!$&&i.jsx("p",{className:"text-slate-600 text-sm line-clamp-2 mb-4",children:((re=B.blocks.find(ie=>ie.type==="paragraph"))==null?void 0:re.content)||"Clique para ler mais..."}),i.jsx("div",{className:"flex gap-4 items-center",children:B.externalUrl?i.jsxs("a",{href:B.externalUrl,target:"_blank",rel:"noopener noreferrer",className:"text-emerald-600 font-semibold text-sm hover:text-emerald-800 flex items-center gap-1",children:["Ler Notcia Completa ",i.jsx(ya,{size:14})]}):i.jsx("button",{onClick:()=>L($?null:B.id),className:`font-bold text-sm flex items-center gap-2 transition-all px-4 py-2 rounded-lg ${$?"bg-slate-200 text-slate-700 hover:bg-slate-300":"text-emerald-600 hover:text-emerald-800 bg-emerald-50 hover:bg-emerald-100"}`,children:$?i.jsxs(i.Fragment,{children:[i.jsx(Ri,{size:16})," Recolher Leitura"]}):i.jsxs(i.Fragment,{children:[i.jsx(Pi,{size:16})," Ler Comunicado"]})})})]})]}),$&&i.jsxs("div",{className:"p-6 md:p-10 border-t border-slate-100 animate-fade-in bg-white",children:[i.jsxs("div",{className:"flex items-center gap-4 mb-8 pb-4 border-b border-slate-50",children:[i.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden border-2 border-emerald-100 shadow-sm shrink-0",children:i.jsx("img",{src:te,alt:B.author,className:"w-full h-full object-cover"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest leading-none mb-1",children:"Autor da Publicao"}),i.jsx("p",{className:"text-sm font-bold text-slate-700 leading-none",children:B.author})]})]}),i.jsx("div",{className:"max-w-none prose prose-slate",children:B.blocks.map(ie=>P(ie))}),i.jsx("div",{className:"mt-10 pt-6 border-t border-slate-100 flex justify-center",children:i.jsxs("button",{onClick:()=>{var ie;L(null),window.scrollTo({top:((ie=document.getElementById(`news-${B.id}`))==null?void 0:ie.offsetTop)||0,behavior:"smooth"})},className:"group flex flex-col items-center gap-2 text-slate-400 hover:text-emerald-600 transition-all",children:[i.jsx(zf,{size:32,className:"group-hover:scale-110 transition-transform"}),i.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Fechar Visualizao"})]})})]}),i.jsx("div",{id:`news-${B.id}`})]},B.id)}):i.jsxs("div",{className:"bg-white rounded-2xl p-12 text-center border border-slate-200 border-dashed text-slate-400",children:[i.jsx(Ai,{size:48,className:"mx-auto mb-4 opacity-20"}),i.jsx("p",{children:"Nenhuma notcia publicada recentemente."})]})})]}),Z&&i.jsxs("div",{className:"space-y-6",children:[(e==null?void 0:e.dashboardShowRooms)&&i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[i.jsx(Gt,{size:20,className:"text-indigo-600"})," Status das Salas"]}),i.jsx(Rt,{to:"/meeting-rooms",className:"text-xs text-indigo-600 hover:underline",children:"Ver agenda"})]}),i.jsx("div",{className:"space-y-4",children:u.length>0?u.map(B=>{const{isOccupied:$,isClosed:U,schedule:te}=ge(B),re=F.has(B.id),ie=f.find(K=>K.id===B.unitId);return i.jsxs("div",{className:"border border-slate-100 rounded-xl p-3 bg-slate-50/50",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2 cursor-pointer select-none",onClick:()=>_(B.id),children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx($t,{size:14,className:"text-slate-400"}),i.jsxs("div",{children:[i.jsx("span",{className:"text-sm font-bold text-slate-700 block leading-tight",children:B.name}),i.jsx("span",{className:"text-[10px] text-slate-400 font-bold uppercase",children:(ie==null?void 0:ie.name)||"SEDE"})]}),U?i.jsx("span",{className:"text-[10px] uppercase font-bold px-2 py-0.5 rounded-full border bg-slate-100 text-slate-500 border-slate-200",children:"Fechado"}):i.jsx("span",{className:`text-[10px] uppercase font-bold px-2 py-0.5 rounded-full border ${$?"bg-red-50 text-red-600 border-red-100":"bg-emerald-50 text-emerald-600 border-emerald-100"}`,children:$?"Ocupada":"Livre"})]}),i.jsx("div",{className:"text-slate-400 hover:text-slate-600 transition-colors",children:re?i.jsx(Ri,{size:16}):i.jsx(Pi,{size:16})})]}),re&&i.jsxs("div",{className:"mt-3 animate-fade-in",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Agenda Hoje:"}),i.jsxs("span",{className:"text-[9px] font-bold text-slate-400 bg-slate-100 px-2 py-0.5 rounded",children:[B.startTime||"08:00"," - ",B.endTime||"18:00"]})]}),i.jsx("div",{className:"grid grid-cols-1 gap-2",children:jC.map(K=>{const ve=te.find(ee=>ee.time===K),z=!!ve,[se,le]=K.split(":").map(Number),be=new Date,qe=K>=(B.startTime||"08:00")&&K<(B.endTime||"18:00"),Le=be.getHours()>se||be.getHours()===se&&be.getMinutes()>=le+30;if(z){const ee=ve.participants||[];return i.jsxs("div",{className:`flex flex-col border rounded-xl p-2.5 ${Le?"bg-slate-100 border-slate-200 opacity-60 grayscale-[50%]":"bg-red-50 border-red-100 shadow-sm"}`,children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("span",{className:`text-[9px] font-bold px-1.5 py-0.5 rounded ${Le?"bg-slate-200 text-slate-500":"bg-red-100 text-red-600"}`,children:K}),i.jsxs("div",{className:"flex items-center gap-1 text-[9px] font-bold text-slate-500 truncate",children:[i.jsx(Ps,{size:10})," ",ve.userName]})]}),i.jsx("p",{className:"text-[10px] font-bold text-slate-800 line-clamp-1",children:ve.subject}),ee.length>0&&i.jsxs("p",{className:"text-[8px] text-slate-400 mt-1 italic",children:["+",ee.length," convidados"]})]},K)}return i.jsxs("div",{className:`flex items-center justify-between border rounded-xl p-2 px-3 ${Le||U||!qe?"bg-slate-100 border-slate-200 opacity-50":"bg-emerald-50 border-emerald-100"}`,children:[i.jsx("span",{className:"text-[9px] font-bold text-slate-400",children:K}),i.jsx("span",{className:"text-[8px] uppercase font-bold text-slate-400",children:U||!qe?"Fechado":Le?"Encerrado":"Livre"})]},K)})}),i.jsx(Rt,{to:"/meeting-rooms",state:{selectedRoomId:B.id},className:"mt-4 w-full py-2 bg-emerald-600 text-white rounded-xl text-xs font-bold flex items-center justify-center gap-2 hover:bg-emerald-700 transition-all shadow-md shadow-emerald-100",children:"Reservar nesta sala"})]})]},B.id)}):i.jsx("p",{className:"text-sm text-slate-400 text-center py-4",children:"Nenhuma sala cadastrada."})})]}),(e==null?void 0:e.dashboardShowBirthdays)&&i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden",children:[i.jsxs("div",{className:"p-6 border-b border-slate-50 bg-slate-50/50 flex items-center justify-between",children:[i.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[i.jsx(bc,{size:20,className:"text-pink-500"})," Aniversariantes"]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("button",{onClick:w,className:"p-1 hover:bg-white rounded-lg transition-colors text-slate-400 hover:text-emerald-600",children:i.jsx(wc,{size:18})}),i.jsx("span",{className:"text-[10px] font-bold text-emerald-700 uppercase min-w-[70px] text-center",children:E[D]}),i.jsx("button",{onClick:b,className:"p-1 hover:bg-white rounded-lg transition-colors text-slate-400 hover:text-emerald-600",children:i.jsx(kr,{size:18})})]})]}),i.jsxs("div",{className:"p-4 space-y-4 max-h-[400px] overflow-y-auto custom-scrollbar",children:[R.todaysBirthdays.length>0&&i.jsxs("div",{className:"space-y-2",children:[i.jsxs("p",{className:"text-[10px] font-black text-orange-600 uppercase tracking-widest flex items-center gap-1.5 mb-3",children:[i.jsx(Bf,{size:14,className:"animate-bounce"}),"  hoje!"]}),R.todaysBirthdays.map(B=>i.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gradient-to-r from-pink-50 to-orange-50 rounded-xl border border-pink-100 relative group overflow-hidden",children:[i.jsx("img",{src:B.avatar,className:"w-10 h-10 rounded-full border-2 border-white shadow-sm object-cover"}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-sm font-bold text-slate-800 truncate",children:B.name}),i.jsx("p",{className:"text-[10px] text-slate-500 truncate uppercase",children:B.department})]}),i.jsx("div",{className:"text-xl",children:""})]},B.id))]}),i.jsxs("div",{className:"space-y-4",children:[R.isCurrentMonth&&R.pastBirthdays.length>0&&i.jsxs("div",{className:"space-y-2",children:[i.jsx("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-widest pt-2",children:"Aconteceu este ms"}),R.pastBirthdays.map(B=>i.jsxs("div",{className:"flex items-center gap-3 p-2 hover:bg-slate-50 transition-all rounded-xl",children:[i.jsx("img",{src:B.avatar,className:"w-8 h-8 rounded-full border border-slate-100 object-cover"}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-xs font-bold text-slate-700 truncate",children:B.name}),i.jsx("p",{className:"text-[9px] text-slate-400 truncate uppercase",children:B.department})]}),i.jsxs("div",{className:"text-[10px] font-black text-slate-400 bg-slate-50 px-2 py-0.5 rounded-lg border border-slate-200",children:["DIA ",B.birthday.split("-")[2]]})]},B.id))]}),(R.upcomingBirthdays.length>0||!R.isCurrentMonth&&R.upcomingBirthdays.length>0)&&i.jsxs("div",{className:"space-y-2",children:[i.jsx("p",{className:"text-[9px] font-bold text-emerald-600 uppercase tracking-widest pt-2",children:"Prximos do ms"}),R.upcomingBirthdays.map(B=>i.jsxs("div",{className:"flex items-center gap-3 p-2 hover:bg-slate-50 rounded-xl transition-colors",children:[i.jsx("img",{src:B.avatar,className:"w-8 h-8 rounded-full border border-slate-100 object-cover"}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-xs font-bold text-slate-700 truncate",children:B.name}),i.jsx("p",{className:"text-[9px] text-slate-400 truncate uppercase",children:B.department})]}),i.jsxs("div",{className:"text-[10px] font-black text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-lg border border-emerald-100",children:["DIA ",B.birthday.split("-")[2]]})]},B.id))]}),R.todaysBirthdays.length===0&&R.pastBirthdays.length===0&&R.upcomingBirthdays.length===0&&i.jsxs("div",{className:"text-center py-8 text-slate-300",children:[i.jsx(ly,{size:32,className:"mx-auto mb-2 opacity-20"}),i.jsx("p",{className:"text-xs font-bold uppercase tracking-widest",children:"Sem registros"})]})]})]})]})]})]})]})},DC=({size:t=18,className:e=""})=>i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[i.jsx("path",{d:"M3 21l1.65-3.8a9 9 0 1 1 3.4 2.9L3 21"}),i.jsx("path",{d:"M9 10a.5.5 0 0 0 1 0V9a.5.5 0 0 0-1 0v1a5 5 0 0 0 5 5h1a.5.5 0 0 0 0-1h-1a.5.5 0 0 0 0 1"})]}),MC=t=>{if(!t)return"";const e=["de","do","da","dos","das","e","em","com","para"],s=["i","ii","iii","iv","v","vi","vii","viii","ix","x"],n=["ti","rh","sesmt","dp","it","ceo","cfo","coo","cto","adm","qhse","comex"];return t.toLowerCase().split(" ").filter(r=>r.length>0).map((r,o)=>o>0&&e.includes(r)?r:s.includes(r)||n.includes(r)?r.toUpperCase():r.charAt(0).toUpperCase()+r.slice(1)).join(" ")},LC=({extension:t})=>{const[e,s]=I.useState(0),[n,r]=I.useState(!1),[o,a]=I.useState(!1),l=I.useRef(null),u=I.useRef(null),d=I.useRef(0),f=I.useRef(0),p=q=>{r(!0),d.current=q,a(!1)},g=q=>{if(!n||!l.current||!u.current||o)return;const E=l.current.offsetWidth,w=u.current.offsetWidth,b=E-w;let _=f.current+(q-d.current);_<0&&(_=0),_>b&&(_=b),s(_)},v=()=>{if(!n||!l.current||!u.current)return;const q=l.current.offsetWidth,E=u.current.offsetWidth,w=q-E,b=w*.9;e>=b?(a(!0),s(w),window.location.href=`tel:713879${t}`,setTimeout(()=>{a(!1),s(0),f.current=0},2e3)):(s(0),f.current=0),r(!1)},A=q=>{p(q.clientX),f.current=e},k=q=>{n&&g(q.clientX)},S=()=>{v()},L=()=>{n&&v()},D=q=>{p(q.touches[0].clientX),f.current=e},j=q=>{n&&g(q.touches[0].clientX)},F=()=>{v()};return i.jsxs("div",{ref:l,className:`relative h-12 rounded-full overflow-hidden select-none transition-colors duration-300 ${o?"bg-green-500":"bg-slate-100 border border-slate-200"}`,onMouseMove:k,onMouseUp:S,onMouseLeave:L,onTouchMove:j,onTouchEnd:F,children:[i.jsx("div",{className:`absolute inset-0 flex items-center justify-center text-sm font-medium transition-opacity duration-300 ${n?"opacity-50":"opacity-100"}`,children:o?i.jsxs("span",{className:"text-white font-bold flex items-center gap-2",children:[i.jsx(qf,{size:16})," Ligando..."]}):i.jsxs("span",{className:"text-slate-500 flex items-center gap-2 pl-4",children:["Ramal ",i.jsx("span",{className:"text-slate-800 font-bold",children:t})," ",i.jsx(kr,{size:14,className:"opacity-50"})]})}),i.jsx("div",{ref:u,style:{transform:`translateX(${e}px)`,touchAction:"none"},className:`absolute top-1 bottom-1 w-10 h-10 rounded-full flex items-center justify-center shadow-md cursor-grab active:cursor-grabbing z-10 transition-colors duration-200 ${o?"bg-white text-green-600":"bg-emerald-600 text-white left-1"}`,onMouseDown:A,onTouchStart:D,children:i.jsx(or,{size:18,className:o?"animate-pulse":""})})]})},VC=()=>{const{currentUser:t,globalSettings:e}=Ut(),s=gc(),n=ir(),[r,o]=I.useState([]),[a,l]=I.useState([]),[u,d]=I.useState([]),[f,p]=I.useState(!0),[g,v]=I.useState(""),[A,k]=I.useState("All"),[S,L]=I.useState("All"),[D,j]=I.useState(null),[F,q]=I.useState(!1),[E,w]=I.useState(""),[b,_]=I.useState([]),T=I.useRef(null);I.useEffect(()=>{(async()=>{p(!0);try{const[Z,B,$]=await Promise.all([Fn(),mr(),ln()]);o(Z),l(B),d($)}catch(Z){console.error("Erro ao carregar diretrio",Z)}finally{p(!1)}})()},[]),I.useEffect(()=>{if(r.length>0&&s.state&&s.state.openChatWith){const P=s.state.openChatWith,Z=r.find(B=>B.id===P);Z&&(C(Z),n(s.pathname,{replace:!0,state:{}}))}},[r,s.state,n,s.pathname]),I.useEffect(()=>{if(!D||!t)return;const P=()=>{GI(t.id,D.id)};P();const Z=Nt(Ee(he,"messages"),Lt("participants","array-contains",t.id),ur("timestamp","asc")),B=es(Z,$=>{const te=$.docs.map(re=>({id:re.id,...re.data()})).filter(re=>re.senderId===t.id&&re.receiverId===D.id||re.senderId===D.id&&re.receiverId===t.id);_(te),F||P()});return()=>B()},[D,t,F]),I.useEffect(()=>{var P;(P=T.current)==null||P.scrollIntoView({behavior:"smooth"})},[b,D,F]);const R=r.filter(P=>{const Z=P.name.toLowerCase().includes(g.toLowerCase())||P.extension&&P.extension.includes(g)||P.role.toLowerCase().includes(g.toLowerCase()),B=A==="All"||P.department===A,$=S==="All"||P.unit&&P.unit===S;return Z&&B&&$}),M=P=>P.replace(/\D/g,""),C=P=>{if(P.id===(t==null?void 0:t.id)){alert("Voc no pode conversar consigo mesmo.");return}j(P),q(!1)},ge=async P=>{if(P==null||P.preventDefault(),!E.trim()||!D||!t)return;const Z=E;w("");try{await qI(t.id,D.id,Z,t.name)}catch(B){console.error("Failed to send message",B),alert("Erro ao enviar mensagem.")}},_e=async P=>{if(confirm("Deseja apagar esta mensagem para todos?"))try{await $I(P)}catch{alert("Erro ao apagar mensagem.")}};return f?i.jsxs("div",{className:"flex justify-center p-12 text-slate-500",children:[i.jsx(Ne,{className:"animate-spin mr-2"})," Carregando ramais..."]}):i.jsxs("div",{className:"space-y-6 relative min-h-[calc(100vh-140px)]",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Diretrio de Pessoas"}),i.jsx("p",{className:"text-slate-500 text-sm",children:"Encontre contatos e ramais de todos os colaboradores"})]}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[i.jsxs("div",{className:"relative flex-1 sm:flex-none",children:[i.jsx(Zs,{className:"absolute left-3 top-3 text-slate-400 w-4 h-4"}),i.jsx("input",{type:"text",placeholder:"Buscar por nome ou ramal...",value:g,onChange:P=>v(P.target.value),className:"pl-10 pr-4 py-2.5 bg-white border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 w-full sm:w-64 text-slate-900"})]}),i.jsxs("select",{value:A,onChange:P=>k(P.target.value),className:"px-4 py-2.5 bg-white border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 text-slate-900",children:[i.jsx("option",{value:"All",children:"Todos Departamentos"}),a.map(P=>i.jsx("option",{value:P.name,children:P.name},P.id))]}),i.jsxs("select",{value:S,onChange:P=>L(P.target.value),className:"px-4 py-2.5 bg-white border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 text-slate-900",children:[i.jsx("option",{value:"All",children:"Todas Unidades"}),u.map(P=>i.jsx("option",{value:P.name,children:P.name},P.id))]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[R.map(P=>i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-100 p-6 flex flex-col items-center text-center transition-all hover:shadow-lg hover:-translate-y-1 group relative",children:[i.jsxs("div",{className:"w-24 h-24 mb-4 relative",children:[i.jsx("img",{src:P.avatar,alt:P.name,className:"w-full h-full rounded-full object-cover border-4 border-slate-50 group-hover:border-emerald-50 transition-colors"}),i.jsx("div",{className:"absolute bottom-1 right-1 w-5 h-5 bg-emerald-500 rounded-full border-2 border-white",title:"Online"})]}),i.jsx("h3",{className:"font-bold text-lg text-slate-900",children:P.name}),(e==null?void 0:e.showRoleInternal)&&P.showRole!==!1&&i.jsx("p",{className:"text-emerald-600 text-sm font-medium mb-1",children:MC(P.role)}),i.jsxs("div",{className:"flex flex-col items-center gap-1 mb-4",children:[i.jsxs("p",{className:"text-slate-400 text-xs flex items-center gap-1 bg-slate-50 px-2 py-0.5 rounded",children:[i.jsx(zr,{size:12})," ",P.department]}),P.unit&&i.jsxs("p",{className:"text-slate-400 text-[10px] flex items-center gap-1",children:[i.jsx($t,{size:10})," ",P.unit]})]}),i.jsxs("div",{className:"w-full space-y-3 mt-auto",children:[P.extension?i.jsx(LC,{extension:P.extension}):i.jsx("div",{className:"h-12 flex items-center justify-center bg-slate-50 rounded-lg border border-dashed border-slate-200 text-slate-400 text-xs uppercase font-medium",children:"Sem Ramal"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("button",{onClick:()=>C(P),className:"flex-1 flex items-center justify-center gap-2 py-2 bg-emerald-600 text-white rounded-lg text-sm hover:bg-emerald-700 transition-colors shadow-sm shadow-emerald-200",children:[i.jsx(Oo,{size:16})," Chat"]}),P.whatsapp&&i.jsx("a",{href:`https://wa.me/${M(P.whatsapp)}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center p-2 border border-green-200 bg-green-50 rounded-lg text-green-600 hover:bg-green-100 transition-colors",title:"WhatsApp",children:i.jsx(DC,{size:18})}),i.jsx("a",{href:`mailto:${P.email}`,className:"flex items-center justify-center p-2 border border-slate-200 rounded-lg text-slate-400 hover:bg-slate-50 hover:text-emerald-600 transition-colors",title:"Enviar E-mail",children:i.jsx(Dr,{size:18})})]})]})]},P.id)),R.length===0&&i.jsx("div",{className:"col-span-full py-12 text-center text-slate-500",children:"Nenhum colaborador encontrado com os filtros atuais."})]}),D&&i.jsxs("div",{className:`fixed bottom-0 right-4 w-96 bg-white rounded-t-xl shadow-2xl border border-slate-200 z-50 flex flex-col transition-all duration-300 ${F?"h-14":"h-[500px]"}`,children:[i.jsxs("div",{className:"bg-emerald-700 text-white p-3 rounded-t-xl flex items-center justify-between cursor-pointer",onClick:()=>q(!F),children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsxs("div",{className:"relative",children:[i.jsx("img",{src:D.avatar,alt:"",className:"w-9 h-9 rounded-full border border-white/30"}),i.jsx("div",{className:"absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-400 rounded-full border border-emerald-900"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-bold leading-tight",children:D.name}),i.jsx("p",{className:"text-[10px] text-emerald-100 leading-tight opacity-80",children:D.role})]})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("button",{className:"p-1 hover:bg-emerald-600 rounded",children:i.jsx(cy,{size:16})}),i.jsx("button",{onClick:P=>{P.stopPropagation(),j(null)},className:"p-1 hover:bg-emerald-600 rounded",children:i.jsx(St,{size:16})})]})]}),!F&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex-1 bg-[#e5ddd5] p-4 overflow-y-auto custom-scrollbar flex flex-col gap-2 relative",children:[i.jsx("div",{className:"absolute inset-0 opacity-10 bg-[url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png')] pointer-events-none"}),i.jsxs("div",{className:"text-center text-[10px] bg-white/50 self-center rounded-full px-3 py-1 text-slate-500 my-2 shadow-sm z-10 backdrop-blur-sm",children:["Incio da conversa com ",D.name]}),b.length===0&&i.jsx("p",{className:"text-center text-xs text-slate-400 italic mt-4 z-10",children:"Nenhuma mensagem ainda."}),b.map(P=>{const Z=P.senderId===(t==null?void 0:t.id);return i.jsxs("div",{className:`relative max-w-[80%] p-2 px-3 rounded-lg text-sm shadow-sm group z-10 ${Z?"bg-[#dcf8c6] self-end rounded-tr-none":"bg-white self-start rounded-tl-none"}`,children:[Z&&!P.deleted&&i.jsx("button",{onClick:()=>_e(P.id),className:"absolute -top-2 -left-2 bg-white text-red-500 rounded-full p-1 shadow-md opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-50",title:"Apagar mensagem",children:i.jsx(st,{size:12})}),P.deleted?i.jsx("div",{className:"flex items-center gap-1 text-slate-400 italic text-xs py-1",children:i.jsx("span",{className:"block",children:" Mensagem apagada"})}):i.jsxs(i.Fragment,{children:[i.jsx("p",{className:"text-slate-800 leading-snug whitespace-pre-wrap",children:P.text}),i.jsxs("div",{className:"flex items-center justify-end gap-1 mt-1 select-none",children:[i.jsx("span",{className:"text-[9px] text-slate-500",children:new Date(P.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),Z&&i.jsx("span",{title:P.read?"Lida":"Enviada",children:P.read?i.jsx(dy,{size:14,className:"text-blue-500"}):i.jsx(uy,{size:14,className:"text-slate-400"})})]})]})]},P.id)}),i.jsx("div",{ref:T})]}),i.jsxs("form",{onSubmit:ge,className:"p-3 bg-[#f0f0f0] border-t border-slate-200 flex gap-2 z-20",children:[i.jsx("input",{type:"text",value:E,onChange:P=>w(P.target.value),placeholder:"Digite uma mensagem...",className:"flex-1 bg-white border border-slate-300 rounded-full px-4 py-2 text-sm focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 text-slate-900"}),i.jsx("button",{type:"submit",disabled:!E.trim(),className:"p-2.5 bg-emerald-600 text-white rounded-full hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm",children:i.jsx(va,{size:18})})]})]})]})]})},UC=()=>{const{currentUser:t,isMaster:e}=Ut(),s=ir(),[n,r]=I.useState([]),[o,a]=I.useState([]),[l,u]=I.useState(!0),[d,f]=I.useState("ALL"),[p,g]=I.useState(!1),[v,A]=I.useState("create"),[k,S]=I.useState(!1),[L,D]=I.useState(null),[j,F]=I.useState({title:"",description:"",assigneeId:"",dueDate:"",status:Ye.TODO});I.useEffect(()=>{t&&q()},[t]);const q=async()=>{if(t){u(!0);try{const[U,te]=await Promise.all([Ux(),Fn()]);r(U),a(te)}catch(U){console.error("Erro ao carregar dados",U)}finally{u(!1)}}},E=U=>o.find(te=>te.id===U),w=U=>o.find(te=>te.id===U),b=U=>o.find(te=>te.id===U),_=U=>{var te,re;return!!(U.signatureRequestId||(te=U.title)!=null&&te.startsWith("Assinatura:")||U.creatorDepartment==="TI"&&((re=U.title)!=null&&re.includes("Assinatura")))},T=()=>{A("create"),F({title:"",description:"",assigneeId:"",dueDate:"",status:Ye.TODO}),g(!0)},R=U=>{A("view"),F({...U}),g(!0)},M=()=>{A("edit")},C=async(U,te,re)=>{re&&re.stopPropagation();const ie=n.find(ve=>ve.id===U);if(ie&&_(ie)&&te===Ye.DONE){alert("Tarefas de assinatura devem ser processadas e finalizadas atravs do menu de Assinaturas no Painel Admin para garantir a gerao da imagem.");return}const K={status:te};te===Ye.DONE?(K.completedAt=new Date().toISOString(),K.completedBy=t==null?void 0:t.id):(K.completedAt=null,K.completedBy=null),r(ve=>ve.map(z=>z.id===U?{...z,...K}:z)),p&&j.id===U&&F(ve=>({...ve,...K}));try{await nm(U,K)}catch(ve){console.error("Erro ao atualizar status",ve),q()}},ge=async()=>{if(!j.title||!j.dueDate){alert("Por favor, preencha o ttulo e a data.");return}if(t){S(!0);try{v==="create"?await fC({title:j.title,description:j.description||"",assigneeId:j.assigneeId||"",dueDate:j.dueDate,status:Ye.TODO,creatorId:t.id,creatorDepartment:t.department}):v==="edit"&&j.id&&await nm(j.id,{title:j.title,description:j.description,assigneeId:j.assigneeId,dueDate:j.dueDate}),await q(),g(!1)}catch{alert("Erro ao salvar tarefa. Verifique sua conexo.")}finally{S(!1)}}},_e=()=>{if(!j.id)return;const U=j.creatorId===(t==null?void 0:t.id);e||U?D(j):alert("Voc no tem permisso para excluir esta tarefa.")},P=async()=>{if(L!=null&&L.id){S(!0);try{await pC(L.id),r(U=>U.filter(te=>te.id!==L.id)),D(null),g(!1)}catch{alert("Erro ao excluir tarefa")}finally{S(!1)}}},Z={[Ye.TODO]:"bg-slate-100 text-slate-600 border-slate-200",[Ye.IN_PROGRESS]:"bg-amber-100 text-amber-700 border-amber-200",[Ye.DONE]:"bg-emerald-100 text-emerald-700 border-emerald-200"},$=n.filter(U=>{if(!t)return!1;const te=U.creatorId===t.id,re=U.assigneeId===t.id,ie=U.creatorDepartment===t.department;return te||re||ie||e}).filter(U=>d==="ALL"||U.status===d);return l?i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsx(Ne,{className:"animate-spin text-emerald-600",size:48})}):i.jsxs("div",{className:"space-y-6 relative",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Gesto de Tarefas"}),i.jsx("p",{className:"text-slate-500 text-sm",children:"Organize demandas pessoais e do seu departamento."})]}),i.jsxs("button",{onClick:T,className:"bg-emerald-600 text-white px-4 py-3 md:py-2 rounded-lg flex items-center justify-center gap-2 hover:bg-emerald-700 transition-colors shadow-lg shadow-emerald-200 w-full md:w-auto font-medium",children:[i.jsx(Pt,{size:18})," ",i.jsx("span",{className:"md:inline",children:"Nova Tarefa"})]})]}),i.jsx("div",{className:"flex gap-2 border-b border-slate-200 pb-1 overflow-x-auto custom-scrollbar -mx-4 px-4 md:mx-0 md:px-0",children:["ALL",Ye.TODO,Ye.IN_PROGRESS,Ye.DONE].map(U=>i.jsx("button",{onClick:()=>f(U),className:`whitespace-nowrap px-4 py-2 text-sm font-medium rounded-t-lg transition-colors flex-shrink-0 ${d===U?"text-emerald-600 border-b-2 border-emerald-600 bg-emerald-50/50":"text-slate-500 hover:text-slate-800"}`,children:U==="ALL"?"Todas":U==="TODO"?"A Fazer":U==="IN_PROGRESS"?"Em Andamento":"Concludo"},U))}),i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full text-left border-collapse hidden md:table min-w-[800px]",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"bg-slate-50 border-b border-slate-200 text-xs uppercase text-slate-500 font-semibold tracking-wider",children:[i.jsx("th",{className:"px-6 py-4",children:"Tarefa"}),i.jsx("th",{className:"px-6 py-4",children:"Origem"}),i.jsx("th",{className:"px-6 py-4",children:"Responsvel"}),i.jsx("th",{className:"px-6 py-4",children:"Prazo"}),i.jsx("th",{className:"px-6 py-4 text-right",children:"Status / Ao"})]})}),i.jsx("tbody",{className:"divide-y divide-slate-100",children:$.map(U=>{const te=E(U.assigneeId),re=U.creatorId===(t==null?void 0:t.id),ie=w(U.creatorId),K=_(U),ve=b(U.completedBy),z=U.status===Ye.DONE&&!re&&!e||K;return i.jsxs("tr",{onClick:()=>R(U),className:"hover:bg-slate-50 transition-colors cursor-pointer group",children:[i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("p",{className:"font-semibold text-slate-800 group-hover:text-emerald-600 transition-colors",children:U.title}),i.jsx("p",{className:"text-xs text-slate-500 truncate max-w-xs",children:U.description})]}),i.jsx("td",{className:"px-6 py-4",children:re?i.jsxs("span",{className:"text-[10px] font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded border border-emerald-100 flex items-center gap-1 w-fit",children:[i.jsx(gu,{size:10})," Eu"]}):ie?i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("img",{src:ie.avatar,alt:"",className:"w-6 h-6 rounded-full object-cover border border-slate-100"}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-xs font-bold text-slate-700 leading-none",children:ie.name.split(" ")[0]}),i.jsx("span",{className:"text-[9px] text-slate-400 leading-none mt-0.5",children:ie.department})]})]}):i.jsx("span",{className:"text-xs text-slate-400 italic",children:"Desconhecido"})}),i.jsx("td",{className:"px-6 py-4",children:te?i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("img",{src:te.avatar,alt:te.name,className:"w-6 h-6 rounded-full object-cover"}),i.jsx("p",{className:"text-sm text-slate-700 leading-none",children:te.name.split(" ")[0]})]}):i.jsx("span",{className:"text-sm text-slate-400 italic",children:"No atribudo"})}),i.jsx("td",{className:"px-6 py-4",children:i.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-slate-600",children:[i.jsx(Gt,{size:14}),U.dueDate?new Date(U.dueDate).toLocaleDateString("pt-BR"):"-"]})}),i.jsx("td",{className:"px-6 py-4 text-right",children:i.jsxs("div",{className:"flex flex-col items-end gap-1",children:[K&&U.status!==Ye.DONE?i.jsxs("button",{onClick:se=>{se.stopPropagation(),s("/admin-signatures")},className:"bg-emerald-600 text-white px-3 py-1.5 rounded-full text-xs font-bold flex items-center gap-1.5 hover:bg-emerald-700 transition-colors shadow-sm",children:[i.jsx(ys,{size:12})," Processar Agora"]}):i.jsxs("div",{className:"relative inline-block",children:[i.jsxs("select",{value:U.status,disabled:z,onClick:se=>se.stopPropagation(),onChange:se=>C(U.id,se.target.value,se),className:`text-xs font-bold px-3 py-1 rounded-full border appearance-none focus:outline-none focus:ring-2 focus:ring-offset-1 ${Z[U.status]} ${z?"opacity-60 cursor-not-allowed pr-6":"cursor-pointer"}`,children:[i.jsx("option",{value:Ye.TODO,children:"A Fazer"}),i.jsx("option",{value:Ye.IN_PROGRESS,children:"Em Andamento"}),i.jsx("option",{value:Ye.DONE,children:"Concludo"})]}),z&&i.jsx(jt,{size:10,className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-500 pointer-events-none"})]}),U.status===Ye.DONE&&i.jsxs("span",{className:"text-[10px] text-emerald-600 flex items-center gap-1",children:[i.jsx(ss,{size:10})," ",ve?`Por: ${ve.name.split(" ")[0]}`:"Concludo"]})]})})]},U.id)})})]})}),i.jsx("div",{className:"md:hidden divide-y divide-slate-100",children:$.map(U=>{const te=E(U.assigneeId),re=U.creatorId===(t==null?void 0:t.id),ie=w(U.creatorId),K=b(U.completedBy),ve=_(U),z=U.status===Ye.DONE&&!re&&!e||ve;return i.jsxs("div",{onClick:()=>R(U),className:"p-5 flex flex-col gap-4 cursor-pointer active:bg-slate-50",children:[i.jsxs("div",{children:[i.jsx("div",{className:"flex justify-between items-start mb-1 relative",children:i.jsxs("div",{className:"w-full",children:[i.jsx("div",{className:"flex items-center justify-between mb-2",children:re?i.jsxs("span",{className:"text-[10px] font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded border border-emerald-100 flex items-center gap-1 w-fit",children:[i.jsx(gu,{size:10})," Minha Tarefa"]}):ie?i.jsxs("div",{className:"flex items-center gap-1.5 bg-slate-50 rounded-full pr-2 py-0.5 pl-0.5 border border-slate-100",children:[i.jsx("img",{src:ie.avatar,className:"w-5 h-5 rounded-full object-cover"}),i.jsxs("span",{className:"text-[10px] font-bold text-slate-600",children:["De: ",ie.name.split(" ")[0]]})]}):null}),i.jsx("h3",{className:"font-bold text-slate-800 text-lg",children:U.title})]})}),i.jsx("p",{className:"text-sm text-slate-500 leading-relaxed line-clamp-2",children:U.description})]}),i.jsxs("div",{className:"flex flex-col gap-3 mt-2",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("div",{className:"flex items-center gap-2",children:te?i.jsxs(i.Fragment,{children:[i.jsx("img",{src:te.avatar,alt:"",className:"w-6 h-6 rounded-full object-cover border border-white shadow-sm"}),i.jsx("span",{className:"text-xs text-slate-600",children:te.name.split(" ")[0]})]}):i.jsx("span",{className:"text-slate-400 italic text-xs",children:"Sem responsvel"})}),ve&&U.status!==Ye.DONE?i.jsxs("button",{onClick:se=>{se.stopPropagation(),s("/admin-signatures")},className:"bg-emerald-600 text-white px-4 py-1.5 rounded-full text-xs font-bold flex items-center gap-1.5 shadow-md",children:[i.jsx(ys,{size:12})," Processar Agora"]}):i.jsxs("div",{className:`text-xs font-bold px-3 py-1 rounded-full border flex items-center gap-1 ${Z[U.status]} ${z?"opacity-70":""}`,children:[U.status==="TODO"?"A Fazer":U.status==="IN_PROGRESS"?"Em Andamento":"Concludo",z&&i.jsx(jt,{size:10})]})]}),U.status===Ye.DONE&&i.jsxs("div",{className:"text-[10px] text-emerald-600 bg-emerald-50 px-2 py-1 rounded self-end flex items-center gap-1 border border-emerald-100",children:[i.jsx(ss,{size:10})," ",K?`Concludo por: ${K.name.split(" ")[0]}`:"Concludo"]})]})]},U.id)})}),$.length===0&&i.jsxs("div",{className:"p-12 text-center text-slate-500 bg-slate-50/50",children:[i.jsx(Qn,{size:48,className:"mx-auto mb-4 text-slate-300"}),i.jsx("p",{children:"Nenhuma tarefa encontrada."})]})]}),p&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-[60] flex items-center justify-center p-4 animate-fade-in",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh]",children:[i.jsxs("div",{className:"p-6 border-b border-slate-100 flex items-center justify-between bg-slate-50 shrink-0",children:[i.jsxs("h3",{className:"text-xl font-bold text-slate-800 flex items-center gap-2",children:[v==="create"&&i.jsxs(i.Fragment,{children:[i.jsx(Pt,{className:"text-emerald-600"})," Nova Tarefa"]}),v==="view"&&i.jsxs(i.Fragment,{children:[i.jsx(Qn,{className:"text-emerald-600"})," Detalhes da Tarefa"]}),v==="edit"&&i.jsxs(i.Fragment,{children:[i.jsx(xu,{className:"text-emerald-600"})," Editar Tarefa"]})]}),i.jsx("button",{onClick:()=>g(!1),className:"text-slate-400 hover:text-slate-600 p-1 hover:bg-slate-200 rounded-full transition-colors",children:i.jsx(St,{size:24})})]}),i.jsxs("div",{className:"p-6 space-y-5 overflow-y-auto custom-scrollbar flex-1",children:[v==="view"&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsx("h2",{className:"text-2xl font-bold text-slate-900 leading-tight",children:j.title}),i.jsx("div",{className:"shrink-0 ml-4 relative",children:(()=>{const U=_(j),te=j.status===Ye.DONE&&j.creatorId!==(t==null?void 0:t.id)&&!e||U;return U&&j.status!==Ye.DONE?i.jsxs("button",{onClick:()=>s("/admin-signatures"),className:"bg-emerald-600 text-white px-4 py-2 rounded-lg text-xs font-bold flex items-center gap-2 hover:bg-emerald-700 transition-all shadow-md active:scale-95",children:[i.jsx(ys,{size:14})," Processar Agora"]}):i.jsxs(i.Fragment,{children:[i.jsxs("select",{value:j.status,disabled:te,onChange:re=>C(j.id,re.target.value),className:`text-xs font-bold px-3 py-1.5 rounded-full border appearance-none focus:outline-none focus:ring-2 focus:ring-offset-1 ${Z[j.status||Ye.TODO]} ${te?"opacity-60 cursor-not-allowed pr-6":"cursor-pointer"}`,children:[i.jsx("option",{value:Ye.TODO,children:"A Fazer"}),i.jsx("option",{value:Ye.IN_PROGRESS,children:"Em Andamento"}),i.jsx("option",{value:Ye.DONE,children:"Concludo"})]}),te&&i.jsx(jt,{size:12,className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-500 pointer-events-none"})]})})()})]}),i.jsx("div",{className:"mt-2 flex items-center gap-2 text-sm text-slate-500",children:i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(Gt,{size:14})," Prazo: ",j.dueDate?new Date(j.dueDate).toLocaleDateString("pt-BR"):"Sem prazo"]})})]}),j.status===Ye.DONE&&j.completedAt&&i.jsxs("div",{className:"bg-emerald-50 border border-emerald-100 rounded-xl p-3 flex items-center gap-3",children:[i.jsx("div",{className:"bg-emerald-100 p-2 rounded-full text-emerald-600",children:i.jsx(ss,{size:20})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-xs font-bold text-emerald-800 uppercase",children:"Tarefa Concluda"}),i.jsxs("p",{className:"text-xs text-emerald-700",children:["Em: ",i.jsx("strong",{children:new Date(j.completedAt).toLocaleString("pt-BR")})]}),j.completedBy&&(()=>{const U=b(j.completedBy);return U?i.jsxs("p",{className:"text-xs text-emerald-700 mt-0.5 flex items-center gap-1",children:["Por: ",i.jsx("img",{src:U.avatar,className:"w-4 h-4 rounded-full inline-block"})," ",i.jsx("strong",{children:U.name})]}):null})()]})]}),i.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-100",children:[i.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2",children:"Descrio"}),i.jsx("p",{className:"text-slate-700 whitespace-pre-wrap leading-relaxed text-sm",children:j.description||i.jsx("span",{className:"italic text-slate-400",children:"Sem descrio."})})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"border border-slate-100 rounded-xl p-3",children:[i.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider block mb-2",children:"Responsvel"}),(()=>{const U=E(j.assigneeId||"");return U?i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("img",{src:U.avatar,className:"w-8 h-8 rounded-full object-cover"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-bold text-slate-700 leading-none",children:U.name}),i.jsx("p",{className:"text-[10px] text-slate-500",children:U.department})]})]}):i.jsx("span",{className:"text-sm text-slate-400 italic",children:"No atribudo"})})()]}),i.jsxs("div",{className:"border border-slate-100 rounded-xl p-3",children:[i.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider block mb-2",children:"Criado por"}),(()=>{const U=w(j.creatorId);return U?i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("img",{src:U.avatar,className:"w-8 h-8 rounded-full object-cover"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-bold text-slate-700 leading-none",children:U.name}),i.jsx("p",{className:"text-[10px] text-slate-500",children:U.department})]})]}):i.jsx("span",{className:"text-sm text-slate-400 italic",children:"Sistema"})})()]})]})]}),(v==="create"||v==="edit")&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Ttulo da Tarefa"}),i.jsx("input",{type:"text",value:j.title,onChange:U=>F({...j,title:U.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900",placeholder:"Ex: Atualizar Relatrio...",autoFocus:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Descrio"}),i.jsxs("div",{className:"relative",children:[i.jsx("textarea",{value:j.description,onChange:U=>F({...j,description:U.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 min-h-[120px] bg-white text-slate-900",placeholder:"Detalhes da tarefa..."}),i.jsx(Gf,{className:"absolute top-3 right-3 text-slate-300 w-4 h-4 pointer-events-none"})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex justify-between items-center mb-1",children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Responsvel"}),i.jsx("button",{type:"button",onClick:()=>F({...j,assigneeId:t==null?void 0:t.id}),className:"text-xs text-emerald-600 font-medium hover:underline focus:outline-none",children:"Atribuir a mim"})]}),i.jsxs("div",{className:"relative",children:[i.jsxs("select",{value:j.assigneeId,onChange:U=>F({...j,assigneeId:U.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 appearance-none bg-white text-slate-900",children:[i.jsx("option",{value:"",children:"Selecione..."}),o.map(U=>i.jsxs("option",{value:U.id,children:[U.name," (",U.department,")"]},U.id))]}),i.jsx(Ps,{className:"absolute top-1/2 -translate-y-1/2 right-3 text-slate-400 w-4 h-4 pointer-events-none"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Prazo"}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"date",value:j.dueDate,onChange:U=>F({...j,dueDate:U.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900"}),i.jsx(Gt,{className:"absolute top-1/2 -translate-y-1/2 right-3 text-slate-400 w-4 h-4 pointer-events-none"})]})]})]})]})]}),i.jsxs("div",{className:"p-6 bg-slate-50 border-t border-slate-100 flex justify-end gap-3 shrink-0",children:[v==="view"&&i.jsxs(i.Fragment,{children:[(j.creatorId===(t==null?void 0:t.id)||e)&&i.jsxs("button",{type:"button",onClick:_e,disabled:k,className:"px-4 py-2 rounded-lg font-medium text-sm flex items-center gap-2 mr-auto transition-colors text-red-600 hover:bg-red-50",title:"Excluir tarefa permanentemente",children:[i.jsx(st,{size:16})," Excluir"]}),j.creatorId===(t==null?void 0:t.id)&&!_(j)&&i.jsxs("button",{onClick:M,className:"px-4 py-2 bg-white border border-slate-200 text-slate-700 hover:bg-slate-50 rounded-lg font-medium text-sm flex items-center gap-2 shadow-sm",children:[i.jsx(xu,{size:16})," Editar"]}),i.jsx("button",{onClick:()=>g(!1),className:"px-6 py-2 bg-emerald-600 text-white rounded-lg font-medium hover:bg-emerald-700 transition-colors text-sm shadow-md shadow-emerald-200",children:"Fechar"})]}),(v==="create"||v==="edit")&&i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:()=>{v==="edit"?A("view"):g(!1)},className:"px-4 py-2 text-slate-600 hover:bg-slate-200 rounded-lg font-medium text-sm",disabled:k,children:"Cancelar"}),i.jsxs("button",{onClick:ge,className:"px-6 py-2 bg-emerald-600 text-white rounded-lg font-medium hover:bg-emerald-700 flex items-center gap-2 disabled:opacity-50 text-sm shadow-md shadow-emerald-200",disabled:k,children:[k?i.jsx(Ne,{className:"animate-spin",size:16}):i.jsx(hs,{size:16}),v==="create"?"Criar Tarefa":"Salvar Alteraes"]})]})]})]})}),L&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-[80] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:i.jsx("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-sm overflow-hidden border-2 border-red-100",children:i.jsxs("div",{className:"p-6 text-center",children:[i.jsx("div",{className:"w-14 h-14 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4 text-red-500",children:i.jsx(ms,{size:28})}),i.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:"Excluir Tarefa?"}),i.jsxs("p",{className:"text-sm text-slate-500 mb-6",children:["Tem certeza que deseja excluir ",i.jsxs("strong",{children:['"',L.title,'"']}),"?",i.jsx("br",{}),"Esta ao no pode ser desfeita."]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{type:"button",onClick:()=>D(null),className:"flex-1 py-2.5 text-slate-600 hover:bg-slate-100 rounded-xl font-bold text-sm transition-colors",disabled:k,children:"Cancelar"}),i.jsx("button",{type:"button",onClick:P,className:"flex-1 py-2.5 bg-red-600 text-white rounded-xl font-bold text-sm hover:bg-red-700 transition-colors flex items-center justify-center gap-2",disabled:k,children:k?i.jsx(Ne,{size:16,className:"animate-spin"}):"Sim, excluir"})]})]})})})]})};var FC={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let OC,zC;function BC(){return{geminiUrl:OC,vertexUrl:zC}}function qC(t,e,s,n){var r,o;if(!(t!=null&&t.baseUrl)){const a=BC();return e?(r=a.vertexUrl)!==null&&r!==void 0?r:s:(o=a.geminiUrl)!==null&&o!==void 0?o:n}return t.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class cn{}function me(t,e){const s=/\{([^}]+)\}/g;return t.replace(s,(n,r)=>{if(Object.prototype.hasOwnProperty.call(e,r)){const o=e[r];return o!=null?String(o):""}else throw new Error(`Key '${r}' not found in valueMap.`)})}function h(t,e,s){for(let o=0;o<e.length-1;o++){const a=e[o];if(a.endsWith("[]")){const l=a.slice(0,-2);if(!(l in t))if(Array.isArray(s))t[l]=Array.from({length:s.length},()=>({}));else throw new Error(`Value must be a list given an array path ${a}`);if(Array.isArray(t[l])){const u=t[l];if(Array.isArray(s))for(let d=0;d<u.length;d++){const f=u[d];h(f,e.slice(o+1),s[d])}else for(const d of u)h(d,e.slice(o+1),s)}return}else if(a.endsWith("[0]")){const l=a.slice(0,-3);l in t||(t[l]=[{}]);const u=t[l];h(u[0],e.slice(o+1),s);return}(!t[a]||typeof t[a]!="object")&&(t[a]={}),t=t[a]}const n=e[e.length-1],r=t[n];if(r!==void 0){if(!s||typeof s=="object"&&Object.keys(s).length===0||s===r)return;if(typeof r=="object"&&typeof s=="object"&&r!==null&&s!==null)Object.assign(r,s);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else n==="_self"&&typeof s=="object"&&s!==null&&!Array.isArray(s)?Object.assign(t,s):t[n]=s}function c(t,e,s=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let n=0;n<e.length;n++){if(typeof t!="object"||t===null)return s;const r=e[n];if(r.endsWith("[]")){const o=r.slice(0,-2);if(o in t){const a=t[o];return Array.isArray(a)?a.map(l=>c(l,e.slice(n+1),s)):s}else return s}else t=t[r]}return t}catch(n){if(n instanceof TypeError)return s;throw n}}function GC(t,e){for(const[s,n]of Object.entries(e)){const r=s.split("."),o=n.split("."),a=new Set;let l=-1;for(let u=0;u<r.length;u++)if(r[u]==="*"){l=u;break}if(l!==-1&&o.length>l)for(let u=l;u<o.length;u++){const d=o[u];d!=="*"&&!d.endsWith("[]")&&!d.endsWith("[0]")&&a.add(d)}sc(t,r,o,0,a)}}function sc(t,e,s,n,r){if(n>=e.length||typeof t!="object"||t===null)return;const o=e[n];if(o.endsWith("[]")){const a=o.slice(0,-2),l=t;if(a in l&&Array.isArray(l[a]))for(const u of l[a])sc(u,e,s,n+1,r)}else if(o==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){const a=t,l=Object.keys(a).filter(d=>!d.startsWith("_")&&!r.has(d)),u={};for(const d of l)u[d]=a[d];for(const[d,f]of Object.entries(u)){const p=[];for(const g of s.slice(n))g==="*"?p.push(d):p.push(g);h(a,p,f)}for(const d of l)delete a[d]}}else{const a=t;o in a&&sc(a[o],e,s,n+1,r)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function _d(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function $C(t){const e={},s=c(t,["operationName"]);s!=null&&h(e,["operationName"],s);const n=c(t,["resourceName"]);return n!=null&&h(e,["_url","resourceName"],n),e}function HC(t){const e={},s=c(t,["name"]);s!=null&&h(e,["name"],s);const n=c(t,["metadata"]);n!=null&&h(e,["metadata"],n);const r=c(t,["done"]);r!=null&&h(e,["done"],r);const o=c(t,["error"]);o!=null&&h(e,["error"],o);const a=c(t,["response","generateVideoResponse"]);return a!=null&&h(e,["response"],JC(a)),e}function WC(t){const e={},s=c(t,["name"]);s!=null&&h(e,["name"],s);const n=c(t,["metadata"]);n!=null&&h(e,["metadata"],n);const r=c(t,["done"]);r!=null&&h(e,["done"],r);const o=c(t,["error"]);o!=null&&h(e,["error"],o);const a=c(t,["response"]);return a!=null&&h(e,["response"],KC(a)),e}function JC(t){const e={},s=c(t,["generatedSamples"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(a=>YC(a))),h(e,["generatedVideos"],o)}const n=c(t,["raiMediaFilteredCount"]);n!=null&&h(e,["raiMediaFilteredCount"],n);const r=c(t,["raiMediaFilteredReasons"]);return r!=null&&h(e,["raiMediaFilteredReasons"],r),e}function KC(t){const e={},s=c(t,["videos"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(a=>XC(a))),h(e,["generatedVideos"],o)}const n=c(t,["raiMediaFilteredCount"]);n!=null&&h(e,["raiMediaFilteredCount"],n);const r=c(t,["raiMediaFilteredReasons"]);return r!=null&&h(e,["raiMediaFilteredReasons"],r),e}function YC(t){const e={},s=c(t,["video"]);return s!=null&&h(e,["video"],nS(s)),e}function XC(t){const e={},s=c(t,["_self"]);return s!=null&&h(e,["video"],rS(s)),e}function QC(t){const e={},s=c(t,["operationName"]);return s!=null&&h(e,["_url","operationName"],s),e}function ZC(t){const e={},s=c(t,["operationName"]);return s!=null&&h(e,["_url","operationName"],s),e}function eS(t){const e={},s=c(t,["name"]);s!=null&&h(e,["name"],s);const n=c(t,["metadata"]);n!=null&&h(e,["metadata"],n);const r=c(t,["done"]);r!=null&&h(e,["done"],r);const o=c(t,["error"]);o!=null&&h(e,["error"],o);const a=c(t,["response"]);return a!=null&&h(e,["response"],tS(a)),e}function tS(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["parent"]);n!=null&&h(e,["parent"],n);const r=c(t,["documentName"]);return r!=null&&h(e,["documentName"],r),e}function Ox(t){const e={},s=c(t,["name"]);s!=null&&h(e,["name"],s);const n=c(t,["metadata"]);n!=null&&h(e,["metadata"],n);const r=c(t,["done"]);r!=null&&h(e,["done"],r);const o=c(t,["error"]);o!=null&&h(e,["error"],o);const a=c(t,["response"]);return a!=null&&h(e,["response"],sS(a)),e}function sS(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["parent"]);n!=null&&h(e,["parent"],n);const r=c(t,["documentName"]);return r!=null&&h(e,["documentName"],r),e}function nS(t){const e={},s=c(t,["uri"]);s!=null&&h(e,["uri"],s);const n=c(t,["encodedVideo"]);n!=null&&h(e,["videoBytes"],_d(n));const r=c(t,["encoding"]);return r!=null&&h(e,["mimeType"],r),e}function rS(t){const e={},s=c(t,["gcsUri"]);s!=null&&h(e,["uri"],s);const n=c(t,["bytesBase64Encoded"]);n!=null&&h(e,["videoBytes"],_d(n));const r=c(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var rm;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(rm||(rm={}));var im;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(im||(im={}));var om;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(om||(om={}));var Nn;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(Nn||(Nn={}));var am;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(am||(am={}));var lm;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(lm||(lm={}));var cm;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(cm||(cm={}));var dm;(function(t){t.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",t.HTTP_IN_QUERY="HTTP_IN_QUERY",t.HTTP_IN_HEADER="HTTP_IN_HEADER",t.HTTP_IN_PATH="HTTP_IN_PATH",t.HTTP_IN_BODY="HTTP_IN_BODY",t.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(dm||(dm={}));var um;(function(t){t.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",t.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",t.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",t.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(um||(um={}));var hm;(function(t){t.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH",t.MINIMAL="MINIMAL"})(hm||(hm={}));var mm;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(mm||(mm={}));var fm;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(fm||(fm={}));var pm;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(pm||(pm={}));var gm;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE",t.IMAGE_RECITATION="IMAGE_RECITATION",t.IMAGE_OTHER="IMAGE_OTHER"})(gm||(gm={}));var xm;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(xm||(xm={}));var ym;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(ym||(ym={}));var vm;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(vm||(vm={}));var bm;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"})(bm||(bm={}));var wm;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(wm||(wm={}));var ha;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(ha||(ha={}));var _m;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(_m||(_m={}));var Nm;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Nm||(Nm={}));var Em;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Em||(Em={}));var nc;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(nc||(nc={}));var Tm;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V",t.TUNING_TASK_R2V="TUNING_TASK_R2V"})(Tm||(Tm={}));var Im;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",t.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(Im||(Im={}));var Cm;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(Cm||(Cm={}));var Sm;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(Sm||(Sm={}));var Am;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Am||(Am={}));var Rm;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Rm||(Rm={}));var Pm;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(Pm||(Pm={}));var jm;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(jm||(jm={}));var km;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(km||(km={}));var Dm;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(Dm||(Dm={}));var Mm;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Mm||(Mm={}));var Lm;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Lm||(Lm={}));var Vm;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Vm||(Vm={}));var Um;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Um||(Um={}));var Fm;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(Fm||(Fm={}));var Om;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(Om||(Om={}));var zm;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(zm||(zm={}));var Bm;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(Bm||(Bm={}));var qm;(function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING"})(qm||(qm={}));var Gm;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.STATE_PENDING="STATE_PENDING",t.STATE_ACTIVE="STATE_ACTIVE",t.STATE_FAILED="STATE_FAILED"})(Gm||(Gm={}));var $m;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})($m||($m={}));var Hm;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(Hm||(Hm={}));var Wm;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(Wm||(Wm={}));var Jm;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(Jm||(Jm={}));var Km;(function(t){t.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",t.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",t.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(Km||(Km={}));var Ym;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Ym||(Ym={}));var Xm;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Xm||(Xm={}));var Qm;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(Qm||(Qm={}));var Zm;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Zm||(Zm={}));var ef;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(ef||(ef={}));var tf;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(tf||(tf={}));var Nr;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(Nr||(Nr={}));class rc{constructor(e){const s={};for(const n of e.headers.entries())s[n[0]]=n[1];this.headers=s,this.responseInternal=e}json(){return this.responseInternal.json()}}class ai{get text(){var e,s,n,r,o,a,l,u;if(((r=(n=(s=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||s===void 0?void 0:s.content)===null||n===void 0?void 0:n.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",f=!1;const p=[];for(const g of(u=(l=(a=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||a===void 0?void 0:a.content)===null||l===void 0?void 0:l.parts)!==null&&u!==void 0?u:[]){for(const[v,A]of Object.entries(g))v!=="text"&&v!=="thought"&&v!=="thoughtSignature"&&(A!==null||A!==void 0)&&p.push(v);if(typeof g.text=="string"){if(typeof g.thought=="boolean"&&g.thought)continue;f=!0,d+=g.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?d:void 0}get data(){var e,s,n,r,o,a,l,u;if(((r=(n=(s=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||s===void 0?void 0:s.content)===null||n===void 0?void 0:n.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="";const f=[];for(const p of(u=(l=(a=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||a===void 0?void 0:a.content)===null||l===void 0?void 0:l.parts)!==null&&u!==void 0?u:[]){for(const[g,v]of Object.entries(p))g!=="inlineData"&&(v!==null||v!==void 0)&&f.push(g);p.inlineData&&typeof p.inlineData.data=="string"&&(d+=atob(p.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var e,s,n,r,o,a,l,u;if(((r=(n=(s=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||s===void 0?void 0:s.content)===null||n===void 0?void 0:n.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(u=(l=(a=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||a===void 0?void 0:a.content)===null||l===void 0?void 0:l.parts)===null||u===void 0?void 0:u.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var e,s,n,r,o,a,l,u,d;if(((r=(n=(s=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||s===void 0?void 0:s.content)===null||n===void 0?void 0:n.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(u=(l=(a=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||a===void 0?void 0:a.content)===null||l===void 0?void 0:l.parts)===null||u===void 0?void 0:u.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(d=f==null?void 0:f[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var e,s,n,r,o,a,l,u,d;if(((r=(n=(s=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||s===void 0?void 0:s.content)===null||n===void 0?void 0:n.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(u=(l=(a=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||a===void 0?void 0:a.content)===null||l===void 0?void 0:l.parts)===null||u===void 0?void 0:u.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(d=f==null?void 0:f[0])===null||d===void 0?void 0:d.output}}class sf{}class nf{}class iS{}class oS{}class aS{}class lS{}class rf{}class of{}class af{}class cS{}class ma{_fromAPIResponse({apiResponse:e,_isVertexAI:s}){const n=new ma;let r;const o=e;return s?r=WC(o):r=HC(o),Object.assign(n,r),n}}class lf{}class cf{}class df{}class uf{}class dS{}class uS{}class hS{}class Nd{_fromAPIResponse({apiResponse:e,_isVertexAI:s}){const n=new Nd,o=eS(e);return Object.assign(n,o),n}}class mS{}class fS{}class pS{}class hf{}class gS{get text(){var e,s,n;let r="",o=!1;const a=[];for(const l of(n=(s=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||s===void 0?void 0:s.parts)!==null&&n!==void 0?n:[]){for(const[u,d]of Object.entries(l))u!=="text"&&u!=="thought"&&d!==null&&a.push(u);if(typeof l.text=="string"){if(typeof l.thought=="boolean"&&l.thought)continue;o=!0,r+=l.text}}return a.length>0&&console.warn(`there are non-text parts ${a} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?r:void 0}get data(){var e,s,n;let r="";const o=[];for(const a of(n=(s=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||s===void 0?void 0:s.parts)!==null&&n!==void 0?n:[]){for(const[l,u]of Object.entries(a))l!=="inlineData"&&u!==null&&o.push(l);a.inlineData&&typeof a.inlineData.data=="string"&&(r+=atob(a.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),r.length>0?btoa(r):void 0}}class xS{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class Ed{_fromAPIResponse({apiResponse:e,_isVertexAI:s}){const n=new Ed,o=Ox(e);return Object.assign(n,o),n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Xe(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const s=e.split("/",2);return`publishers/${s[0]}/models/${s[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function zx(t,e){const s=Xe(t,e);return s?s.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${s}`:s.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${s}`:s:""}function Bx(t){return Array.isArray(t)?t.map(e=>fa(e)):[fa(t)]}function fa(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function qx(t){const e=fa(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Gx(t){const e=fa(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function mf(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function $x(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>mf(e)):[mf(t)]}function ic(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function ff(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function pf(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function Xt(t){if(t==null)throw new Error("ContentUnion is required");return ic(t)?t:{role:"user",parts:$x(t)}}function Td(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(s=>{const n=Xt(s);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(t.isVertexAI()){const s=Xt(e);return s.parts&&s.parts.length>0&&s.parts[0].text!==void 0?[s.parts[0].text]:[]}return Array.isArray(e)?e.map(s=>Xt(s)):[Xt(e)]}function gs(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(ff(t)||pf(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Xt(t)]}const e=[],s=[],n=ic(t[0]);for(const r of t){const o=ic(r);if(o!=n)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)e.push(r);else{if(ff(r)||pf(r))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");s.push(r)}}return n||e.push({role:"user",parts:$x(s)}),e}function yS(t,e){t.includes("null")&&(e.nullable=!0);const s=t.filter(n=>n!=="null");if(s.length===1)e.type=Object.values(Nn).includes(s[0].toUpperCase())?s[0].toUpperCase():Nn.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const n of s)e.anyOf.push({type:Object.values(Nn).includes(n.toUpperCase())?n.toUpperCase():Nn.TYPE_UNSPECIFIED})}}function Rr(t){const e={},s=["items"],n=["anyOf"],r=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const o=t.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(e.nullable=!0,t=o[1]):o[1].type==="null"&&(e.nullable=!0,t=o[0])),t.type instanceof Array&&yS(t.type,e);for(const[a,l]of Object.entries(t))if(l!=null)if(a=="type"){if(l==="null")throw new Error("type: null can not be the only possible type for the field.");if(l instanceof Array)continue;e.type=Object.values(Nn).includes(l.toUpperCase())?l.toUpperCase():Nn.TYPE_UNSPECIFIED}else if(s.includes(a))e[a]=Rr(l);else if(n.includes(a)){const u=[];for(const d of l){if(d.type=="null"){e.nullable=!0;continue}u.push(Rr(d))}e[a]=u}else if(r.includes(a)){const u={};for(const[d,f]of Object.entries(l))u[d]=Rr(f);e[a]=u}else{if(a==="additionalProperties")continue;e[a]=l}return e}function Id(t){return Rr(t)}function Cd(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function Sd(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function Wr(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Rr(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Rr(e.response));return t}function Jr(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const s of t)e.push(s);return e}function vS(t,e,s,n=1){const r=!e.startsWith(`${s}/`)&&e.split("/").length===n;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${s}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:r?`projects/${t.getProject()}/locations/${t.getLocation()}/${s}/${e}`:e:r?`${s}/${e}`:e}function dn(t,e){if(typeof e!="string")throw new Error("name must be a string");return vS(t,e,"cachedContents")}function Hx(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function On(t){return _d(t)}function bS(t){return t!=null&&typeof t=="object"&&"name"in t}function wS(t){return t!=null&&typeof t=="object"&&"video"in t}function _S(t){return t!=null&&typeof t=="object"&&"uri"in t}function Wx(t){var e;let s;if(bS(t)&&(s=t.name),!(_S(t)&&(s=t.uri,s===void 0))&&!(wS(t)&&(s=(e=t.video)===null||e===void 0?void 0:e.uri,s===void 0))){if(typeof t=="string"&&(s=t),s===void 0)throw new Error("Could not extract file name from the provided input.");if(s.startsWith("https://")){const r=s.split("files/")[1].match(/[a-z0-9]+/);if(r===null)throw new Error(`Could not extract file name from URI ${s}`);s=r[0]}else s.startsWith("files/")&&(s=s.split("files/")[1]);return s}}function Jx(t,e){let s;return t.isVertexAI()?s=e?"publishers/google/models":"models":s=e?"models":"tunedModels",s}function Kx(t){for(const e of["models","tunedModels","publisherModels"])if(NS(t,e))return t[e];return[]}function NS(t,e){return t!==null&&typeof t=="object"&&e in t}function ES(t,e={}){const s=t,n={name:s.name,description:s.description,parametersJsonSchema:s.inputSchema};return s.outputSchema&&(n.responseJsonSchema=s.outputSchema),e.behavior&&(n.behavior=e.behavior),{functionDeclarations:[n]}}function TS(t,e={}){const s=[],n=new Set;for(const r of t){const o=r.name;if(n.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);n.add(o);const a=ES(r,e);a.functionDeclarations&&s.push(...a.functionDeclarations)}return{functionDeclarations:s}}function Yx(t,e){let s;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))s={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))s={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))s={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");s={inlinedRequests:e}}else s=e;const n=[s.gcsUri,s.bigqueryUri].filter(Boolean).length,r=[s.inlinedRequests,s.fileName].filter(Boolean).length;if(t.isVertexAI()){if(r>0||n!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(n>0||r!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return s}function IS(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function Xx(t){if(typeof t!="object"||t===null)return{};const e=t,s=e.inlinedResponses;if(typeof s!="object"||s===null)return t;const r=s.inlinedResponses;if(!Array.isArray(r)||r.length===0)return t;let o=!1;for(const a of r){if(typeof a!="object"||a===null)continue;const u=a.response;if(typeof u!="object"||u===null)continue;if(u.embedding!==void 0){o=!0;break}}return o&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function Kr(t,e){const s=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(s))return s.split("/").pop();throw new Error(`Invalid batch job name: ${s}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(s))return s.split("/").pop();if(/^\d+$/.test(s))return s;throw new Error(`Invalid batch job name: ${s}.`)}function Qx(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function CS(t){const e={},s=c(t,["responsesFile"]);s!=null&&h(e,["fileName"],s);const n=c(t,["inlinedResponses","inlinedResponses"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>aA(a))),h(e,["inlinedResponses"],o)}const r=c(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>a)),h(e,["inlinedEmbedContentResponses"],o)}return e}function SS(t){const e={},s=c(t,["predictionsFormat"]);s!=null&&h(e,["format"],s);const n=c(t,["gcsDestination","outputUriPrefix"]);n!=null&&h(e,["gcsUri"],n);const r=c(t,["bigqueryDestination","outputUri"]);return r!=null&&h(e,["bigqueryUri"],r),e}function AS(t){const e={},s=c(t,["format"]);s!=null&&h(e,["predictionsFormat"],s);const n=c(t,["gcsUri"]);n!=null&&h(e,["gcsDestination","outputUriPrefix"],n);const r=c(t,["bigqueryUri"]);if(r!=null&&h(e,["bigqueryDestination","outputUri"],r),c(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(c(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(c(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Vo(t){const e={},s=c(t,["name"]);s!=null&&h(e,["name"],s);const n=c(t,["metadata","displayName"]);n!=null&&h(e,["displayName"],n);const r=c(t,["metadata","state"]);r!=null&&h(e,["state"],Qx(r));const o=c(t,["metadata","createTime"]);o!=null&&h(e,["createTime"],o);const a=c(t,["metadata","endTime"]);a!=null&&h(e,["endTime"],a);const l=c(t,["metadata","updateTime"]);l!=null&&h(e,["updateTime"],l);const u=c(t,["metadata","model"]);u!=null&&h(e,["model"],u);const d=c(t,["metadata","output"]);return d!=null&&h(e,["dest"],CS(Xx(d))),e}function oc(t){const e={},s=c(t,["name"]);s!=null&&h(e,["name"],s);const n=c(t,["displayName"]);n!=null&&h(e,["displayName"],n);const r=c(t,["state"]);r!=null&&h(e,["state"],Qx(r));const o=c(t,["error"]);o!=null&&h(e,["error"],o);const a=c(t,["createTime"]);a!=null&&h(e,["createTime"],a);const l=c(t,["startTime"]);l!=null&&h(e,["startTime"],l);const u=c(t,["endTime"]);u!=null&&h(e,["endTime"],u);const d=c(t,["updateTime"]);d!=null&&h(e,["updateTime"],d);const f=c(t,["model"]);f!=null&&h(e,["model"],f);const p=c(t,["inputConfig"]);p!=null&&h(e,["src"],RS(p));const g=c(t,["outputConfig"]);g!=null&&h(e,["dest"],SS(Xx(g)));const v=c(t,["completionStats"]);return v!=null&&h(e,["completionStats"],v),e}function RS(t){const e={},s=c(t,["instancesFormat"]);s!=null&&h(e,["format"],s);const n=c(t,["gcsSource","uris"]);n!=null&&h(e,["gcsUri"],n);const r=c(t,["bigquerySource","inputUri"]);return r!=null&&h(e,["bigqueryUri"],r),e}function PS(t,e){const s={};if(c(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(c(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(c(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const n=c(e,["fileName"]);n!=null&&h(s,["fileName"],n);const r=c(e,["inlinedRequests"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>oA(t,a))),h(s,["requests","requests"],o)}return s}function jS(t){const e={},s=c(t,["format"]);s!=null&&h(e,["instancesFormat"],s);const n=c(t,["gcsUri"]);n!=null&&h(e,["gcsSource","uris"],n);const r=c(t,["bigqueryUri"]);if(r!=null&&h(e,["bigquerySource","inputUri"],r),c(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(c(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function kS(t){const e={},s=c(t,["data"]);if(s!=null&&h(e,["data"],s),c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=c(t,["mimeType"]);return n!=null&&h(e,["mimeType"],n),e}function DS(t,e){const s={},n=c(e,["name"]);return n!=null&&h(s,["_url","name"],Kr(t,n)),s}function MS(t,e){const s={},n=c(e,["name"]);return n!=null&&h(s,["_url","name"],Kr(t,n)),s}function LS(t){const e={},s=c(t,["content"]);s!=null&&h(e,["content"],s);const n=c(t,["citationMetadata"]);n!=null&&h(e,["citationMetadata"],VS(n));const r=c(t,["tokenCount"]);r!=null&&h(e,["tokenCount"],r);const o=c(t,["finishReason"]);o!=null&&h(e,["finishReason"],o);const a=c(t,["avgLogprobs"]);a!=null&&h(e,["avgLogprobs"],a);const l=c(t,["groundingMetadata"]);l!=null&&h(e,["groundingMetadata"],l);const u=c(t,["index"]);u!=null&&h(e,["index"],u);const d=c(t,["logprobsResult"]);d!=null&&h(e,["logprobsResult"],d);const f=c(t,["safetyRatings"]);if(f!=null){let g=f;Array.isArray(g)&&(g=g.map(v=>v)),h(e,["safetyRatings"],g)}const p=c(t,["urlContextMetadata"]);return p!=null&&h(e,["urlContextMetadata"],p),e}function VS(t){const e={},s=c(t,["citationSources"]);if(s!=null){let n=s;Array.isArray(n)&&(n=n.map(r=>r)),h(e,["citations"],n)}return e}function Zx(t){const e={},s=c(t,["parts"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>fA(o))),h(e,["parts"],r)}const n=c(t,["role"]);return n!=null&&h(e,["role"],n),e}function US(t,e){const s={},n=c(t,["displayName"]);if(e!==void 0&&n!=null&&h(e,["batch","displayName"],n),c(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return s}function FS(t,e){const s={},n=c(t,["displayName"]);e!==void 0&&n!=null&&h(e,["displayName"],n);const r=c(t,["dest"]);return e!==void 0&&r!=null&&h(e,["outputConfig"],AS(IS(r))),s}function gf(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["_url","model"],Xe(t,n));const r=c(e,["src"]);r!=null&&h(s,["batch","inputConfig"],PS(t,Yx(t,r)));const o=c(e,["config"]);return o!=null&&US(o,s),s}function OS(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["model"],Xe(t,n));const r=c(e,["src"]);r!=null&&h(s,["inputConfig"],jS(Yx(t,r)));const o=c(e,["config"]);return o!=null&&FS(o,s),s}function zS(t,e){const s={},n=c(t,["displayName"]);return e!==void 0&&n!=null&&h(e,["batch","displayName"],n),s}function BS(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["_url","model"],Xe(t,n));const r=c(e,["src"]);r!=null&&h(s,["batch","inputConfig"],KS(t,r));const o=c(e,["config"]);return o!=null&&zS(o,s),s}function qS(t,e){const s={},n=c(e,["name"]);return n!=null&&h(s,["_url","name"],Kr(t,n)),s}function GS(t,e){const s={},n=c(e,["name"]);return n!=null&&h(s,["_url","name"],Kr(t,n)),s}function $S(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["name"]);n!=null&&h(e,["name"],n);const r=c(t,["done"]);r!=null&&h(e,["done"],r);const o=c(t,["error"]);return o!=null&&h(e,["error"],o),e}function HS(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["name"]);n!=null&&h(e,["name"],n);const r=c(t,["done"]);r!=null&&h(e,["done"],r);const o=c(t,["error"]);return o!=null&&h(e,["error"],o),e}function WS(t,e){const s={},n=c(e,["contents"]);if(n!=null){let o=Td(t,n);Array.isArray(o)&&(o=o.map(a=>a)),h(s,["requests[]","request","content"],o)}const r=c(e,["config"]);return r!=null&&(h(s,["_self"],JS(r,s)),GC(s,{"requests[].*":"requests[].request.*"})),s}function JS(t,e){const s={},n=c(t,["taskType"]);e!==void 0&&n!=null&&h(e,["requests[]","taskType"],n);const r=c(t,["title"]);e!==void 0&&r!=null&&h(e,["requests[]","title"],r);const o=c(t,["outputDimensionality"]);if(e!==void 0&&o!=null&&h(e,["requests[]","outputDimensionality"],o),c(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(c(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return s}function KS(t,e){const s={},n=c(e,["fileName"]);n!=null&&h(s,["file_name"],n);const r=c(e,["inlinedRequests"]);return r!=null&&h(s,["requests"],WS(t,r)),s}function YS(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=c(t,["fileUri"]);s!=null&&h(e,["fileUri"],s);const n=c(t,["mimeType"]);return n!=null&&h(e,["mimeType"],n),e}function XS(t){const e={},s=c(t,["id"]);s!=null&&h(e,["id"],s);const n=c(t,["args"]);n!=null&&h(e,["args"],n);const r=c(t,["name"]);if(r!=null&&h(e,["name"],r),c(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(c(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function QS(t){const e={},s=c(t,["mode"]);s!=null&&h(e,["mode"],s);const n=c(t,["allowedFunctionNames"]);if(n!=null&&h(e,["allowedFunctionNames"],n),c(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function ZS(t,e,s){const n={},r=c(e,["systemInstruction"]);s!==void 0&&r!=null&&h(s,["systemInstruction"],Zx(Xt(r)));const o=c(e,["temperature"]);o!=null&&h(n,["temperature"],o);const a=c(e,["topP"]);a!=null&&h(n,["topP"],a);const l=c(e,["topK"]);l!=null&&h(n,["topK"],l);const u=c(e,["candidateCount"]);u!=null&&h(n,["candidateCount"],u);const d=c(e,["maxOutputTokens"]);d!=null&&h(n,["maxOutputTokens"],d);const f=c(e,["stopSequences"]);f!=null&&h(n,["stopSequences"],f);const p=c(e,["responseLogprobs"]);p!=null&&h(n,["responseLogprobs"],p);const g=c(e,["logprobs"]);g!=null&&h(n,["logprobs"],g);const v=c(e,["presencePenalty"]);v!=null&&h(n,["presencePenalty"],v);const A=c(e,["frequencyPenalty"]);A!=null&&h(n,["frequencyPenalty"],A);const k=c(e,["seed"]);k!=null&&h(n,["seed"],k);const S=c(e,["responseMimeType"]);S!=null&&h(n,["responseMimeType"],S);const L=c(e,["responseSchema"]);L!=null&&h(n,["responseSchema"],Id(L));const D=c(e,["responseJsonSchema"]);if(D!=null&&h(n,["responseJsonSchema"],D),c(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(c(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const j=c(e,["safetySettings"]);if(s!==void 0&&j!=null){let C=j;Array.isArray(C)&&(C=C.map(ge=>pA(ge))),h(s,["safetySettings"],C)}const F=c(e,["tools"]);if(s!==void 0&&F!=null){let C=Jr(F);Array.isArray(C)&&(C=C.map(ge=>xA(Wr(ge)))),h(s,["tools"],C)}const q=c(e,["toolConfig"]);if(s!==void 0&&q!=null&&h(s,["toolConfig"],gA(q)),c(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const E=c(e,["cachedContent"]);s!==void 0&&E!=null&&h(s,["cachedContent"],dn(t,E));const w=c(e,["responseModalities"]);w!=null&&h(n,["responseModalities"],w);const b=c(e,["mediaResolution"]);b!=null&&h(n,["mediaResolution"],b);const _=c(e,["speechConfig"]);if(_!=null&&h(n,["speechConfig"],Cd(_)),c(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const T=c(e,["thinkingConfig"]);T!=null&&h(n,["thinkingConfig"],T);const R=c(e,["imageConfig"]);R!=null&&h(n,["imageConfig"],iA(R));const M=c(e,["enableEnhancedCivicAnswers"]);return M!=null&&h(n,["enableEnhancedCivicAnswers"],M),n}function eA(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["candidates"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(d=>LS(d))),h(e,["candidates"],u)}const r=c(t,["modelVersion"]);r!=null&&h(e,["modelVersion"],r);const o=c(t,["promptFeedback"]);o!=null&&h(e,["promptFeedback"],o);const a=c(t,["responseId"]);a!=null&&h(e,["responseId"],a);const l=c(t,["usageMetadata"]);return l!=null&&h(e,["usageMetadata"],l),e}function tA(t,e){const s={},n=c(e,["name"]);return n!=null&&h(s,["_url","name"],Kr(t,n)),s}function sA(t,e){const s={},n=c(e,["name"]);return n!=null&&h(s,["_url","name"],Kr(t,n)),s}function nA(t){const e={};if(c(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const s=c(t,["enableWidget"]);return s!=null&&h(e,["enableWidget"],s),e}function rA(t){const e={};if(c(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(c(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const s=c(t,["timeRangeFilter"]);return s!=null&&h(e,["timeRangeFilter"],s),e}function iA(t){const e={},s=c(t,["aspectRatio"]);s!=null&&h(e,["aspectRatio"],s);const n=c(t,["imageSize"]);if(n!=null&&h(e,["imageSize"],n),c(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(c(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function oA(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["request","model"],Xe(t,n));const r=c(e,["contents"]);if(r!=null){let l=gs(r);Array.isArray(l)&&(l=l.map(u=>Zx(u))),h(s,["request","contents"],l)}const o=c(e,["metadata"]);o!=null&&h(s,["metadata"],o);const a=c(e,["config"]);return a!=null&&h(s,["request","generationConfig"],ZS(t,a,c(s,["request"],{}))),s}function aA(t){const e={},s=c(t,["response"]);s!=null&&h(e,["response"],eA(s));const n=c(t,["error"]);return n!=null&&h(e,["error"],n),e}function lA(t,e){const s={},n=c(t,["pageSize"]);e!==void 0&&n!=null&&h(e,["_query","pageSize"],n);const r=c(t,["pageToken"]);if(e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),c(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return s}function cA(t,e){const s={},n=c(t,["pageSize"]);e!==void 0&&n!=null&&h(e,["_query","pageSize"],n);const r=c(t,["pageToken"]);e!==void 0&&r!=null&&h(e,["_query","pageToken"],r);const o=c(t,["filter"]);return e!==void 0&&o!=null&&h(e,["_query","filter"],o),s}function dA(t){const e={},s=c(t,["config"]);return s!=null&&lA(s,e),e}function uA(t){const e={},s=c(t,["config"]);return s!=null&&cA(s,e),e}function hA(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["nextPageToken"]);n!=null&&h(e,["nextPageToken"],n);const r=c(t,["operations"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>Vo(a))),h(e,["batchJobs"],o)}return e}function mA(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["nextPageToken"]);n!=null&&h(e,["nextPageToken"],n);const r=c(t,["batchPredictionJobs"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>oc(a))),h(e,["batchJobs"],o)}return e}function fA(t){const e={},s=c(t,["mediaResolution"]);s!=null&&h(e,["mediaResolution"],s);const n=c(t,["codeExecutionResult"]);n!=null&&h(e,["codeExecutionResult"],n);const r=c(t,["executableCode"]);r!=null&&h(e,["executableCode"],r);const o=c(t,["fileData"]);o!=null&&h(e,["fileData"],YS(o));const a=c(t,["functionCall"]);a!=null&&h(e,["functionCall"],XS(a));const l=c(t,["functionResponse"]);l!=null&&h(e,["functionResponse"],l);const u=c(t,["inlineData"]);u!=null&&h(e,["inlineData"],kS(u));const d=c(t,["text"]);d!=null&&h(e,["text"],d);const f=c(t,["thought"]);f!=null&&h(e,["thought"],f);const p=c(t,["thoughtSignature"]);p!=null&&h(e,["thoughtSignature"],p);const g=c(t,["videoMetadata"]);return g!=null&&h(e,["videoMetadata"],g),e}function pA(t){const e={},s=c(t,["category"]);if(s!=null&&h(e,["category"],s),c(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=c(t,["threshold"]);return n!=null&&h(e,["threshold"],n),e}function gA(t){const e={},s=c(t,["functionCallingConfig"]);s!=null&&h(e,["functionCallingConfig"],QS(s));const n=c(t,["retrievalConfig"]);return n!=null&&h(e,["retrievalConfig"],n),e}function xA(t){const e={},s=c(t,["functionDeclarations"]);if(s!=null){let f=s;Array.isArray(f)&&(f=f.map(p=>p)),h(e,["functionDeclarations"],f)}if(c(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=c(t,["googleSearchRetrieval"]);n!=null&&h(e,["googleSearchRetrieval"],n);const r=c(t,["computerUse"]);r!=null&&h(e,["computerUse"],r);const o=c(t,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);const a=c(t,["codeExecution"]);if(a!=null&&h(e,["codeExecution"],a),c(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=c(t,["googleMaps"]);l!=null&&h(e,["googleMaps"],nA(l));const u=c(t,["googleSearch"]);u!=null&&h(e,["googleSearch"],rA(u));const d=c(t,["urlContext"]);return d!=null&&h(e,["urlContext"],d),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var rn;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",t.PAGED_ITEM_DOCUMENTS="documents"})(rn||(rn={}));class fr{constructor(e,s,n,r){this.pageInternal=[],this.paramsInternal={},this.requestInternal=s,this.init(e,n,r)}init(e,s,n){var r,o;this.nameInternal=e,this.pageInternal=s[this.nameInternal]||[],this.sdkHttpResponseInternal=s==null?void 0:s.sdkHttpResponse,this.idxInternal=0;let a={config:{}};!n||Object.keys(n).length===0?a={config:{}}:typeof n=="object"?a=Object.assign({},n):a=n,a.config&&(a.config.pageToken=s.nextPageToken),this.paramsInternal=a,this.pageInternalSize=(o=(r=a.config)===null||r===void 0?void 0:r.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class yA extends cn{constructor(e){super(),this.apiClient=e,this.list=async(s={})=>new fr(rn.PAGED_ITEM_BATCH_JOBS,n=>this.listInternal(n),await this.listInternal(s),s),this.create=async s=>(this.apiClient.isVertexAI()&&(s.config=this.formatDestination(s.src,s.config)),this.createInternal(s)),this.createEmbeddings=async s=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(s)}}createInlinedGenerateContentRequest(e){const s=gf(this.apiClient,e),n=s._url,r=me("{model}:batchGenerateContent",n),l=s.batch.inputConfig.requests,u=l.requests,d=[];for(const f of u){const p=Object.assign({},f);if(p.systemInstruction){const g=p.systemInstruction;delete p.systemInstruction;const v=p.request;v.systemInstruction=g,p.request=v}d.push(p)}return l.requests=d,delete s.config,delete s._url,delete s._query,{path:r,body:s}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,s){const n=s?Object.assign({},s):{},r=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${r}`),n.dest===void 0){const o=this.getGcsUri(e),a=this.getBigqueryUri(e);if(o)o.endsWith(".jsonl")?n.dest=`${o.slice(0,-6)}/dest`:n.dest=`${o}_dest_${r}`;else if(a)n.dest=`${a}_dest_${r}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=OS(this.apiClient,e);return l=me("batchPredictionJobs",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>oc(f))}else{const d=gf(this.apiClient,e);return l=me("{model}:batchGenerateContent",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>Vo(f))}}async createEmbeddingsInternal(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=BS(this.apiClient,e);return o=me("{model}:asyncBatchEmbedContent",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),r.then(u=>Vo(u))}}async get(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=sA(this.apiClient,e);return l=me("batchPredictionJobs/{name}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>oc(f))}else{const d=tA(this.apiClient,e);return l=me("batches/{name}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>Vo(f))}}async cancel(e){var s,n,r,o;let a="",l={};if(this.apiClient.isVertexAI()){const u=MS(this.apiClient,e);a=me("batchPredictionJobs/{name}:cancel",u._url),l=u._query,delete u._url,delete u._query,await this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}else{const u=DS(this.apiClient,e);a=me("batches/{name}:cancel",u._url),l=u._query,delete u._url,delete u._query,await this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=uA(e);return l=me("batchPredictionJobs",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=mA(f),g=new hf;return Object.assign(g,p),g})}else{const d=dA(e);return l=me("batches",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=hA(f),g=new hf;return Object.assign(g,p),g})}}async delete(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=GS(this.apiClient,e);return l=me("batchPredictionJobs/{name}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>HS(f))}else{const d=qS(this.apiClient,e);return l=me("batches/{name}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>$S(f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function vA(t){const e={},s=c(t,["data"]);if(s!=null&&h(e,["data"],s),c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=c(t,["mimeType"]);return n!=null&&h(e,["mimeType"],n),e}function xf(t){const e={},s=c(t,["parts"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>BA(o))),h(e,["parts"],r)}const n=c(t,["role"]);return n!=null&&h(e,["role"],n),e}function bA(t,e){const s={},n=c(t,["ttl"]);e!==void 0&&n!=null&&h(e,["ttl"],n);const r=c(t,["expireTime"]);e!==void 0&&r!=null&&h(e,["expireTime"],r);const o=c(t,["displayName"]);e!==void 0&&o!=null&&h(e,["displayName"],o);const a=c(t,["contents"]);if(e!==void 0&&a!=null){let f=gs(a);Array.isArray(f)&&(f=f.map(p=>xf(p))),h(e,["contents"],f)}const l=c(t,["systemInstruction"]);e!==void 0&&l!=null&&h(e,["systemInstruction"],xf(Xt(l)));const u=c(t,["tools"]);if(e!==void 0&&u!=null){let f=u;Array.isArray(f)&&(f=f.map(p=>GA(p))),h(e,["tools"],f)}const d=c(t,["toolConfig"]);if(e!==void 0&&d!=null&&h(e,["toolConfig"],qA(d)),c(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return s}function wA(t,e){const s={},n=c(t,["ttl"]);e!==void 0&&n!=null&&h(e,["ttl"],n);const r=c(t,["expireTime"]);e!==void 0&&r!=null&&h(e,["expireTime"],r);const o=c(t,["displayName"]);e!==void 0&&o!=null&&h(e,["displayName"],o);const a=c(t,["contents"]);if(e!==void 0&&a!=null){let p=gs(a);Array.isArray(p)&&(p=p.map(g=>g)),h(e,["contents"],p)}const l=c(t,["systemInstruction"]);e!==void 0&&l!=null&&h(e,["systemInstruction"],Xt(l));const u=c(t,["tools"]);if(e!==void 0&&u!=null){let p=u;Array.isArray(p)&&(p=p.map(g=>$A(g))),h(e,["tools"],p)}const d=c(t,["toolConfig"]);e!==void 0&&d!=null&&h(e,["toolConfig"],d);const f=c(t,["kmsKeyName"]);return e!==void 0&&f!=null&&h(e,["encryption_spec","kmsKeyName"],f),s}function _A(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["model"],zx(t,n));const r=c(e,["config"]);return r!=null&&bA(r,s),s}function NA(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["model"],zx(t,n));const r=c(e,["config"]);return r!=null&&wA(r,s),s}function EA(t,e){const s={},n=c(e,["name"]);return n!=null&&h(s,["_url","name"],dn(t,n)),s}function TA(t,e){const s={},n=c(e,["name"]);return n!=null&&h(s,["_url","name"],dn(t,n)),s}function IA(t){const e={},s=c(t,["sdkHttpResponse"]);return s!=null&&h(e,["sdkHttpResponse"],s),e}function CA(t){const e={},s=c(t,["sdkHttpResponse"]);return s!=null&&h(e,["sdkHttpResponse"],s),e}function SA(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=c(t,["fileUri"]);s!=null&&h(e,["fileUri"],s);const n=c(t,["mimeType"]);return n!=null&&h(e,["mimeType"],n),e}function AA(t){const e={},s=c(t,["id"]);s!=null&&h(e,["id"],s);const n=c(t,["args"]);n!=null&&h(e,["args"],n);const r=c(t,["name"]);if(r!=null&&h(e,["name"],r),c(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(c(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function RA(t){const e={},s=c(t,["mode"]);s!=null&&h(e,["mode"],s);const n=c(t,["allowedFunctionNames"]);if(n!=null&&h(e,["allowedFunctionNames"],n),c(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function PA(t){const e={};if(c(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const s=c(t,["description"]);s!=null&&h(e,["description"],s);const n=c(t,["name"]);n!=null&&h(e,["name"],n);const r=c(t,["parameters"]);r!=null&&h(e,["parameters"],r);const o=c(t,["parametersJsonSchema"]);o!=null&&h(e,["parametersJsonSchema"],o);const a=c(t,["response"]);a!=null&&h(e,["response"],a);const l=c(t,["responseJsonSchema"]);return l!=null&&h(e,["responseJsonSchema"],l),e}function jA(t,e){const s={},n=c(e,["name"]);return n!=null&&h(s,["_url","name"],dn(t,n)),s}function kA(t,e){const s={},n=c(e,["name"]);return n!=null&&h(s,["_url","name"],dn(t,n)),s}function DA(t){const e={};if(c(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const s=c(t,["enableWidget"]);return s!=null&&h(e,["enableWidget"],s),e}function MA(t){const e={};if(c(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(c(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const s=c(t,["timeRangeFilter"]);return s!=null&&h(e,["timeRangeFilter"],s),e}function LA(t,e){const s={},n=c(t,["pageSize"]);e!==void 0&&n!=null&&h(e,["_query","pageSize"],n);const r=c(t,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),s}function VA(t,e){const s={},n=c(t,["pageSize"]);e!==void 0&&n!=null&&h(e,["_query","pageSize"],n);const r=c(t,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),s}function UA(t){const e={},s=c(t,["config"]);return s!=null&&LA(s,e),e}function FA(t){const e={},s=c(t,["config"]);return s!=null&&VA(s,e),e}function OA(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["nextPageToken"]);n!=null&&h(e,["nextPageToken"],n);const r=c(t,["cachedContents"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>a)),h(e,["cachedContents"],o)}return e}function zA(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["nextPageToken"]);n!=null&&h(e,["nextPageToken"],n);const r=c(t,["cachedContents"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>a)),h(e,["cachedContents"],o)}return e}function BA(t){const e={},s=c(t,["mediaResolution"]);s!=null&&h(e,["mediaResolution"],s);const n=c(t,["codeExecutionResult"]);n!=null&&h(e,["codeExecutionResult"],n);const r=c(t,["executableCode"]);r!=null&&h(e,["executableCode"],r);const o=c(t,["fileData"]);o!=null&&h(e,["fileData"],SA(o));const a=c(t,["functionCall"]);a!=null&&h(e,["functionCall"],AA(a));const l=c(t,["functionResponse"]);l!=null&&h(e,["functionResponse"],l);const u=c(t,["inlineData"]);u!=null&&h(e,["inlineData"],vA(u));const d=c(t,["text"]);d!=null&&h(e,["text"],d);const f=c(t,["thought"]);f!=null&&h(e,["thought"],f);const p=c(t,["thoughtSignature"]);p!=null&&h(e,["thoughtSignature"],p);const g=c(t,["videoMetadata"]);return g!=null&&h(e,["videoMetadata"],g),e}function qA(t){const e={},s=c(t,["functionCallingConfig"]);s!=null&&h(e,["functionCallingConfig"],RA(s));const n=c(t,["retrievalConfig"]);return n!=null&&h(e,["retrievalConfig"],n),e}function GA(t){const e={},s=c(t,["functionDeclarations"]);if(s!=null){let f=s;Array.isArray(f)&&(f=f.map(p=>p)),h(e,["functionDeclarations"],f)}if(c(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=c(t,["googleSearchRetrieval"]);n!=null&&h(e,["googleSearchRetrieval"],n);const r=c(t,["computerUse"]);r!=null&&h(e,["computerUse"],r);const o=c(t,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);const a=c(t,["codeExecution"]);if(a!=null&&h(e,["codeExecution"],a),c(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=c(t,["googleMaps"]);l!=null&&h(e,["googleMaps"],DA(l));const u=c(t,["googleSearch"]);u!=null&&h(e,["googleSearch"],MA(u));const d=c(t,["urlContext"]);return d!=null&&h(e,["urlContext"],d),e}function $A(t){const e={},s=c(t,["functionDeclarations"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(g=>PA(g))),h(e,["functionDeclarations"],p)}const n=c(t,["retrieval"]);n!=null&&h(e,["retrieval"],n);const r=c(t,["googleSearchRetrieval"]);r!=null&&h(e,["googleSearchRetrieval"],r);const o=c(t,["computerUse"]);if(o!=null&&h(e,["computerUse"],o),c(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const a=c(t,["codeExecution"]);a!=null&&h(e,["codeExecution"],a);const l=c(t,["enterpriseWebSearch"]);l!=null&&h(e,["enterpriseWebSearch"],l);const u=c(t,["googleMaps"]);u!=null&&h(e,["googleMaps"],u);const d=c(t,["googleSearch"]);d!=null&&h(e,["googleSearch"],d);const f=c(t,["urlContext"]);return f!=null&&h(e,["urlContext"],f),e}function HA(t,e){const s={},n=c(t,["ttl"]);e!==void 0&&n!=null&&h(e,["ttl"],n);const r=c(t,["expireTime"]);return e!==void 0&&r!=null&&h(e,["expireTime"],r),s}function WA(t,e){const s={},n=c(t,["ttl"]);e!==void 0&&n!=null&&h(e,["ttl"],n);const r=c(t,["expireTime"]);return e!==void 0&&r!=null&&h(e,["expireTime"],r),s}function JA(t,e){const s={},n=c(e,["name"]);n!=null&&h(s,["_url","name"],dn(t,n));const r=c(e,["config"]);return r!=null&&HA(r,s),s}function KA(t,e){const s={},n=c(e,["name"]);n!=null&&h(s,["_url","name"],dn(t,n));const r=c(e,["config"]);return r!=null&&WA(r,s),s}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class YA extends cn{constructor(e){super(),this.apiClient=e,this.list=async(s={})=>new fr(rn.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(s),s)}async create(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=NA(this.apiClient,e);return l=me("cachedContents",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>f)}else{const d=_A(this.apiClient,e);return l=me("cachedContents",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>f)}}async get(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=kA(this.apiClient,e);return l=me("{name}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>f)}else{const d=jA(this.apiClient,e);return l=me("{name}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>f)}}async delete(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=TA(this.apiClient,e);return l=me("{name}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=CA(f),g=new df;return Object.assign(g,p),g})}else{const d=EA(this.apiClient,e);return l=me("{name}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=IA(f),g=new df;return Object.assign(g,p),g})}}async update(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=KA(this.apiClient,e);return l=me("{name}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>f)}else{const d=JA(this.apiClient,e);return l=me("{name}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>f)}}async listInternal(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=FA(e);return l=me("cachedContents",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=zA(f),g=new uf;return Object.assign(g,p),g})}else{const d=UA(e);return l=me("cachedContents",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=OA(f),g=new uf;return Object.assign(g,p),g})}}}function pa(t,e){var s={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(s[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(s[n[r]]=t[n[r]]);return s}function yf(t){var e=typeof Symbol=="function"&&Symbol.iterator,s=e&&t[e],n=0;if(s)return s.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Re(t){return this instanceof Re?(this.v=t,this):new Re(t)}function ws(t,e,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=s.apply(t,e||[]),r,o=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",a),r[Symbol.asyncIterator]=function(){return this},r;function a(v){return function(A){return Promise.resolve(A).then(v,p)}}function l(v,A){n[v]&&(r[v]=function(k){return new Promise(function(S,L){o.push([v,k,S,L])>1||u(v,k)})},A&&(r[v]=A(r[v])))}function u(v,A){try{d(n[v](A))}catch(k){g(o[0][3],k)}}function d(v){v.value instanceof Re?Promise.resolve(v.value.v).then(f,p):g(o[0][2],v)}function f(v){u("next",v)}function p(v){u("throw",v)}function g(v,A){v(A),o.shift(),o.length&&u(o[0][0],o[0][1])}}function _s(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],s;return e?e.call(t):(t=typeof yf=="function"?yf(t):t[Symbol.iterator](),s={},n("next"),n("throw"),n("return"),s[Symbol.asyncIterator]=function(){return this},s);function n(o){s[o]=t[o]&&function(a){return new Promise(function(l,u){a=t[o](a),r(l,u,a.done,a.value)})}}function r(o,a,l,u){Promise.resolve(u).then(function(d){o({value:d,done:l})},a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function XA(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const s=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return s===void 0?!1:e0(s)}function e0(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function QA(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function vf(t){if(t===void 0||t.length===0)return[];const e=[],s=t.length;let n=0;for(;n<s;)if(t[n].role==="user")e.push(t[n]),n++;else{const r=[];let o=!0;for(;n<s&&t[n].role==="model";)r.push(t[n]),o&&!e0(t[n])&&(o=!1),n++;o?e.push(...r):e.pop()}return e}class ZA{constructor(e,s){this.modelsModule=e,this.apiClient=s}create(e){return new eR(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class eR{constructor(e,s,n,r={},o=[]){this.apiClient=e,this.modelsModule=s,this.model=n,this.config=r,this.history=o,this.sendPromise=Promise.resolve(),QA(o)}async sendMessage(e){var s;await this.sendPromise;const n=Xt(e.message),r=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(s=e.config)!==null&&s!==void 0?s:this.config});return this.sendPromise=(async()=>{var o,a,l;const u=await r,d=(a=(o=u.candidates)===null||o===void 0?void 0:o[0])===null||a===void 0?void 0:a.content,f=u.automaticFunctionCallingHistory,p=this.getHistory(!0).length;let g=[];f!=null&&(g=(l=f.slice(p))!==null&&l!==void 0?l:[]);const v=d?[d]:[];this.recordHistory(n,v,g)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),r}async sendMessageStream(e){var s;await this.sendPromise;const n=Xt(e.message),r=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(s=e.config)!==null&&s!==void 0?s:this.config});this.sendPromise=r.then(()=>{}).catch(()=>{});const o=await r;return this.processStreamResponse(o,n)}getHistory(e=!1){const s=e?vf(this.history):this.history;return structuredClone(s)}processStreamResponse(e,s){return ws(this,arguments,function*(){var r,o,a,l,u,d;const f=[];try{for(var p=!0,g=_s(e),v;v=yield Re(g.next()),r=v.done,!r;p=!0){l=v.value,p=!1;const A=l;if(XA(A)){const k=(d=(u=A.candidates)===null||u===void 0?void 0:u[0])===null||d===void 0?void 0:d.content;k!==void 0&&f.push(k)}yield yield Re(A)}}catch(A){o={error:A}}finally{try{!p&&!r&&(a=g.return)&&(yield Re(a.call(g)))}finally{if(o)throw o.error}}this.recordHistory(s,f)})}recordHistory(e,s,n){let r=[];s.length>0&&s.every(o=>o.role!==void 0)?r=s:r.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...vf(n)):this.history.push(e),this.history.push(...r)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Wa extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Wa.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function tR(t){const e={},s=c(t,["file"]);return s!=null&&h(e,["file"],s),e}function sR(t){const e={},s=c(t,["sdkHttpResponse"]);return s!=null&&h(e,["sdkHttpResponse"],s),e}function nR(t){const e={},s=c(t,["name"]);return s!=null&&h(e,["_url","file"],Wx(s)),e}function rR(t){const e={},s=c(t,["sdkHttpResponse"]);return s!=null&&h(e,["sdkHttpResponse"],s),e}function iR(t){const e={},s=c(t,["name"]);return s!=null&&h(e,["_url","file"],Wx(s)),e}function oR(t,e){const s={},n=c(t,["pageSize"]);e!==void 0&&n!=null&&h(e,["_query","pageSize"],n);const r=c(t,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),s}function aR(t){const e={},s=c(t,["config"]);return s!=null&&oR(s,e),e}function lR(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["nextPageToken"]);n!=null&&h(e,["nextPageToken"],n);const r=c(t,["files"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>a)),h(e,["files"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class cR extends cn{constructor(e){super(),this.apiClient=e,this.list=async(s={})=>new fr(rn.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(s),s)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(s=>s)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=aR(e);return o=me("files",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(d=>{const f=d;return f.sdkHttpResponse={headers:u.headers},f})),r.then(u=>{const d=lR(u),f=new mS;return Object.assign(f,d),f})}}async createInternal(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=tR(e);return o=me("upload/v1beta/files",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),r.then(u=>{const d=sR(u),f=new fS;return Object.assign(f,d),f})}}async get(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=iR(e);return o=me("files/{file}",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),r.then(u=>u)}}async delete(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=nR(e);return o=me("files/{file}",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(d=>{const f=d;return f.sdkHttpResponse={headers:u.headers},f})),r.then(u=>{const d=rR(u),f=new pS;return Object.assign(f,d),f})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Uo(t){const e={},s=c(t,["data"]);if(s!=null&&h(e,["data"],s),c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=c(t,["mimeType"]);return n!=null&&h(e,["mimeType"],n),e}function dR(t){const e={},s=c(t,["parts"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>IR(o))),h(e,["parts"],r)}const n=c(t,["role"]);return n!=null&&h(e,["role"],n),e}function uR(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=c(t,["fileUri"]);s!=null&&h(e,["fileUri"],s);const n=c(t,["mimeType"]);return n!=null&&h(e,["mimeType"],n),e}function hR(t){const e={},s=c(t,["id"]);s!=null&&h(e,["id"],s);const n=c(t,["args"]);n!=null&&h(e,["args"],n);const r=c(t,["name"]);if(r!=null&&h(e,["name"],r),c(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(c(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function mR(t){const e={};if(c(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const s=c(t,["description"]);s!=null&&h(e,["description"],s);const n=c(t,["name"]);n!=null&&h(e,["name"],n);const r=c(t,["parameters"]);r!=null&&h(e,["parameters"],r);const o=c(t,["parametersJsonSchema"]);o!=null&&h(e,["parametersJsonSchema"],o);const a=c(t,["response"]);a!=null&&h(e,["response"],a);const l=c(t,["responseJsonSchema"]);return l!=null&&h(e,["responseJsonSchema"],l),e}function fR(t){const e={},s=c(t,["modelSelectionConfig"]);s!=null&&h(e,["modelConfig"],s);const n=c(t,["responseJsonSchema"]);n!=null&&h(e,["responseJsonSchema"],n);const r=c(t,["audioTimestamp"]);r!=null&&h(e,["audioTimestamp"],r);const o=c(t,["candidateCount"]);o!=null&&h(e,["candidateCount"],o);const a=c(t,["enableAffectiveDialog"]);a!=null&&h(e,["enableAffectiveDialog"],a);const l=c(t,["frequencyPenalty"]);l!=null&&h(e,["frequencyPenalty"],l);const u=c(t,["logprobs"]);u!=null&&h(e,["logprobs"],u);const d=c(t,["maxOutputTokens"]);d!=null&&h(e,["maxOutputTokens"],d);const f=c(t,["mediaResolution"]);f!=null&&h(e,["mediaResolution"],f);const p=c(t,["presencePenalty"]);p!=null&&h(e,["presencePenalty"],p);const g=c(t,["responseLogprobs"]);g!=null&&h(e,["responseLogprobs"],g);const v=c(t,["responseMimeType"]);v!=null&&h(e,["responseMimeType"],v);const A=c(t,["responseModalities"]);A!=null&&h(e,["responseModalities"],A);const k=c(t,["responseSchema"]);k!=null&&h(e,["responseSchema"],k);const S=c(t,["routingConfig"]);S!=null&&h(e,["routingConfig"],S);const L=c(t,["seed"]);L!=null&&h(e,["seed"],L);const D=c(t,["speechConfig"]);D!=null&&h(e,["speechConfig"],D);const j=c(t,["stopSequences"]);j!=null&&h(e,["stopSequences"],j);const F=c(t,["temperature"]);F!=null&&h(e,["temperature"],F);const q=c(t,["thinkingConfig"]);q!=null&&h(e,["thinkingConfig"],q);const E=c(t,["topK"]);E!=null&&h(e,["topK"],E);const w=c(t,["topP"]);if(w!=null&&h(e,["topP"],w),c(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function pR(t){const e={};if(c(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const s=c(t,["enableWidget"]);return s!=null&&h(e,["enableWidget"],s),e}function gR(t){const e={};if(c(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(c(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const s=c(t,["timeRangeFilter"]);return s!=null&&h(e,["timeRangeFilter"],s),e}function xR(t,e){const s={},n=c(t,["generationConfig"]);e!==void 0&&n!=null&&h(e,["setup","generationConfig"],n);const r=c(t,["responseModalities"]);e!==void 0&&r!=null&&h(e,["setup","generationConfig","responseModalities"],r);const o=c(t,["temperature"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","temperature"],o);const a=c(t,["topP"]);e!==void 0&&a!=null&&h(e,["setup","generationConfig","topP"],a);const l=c(t,["topK"]);e!==void 0&&l!=null&&h(e,["setup","generationConfig","topK"],l);const u=c(t,["maxOutputTokens"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","maxOutputTokens"],u);const d=c(t,["mediaResolution"]);e!==void 0&&d!=null&&h(e,["setup","generationConfig","mediaResolution"],d);const f=c(t,["seed"]);e!==void 0&&f!=null&&h(e,["setup","generationConfig","seed"],f);const p=c(t,["speechConfig"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","speechConfig"],Sd(p));const g=c(t,["thinkingConfig"]);e!==void 0&&g!=null&&h(e,["setup","generationConfig","thinkingConfig"],g);const v=c(t,["enableAffectiveDialog"]);e!==void 0&&v!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],v);const A=c(t,["systemInstruction"]);e!==void 0&&A!=null&&h(e,["setup","systemInstruction"],dR(Xt(A)));const k=c(t,["tools"]);if(e!==void 0&&k!=null){let E=Jr(k);Array.isArray(E)&&(E=E.map(w=>SR(Wr(w)))),h(e,["setup","tools"],E)}const S=c(t,["sessionResumption"]);e!==void 0&&S!=null&&h(e,["setup","sessionResumption"],CR(S));const L=c(t,["inputAudioTranscription"]);e!==void 0&&L!=null&&h(e,["setup","inputAudioTranscription"],L);const D=c(t,["outputAudioTranscription"]);e!==void 0&&D!=null&&h(e,["setup","outputAudioTranscription"],D);const j=c(t,["realtimeInputConfig"]);e!==void 0&&j!=null&&h(e,["setup","realtimeInputConfig"],j);const F=c(t,["contextWindowCompression"]);e!==void 0&&F!=null&&h(e,["setup","contextWindowCompression"],F);const q=c(t,["proactivity"]);if(e!==void 0&&q!=null&&h(e,["setup","proactivity"],q),c(t,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return s}function yR(t,e){const s={},n=c(t,["generationConfig"]);e!==void 0&&n!=null&&h(e,["setup","generationConfig"],fR(n));const r=c(t,["responseModalities"]);e!==void 0&&r!=null&&h(e,["setup","generationConfig","responseModalities"],r);const o=c(t,["temperature"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","temperature"],o);const a=c(t,["topP"]);e!==void 0&&a!=null&&h(e,["setup","generationConfig","topP"],a);const l=c(t,["topK"]);e!==void 0&&l!=null&&h(e,["setup","generationConfig","topK"],l);const u=c(t,["maxOutputTokens"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","maxOutputTokens"],u);const d=c(t,["mediaResolution"]);e!==void 0&&d!=null&&h(e,["setup","generationConfig","mediaResolution"],d);const f=c(t,["seed"]);e!==void 0&&f!=null&&h(e,["setup","generationConfig","seed"],f);const p=c(t,["speechConfig"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","speechConfig"],Sd(p));const g=c(t,["thinkingConfig"]);e!==void 0&&g!=null&&h(e,["setup","generationConfig","thinkingConfig"],g);const v=c(t,["enableAffectiveDialog"]);e!==void 0&&v!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],v);const A=c(t,["systemInstruction"]);e!==void 0&&A!=null&&h(e,["setup","systemInstruction"],Xt(A));const k=c(t,["tools"]);if(e!==void 0&&k!=null){let w=Jr(k);Array.isArray(w)&&(w=w.map(b=>AR(Wr(b)))),h(e,["setup","tools"],w)}const S=c(t,["sessionResumption"]);e!==void 0&&S!=null&&h(e,["setup","sessionResumption"],S);const L=c(t,["inputAudioTranscription"]);e!==void 0&&L!=null&&h(e,["setup","inputAudioTranscription"],L);const D=c(t,["outputAudioTranscription"]);e!==void 0&&D!=null&&h(e,["setup","outputAudioTranscription"],D);const j=c(t,["realtimeInputConfig"]);e!==void 0&&j!=null&&h(e,["setup","realtimeInputConfig"],j);const F=c(t,["contextWindowCompression"]);e!==void 0&&F!=null&&h(e,["setup","contextWindowCompression"],F);const q=c(t,["proactivity"]);e!==void 0&&q!=null&&h(e,["setup","proactivity"],q);const E=c(t,["explicitVadSignal"]);return e!==void 0&&E!=null&&h(e,["setup","explicitVadSignal"],E),s}function vR(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["setup","model"],Xe(t,n));const r=c(e,["config"]);return r!=null&&h(s,["config"],xR(r,s)),s}function bR(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["setup","model"],Xe(t,n));const r=c(e,["config"]);return r!=null&&h(s,["config"],yR(r,s)),s}function wR(t){const e={},s=c(t,["musicGenerationConfig"]);return s!=null&&h(e,["musicGenerationConfig"],s),e}function _R(t){const e={},s=c(t,["weightedPrompts"]);if(s!=null){let n=s;Array.isArray(n)&&(n=n.map(r=>r)),h(e,["weightedPrompts"],n)}return e}function NR(t){const e={},s=c(t,["media"]);if(s!=null){let d=Bx(s);Array.isArray(d)&&(d=d.map(f=>Uo(f))),h(e,["mediaChunks"],d)}const n=c(t,["audio"]);n!=null&&h(e,["audio"],Uo(Gx(n)));const r=c(t,["audioStreamEnd"]);r!=null&&h(e,["audioStreamEnd"],r);const o=c(t,["video"]);o!=null&&h(e,["video"],Uo(qx(o)));const a=c(t,["text"]);a!=null&&h(e,["text"],a);const l=c(t,["activityStart"]);l!=null&&h(e,["activityStart"],l);const u=c(t,["activityEnd"]);return u!=null&&h(e,["activityEnd"],u),e}function ER(t){const e={},s=c(t,["media"]);if(s!=null){let d=Bx(s);Array.isArray(d)&&(d=d.map(f=>f)),h(e,["mediaChunks"],d)}const n=c(t,["audio"]);n!=null&&h(e,["audio"],Gx(n));const r=c(t,["audioStreamEnd"]);r!=null&&h(e,["audioStreamEnd"],r);const o=c(t,["video"]);o!=null&&h(e,["video"],qx(o));const a=c(t,["text"]);a!=null&&h(e,["text"],a);const l=c(t,["activityStart"]);l!=null&&h(e,["activityStart"],l);const u=c(t,["activityEnd"]);return u!=null&&h(e,["activityEnd"],u),e}function TR(t){const e={},s=c(t,["setupComplete"]);s!=null&&h(e,["setupComplete"],s);const n=c(t,["serverContent"]);n!=null&&h(e,["serverContent"],n);const r=c(t,["toolCall"]);r!=null&&h(e,["toolCall"],r);const o=c(t,["toolCallCancellation"]);o!=null&&h(e,["toolCallCancellation"],o);const a=c(t,["usageMetadata"]);a!=null&&h(e,["usageMetadata"],RR(a));const l=c(t,["goAway"]);l!=null&&h(e,["goAway"],l);const u=c(t,["sessionResumptionUpdate"]);u!=null&&h(e,["sessionResumptionUpdate"],u);const d=c(t,["voiceActivityDetectionSignal"]);return d!=null&&h(e,["voiceActivityDetectionSignal"],d),e}function IR(t){const e={},s=c(t,["mediaResolution"]);s!=null&&h(e,["mediaResolution"],s);const n=c(t,["codeExecutionResult"]);n!=null&&h(e,["codeExecutionResult"],n);const r=c(t,["executableCode"]);r!=null&&h(e,["executableCode"],r);const o=c(t,["fileData"]);o!=null&&h(e,["fileData"],uR(o));const a=c(t,["functionCall"]);a!=null&&h(e,["functionCall"],hR(a));const l=c(t,["functionResponse"]);l!=null&&h(e,["functionResponse"],l);const u=c(t,["inlineData"]);u!=null&&h(e,["inlineData"],Uo(u));const d=c(t,["text"]);d!=null&&h(e,["text"],d);const f=c(t,["thought"]);f!=null&&h(e,["thought"],f);const p=c(t,["thoughtSignature"]);p!=null&&h(e,["thoughtSignature"],p);const g=c(t,["videoMetadata"]);return g!=null&&h(e,["videoMetadata"],g),e}function CR(t){const e={},s=c(t,["handle"]);if(s!=null&&h(e,["handle"],s),c(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function SR(t){const e={},s=c(t,["functionDeclarations"]);if(s!=null){let f=s;Array.isArray(f)&&(f=f.map(p=>p)),h(e,["functionDeclarations"],f)}if(c(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=c(t,["googleSearchRetrieval"]);n!=null&&h(e,["googleSearchRetrieval"],n);const r=c(t,["computerUse"]);r!=null&&h(e,["computerUse"],r);const o=c(t,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);const a=c(t,["codeExecution"]);if(a!=null&&h(e,["codeExecution"],a),c(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=c(t,["googleMaps"]);l!=null&&h(e,["googleMaps"],pR(l));const u=c(t,["googleSearch"]);u!=null&&h(e,["googleSearch"],gR(u));const d=c(t,["urlContext"]);return d!=null&&h(e,["urlContext"],d),e}function AR(t){const e={},s=c(t,["functionDeclarations"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(g=>mR(g))),h(e,["functionDeclarations"],p)}const n=c(t,["retrieval"]);n!=null&&h(e,["retrieval"],n);const r=c(t,["googleSearchRetrieval"]);r!=null&&h(e,["googleSearchRetrieval"],r);const o=c(t,["computerUse"]);if(o!=null&&h(e,["computerUse"],o),c(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const a=c(t,["codeExecution"]);a!=null&&h(e,["codeExecution"],a);const l=c(t,["enterpriseWebSearch"]);l!=null&&h(e,["enterpriseWebSearch"],l);const u=c(t,["googleMaps"]);u!=null&&h(e,["googleMaps"],u);const d=c(t,["googleSearch"]);d!=null&&h(e,["googleSearch"],d);const f=c(t,["urlContext"]);return f!=null&&h(e,["urlContext"],f),e}function RR(t){const e={},s=c(t,["promptTokenCount"]);s!=null&&h(e,["promptTokenCount"],s);const n=c(t,["cachedContentTokenCount"]);n!=null&&h(e,["cachedContentTokenCount"],n);const r=c(t,["candidatesTokenCount"]);r!=null&&h(e,["responseTokenCount"],r);const o=c(t,["toolUsePromptTokenCount"]);o!=null&&h(e,["toolUsePromptTokenCount"],o);const a=c(t,["thoughtsTokenCount"]);a!=null&&h(e,["thoughtsTokenCount"],a);const l=c(t,["totalTokenCount"]);l!=null&&h(e,["totalTokenCount"],l);const u=c(t,["promptTokensDetails"]);if(u!=null){let v=u;Array.isArray(v)&&(v=v.map(A=>A)),h(e,["promptTokensDetails"],v)}const d=c(t,["cacheTokensDetails"]);if(d!=null){let v=d;Array.isArray(v)&&(v=v.map(A=>A)),h(e,["cacheTokensDetails"],v)}const f=c(t,["candidatesTokensDetails"]);if(f!=null){let v=f;Array.isArray(v)&&(v=v.map(A=>A)),h(e,["responseTokensDetails"],v)}const p=c(t,["toolUsePromptTokensDetails"]);if(p!=null){let v=p;Array.isArray(v)&&(v=v.map(A=>A)),h(e,["toolUsePromptTokensDetails"],v)}const g=c(t,["trafficType"]);return g!=null&&h(e,["trafficType"],g),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function PR(t){const e={},s=c(t,["data"]);if(s!=null&&h(e,["data"],s),c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=c(t,["mimeType"]);return n!=null&&h(e,["mimeType"],n),e}function jR(t){const e={},s=c(t,["content"]);s!=null&&h(e,["content"],s);const n=c(t,["citationMetadata"]);n!=null&&h(e,["citationMetadata"],kR(n));const r=c(t,["tokenCount"]);r!=null&&h(e,["tokenCount"],r);const o=c(t,["finishReason"]);o!=null&&h(e,["finishReason"],o);const a=c(t,["avgLogprobs"]);a!=null&&h(e,["avgLogprobs"],a);const l=c(t,["groundingMetadata"]);l!=null&&h(e,["groundingMetadata"],l);const u=c(t,["index"]);u!=null&&h(e,["index"],u);const d=c(t,["logprobsResult"]);d!=null&&h(e,["logprobsResult"],d);const f=c(t,["safetyRatings"]);if(f!=null){let g=f;Array.isArray(g)&&(g=g.map(v=>v)),h(e,["safetyRatings"],g)}const p=c(t,["urlContextMetadata"]);return p!=null&&h(e,["urlContextMetadata"],p),e}function kR(t){const e={},s=c(t,["citationSources"]);if(s!=null){let n=s;Array.isArray(n)&&(n=n.map(r=>r)),h(e,["citations"],n)}return e}function DR(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["_url","model"],Xe(t,n));const r=c(e,["contents"]);if(r!=null){let o=gs(r);Array.isArray(o)&&(o=o.map(a=>a)),h(s,["contents"],o)}return s}function MR(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["tokensInfo"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),h(e,["tokensInfo"],r)}return e}function LR(t){const e={},s=c(t,["values"]);s!=null&&h(e,["values"],s);const n=c(t,["statistics"]);return n!=null&&h(e,["statistics"],VR(n)),e}function VR(t){const e={},s=c(t,["truncated"]);s!=null&&h(e,["truncated"],s);const n=c(t,["token_count"]);return n!=null&&h(e,["tokenCount"],n),e}function Ja(t){const e={},s=c(t,["parts"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>H1(o))),h(e,["parts"],r)}const n=c(t,["role"]);return n!=null&&h(e,["role"],n),e}function UR(t){const e={},s=c(t,["controlType"]);s!=null&&h(e,["controlType"],s);const n=c(t,["enableControlImageComputation"]);return n!=null&&h(e,["computeControl"],n),e}function FR(t){const e={};if(c(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(c(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(c(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function OR(t,e){const s={},n=c(t,["systemInstruction"]);e!==void 0&&n!=null&&h(e,["systemInstruction"],Xt(n));const r=c(t,["tools"]);if(e!==void 0&&r!=null){let a=r;Array.isArray(a)&&(a=a.map(l=>r0(l))),h(e,["tools"],a)}const o=c(t,["generationConfig"]);return e!==void 0&&o!=null&&h(e,["generationConfig"],P1(o)),s}function zR(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["_url","model"],Xe(t,n));const r=c(e,["contents"]);if(r!=null){let a=gs(r);Array.isArray(a)&&(a=a.map(l=>Ja(l))),h(s,["contents"],a)}const o=c(e,["config"]);return o!=null&&FR(o),s}function BR(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["_url","model"],Xe(t,n));const r=c(e,["contents"]);if(r!=null){let a=gs(r);Array.isArray(a)&&(a=a.map(l=>l)),h(s,["contents"],a)}const o=c(e,["config"]);return o!=null&&OR(o,s),s}function qR(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["totalTokens"]);n!=null&&h(e,["totalTokens"],n);const r=c(t,["cachedContentTokenCount"]);return r!=null&&h(e,["cachedContentTokenCount"],r),e}function GR(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["totalTokens"]);return n!=null&&h(e,["totalTokens"],n),e}function $R(t,e){const s={},n=c(e,["model"]);return n!=null&&h(s,["_url","name"],Xe(t,n)),s}function HR(t,e){const s={},n=c(e,["model"]);return n!=null&&h(s,["_url","name"],Xe(t,n)),s}function WR(t){const e={},s=c(t,["sdkHttpResponse"]);return s!=null&&h(e,["sdkHttpResponse"],s),e}function JR(t){const e={},s=c(t,["sdkHttpResponse"]);return s!=null&&h(e,["sdkHttpResponse"],s),e}function KR(t,e){const s={},n=c(t,["outputGcsUri"]);e!==void 0&&n!=null&&h(e,["parameters","storageUri"],n);const r=c(t,["negativePrompt"]);e!==void 0&&r!=null&&h(e,["parameters","negativePrompt"],r);const o=c(t,["numberOfImages"]);e!==void 0&&o!=null&&h(e,["parameters","sampleCount"],o);const a=c(t,["aspectRatio"]);e!==void 0&&a!=null&&h(e,["parameters","aspectRatio"],a);const l=c(t,["guidanceScale"]);e!==void 0&&l!=null&&h(e,["parameters","guidanceScale"],l);const u=c(t,["seed"]);e!==void 0&&u!=null&&h(e,["parameters","seed"],u);const d=c(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&h(e,["parameters","safetySetting"],d);const f=c(t,["personGeneration"]);e!==void 0&&f!=null&&h(e,["parameters","personGeneration"],f);const p=c(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&h(e,["parameters","includeSafetyAttributes"],p);const g=c(t,["includeRaiReason"]);e!==void 0&&g!=null&&h(e,["parameters","includeRaiReason"],g);const v=c(t,["language"]);e!==void 0&&v!=null&&h(e,["parameters","language"],v);const A=c(t,["outputMimeType"]);e!==void 0&&A!=null&&h(e,["parameters","outputOptions","mimeType"],A);const k=c(t,["outputCompressionQuality"]);e!==void 0&&k!=null&&h(e,["parameters","outputOptions","compressionQuality"],k);const S=c(t,["addWatermark"]);e!==void 0&&S!=null&&h(e,["parameters","addWatermark"],S);const L=c(t,["labels"]);e!==void 0&&L!=null&&h(e,["labels"],L);const D=c(t,["editMode"]);e!==void 0&&D!=null&&h(e,["parameters","editMode"],D);const j=c(t,["baseSteps"]);return e!==void 0&&j!=null&&h(e,["parameters","editConfig","baseSteps"],j),s}function YR(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["_url","model"],Xe(t,n));const r=c(e,["prompt"]);r!=null&&h(s,["instances[0]","prompt"],r);const o=c(e,["referenceImages"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(u=>Q1(u))),h(s,["instances[0]","referenceImages"],l)}const a=c(e,["config"]);return a!=null&&KR(a,s),s}function XR(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>Ka(o))),h(e,["generatedImages"],r)}return e}function QR(t,e){const s={},n=c(t,["taskType"]);e!==void 0&&n!=null&&h(e,["requests[]","taskType"],n);const r=c(t,["title"]);e!==void 0&&r!=null&&h(e,["requests[]","title"],r);const o=c(t,["outputDimensionality"]);if(e!==void 0&&o!=null&&h(e,["requests[]","outputDimensionality"],o),c(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(c(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return s}function ZR(t,e){const s={},n=c(t,["taskType"]);e!==void 0&&n!=null&&h(e,["instances[]","task_type"],n);const r=c(t,["title"]);e!==void 0&&r!=null&&h(e,["instances[]","title"],r);const o=c(t,["outputDimensionality"]);e!==void 0&&o!=null&&h(e,["parameters","outputDimensionality"],o);const a=c(t,["mimeType"]);e!==void 0&&a!=null&&h(e,["instances[]","mimeType"],a);const l=c(t,["autoTruncate"]);return e!==void 0&&l!=null&&h(e,["parameters","autoTruncate"],l),s}function e1(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["_url","model"],Xe(t,n));const r=c(e,["contents"]);if(r!=null){let l=Td(t,r);Array.isArray(l)&&(l=l.map(u=>u)),h(s,["requests[]","content"],l)}const o=c(e,["config"]);o!=null&&QR(o,s);const a=c(e,["model"]);return a!==void 0&&h(s,["requests[]","model"],Xe(t,a)),s}function t1(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["_url","model"],Xe(t,n));const r=c(e,["contents"]);if(r!=null){let a=Td(t,r);Array.isArray(a)&&(a=a.map(l=>l)),h(s,["instances[]","content"],a)}const o=c(e,["config"]);return o!=null&&ZR(o,s),s}function s1(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["embeddings"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>a)),h(e,["embeddings"],o)}const r=c(t,["metadata"]);return r!=null&&h(e,["metadata"],r),e}function n1(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["predictions[]","embeddings"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>LR(a))),h(e,["embeddings"],o)}const r=c(t,["metadata"]);return r!=null&&h(e,["metadata"],r),e}function r1(t){const e={},s=c(t,["endpoint"]);s!=null&&h(e,["name"],s);const n=c(t,["deployedModelId"]);return n!=null&&h(e,["deployedModelId"],n),e}function i1(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=c(t,["fileUri"]);s!=null&&h(e,["fileUri"],s);const n=c(t,["mimeType"]);return n!=null&&h(e,["mimeType"],n),e}function o1(t){const e={},s=c(t,["id"]);s!=null&&h(e,["id"],s);const n=c(t,["args"]);n!=null&&h(e,["args"],n);const r=c(t,["name"]);if(r!=null&&h(e,["name"],r),c(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(c(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function a1(t){const e={},s=c(t,["mode"]);s!=null&&h(e,["mode"],s);const n=c(t,["allowedFunctionNames"]);if(n!=null&&h(e,["allowedFunctionNames"],n),c(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function l1(t){const e={};if(c(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const s=c(t,["description"]);s!=null&&h(e,["description"],s);const n=c(t,["name"]);n!=null&&h(e,["name"],n);const r=c(t,["parameters"]);r!=null&&h(e,["parameters"],r);const o=c(t,["parametersJsonSchema"]);o!=null&&h(e,["parametersJsonSchema"],o);const a=c(t,["response"]);a!=null&&h(e,["response"],a);const l=c(t,["responseJsonSchema"]);return l!=null&&h(e,["responseJsonSchema"],l),e}function c1(t,e,s){const n={},r=c(e,["systemInstruction"]);s!==void 0&&r!=null&&h(s,["systemInstruction"],Ja(Xt(r)));const o=c(e,["temperature"]);o!=null&&h(n,["temperature"],o);const a=c(e,["topP"]);a!=null&&h(n,["topP"],a);const l=c(e,["topK"]);l!=null&&h(n,["topK"],l);const u=c(e,["candidateCount"]);u!=null&&h(n,["candidateCount"],u);const d=c(e,["maxOutputTokens"]);d!=null&&h(n,["maxOutputTokens"],d);const f=c(e,["stopSequences"]);f!=null&&h(n,["stopSequences"],f);const p=c(e,["responseLogprobs"]);p!=null&&h(n,["responseLogprobs"],p);const g=c(e,["logprobs"]);g!=null&&h(n,["logprobs"],g);const v=c(e,["presencePenalty"]);v!=null&&h(n,["presencePenalty"],v);const A=c(e,["frequencyPenalty"]);A!=null&&h(n,["frequencyPenalty"],A);const k=c(e,["seed"]);k!=null&&h(n,["seed"],k);const S=c(e,["responseMimeType"]);S!=null&&h(n,["responseMimeType"],S);const L=c(e,["responseSchema"]);L!=null&&h(n,["responseSchema"],Id(L));const D=c(e,["responseJsonSchema"]);if(D!=null&&h(n,["responseJsonSchema"],D),c(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(c(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const j=c(e,["safetySettings"]);if(s!==void 0&&j!=null){let C=j;Array.isArray(C)&&(C=C.map(ge=>Z1(ge))),h(s,["safetySettings"],C)}const F=c(e,["tools"]);if(s!==void 0&&F!=null){let C=Jr(F);Array.isArray(C)&&(C=C.map(ge=>oP(Wr(ge)))),h(s,["tools"],C)}const q=c(e,["toolConfig"]);if(s!==void 0&&q!=null&&h(s,["toolConfig"],iP(q)),c(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const E=c(e,["cachedContent"]);s!==void 0&&E!=null&&h(s,["cachedContent"],dn(t,E));const w=c(e,["responseModalities"]);w!=null&&h(n,["responseModalities"],w);const b=c(e,["mediaResolution"]);b!=null&&h(n,["mediaResolution"],b);const _=c(e,["speechConfig"]);if(_!=null&&h(n,["speechConfig"],Cd(_)),c(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const T=c(e,["thinkingConfig"]);T!=null&&h(n,["thinkingConfig"],T);const R=c(e,["imageConfig"]);R!=null&&h(n,["imageConfig"],L1(R));const M=c(e,["enableEnhancedCivicAnswers"]);return M!=null&&h(n,["enableEnhancedCivicAnswers"],M),n}function d1(t,e,s){const n={},r=c(e,["systemInstruction"]);s!==void 0&&r!=null&&h(s,["systemInstruction"],Xt(r));const o=c(e,["temperature"]);o!=null&&h(n,["temperature"],o);const a=c(e,["topP"]);a!=null&&h(n,["topP"],a);const l=c(e,["topK"]);l!=null&&h(n,["topK"],l);const u=c(e,["candidateCount"]);u!=null&&h(n,["candidateCount"],u);const d=c(e,["maxOutputTokens"]);d!=null&&h(n,["maxOutputTokens"],d);const f=c(e,["stopSequences"]);f!=null&&h(n,["stopSequences"],f);const p=c(e,["responseLogprobs"]);p!=null&&h(n,["responseLogprobs"],p);const g=c(e,["logprobs"]);g!=null&&h(n,["logprobs"],g);const v=c(e,["presencePenalty"]);v!=null&&h(n,["presencePenalty"],v);const A=c(e,["frequencyPenalty"]);A!=null&&h(n,["frequencyPenalty"],A);const k=c(e,["seed"]);k!=null&&h(n,["seed"],k);const S=c(e,["responseMimeType"]);S!=null&&h(n,["responseMimeType"],S);const L=c(e,["responseSchema"]);L!=null&&h(n,["responseSchema"],Id(L));const D=c(e,["responseJsonSchema"]);D!=null&&h(n,["responseJsonSchema"],D);const j=c(e,["routingConfig"]);j!=null&&h(n,["routingConfig"],j);const F=c(e,["modelSelectionConfig"]);F!=null&&h(n,["modelConfig"],F);const q=c(e,["safetySettings"]);if(s!==void 0&&q!=null){let P=q;Array.isArray(P)&&(P=P.map(Z=>Z)),h(s,["safetySettings"],P)}const E=c(e,["tools"]);if(s!==void 0&&E!=null){let P=Jr(E);Array.isArray(P)&&(P=P.map(Z=>r0(Wr(Z)))),h(s,["tools"],P)}const w=c(e,["toolConfig"]);s!==void 0&&w!=null&&h(s,["toolConfig"],w);const b=c(e,["labels"]);s!==void 0&&b!=null&&h(s,["labels"],b);const _=c(e,["cachedContent"]);s!==void 0&&_!=null&&h(s,["cachedContent"],dn(t,_));const T=c(e,["responseModalities"]);T!=null&&h(n,["responseModalities"],T);const R=c(e,["mediaResolution"]);R!=null&&h(n,["mediaResolution"],R);const M=c(e,["speechConfig"]);M!=null&&h(n,["speechConfig"],Cd(M));const C=c(e,["audioTimestamp"]);C!=null&&h(n,["audioTimestamp"],C);const ge=c(e,["thinkingConfig"]);ge!=null&&h(n,["thinkingConfig"],ge);const _e=c(e,["imageConfig"]);if(_e!=null&&h(n,["imageConfig"],V1(_e)),c(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}function bf(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["_url","model"],Xe(t,n));const r=c(e,["contents"]);if(r!=null){let a=gs(r);Array.isArray(a)&&(a=a.map(l=>Ja(l))),h(s,["contents"],a)}const o=c(e,["config"]);return o!=null&&h(s,["generationConfig"],c1(t,o,s)),s}function wf(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["_url","model"],Xe(t,n));const r=c(e,["contents"]);if(r!=null){let a=gs(r);Array.isArray(a)&&(a=a.map(l=>l)),h(s,["contents"],a)}const o=c(e,["config"]);return o!=null&&h(s,["generationConfig"],d1(t,o,s)),s}function _f(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["candidates"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(d=>jR(d))),h(e,["candidates"],u)}const r=c(t,["modelVersion"]);r!=null&&h(e,["modelVersion"],r);const o=c(t,["promptFeedback"]);o!=null&&h(e,["promptFeedback"],o);const a=c(t,["responseId"]);a!=null&&h(e,["responseId"],a);const l=c(t,["usageMetadata"]);return l!=null&&h(e,["usageMetadata"],l),e}function Nf(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["candidates"]);if(n!=null){let d=n;Array.isArray(d)&&(d=d.map(f=>f)),h(e,["candidates"],d)}const r=c(t,["createTime"]);r!=null&&h(e,["createTime"],r);const o=c(t,["modelVersion"]);o!=null&&h(e,["modelVersion"],o);const a=c(t,["promptFeedback"]);a!=null&&h(e,["promptFeedback"],a);const l=c(t,["responseId"]);l!=null&&h(e,["responseId"],l);const u=c(t,["usageMetadata"]);return u!=null&&h(e,["usageMetadata"],u),e}function u1(t,e){const s={};if(c(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(c(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const n=c(t,["numberOfImages"]);e!==void 0&&n!=null&&h(e,["parameters","sampleCount"],n);const r=c(t,["aspectRatio"]);e!==void 0&&r!=null&&h(e,["parameters","aspectRatio"],r);const o=c(t,["guidanceScale"]);if(e!==void 0&&o!=null&&h(e,["parameters","guidanceScale"],o),c(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const a=c(t,["safetyFilterLevel"]);e!==void 0&&a!=null&&h(e,["parameters","safetySetting"],a);const l=c(t,["personGeneration"]);e!==void 0&&l!=null&&h(e,["parameters","personGeneration"],l);const u=c(t,["includeSafetyAttributes"]);e!==void 0&&u!=null&&h(e,["parameters","includeSafetyAttributes"],u);const d=c(t,["includeRaiReason"]);e!==void 0&&d!=null&&h(e,["parameters","includeRaiReason"],d);const f=c(t,["language"]);e!==void 0&&f!=null&&h(e,["parameters","language"],f);const p=c(t,["outputMimeType"]);e!==void 0&&p!=null&&h(e,["parameters","outputOptions","mimeType"],p);const g=c(t,["outputCompressionQuality"]);if(e!==void 0&&g!=null&&h(e,["parameters","outputOptions","compressionQuality"],g),c(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(c(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const v=c(t,["imageSize"]);if(e!==void 0&&v!=null&&h(e,["parameters","sampleImageSize"],v),c(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return s}function h1(t,e){const s={},n=c(t,["outputGcsUri"]);e!==void 0&&n!=null&&h(e,["parameters","storageUri"],n);const r=c(t,["negativePrompt"]);e!==void 0&&r!=null&&h(e,["parameters","negativePrompt"],r);const o=c(t,["numberOfImages"]);e!==void 0&&o!=null&&h(e,["parameters","sampleCount"],o);const a=c(t,["aspectRatio"]);e!==void 0&&a!=null&&h(e,["parameters","aspectRatio"],a);const l=c(t,["guidanceScale"]);e!==void 0&&l!=null&&h(e,["parameters","guidanceScale"],l);const u=c(t,["seed"]);e!==void 0&&u!=null&&h(e,["parameters","seed"],u);const d=c(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&h(e,["parameters","safetySetting"],d);const f=c(t,["personGeneration"]);e!==void 0&&f!=null&&h(e,["parameters","personGeneration"],f);const p=c(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&h(e,["parameters","includeSafetyAttributes"],p);const g=c(t,["includeRaiReason"]);e!==void 0&&g!=null&&h(e,["parameters","includeRaiReason"],g);const v=c(t,["language"]);e!==void 0&&v!=null&&h(e,["parameters","language"],v);const A=c(t,["outputMimeType"]);e!==void 0&&A!=null&&h(e,["parameters","outputOptions","mimeType"],A);const k=c(t,["outputCompressionQuality"]);e!==void 0&&k!=null&&h(e,["parameters","outputOptions","compressionQuality"],k);const S=c(t,["addWatermark"]);e!==void 0&&S!=null&&h(e,["parameters","addWatermark"],S);const L=c(t,["labels"]);e!==void 0&&L!=null&&h(e,["labels"],L);const D=c(t,["imageSize"]);e!==void 0&&D!=null&&h(e,["parameters","sampleImageSize"],D);const j=c(t,["enhancePrompt"]);return e!==void 0&&j!=null&&h(e,["parameters","enhancePrompt"],j),s}function m1(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["_url","model"],Xe(t,n));const r=c(e,["prompt"]);r!=null&&h(s,["instances[0]","prompt"],r);const o=c(e,["config"]);return o!=null&&u1(o,s),s}function f1(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["_url","model"],Xe(t,n));const r=c(e,["prompt"]);r!=null&&h(s,["instances[0]","prompt"],r);const o=c(e,["config"]);return o!=null&&h1(o,s),s}function p1(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>C1(a))),h(e,["generatedImages"],o)}const r=c(t,["positivePromptSafetyAttributes"]);return r!=null&&h(e,["positivePromptSafetyAttributes"],s0(r)),e}function g1(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>Ka(a))),h(e,["generatedImages"],o)}const r=c(t,["positivePromptSafetyAttributes"]);return r!=null&&h(e,["positivePromptSafetyAttributes"],n0(r)),e}function x1(t,e){const s={},n=c(t,["numberOfVideos"]);if(e!==void 0&&n!=null&&h(e,["parameters","sampleCount"],n),c(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(c(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const r=c(t,["durationSeconds"]);if(e!==void 0&&r!=null&&h(e,["parameters","durationSeconds"],r),c(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=c(t,["aspectRatio"]);e!==void 0&&o!=null&&h(e,["parameters","aspectRatio"],o);const a=c(t,["resolution"]);e!==void 0&&a!=null&&h(e,["parameters","resolution"],a);const l=c(t,["personGeneration"]);if(e!==void 0&&l!=null&&h(e,["parameters","personGeneration"],l),c(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const u=c(t,["negativePrompt"]);e!==void 0&&u!=null&&h(e,["parameters","negativePrompt"],u);const d=c(t,["enhancePrompt"]);if(e!==void 0&&d!=null&&h(e,["parameters","enhancePrompt"],d),c(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const f=c(t,["lastFrame"]);e!==void 0&&f!=null&&h(e,["instances[0]","lastFrame"],Ya(f));const p=c(t,["referenceImages"]);if(e!==void 0&&p!=null){let g=p;Array.isArray(g)&&(g=g.map(v=>vP(v))),h(e,["instances[0]","referenceImages"],g)}if(c(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(c(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return s}function y1(t,e){const s={},n=c(t,["numberOfVideos"]);e!==void 0&&n!=null&&h(e,["parameters","sampleCount"],n);const r=c(t,["outputGcsUri"]);e!==void 0&&r!=null&&h(e,["parameters","storageUri"],r);const o=c(t,["fps"]);e!==void 0&&o!=null&&h(e,["parameters","fps"],o);const a=c(t,["durationSeconds"]);e!==void 0&&a!=null&&h(e,["parameters","durationSeconds"],a);const l=c(t,["seed"]);e!==void 0&&l!=null&&h(e,["parameters","seed"],l);const u=c(t,["aspectRatio"]);e!==void 0&&u!=null&&h(e,["parameters","aspectRatio"],u);const d=c(t,["resolution"]);e!==void 0&&d!=null&&h(e,["parameters","resolution"],d);const f=c(t,["personGeneration"]);e!==void 0&&f!=null&&h(e,["parameters","personGeneration"],f);const p=c(t,["pubsubTopic"]);e!==void 0&&p!=null&&h(e,["parameters","pubsubTopic"],p);const g=c(t,["negativePrompt"]);e!==void 0&&g!=null&&h(e,["parameters","negativePrompt"],g);const v=c(t,["enhancePrompt"]);e!==void 0&&v!=null&&h(e,["parameters","enhancePrompt"],v);const A=c(t,["generateAudio"]);e!==void 0&&A!=null&&h(e,["parameters","generateAudio"],A);const k=c(t,["lastFrame"]);e!==void 0&&k!=null&&h(e,["instances[0]","lastFrame"],Ts(k));const S=c(t,["referenceImages"]);if(e!==void 0&&S!=null){let j=S;Array.isArray(j)&&(j=j.map(F=>bP(F))),h(e,["instances[0]","referenceImages"],j)}const L=c(t,["mask"]);e!==void 0&&L!=null&&h(e,["instances[0]","mask"],yP(L));const D=c(t,["compressionQuality"]);return e!==void 0&&D!=null&&h(e,["parameters","compressionQuality"],D),s}function v1(t){const e={},s=c(t,["name"]);s!=null&&h(e,["name"],s);const n=c(t,["metadata"]);n!=null&&h(e,["metadata"],n);const r=c(t,["done"]);r!=null&&h(e,["done"],r);const o=c(t,["error"]);o!=null&&h(e,["error"],o);const a=c(t,["response","generateVideoResponse"]);return a!=null&&h(e,["response"],N1(a)),e}function b1(t){const e={},s=c(t,["name"]);s!=null&&h(e,["name"],s);const n=c(t,["metadata"]);n!=null&&h(e,["metadata"],n);const r=c(t,["done"]);r!=null&&h(e,["done"],r);const o=c(t,["error"]);o!=null&&h(e,["error"],o);const a=c(t,["response"]);return a!=null&&h(e,["response"],E1(a)),e}function w1(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["_url","model"],Xe(t,n));const r=c(e,["prompt"]);r!=null&&h(s,["instances[0]","prompt"],r);const o=c(e,["image"]);o!=null&&h(s,["instances[0]","image"],Ya(o));const a=c(e,["video"]);a!=null&&h(s,["instances[0]","video"],i0(a));const l=c(e,["source"]);l!=null&&T1(l,s);const u=c(e,["config"]);return u!=null&&x1(u,s),s}function _1(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["_url","model"],Xe(t,n));const r=c(e,["prompt"]);r!=null&&h(s,["instances[0]","prompt"],r);const o=c(e,["image"]);o!=null&&h(s,["instances[0]","image"],Ts(o));const a=c(e,["video"]);a!=null&&h(s,["instances[0]","video"],o0(a));const l=c(e,["source"]);l!=null&&I1(l,s);const u=c(e,["config"]);return u!=null&&y1(u,s),s}function N1(t){const e={},s=c(t,["generatedSamples"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(a=>A1(a))),h(e,["generatedVideos"],o)}const n=c(t,["raiMediaFilteredCount"]);n!=null&&h(e,["raiMediaFilteredCount"],n);const r=c(t,["raiMediaFilteredReasons"]);return r!=null&&h(e,["raiMediaFilteredReasons"],r),e}function E1(t){const e={},s=c(t,["videos"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(a=>R1(a))),h(e,["generatedVideos"],o)}const n=c(t,["raiMediaFilteredCount"]);n!=null&&h(e,["raiMediaFilteredCount"],n);const r=c(t,["raiMediaFilteredReasons"]);return r!=null&&h(e,["raiMediaFilteredReasons"],r),e}function T1(t,e){const s={},n=c(t,["prompt"]);e!==void 0&&n!=null&&h(e,["instances[0]","prompt"],n);const r=c(t,["image"]);e!==void 0&&r!=null&&h(e,["instances[0]","image"],Ya(r));const o=c(t,["video"]);return e!==void 0&&o!=null&&h(e,["instances[0]","video"],i0(o)),s}function I1(t,e){const s={},n=c(t,["prompt"]);e!==void 0&&n!=null&&h(e,["instances[0]","prompt"],n);const r=c(t,["image"]);e!==void 0&&r!=null&&h(e,["instances[0]","image"],Ts(r));const o=c(t,["video"]);return e!==void 0&&o!=null&&h(e,["instances[0]","video"],o0(o)),s}function C1(t){const e={},s=c(t,["_self"]);s!=null&&h(e,["image"],U1(s));const n=c(t,["raiFilteredReason"]);n!=null&&h(e,["raiFilteredReason"],n);const r=c(t,["_self"]);return r!=null&&h(e,["safetyAttributes"],s0(r)),e}function Ka(t){const e={},s=c(t,["_self"]);s!=null&&h(e,["image"],t0(s));const n=c(t,["raiFilteredReason"]);n!=null&&h(e,["raiFilteredReason"],n);const r=c(t,["_self"]);r!=null&&h(e,["safetyAttributes"],n0(r));const o=c(t,["prompt"]);return o!=null&&h(e,["enhancedPrompt"],o),e}function S1(t){const e={},s=c(t,["_self"]);s!=null&&h(e,["mask"],t0(s));const n=c(t,["labels"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),h(e,["labels"],r)}return e}function A1(t){const e={},s=c(t,["video"]);return s!=null&&h(e,["video"],gP(s)),e}function R1(t){const e={},s=c(t,["_self"]);return s!=null&&h(e,["video"],xP(s)),e}function P1(t){const e={},s=c(t,["modelSelectionConfig"]);s!=null&&h(e,["modelConfig"],s);const n=c(t,["responseJsonSchema"]);n!=null&&h(e,["responseJsonSchema"],n);const r=c(t,["audioTimestamp"]);r!=null&&h(e,["audioTimestamp"],r);const o=c(t,["candidateCount"]);o!=null&&h(e,["candidateCount"],o);const a=c(t,["enableAffectiveDialog"]);a!=null&&h(e,["enableAffectiveDialog"],a);const l=c(t,["frequencyPenalty"]);l!=null&&h(e,["frequencyPenalty"],l);const u=c(t,["logprobs"]);u!=null&&h(e,["logprobs"],u);const d=c(t,["maxOutputTokens"]);d!=null&&h(e,["maxOutputTokens"],d);const f=c(t,["mediaResolution"]);f!=null&&h(e,["mediaResolution"],f);const p=c(t,["presencePenalty"]);p!=null&&h(e,["presencePenalty"],p);const g=c(t,["responseLogprobs"]);g!=null&&h(e,["responseLogprobs"],g);const v=c(t,["responseMimeType"]);v!=null&&h(e,["responseMimeType"],v);const A=c(t,["responseModalities"]);A!=null&&h(e,["responseModalities"],A);const k=c(t,["responseSchema"]);k!=null&&h(e,["responseSchema"],k);const S=c(t,["routingConfig"]);S!=null&&h(e,["routingConfig"],S);const L=c(t,["seed"]);L!=null&&h(e,["seed"],L);const D=c(t,["speechConfig"]);D!=null&&h(e,["speechConfig"],D);const j=c(t,["stopSequences"]);j!=null&&h(e,["stopSequences"],j);const F=c(t,["temperature"]);F!=null&&h(e,["temperature"],F);const q=c(t,["thinkingConfig"]);q!=null&&h(e,["thinkingConfig"],q);const E=c(t,["topK"]);E!=null&&h(e,["topK"],E);const w=c(t,["topP"]);if(w!=null&&h(e,["topP"],w),c(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function j1(t,e){const s={},n=c(e,["model"]);return n!=null&&h(s,["_url","name"],Xe(t,n)),s}function k1(t,e){const s={},n=c(e,["model"]);return n!=null&&h(s,["_url","name"],Xe(t,n)),s}function D1(t){const e={};if(c(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const s=c(t,["enableWidget"]);return s!=null&&h(e,["enableWidget"],s),e}function M1(t){const e={};if(c(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(c(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const s=c(t,["timeRangeFilter"]);return s!=null&&h(e,["timeRangeFilter"],s),e}function L1(t){const e={},s=c(t,["aspectRatio"]);s!=null&&h(e,["aspectRatio"],s);const n=c(t,["imageSize"]);if(n!=null&&h(e,["imageSize"],n),c(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(c(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function V1(t){const e={},s=c(t,["aspectRatio"]);s!=null&&h(e,["aspectRatio"],s);const n=c(t,["imageSize"]);n!=null&&h(e,["imageSize"],n);const r=c(t,["outputMimeType"]);r!=null&&h(e,["imageOutputOptions","mimeType"],r);const o=c(t,["outputCompressionQuality"]);return o!=null&&h(e,["imageOutputOptions","compressionQuality"],o),e}function U1(t){const e={},s=c(t,["bytesBase64Encoded"]);s!=null&&h(e,["imageBytes"],On(s));const n=c(t,["mimeType"]);return n!=null&&h(e,["mimeType"],n),e}function t0(t){const e={},s=c(t,["gcsUri"]);s!=null&&h(e,["gcsUri"],s);const n=c(t,["bytesBase64Encoded"]);n!=null&&h(e,["imageBytes"],On(n));const r=c(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function Ya(t){const e={};if(c(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const s=c(t,["imageBytes"]);s!=null&&h(e,["bytesBase64Encoded"],On(s));const n=c(t,["mimeType"]);return n!=null&&h(e,["mimeType"],n),e}function Ts(t){const e={},s=c(t,["gcsUri"]);s!=null&&h(e,["gcsUri"],s);const n=c(t,["imageBytes"]);n!=null&&h(e,["bytesBase64Encoded"],On(n));const r=c(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function F1(t,e,s){const n={},r=c(e,["pageSize"]);s!==void 0&&r!=null&&h(s,["_query","pageSize"],r);const o=c(e,["pageToken"]);s!==void 0&&o!=null&&h(s,["_query","pageToken"],o);const a=c(e,["filter"]);s!==void 0&&a!=null&&h(s,["_query","filter"],a);const l=c(e,["queryBase"]);return s!==void 0&&l!=null&&h(s,["_url","models_url"],Jx(t,l)),n}function O1(t,e,s){const n={},r=c(e,["pageSize"]);s!==void 0&&r!=null&&h(s,["_query","pageSize"],r);const o=c(e,["pageToken"]);s!==void 0&&o!=null&&h(s,["_query","pageToken"],o);const a=c(e,["filter"]);s!==void 0&&a!=null&&h(s,["_query","filter"],a);const l=c(e,["queryBase"]);return s!==void 0&&l!=null&&h(s,["_url","models_url"],Jx(t,l)),n}function z1(t,e){const s={},n=c(e,["config"]);return n!=null&&F1(t,n,s),s}function B1(t,e){const s={},n=c(e,["config"]);return n!=null&&O1(t,n,s),s}function q1(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["nextPageToken"]);n!=null&&h(e,["nextPageToken"],n);const r=c(t,["_self"]);if(r!=null){let o=Kx(r);Array.isArray(o)&&(o=o.map(a=>ac(a))),h(e,["models"],o)}return e}function G1(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["nextPageToken"]);n!=null&&h(e,["nextPageToken"],n);const r=c(t,["_self"]);if(r!=null){let o=Kx(r);Array.isArray(o)&&(o=o.map(a=>lc(a))),h(e,["models"],o)}return e}function $1(t){const e={},s=c(t,["maskMode"]);s!=null&&h(e,["maskMode"],s);const n=c(t,["segmentationClasses"]);n!=null&&h(e,["maskClasses"],n);const r=c(t,["maskDilation"]);return r!=null&&h(e,["dilation"],r),e}function ac(t){const e={},s=c(t,["name"]);s!=null&&h(e,["name"],s);const n=c(t,["displayName"]);n!=null&&h(e,["displayName"],n);const r=c(t,["description"]);r!=null&&h(e,["description"],r);const o=c(t,["version"]);o!=null&&h(e,["version"],o);const a=c(t,["_self"]);a!=null&&h(e,["tunedModelInfo"],aP(a));const l=c(t,["inputTokenLimit"]);l!=null&&h(e,["inputTokenLimit"],l);const u=c(t,["outputTokenLimit"]);u!=null&&h(e,["outputTokenLimit"],u);const d=c(t,["supportedGenerationMethods"]);d!=null&&h(e,["supportedActions"],d);const f=c(t,["temperature"]);f!=null&&h(e,["temperature"],f);const p=c(t,["maxTemperature"]);p!=null&&h(e,["maxTemperature"],p);const g=c(t,["topP"]);g!=null&&h(e,["topP"],g);const v=c(t,["topK"]);v!=null&&h(e,["topK"],v);const A=c(t,["thinking"]);return A!=null&&h(e,["thinking"],A),e}function lc(t){const e={},s=c(t,["name"]);s!=null&&h(e,["name"],s);const n=c(t,["displayName"]);n!=null&&h(e,["displayName"],n);const r=c(t,["description"]);r!=null&&h(e,["description"],r);const o=c(t,["versionId"]);o!=null&&h(e,["version"],o);const a=c(t,["deployedModels"]);if(a!=null){let p=a;Array.isArray(p)&&(p=p.map(g=>r1(g))),h(e,["endpoints"],p)}const l=c(t,["labels"]);l!=null&&h(e,["labels"],l);const u=c(t,["_self"]);u!=null&&h(e,["tunedModelInfo"],lP(u));const d=c(t,["defaultCheckpointId"]);d!=null&&h(e,["defaultCheckpointId"],d);const f=c(t,["checkpoints"]);if(f!=null){let p=f;Array.isArray(p)&&(p=p.map(g=>g)),h(e,["checkpoints"],p)}return e}function H1(t){const e={},s=c(t,["mediaResolution"]);s!=null&&h(e,["mediaResolution"],s);const n=c(t,["codeExecutionResult"]);n!=null&&h(e,["codeExecutionResult"],n);const r=c(t,["executableCode"]);r!=null&&h(e,["executableCode"],r);const o=c(t,["fileData"]);o!=null&&h(e,["fileData"],i1(o));const a=c(t,["functionCall"]);a!=null&&h(e,["functionCall"],o1(a));const l=c(t,["functionResponse"]);l!=null&&h(e,["functionResponse"],l);const u=c(t,["inlineData"]);u!=null&&h(e,["inlineData"],PR(u));const d=c(t,["text"]);d!=null&&h(e,["text"],d);const f=c(t,["thought"]);f!=null&&h(e,["thought"],f);const p=c(t,["thoughtSignature"]);p!=null&&h(e,["thoughtSignature"],p);const g=c(t,["videoMetadata"]);return g!=null&&h(e,["videoMetadata"],g),e}function W1(t){const e={},s=c(t,["productImage"]);return s!=null&&h(e,["image"],Ts(s)),e}function J1(t,e){const s={},n=c(t,["numberOfImages"]);e!==void 0&&n!=null&&h(e,["parameters","sampleCount"],n);const r=c(t,["baseSteps"]);e!==void 0&&r!=null&&h(e,["parameters","baseSteps"],r);const o=c(t,["outputGcsUri"]);e!==void 0&&o!=null&&h(e,["parameters","storageUri"],o);const a=c(t,["seed"]);e!==void 0&&a!=null&&h(e,["parameters","seed"],a);const l=c(t,["safetyFilterLevel"]);e!==void 0&&l!=null&&h(e,["parameters","safetySetting"],l);const u=c(t,["personGeneration"]);e!==void 0&&u!=null&&h(e,["parameters","personGeneration"],u);const d=c(t,["addWatermark"]);e!==void 0&&d!=null&&h(e,["parameters","addWatermark"],d);const f=c(t,["outputMimeType"]);e!==void 0&&f!=null&&h(e,["parameters","outputOptions","mimeType"],f);const p=c(t,["outputCompressionQuality"]);e!==void 0&&p!=null&&h(e,["parameters","outputOptions","compressionQuality"],p);const g=c(t,["enhancePrompt"]);e!==void 0&&g!=null&&h(e,["parameters","enhancePrompt"],g);const v=c(t,["labels"]);return e!==void 0&&v!=null&&h(e,["labels"],v),s}function K1(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["_url","model"],Xe(t,n));const r=c(e,["source"]);r!=null&&X1(r,s);const o=c(e,["config"]);return o!=null&&J1(o,s),s}function Y1(t){const e={},s=c(t,["predictions"]);if(s!=null){let n=s;Array.isArray(n)&&(n=n.map(r=>Ka(r))),h(e,["generatedImages"],n)}return e}function X1(t,e){const s={},n=c(t,["prompt"]);e!==void 0&&n!=null&&h(e,["instances[0]","prompt"],n);const r=c(t,["personImage"]);e!==void 0&&r!=null&&h(e,["instances[0]","personImage","image"],Ts(r));const o=c(t,["productImages"]);if(e!==void 0&&o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>W1(l))),h(e,["instances[0]","productImages"],a)}return s}function Q1(t){const e={},s=c(t,["referenceImage"]);s!=null&&h(e,["referenceImage"],Ts(s));const n=c(t,["referenceId"]);n!=null&&h(e,["referenceId"],n);const r=c(t,["referenceType"]);r!=null&&h(e,["referenceType"],r);const o=c(t,["maskImageConfig"]);o!=null&&h(e,["maskImageConfig"],$1(o));const a=c(t,["controlImageConfig"]);a!=null&&h(e,["controlImageConfig"],UR(a));const l=c(t,["styleImageConfig"]);l!=null&&h(e,["styleImageConfig"],l);const u=c(t,["subjectImageConfig"]);return u!=null&&h(e,["subjectImageConfig"],u),e}function s0(t){const e={},s=c(t,["safetyAttributes","categories"]);s!=null&&h(e,["categories"],s);const n=c(t,["safetyAttributes","scores"]);n!=null&&h(e,["scores"],n);const r=c(t,["contentType"]);return r!=null&&h(e,["contentType"],r),e}function n0(t){const e={},s=c(t,["safetyAttributes","categories"]);s!=null&&h(e,["categories"],s);const n=c(t,["safetyAttributes","scores"]);n!=null&&h(e,["scores"],n);const r=c(t,["contentType"]);return r!=null&&h(e,["contentType"],r),e}function Z1(t){const e={},s=c(t,["category"]);if(s!=null&&h(e,["category"],s),c(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=c(t,["threshold"]);return n!=null&&h(e,["threshold"],n),e}function eP(t){const e={},s=c(t,["image"]);return s!=null&&h(e,["image"],Ts(s)),e}function tP(t,e){const s={},n=c(t,["mode"]);e!==void 0&&n!=null&&h(e,["parameters","mode"],n);const r=c(t,["maxPredictions"]);e!==void 0&&r!=null&&h(e,["parameters","maxPredictions"],r);const o=c(t,["confidenceThreshold"]);e!==void 0&&o!=null&&h(e,["parameters","confidenceThreshold"],o);const a=c(t,["maskDilation"]);e!==void 0&&a!=null&&h(e,["parameters","maskDilation"],a);const l=c(t,["binaryColorThreshold"]);e!==void 0&&l!=null&&h(e,["parameters","binaryColorThreshold"],l);const u=c(t,["labels"]);return e!==void 0&&u!=null&&h(e,["labels"],u),s}function sP(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["_url","model"],Xe(t,n));const r=c(e,["source"]);r!=null&&rP(r,s);const o=c(e,["config"]);return o!=null&&tP(o,s),s}function nP(t){const e={},s=c(t,["predictions"]);if(s!=null){let n=s;Array.isArray(n)&&(n=n.map(r=>S1(r))),h(e,["generatedMasks"],n)}return e}function rP(t,e){const s={},n=c(t,["prompt"]);e!==void 0&&n!=null&&h(e,["instances[0]","prompt"],n);const r=c(t,["image"]);e!==void 0&&r!=null&&h(e,["instances[0]","image"],Ts(r));const o=c(t,["scribbleImage"]);return e!==void 0&&o!=null&&h(e,["instances[0]","scribble"],eP(o)),s}function iP(t){const e={},s=c(t,["functionCallingConfig"]);s!=null&&h(e,["functionCallingConfig"],a1(s));const n=c(t,["retrievalConfig"]);return n!=null&&h(e,["retrievalConfig"],n),e}function oP(t){const e={},s=c(t,["functionDeclarations"]);if(s!=null){let f=s;Array.isArray(f)&&(f=f.map(p=>p)),h(e,["functionDeclarations"],f)}if(c(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=c(t,["googleSearchRetrieval"]);n!=null&&h(e,["googleSearchRetrieval"],n);const r=c(t,["computerUse"]);r!=null&&h(e,["computerUse"],r);const o=c(t,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);const a=c(t,["codeExecution"]);if(a!=null&&h(e,["codeExecution"],a),c(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=c(t,["googleMaps"]);l!=null&&h(e,["googleMaps"],D1(l));const u=c(t,["googleSearch"]);u!=null&&h(e,["googleSearch"],M1(u));const d=c(t,["urlContext"]);return d!=null&&h(e,["urlContext"],d),e}function r0(t){const e={},s=c(t,["functionDeclarations"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(g=>l1(g))),h(e,["functionDeclarations"],p)}const n=c(t,["retrieval"]);n!=null&&h(e,["retrieval"],n);const r=c(t,["googleSearchRetrieval"]);r!=null&&h(e,["googleSearchRetrieval"],r);const o=c(t,["computerUse"]);if(o!=null&&h(e,["computerUse"],o),c(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const a=c(t,["codeExecution"]);a!=null&&h(e,["codeExecution"],a);const l=c(t,["enterpriseWebSearch"]);l!=null&&h(e,["enterpriseWebSearch"],l);const u=c(t,["googleMaps"]);u!=null&&h(e,["googleMaps"],u);const d=c(t,["googleSearch"]);d!=null&&h(e,["googleSearch"],d);const f=c(t,["urlContext"]);return f!=null&&h(e,["urlContext"],f),e}function aP(t){const e={},s=c(t,["baseModel"]);s!=null&&h(e,["baseModel"],s);const n=c(t,["createTime"]);n!=null&&h(e,["createTime"],n);const r=c(t,["updateTime"]);return r!=null&&h(e,["updateTime"],r),e}function lP(t){const e={},s=c(t,["labels","google-vertex-llm-tuning-base-model-id"]);s!=null&&h(e,["baseModel"],s);const n=c(t,["createTime"]);n!=null&&h(e,["createTime"],n);const r=c(t,["updateTime"]);return r!=null&&h(e,["updateTime"],r),e}function cP(t,e){const s={},n=c(t,["displayName"]);e!==void 0&&n!=null&&h(e,["displayName"],n);const r=c(t,["description"]);e!==void 0&&r!=null&&h(e,["description"],r);const o=c(t,["defaultCheckpointId"]);return e!==void 0&&o!=null&&h(e,["defaultCheckpointId"],o),s}function dP(t,e){const s={},n=c(t,["displayName"]);e!==void 0&&n!=null&&h(e,["displayName"],n);const r=c(t,["description"]);e!==void 0&&r!=null&&h(e,["description"],r);const o=c(t,["defaultCheckpointId"]);return e!==void 0&&o!=null&&h(e,["defaultCheckpointId"],o),s}function uP(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["_url","name"],Xe(t,n));const r=c(e,["config"]);return r!=null&&cP(r,s),s}function hP(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["_url","model"],Xe(t,n));const r=c(e,["config"]);return r!=null&&dP(r,s),s}function mP(t,e){const s={},n=c(t,["outputGcsUri"]);e!==void 0&&n!=null&&h(e,["parameters","storageUri"],n);const r=c(t,["safetyFilterLevel"]);e!==void 0&&r!=null&&h(e,["parameters","safetySetting"],r);const o=c(t,["personGeneration"]);e!==void 0&&o!=null&&h(e,["parameters","personGeneration"],o);const a=c(t,["includeRaiReason"]);e!==void 0&&a!=null&&h(e,["parameters","includeRaiReason"],a);const l=c(t,["outputMimeType"]);e!==void 0&&l!=null&&h(e,["parameters","outputOptions","mimeType"],l);const u=c(t,["outputCompressionQuality"]);e!==void 0&&u!=null&&h(e,["parameters","outputOptions","compressionQuality"],u);const d=c(t,["enhanceInputImage"]);e!==void 0&&d!=null&&h(e,["parameters","upscaleConfig","enhanceInputImage"],d);const f=c(t,["imagePreservationFactor"]);e!==void 0&&f!=null&&h(e,["parameters","upscaleConfig","imagePreservationFactor"],f);const p=c(t,["labels"]);e!==void 0&&p!=null&&h(e,["labels"],p);const g=c(t,["numberOfImages"]);e!==void 0&&g!=null&&h(e,["parameters","sampleCount"],g);const v=c(t,["mode"]);return e!==void 0&&v!=null&&h(e,["parameters","mode"],v),s}function fP(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["_url","model"],Xe(t,n));const r=c(e,["image"]);r!=null&&h(s,["instances[0]","image"],Ts(r));const o=c(e,["upscaleFactor"]);o!=null&&h(s,["parameters","upscaleConfig","upscaleFactor"],o);const a=c(e,["config"]);return a!=null&&mP(a,s),s}function pP(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>Ka(o))),h(e,["generatedImages"],r)}return e}function gP(t){const e={},s=c(t,["uri"]);s!=null&&h(e,["uri"],s);const n=c(t,["encodedVideo"]);n!=null&&h(e,["videoBytes"],On(n));const r=c(t,["encoding"]);return r!=null&&h(e,["mimeType"],r),e}function xP(t){const e={},s=c(t,["gcsUri"]);s!=null&&h(e,["uri"],s);const n=c(t,["bytesBase64Encoded"]);n!=null&&h(e,["videoBytes"],On(n));const r=c(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function yP(t){const e={},s=c(t,["image"]);s!=null&&h(e,["_self"],Ts(s));const n=c(t,["maskMode"]);return n!=null&&h(e,["maskMode"],n),e}function vP(t){const e={},s=c(t,["image"]);s!=null&&h(e,["image"],Ya(s));const n=c(t,["referenceType"]);return n!=null&&h(e,["referenceType"],n),e}function bP(t){const e={},s=c(t,["image"]);s!=null&&h(e,["image"],Ts(s));const n=c(t,["referenceType"]);return n!=null&&h(e,["referenceType"],n),e}function i0(t){const e={},s=c(t,["uri"]);s!=null&&h(e,["uri"],s);const n=c(t,["videoBytes"]);n!=null&&h(e,["encodedVideo"],On(n));const r=c(t,["mimeType"]);return r!=null&&h(e,["encoding"],r),e}function o0(t){const e={},s=c(t,["uri"]);s!=null&&h(e,["gcsUri"],s);const n=c(t,["videoBytes"]);n!=null&&h(e,["bytesBase64Encoded"],On(n));const r=c(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function wP(t,e){const s={},n=c(t,["displayName"]);return e!==void 0&&n!=null&&h(e,["displayName"],n),s}function _P(t){const e={},s=c(t,["config"]);return s!=null&&wP(s,e),e}function NP(t,e){const s={},n=c(t,["force"]);return e!==void 0&&n!=null&&h(e,["_query","force"],n),s}function EP(t){const e={},s=c(t,["name"]);s!=null&&h(e,["_url","name"],s);const n=c(t,["config"]);return n!=null&&NP(n,e),e}function TP(t){const e={},s=c(t,["name"]);return s!=null&&h(e,["_url","name"],s),e}function IP(t,e){const s={},n=c(t,["customMetadata"]);if(e!==void 0&&n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>a)),h(e,["customMetadata"],o)}const r=c(t,["chunkingConfig"]);return e!==void 0&&r!=null&&h(e,["chunkingConfig"],r),s}function CP(t){const e={},s=c(t,["name"]);s!=null&&h(e,["name"],s);const n=c(t,["metadata"]);n!=null&&h(e,["metadata"],n);const r=c(t,["done"]);r!=null&&h(e,["done"],r);const o=c(t,["error"]);o!=null&&h(e,["error"],o);const a=c(t,["response"]);return a!=null&&h(e,["response"],AP(a)),e}function SP(t){const e={},s=c(t,["fileSearchStoreName"]);s!=null&&h(e,["_url","file_search_store_name"],s);const n=c(t,["fileName"]);n!=null&&h(e,["fileName"],n);const r=c(t,["config"]);return r!=null&&IP(r,e),e}function AP(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["parent"]);n!=null&&h(e,["parent"],n);const r=c(t,["documentName"]);return r!=null&&h(e,["documentName"],r),e}function RP(t,e){const s={},n=c(t,["pageSize"]);e!==void 0&&n!=null&&h(e,["_query","pageSize"],n);const r=c(t,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),s}function PP(t){const e={},s=c(t,["config"]);return s!=null&&RP(s,e),e}function jP(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["nextPageToken"]);n!=null&&h(e,["nextPageToken"],n);const r=c(t,["fileSearchStores"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>a)),h(e,["fileSearchStores"],o)}return e}function a0(t,e){const s={},n=c(t,["mimeType"]);e!==void 0&&n!=null&&h(e,["mimeType"],n);const r=c(t,["displayName"]);e!==void 0&&r!=null&&h(e,["displayName"],r);const o=c(t,["customMetadata"]);if(e!==void 0&&o!=null){let l=o;Array.isArray(l)&&(l=l.map(u=>u)),h(e,["customMetadata"],l)}const a=c(t,["chunkingConfig"]);return e!==void 0&&a!=null&&h(e,["chunkingConfig"],a),s}function kP(t){const e={},s=c(t,["fileSearchStoreName"]);s!=null&&h(e,["_url","file_search_store_name"],s);const n=c(t,["config"]);return n!=null&&a0(n,e),e}function DP(t){const e={},s=c(t,["sdkHttpResponse"]);return s!=null&&h(e,["sdkHttpResponse"],s),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const MP="Content-Type",LP="X-Server-Timeout",VP="User-Agent",cc="x-goog-api-client",UP="1.34.0",FP=`google-genai-sdk/${UP}`,OP="v1beta1",zP="v1beta";class BP{constructor(e){var s,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const r={};this.clientOptions.vertexai?(r.apiVersion=(s=this.clientOptions.apiVersion)!==null&&s!==void 0?s:OP,r.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(r.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:zP,r.baseUrl="https://generativelanguage.googleapis.com/"),r.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=r,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(r,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){const e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const n=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&n.push(e.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),s=new URL(e);return s.protocol=s.protocol=="http:"?"ws":"wss",s.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,s,n){const r=[this.getRequestUrlInternal(s)];return n&&r.push(this.getBaseResourcePath()),e!==""&&r.push(e),new URL(`${r.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let s=this.clientOptions.httpOptions;e.httpOptions&&(s=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const n=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,s,n);if(e.queryParams)for(const[a,l]of Object.entries(e.queryParams))r.searchParams.append(a,String(l));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,s,r.toString(),e.abortSignal),this.unaryApiCall(r,o,e.httpMethod)}patchHttpOptions(e,s){const n=JSON.parse(JSON.stringify(e));for(const[r,o]of Object.entries(s))typeof o=="object"?n[r]=Object.assign(Object.assign({},n[r]),o):o!==void 0&&(n[r]=o);return n}async requestStream(e){let s=this.clientOptions.httpOptions;e.httpOptions&&(s=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const n=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,s,n);(!r.searchParams.has("alt")||r.searchParams.get("alt")!=="sse")&&r.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,s,r.toString(),e.abortSignal),this.streamApiCall(r,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,s,n,r){if(s&&s.timeout||r){const o=new AbortController,a=o.signal;if(s.timeout&&(s==null?void 0:s.timeout)>0){const l=setTimeout(()=>o.abort(),s.timeout);l&&typeof l.unref=="function"&&l.unref()}r&&r.addEventListener("abort",()=>{o.abort()}),e.signal=a}return s&&s.extraBody!==null&&qP(e,s.extraBody),e.headers=await this.getHeadersInternal(s,n),e}async unaryApiCall(e,s,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},s),{method:n})).then(async r=>(await Ef(r),new rc(r))).catch(r=>{throw r instanceof Error?r:new Error(JSON.stringify(r))})}async streamApiCall(e,s,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},s),{method:n})).then(async r=>(await Ef(r),this.processStreamResponse(r))).catch(r=>{throw r instanceof Error?r:new Error(JSON.stringify(r))})}processStreamResponse(e){return ws(this,arguments,function*(){var n;const r=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),o=new TextDecoder("utf-8");if(!r)throw new Error("Response body is empty");try{let a="";const l="data:",u=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:d,value:f}=yield Re(r.read());if(d){if(a.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const p=o.decode(f,{stream:!0});try{const A=JSON.parse(p);if("error"in A){const k=JSON.parse(JSON.stringify(A.error)),S=k.status,L=k.code,D=`got status: ${S}. ${JSON.stringify(A)}`;if(L>=400&&L<600)throw new Wa({message:D,status:L})}}catch(A){if(A.name==="ApiError")throw A}a+=p;let g=-1,v=0;for(;;){g=-1,v=0;for(const S of u){const L=a.indexOf(S);L!==-1&&(g===-1||L<g)&&(g=L,v=S.length)}if(g===-1)break;const A=a.substring(0,g);a=a.substring(g+v);const k=A.trim();if(k.startsWith(l)){const S=k.substring(l.length).trim();try{const L=new Response(S,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield Re(new rc(L))}catch(L){throw new Error(`exception parsing stream chunk ${S}. ${L}`)}}}}}finally{r.releaseLock()}})}async apiCall(e,s){return fetch(e,s).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){const e={},s=FP+" "+this.clientOptions.userAgentExtra;return e[VP]=s,e[cc]=s,e[MP]="application/json",e}async getHeadersInternal(e,s){const n=new Headers;if(e&&e.headers){for(const[r,o]of Object.entries(e.headers))n.append(r,o);e.timeout&&e.timeout>0&&n.append(LP,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,s),n}getFileName(e){var s;let n="";return typeof e=="string"&&(n=e.replace(/[/\\]+$/,""),n=(s=n.split(/[/\\]/).pop())!==null&&s!==void 0?s:""),n}async uploadFile(e,s){var n;const r={};s!=null&&(r.mimeType=s.mimeType,r.name=s.name,r.displayName=s.displayName),r.name&&!r.name.startsWith("files/")&&(r.name=`files/${r.name}`);const o=this.clientOptions.uploader,a=await o.stat(e);r.sizeBytes=String(a.size);const l=(n=s==null?void 0:s.mimeType)!==null&&n!==void 0?n:a.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");r.mimeType=l;const u={file:r},d=this.getFileName(e),f=me("upload/v1beta/files",u._url),p=await this.fetchUploadUrl(f,r.sizeBytes,r.mimeType,d,u,s==null?void 0:s.httpOptions);return o.upload(e,p,this)}async uploadFileToFileSearchStore(e,s,n){var r;const o=this.clientOptions.uploader,a=await o.stat(s),l=String(a.size),u=(r=n==null?void 0:n.mimeType)!==null&&r!==void 0?r:a.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const d=`upload/v1beta/${e}:uploadToFileSearchStore`,f=this.getFileName(s),p={};n!=null&&a0(n,p);const g=await this.fetchUploadUrl(d,l,u,f,p,n==null?void 0:n.httpOptions);return o.uploadToFileSearchStore(s,g,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,s,n,r,o,a){var l;let u={};a?u=a:u={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${s}`,"X-Goog-Upload-Header-Content-Type":`${n}`},r?{"X-Goog-Upload-File-Name":r}:{})};const d=await this.request({path:e,body:JSON.stringify(o),httpMethod:"POST",httpOptions:u});if(!d||!(d!=null&&d.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const f=(l=d==null?void 0:d.headers)===null||l===void 0?void 0:l["x-goog-upload-url"];if(f===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return f}}async function Ef(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const s=t.status;let n;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?n=await t.json():n={error:{message:await t.text(),code:t.status,status:t.statusText}};const r=JSON.stringify(n);throw s>=400&&s<600?new Wa({message:r,status:s}):new Error(r)}}function qP(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let s={};if(typeof t.body=="string"&&t.body.length>0)try{const o=JSON.parse(t.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))s=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function n(o,a){const l=Object.assign({},o);for(const u in a)if(Object.prototype.hasOwnProperty.call(a,u)){const d=a[u],f=l[u];d&&typeof d=="object"&&!Array.isArray(d)&&f&&typeof f=="object"&&!Array.isArray(f)?l[u]=n(f,d):(f&&d&&typeof f!=typeof d&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${u}". Original type: ${typeof f}, New type: ${typeof d}. Overwriting.`),l[u]=d)}return l}const r=n(s,e);t.body=JSON.stringify(r)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const GP="mcp_used/unknown";let $P=!1;function l0(t){for(const e of t)if(HP(e)||typeof e=="object"&&"inputSchema"in e)return!0;return $P}function c0(t){var e;const s=(e=t[cc])!==null&&e!==void 0?e:"";t[cc]=(s+` ${GP}`).trimStart()}function HP(t){return t!==null&&typeof t=="object"&&t instanceof Ad}function WP(t){return ws(this,arguments,function*(s,n=100){let r,o=0;for(;o<n;){const a=yield Re(s.listTools({cursor:r}));for(const l of a.tools)yield yield Re(l),o++;if(!a.nextCursor)break;r=a.nextCursor}})}class Ad{constructor(e=[],s){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=s}static create(e,s){return new Ad(e,s)}async initialize(){var e,s,n,r;if(this.mcpTools.length>0)return;const o={},a=[];for(const f of this.mcpClients)try{for(var l=!0,u=(s=void 0,_s(WP(f))),d;d=await u.next(),e=d.done,!e;l=!0){r=d.value,l=!1;const p=r;a.push(p);const g=p.name;if(o[g])throw new Error(`Duplicate function name ${g} found in MCP tools. Please ensure function names are unique.`);o[g]=f}}catch(p){s={error:p}}finally{try{!l&&!e&&(n=u.return)&&await n.call(u)}finally{if(s)throw s.error}}this.mcpTools=a,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),TS(this.mcpTools,this.config)}async callTool(e){await this.initialize();const s=[];for(const n of e)if(n.name in this.functionNameToMcpClient){const r=this.functionNameToMcpClient[n.name];let o;this.config.timeout&&(o={timeout:this.config.timeout});const a=await r.callTool({name:n.name,arguments:n.args},void 0,o);s.push({functionResponse:{name:n.name,response:a.isError?{error:a}:a}})}return s}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function JP(t,e,s){const n=new xS;let r;s.data instanceof Blob?r=JSON.parse(await s.data.text()):r=JSON.parse(s.data),Object.assign(n,r),e(n)}class KP{constructor(e,s,n){this.apiClient=e,this.auth=s,this.webSocketFactory=n}async connect(e){var s,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const r=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),a=QP(this.apiClient.getDefaultHeaders()),l=this.apiClient.getApiKey(),u=`${r}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${l}`;let d=()=>{};const f=new Promise(j=>{d=j}),p=e.callbacks,g=function(){d({})},v=this.apiClient,A={onopen:g,onmessage:j=>{JP(v,p.onmessage,j)},onerror:(s=p==null?void 0:p.onerror)!==null&&s!==void 0?s:function(j){},onclose:(n=p==null?void 0:p.onclose)!==null&&n!==void 0?n:function(j){}},k=this.webSocketFactory.create(u,XP(a),A);k.connect(),await f;const D={setup:{model:Xe(this.apiClient,e.model)}};return k.send(JSON.stringify(D)),new YP(k,this.apiClient)}}class YP{constructor(e,s){this.conn=e,this.apiClient=s}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const s=_R(e);this.conn.send(JSON.stringify({clientContent:s}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const s=wR(e);this.conn.send(JSON.stringify(s))}sendPlaybackControl(e){const s={playbackControl:e};this.conn.send(JSON.stringify(s))}play(){this.sendPlaybackControl(Nr.PLAY)}pause(){this.sendPlaybackControl(Nr.PAUSE)}stop(){this.sendPlaybackControl(Nr.STOP)}resetContext(){this.sendPlaybackControl(Nr.RESET_CONTEXT)}close(){this.conn.close()}}function XP(t){const e={};return t.forEach((s,n)=>{e[n]=s}),e}function QP(t){const e=new Headers;for(const[s,n]of Object.entries(t))e.append(s,n);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ZP="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function ej(t,e,s){const n=new gS;let r;s.data instanceof Blob?r=await s.data.text():s.data instanceof ArrayBuffer?r=new TextDecoder().decode(s.data):r=s.data;const o=JSON.parse(r);if(t.isVertexAI()){const a=TR(o);Object.assign(n,a)}else Object.assign(n,o);e(n)}class tj{constructor(e,s,n){this.apiClient=e,this.auth=s,this.webSocketFactory=n,this.music=new KP(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var s,n,r,o,a,l;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const u=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let f;const p=this.apiClient.getHeaders();e.config&&e.config.tools&&l0(e.config.tools)&&c0(p);const g=ij(p);if(this.apiClient.isVertexAI())f=`${u}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(g,f);else{const _=this.apiClient.getApiKey();let T="BidiGenerateContent",R="key";_!=null&&_.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),d!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),T="BidiGenerateContentConstrained",R="access_token"),f=`${u}/ws/google.ai.generativelanguage.${d}.GenerativeService.${T}?${R}=${_}`}let v=()=>{};const A=new Promise(_=>{v=_}),k=e.callbacks,S=function(){var _;(_=k==null?void 0:k.onopen)===null||_===void 0||_.call(k),v({})},L=this.apiClient,D={onopen:S,onmessage:_=>{ej(L,k.onmessage,_)},onerror:(s=k==null?void 0:k.onerror)!==null&&s!==void 0?s:function(_){},onclose:(n=k==null?void 0:k.onclose)!==null&&n!==void 0?n:function(_){}},j=this.webSocketFactory.create(f,rj(g),D);j.connect(),await A;let F=Xe(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&F.startsWith("publishers/")){const _=this.apiClient.getProject(),T=this.apiClient.getLocation();F=`projects/${_}/locations/${T}/`+F}let q={};this.apiClient.isVertexAI()&&((r=e.config)===null||r===void 0?void 0:r.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[ha.AUDIO]}:e.config.responseModalities=[ha.AUDIO]),!((o=e.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const E=(l=(a=e.config)===null||a===void 0?void 0:a.tools)!==null&&l!==void 0?l:[],w=[];for(const _ of E)if(this.isCallableTool(_)){const T=_;w.push(await T.tool())}else w.push(_);w.length>0&&(e.config.tools=w);const b={model:F,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?q=bR(this.apiClient,b):q=vR(this.apiClient,b),delete q.config,j.send(JSON.stringify(q)),new nj(j,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const sj={turnComplete:!0};class nj{constructor(e,s){this.conn=e,this.apiClient=s}tLiveClientContent(e,s){if(s.turns!==null&&s.turns!==void 0){let n=[];try{n=gs(s.turns),e.isVertexAI()||(n=n.map(r=>Ja(r)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof s.turns}'`)}return{clientContent:{turns:n,turnComplete:s.turnComplete}}}return{clientContent:{turnComplete:s.turnComplete}}}tLiveClienttToolResponse(e,s){let n=[];if(s.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(s.functionResponses)?n=s.functionResponses:n=[s.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(const o of n){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!e.isVertexAI()&&!("id"in o))throw new Error(ZP)}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},sj),e);const s=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(s))}sendRealtimeInput(e){let s={};this.apiClient.isVertexAI()?s={realtimeInput:ER(e)}:s={realtimeInput:NR(e)},this.conn.send(JSON.stringify(s))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const s=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(s))}close(){this.conn.close()}}function rj(t){const e={};return t.forEach((s,n)=>{e[n]=s}),e}function ij(t){const e=new Headers;for(const[s,n]of Object.entries(t))e.append(s,n);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Tf=10;function If(t){var e,s,n;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let r=!1;for(const a of(s=t==null?void 0:t.tools)!==null&&s!==void 0?s:[])if(Pr(a)){r=!0;break}if(!r)return!0;const o=(n=t==null?void 0:t.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function Pr(t){return"callTool"in t&&typeof t.callTool=="function"}function oj(t){var e,s,n;return(n=(s=(e=t.config)===null||e===void 0?void 0:e.tools)===null||s===void 0?void 0:s.some(r=>Pr(r)))!==null&&n!==void 0?n:!1}function Cf(t){var e;const s=[];return!((e=t==null?void 0:t.config)===null||e===void 0)&&e.tools&&t.config.tools.forEach((n,r)=>{if(Pr(n))return;const o=n;o.functionDeclarations&&o.functionDeclarations.length>0&&s.push(r)}),s}function Sf(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class aj extends cn{constructor(e){super(),this.apiClient=e,this.generateContent=async s=>{var n,r,o,a,l;const u=await this.processParamsMaybeAddMcpUsage(s);if(this.maybeMoveToResponseJsonSchem(s),!oj(s)||If(s.config))return await this.generateContentInternal(u);const d=Cf(s);if(d.length>0){const k=d.map(S=>`tools[${S}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${k}.`)}let f,p;const g=gs(u.contents),v=(o=(r=(n=u.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&o!==void 0?o:Tf;let A=0;for(;A<v&&(f=await this.generateContentInternal(u),!(!f.functionCalls||f.functionCalls.length===0));){const k=f.candidates[0].content,S=[];for(const L of(l=(a=s.config)===null||a===void 0?void 0:a.tools)!==null&&l!==void 0?l:[])if(Pr(L)){const j=await L.callTool(f.functionCalls);S.push(...j)}A++,p={role:"user",parts:S},u.contents=gs(u.contents),u.contents.push(k),u.contents.push(p),Sf(u.config)&&(g.push(k),g.push(p))}return Sf(u.config)&&(f.automaticFunctionCallingHistory=g),f},this.generateContentStream=async s=>{var n,r,o,a,l;if(this.maybeMoveToResponseJsonSchem(s),If(s.config)){const p=await this.processParamsMaybeAddMcpUsage(s);return await this.generateContentStreamInternal(p)}const u=Cf(s);if(u.length>0){const p=u.map(g=>`tools[${g}]`).join(", ");throw new Error(`Incompatible tools found at ${p}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const d=(o=(r=(n=s==null?void 0:s.config)===null||n===void 0?void 0:n.toolConfig)===null||r===void 0?void 0:r.functionCallingConfig)===null||o===void 0?void 0:o.streamFunctionCallArguments,f=(l=(a=s==null?void 0:s.config)===null||a===void 0?void 0:a.automaticFunctionCalling)===null||l===void 0?void 0:l.disable;if(d&&!f)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(s)},this.generateImages=async s=>await this.generateImagesInternal(s).then(n=>{var r;let o;const a=[];if(n!=null&&n.generatedImages)for(const u of n.generatedImages)u&&(u!=null&&u.safetyAttributes)&&((r=u==null?void 0:u.safetyAttributes)===null||r===void 0?void 0:r.contentType)==="Positive Prompt"?o=u==null?void 0:u.safetyAttributes:a.push(u);let l;return o?l={generatedImages:a,positivePromptSafetyAttributes:o,sdkHttpResponse:n.sdkHttpResponse}:l={generatedImages:a,sdkHttpResponse:n.sdkHttpResponse},l}),this.list=async s=>{var n;const a={config:Object.assign(Object.assign({},{queryBase:!0}),s==null?void 0:s.config)};if(this.apiClient.isVertexAI()&&!a.config.queryBase){if(!((n=a.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");a.config.filter="labels.tune-type:*"}return new fr(rn.PAGED_ITEM_MODELS,l=>this.listInternal(l),await this.listInternal(a),a)},this.editImage=async s=>{const n={model:s.model,prompt:s.prompt,referenceImages:[],config:s.config};return s.referenceImages&&s.referenceImages&&(n.referenceImages=s.referenceImages.map(r=>r.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async s=>{let n={numberOfImages:1,mode:"upscale"};s.config&&(n=Object.assign(Object.assign({},n),s.config));const r={model:s.model,image:s.image,upscaleFactor:s.upscaleFactor,config:n};return await this.upscaleImageInternal(r)},this.generateVideos=async s=>{var n,r,o,a,l,u;if((s.prompt||s.image||s.video)&&s.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((n=s.video)===null||n===void 0)&&n.uri&&(!((r=s.video)===null||r===void 0)&&r.videoBytes)?s.video={uri:s.video.uri,mimeType:s.video.mimeType}:!((a=(o=s.source)===null||o===void 0?void 0:o.video)===null||a===void 0)&&a.uri&&(!((u=(l=s.source)===null||l===void 0?void 0:l.video)===null||u===void 0)&&u.videoBytes)&&(s.source.video={uri:s.source.video.uri,mimeType:s.source.video.mimeType})),await this.generateVideosInternal(s)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var s,n,r;const o=(s=e.config)===null||s===void 0?void 0:s.tools;if(!o)return e;const a=await Promise.all(o.map(async u=>Pr(u)?await u.tool():u)),l={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:a})};if(l.config.tools=a,e.config&&e.config.tools&&l0(e.config.tools)){const u=(r=(n=e.config.httpOptions)===null||n===void 0?void 0:n.headers)!==null&&r!==void 0?r:{};let d=Object.assign({},u);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),c0(d),l.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:d})}return l}async initAfcToolsMap(e){var s,n,r;const o=new Map;for(const a of(n=(s=e.config)===null||s===void 0?void 0:s.tools)!==null&&n!==void 0?n:[])if(Pr(a)){const l=a,u=await l.tool();for(const d of(r=u.functionDeclarations)!==null&&r!==void 0?r:[]){if(!d.name)throw new Error("Function declaration name is required.");if(o.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);o.set(d.name,l)}}return o}async processAfcStream(e){var s,n,r;const o=(r=(n=(s=e.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls)!==null&&r!==void 0?r:Tf;let a=!1,l=0;const u=await this.initAfcToolsMap(e);return function(d,f,p){return ws(this,arguments,function*(){for(var g,v,A,k,S,L;l<o;){a&&(l++,a=!1);const q=yield Re(d.processParamsMaybeAddMcpUsage(p)),E=yield Re(d.generateContentStreamInternal(q)),w=[],b=[];try{for(var D=!0,j=(v=void 0,_s(E)),F;F=yield Re(j.next()),g=F.done,!g;D=!0){k=F.value,D=!1;const _=k;if(yield yield Re(_),_.candidates&&(!((S=_.candidates[0])===null||S===void 0)&&S.content)){b.push(_.candidates[0].content);for(const T of(L=_.candidates[0].content.parts)!==null&&L!==void 0?L:[])if(l<o&&T.functionCall){if(!T.functionCall.name)throw new Error("Function call name was not returned by the model.");if(f.has(T.functionCall.name)){const R=yield Re(f.get(T.functionCall.name).callTool([T.functionCall]));w.push(...R)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${f.keys()}, mising tool: ${T.functionCall.name}`)}}}}catch(_){v={error:_}}finally{try{!D&&!g&&(A=j.return)&&(yield Re(A.call(j)))}finally{if(v)throw v.error}}if(w.length>0){a=!0;const _=new ai;_.candidates=[{content:{role:"user",parts:w}}],yield yield Re(_);const T=[];T.push(...b),T.push({role:"user",parts:w});const R=gs(p.contents).concat(T);p.contents=R}else break}})}(this,u,e)}async generateContentInternal(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=wf(this.apiClient,e);return l=me("{model}:generateContent",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=Nf(f),g=new ai;return Object.assign(g,p),g})}else{const d=bf(this.apiClient,e);return l=me("{model}:generateContent",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=_f(f),g=new ai;return Object.assign(g,p),g})}}async generateContentStreamInternal(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=wf(this.apiClient,e);return l=me("{model}:streamGenerateContent?alt=sse",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.requestStream({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}),a.then(function(p){return ws(this,arguments,function*(){var g,v,A,k;try{for(var S=!0,L=_s(p),D;D=yield Re(L.next()),g=D.done,!g;S=!0){k=D.value,S=!1;const j=k,F=Nf(yield Re(j.json()));F.sdkHttpResponse={headers:j.headers};const q=new ai;Object.assign(q,F),yield yield Re(q)}}catch(j){v={error:j}}finally{try{!S&&!g&&(A=L.return)&&(yield Re(A.call(L)))}finally{if(v)throw v.error}}})})}else{const d=bf(this.apiClient,e);return l=me("{model}:streamGenerateContent?alt=sse",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.requestStream({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),a.then(function(p){return ws(this,arguments,function*(){var g,v,A,k;try{for(var S=!0,L=_s(p),D;D=yield Re(L.next()),g=D.done,!g;S=!0){k=D.value,S=!1;const j=k,F=_f(yield Re(j.json()));F.sdkHttpResponse={headers:j.headers};const q=new ai;Object.assign(q,F),yield yield Re(q)}}catch(j){v={error:j}}finally{try{!S&&!g&&(A=L.return)&&(yield Re(A.call(L)))}finally{if(v)throw v.error}}})})}}async embedContent(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=t1(this.apiClient,e);return l=me("{model}:predict",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=n1(f),g=new sf;return Object.assign(g,p),g})}else{const d=e1(this.apiClient,e);return l=me("{model}:batchEmbedContents",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=s1(f),g=new sf;return Object.assign(g,p),g})}}async generateImagesInternal(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=f1(this.apiClient,e);return l=me("{model}:predict",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=g1(f),g=new nf;return Object.assign(g,p),g})}else{const d=m1(this.apiClient,e);return l=me("{model}:predict",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=p1(f),g=new nf;return Object.assign(g,p),g})}}async editImageInternal(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI()){const l=YR(this.apiClient,e);return o=me("{model}:predict",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(d=>{const f=d;return f.sdkHttpResponse={headers:u.headers},f})),r.then(u=>{const d=XR(u),f=new iS;return Object.assign(f,d),f})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI()){const l=fP(this.apiClient,e);return o=me("{model}:predict",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(d=>{const f=d;return f.sdkHttpResponse={headers:u.headers},f})),r.then(u=>{const d=pP(u),f=new oS;return Object.assign(f,d),f})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI()){const l=K1(this.apiClient,e);return o=me("{model}:predict",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),r.then(u=>{const d=Y1(u),f=new aS;return Object.assign(f,d),f})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI()){const l=sP(this.apiClient,e);return o=me("{model}:predict",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),r.then(u=>{const d=nP(u),f=new lS;return Object.assign(f,d),f})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=k1(this.apiClient,e);return l=me("{name}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>lc(f))}else{const d=j1(this.apiClient,e);return l=me("{name}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>ac(f))}}async listInternal(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=B1(this.apiClient,e);return l=me("{models_url}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=G1(f),g=new rf;return Object.assign(g,p),g})}else{const d=z1(this.apiClient,e);return l=me("{models_url}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=q1(f),g=new rf;return Object.assign(g,p),g})}}async update(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=hP(this.apiClient,e);return l=me("{model}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>lc(f))}else{const d=uP(this.apiClient,e);return l=me("{name}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>ac(f))}}async delete(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=HR(this.apiClient,e);return l=me("{name}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=JR(f),g=new of;return Object.assign(g,p),g})}else{const d=$R(this.apiClient,e);return l=me("{name}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=WR(f),g=new of;return Object.assign(g,p),g})}}async countTokens(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=BR(this.apiClient,e);return l=me("{model}:countTokens",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=GR(f),g=new af;return Object.assign(g,p),g})}else{const d=zR(this.apiClient,e);return l=me("{model}:countTokens",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=qR(f),g=new af;return Object.assign(g,p),g})}}async computeTokens(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI()){const l=DR(this.apiClient,e);return o=me("{model}:computeTokens",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(d=>{const f=d;return f.sdkHttpResponse={headers:u.headers},f})),r.then(u=>{const d=MR(u),f=new cS;return Object.assign(f,d),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=_1(this.apiClient,e);return l=me("{model}:predictLongRunning",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=b1(f),g=new ma;return Object.assign(g,p),g})}else{const d=w1(this.apiClient,e);return l=me("{model}:predictLongRunning",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>{const p=v1(f),g=new ma;return Object.assign(g,p),g})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class lj extends cn{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const s=e.operation,n=e.config;if(s.name===void 0||s.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const r=s.name.split("/operations/")[0];let o;n&&"httpOptions"in n&&(o=n.httpOptions);const a=await this.fetchPredictVideosOperationInternal({operationName:s.name,resourceName:r,config:{httpOptions:o}});return s._fromAPIResponse({apiResponse:a,_isVertexAI:!0})}else{const r=await this.getVideosOperationInternal({operationName:s.name,config:n});return s._fromAPIResponse({apiResponse:r,_isVertexAI:!1})}}async get(e){const s=e.operation,n=e.config;if(s.name===void 0||s.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const r=s.name.split("/operations/")[0];let o;n&&"httpOptions"in n&&(o=n.httpOptions);const a=await this.fetchPredictVideosOperationInternal({operationName:s.name,resourceName:r,config:{httpOptions:o}});return s._fromAPIResponse({apiResponse:a,_isVertexAI:!0})}else{const r=await this.getVideosOperationInternal({operationName:s.name,config:n});return s._fromAPIResponse({apiResponse:r,_isVertexAI:!1})}}async getVideosOperationInternal(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=ZC(e);return l=me("{operationName}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a}else{const d=QC(e);return l=me("{operationName}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a}}async fetchPredictVideosOperationInternal(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI()){const l=$C(e);return o=me("{resourceName}:fetchPredictOperation",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),r}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function cj(t){const e={},s=c(t,["data"]);if(s!=null&&h(e,["data"],s),c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=c(t,["mimeType"]);return n!=null&&h(e,["mimeType"],n),e}function dj(t){const e={},s=c(t,["parts"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>vj(o))),h(e,["parts"],r)}const n=c(t,["role"]);return n!=null&&h(e,["role"],n),e}function uj(t,e,s){const n={},r=c(e,["expireTime"]);s!==void 0&&r!=null&&h(s,["expireTime"],r);const o=c(e,["newSessionExpireTime"]);s!==void 0&&o!=null&&h(s,["newSessionExpireTime"],o);const a=c(e,["uses"]);s!==void 0&&a!=null&&h(s,["uses"],a);const l=c(e,["liveConnectConstraints"]);s!==void 0&&l!=null&&h(s,["bidiGenerateContentSetup"],yj(t,l));const u=c(e,["lockAdditionalFields"]);return s!==void 0&&u!=null&&h(s,["fieldMask"],u),n}function hj(t,e){const s={},n=c(e,["config"]);return n!=null&&h(s,["config"],uj(t,n,s)),s}function mj(t){const e={};if(c(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=c(t,["fileUri"]);s!=null&&h(e,["fileUri"],s);const n=c(t,["mimeType"]);return n!=null&&h(e,["mimeType"],n),e}function fj(t){const e={},s=c(t,["id"]);s!=null&&h(e,["id"],s);const n=c(t,["args"]);n!=null&&h(e,["args"],n);const r=c(t,["name"]);if(r!=null&&h(e,["name"],r),c(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(c(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function pj(t){const e={};if(c(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const s=c(t,["enableWidget"]);return s!=null&&h(e,["enableWidget"],s),e}function gj(t){const e={};if(c(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(c(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const s=c(t,["timeRangeFilter"]);return s!=null&&h(e,["timeRangeFilter"],s),e}function xj(t,e){const s={},n=c(t,["generationConfig"]);e!==void 0&&n!=null&&h(e,["setup","generationConfig"],n);const r=c(t,["responseModalities"]);e!==void 0&&r!=null&&h(e,["setup","generationConfig","responseModalities"],r);const o=c(t,["temperature"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","temperature"],o);const a=c(t,["topP"]);e!==void 0&&a!=null&&h(e,["setup","generationConfig","topP"],a);const l=c(t,["topK"]);e!==void 0&&l!=null&&h(e,["setup","generationConfig","topK"],l);const u=c(t,["maxOutputTokens"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","maxOutputTokens"],u);const d=c(t,["mediaResolution"]);e!==void 0&&d!=null&&h(e,["setup","generationConfig","mediaResolution"],d);const f=c(t,["seed"]);e!==void 0&&f!=null&&h(e,["setup","generationConfig","seed"],f);const p=c(t,["speechConfig"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","speechConfig"],Sd(p));const g=c(t,["thinkingConfig"]);e!==void 0&&g!=null&&h(e,["setup","generationConfig","thinkingConfig"],g);const v=c(t,["enableAffectiveDialog"]);e!==void 0&&v!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],v);const A=c(t,["systemInstruction"]);e!==void 0&&A!=null&&h(e,["setup","systemInstruction"],dj(Xt(A)));const k=c(t,["tools"]);if(e!==void 0&&k!=null){let E=Jr(k);Array.isArray(E)&&(E=E.map(w=>wj(Wr(w)))),h(e,["setup","tools"],E)}const S=c(t,["sessionResumption"]);e!==void 0&&S!=null&&h(e,["setup","sessionResumption"],bj(S));const L=c(t,["inputAudioTranscription"]);e!==void 0&&L!=null&&h(e,["setup","inputAudioTranscription"],L);const D=c(t,["outputAudioTranscription"]);e!==void 0&&D!=null&&h(e,["setup","outputAudioTranscription"],D);const j=c(t,["realtimeInputConfig"]);e!==void 0&&j!=null&&h(e,["setup","realtimeInputConfig"],j);const F=c(t,["contextWindowCompression"]);e!==void 0&&F!=null&&h(e,["setup","contextWindowCompression"],F);const q=c(t,["proactivity"]);if(e!==void 0&&q!=null&&h(e,["setup","proactivity"],q),c(t,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return s}function yj(t,e){const s={},n=c(e,["model"]);n!=null&&h(s,["setup","model"],Xe(t,n));const r=c(e,["config"]);return r!=null&&h(s,["config"],xj(r,s)),s}function vj(t){const e={},s=c(t,["mediaResolution"]);s!=null&&h(e,["mediaResolution"],s);const n=c(t,["codeExecutionResult"]);n!=null&&h(e,["codeExecutionResult"],n);const r=c(t,["executableCode"]);r!=null&&h(e,["executableCode"],r);const o=c(t,["fileData"]);o!=null&&h(e,["fileData"],mj(o));const a=c(t,["functionCall"]);a!=null&&h(e,["functionCall"],fj(a));const l=c(t,["functionResponse"]);l!=null&&h(e,["functionResponse"],l);const u=c(t,["inlineData"]);u!=null&&h(e,["inlineData"],cj(u));const d=c(t,["text"]);d!=null&&h(e,["text"],d);const f=c(t,["thought"]);f!=null&&h(e,["thought"],f);const p=c(t,["thoughtSignature"]);p!=null&&h(e,["thoughtSignature"],p);const g=c(t,["videoMetadata"]);return g!=null&&h(e,["videoMetadata"],g),e}function bj(t){const e={},s=c(t,["handle"]);if(s!=null&&h(e,["handle"],s),c(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function wj(t){const e={},s=c(t,["functionDeclarations"]);if(s!=null){let f=s;Array.isArray(f)&&(f=f.map(p=>p)),h(e,["functionDeclarations"],f)}if(c(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=c(t,["googleSearchRetrieval"]);n!=null&&h(e,["googleSearchRetrieval"],n);const r=c(t,["computerUse"]);r!=null&&h(e,["computerUse"],r);const o=c(t,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);const a=c(t,["codeExecution"]);if(a!=null&&h(e,["codeExecution"],a),c(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=c(t,["googleMaps"]);l!=null&&h(e,["googleMaps"],pj(l));const u=c(t,["googleSearch"]);u!=null&&h(e,["googleSearch"],gj(u));const d=c(t,["urlContext"]);return d!=null&&h(e,["urlContext"],d),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function _j(t){const e=[];for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){const n=t[s];if(typeof n=="object"&&n!=null&&Object.keys(n).length>0){const r=Object.keys(n).map(o=>`${s}.${o}`);e.push(...r)}else e.push(s)}return e.join(",")}function Nj(t,e){let s=null;const n=t.bidiGenerateContentSetup;if(typeof n=="object"&&n!==null&&"setup"in n){const o=n.setup;typeof o=="object"&&o!==null?(t.bidiGenerateContentSetup=o,s=o):delete t.bidiGenerateContentSetup}else n!==void 0&&delete t.bidiGenerateContentSetup;const r=t.fieldMask;if(s){const o=_j(s);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)o?t.fieldMask=o:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&r!==null&&Array.isArray(r)&&r.length>0){const a=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let l=[];r.length>0&&(l=r.map(d=>a.includes(d)?`generationConfig.${d}`:d));const u=[];o&&u.push(o),l.length>0&&u.push(...l),u.length>0?t.fieldMask=u.join(","):delete t.fieldMask}else delete t.fieldMask}else r!==null&&Array.isArray(r)&&r.length>0?t.fieldMask=r.join(","):delete t.fieldMask;return t}class Ej extends cn{constructor(e){super(),this.apiClient=e}async create(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const l=hj(this.apiClient,e);o=me("auth_tokens",l._url),a=l._query,delete l.config,delete l._url,delete l._query;const u=Nj(l,e.config);return r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),r.then(d=>d)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Tj(t,e){const s={},n=c(t,["force"]);return e!==void 0&&n!=null&&h(e,["_query","force"],n),s}function Ij(t){const e={},s=c(t,["name"]);s!=null&&h(e,["_url","name"],s);const n=c(t,["config"]);return n!=null&&Tj(n,e),e}function Cj(t){const e={},s=c(t,["name"]);return s!=null&&h(e,["_url","name"],s),e}function Sj(t,e){const s={},n=c(t,["pageSize"]);e!==void 0&&n!=null&&h(e,["_query","pageSize"],n);const r=c(t,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),s}function Aj(t){const e={},s=c(t,["parent"]);s!=null&&h(e,["_url","parent"],s);const n=c(t,["config"]);return n!=null&&Sj(n,e),e}function Rj(t){const e={},s=c(t,["sdkHttpResponse"]);s!=null&&h(e,["sdkHttpResponse"],s);const n=c(t,["nextPageToken"]);n!=null&&h(e,["nextPageToken"],n);const r=c(t,["documents"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>a)),h(e,["documents"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Pj extends cn{constructor(e){super(),this.apiClient=e,this.list=async s=>new fr(rn.PAGED_ITEM_DOCUMENTS,n=>this.listInternal({parent:s.parent,config:n.config}),await this.listInternal(s),s)}async get(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=Cj(e);return o=me("{name}",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),r.then(u=>u)}}async delete(e){var s,n;let r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Ij(e);r=me("{name}",a._url),o=a._query,delete a._url,delete a._query,await this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=Aj(e);return o=me("{parent}/documents",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),r.then(u=>{const d=Rj(u),f=new dS;return Object.assign(f,d),f})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class jj extends cn{constructor(e,s=new Pj(e)){super(),this.apiClient=e,this.documents=s,this.list=async(n={})=>new fr(rn.PAGED_ITEM_FILE_SEARCH_STORES,r=>this.listInternal(r),await this.listInternal(n),n)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=_P(e);return o=me("fileSearchStores",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),r.then(u=>u)}}async get(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=TP(e);return o=me("{name}",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),r.then(u=>u)}}async delete(e){var s,n;let r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=EP(e);r=me("{name}",a._url),o=a._query,delete a._url,delete a._query,await this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=PP(e);return o=me("fileSearchStores",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),r.then(u=>{const d=jP(u),f=new uS;return Object.assign(f,d),f})}}async uploadToFileSearchStoreInternal(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=kP(e);return o=me("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),r.then(u=>{const d=DP(u),f=new hS;return Object.assign(f,d),f})}}async importFile(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=SP(e);return o=me("{file_search_store_name}:importFile",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),r.then(u=>{const d=CP(u),f=new Nd;return Object.assign(f,d),f})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let d0=function(){const{crypto:t}=globalThis;if(t!=null&&t.randomUUID)return d0=t.randomUUID.bind(t),t.randomUUID();const e=new Uint8Array(1),s=t?()=>t.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^s()&15>>+n/4).toString(16))};const kj=()=>d0();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function dc(t){return typeof t=="object"&&t!==null&&("name"in t&&t.name==="AbortError"||"message"in t&&String(t.message).includes("FetchRequestCanceledException"))}const uc=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null){try{if(Object.prototype.toString.call(t)==="[object Error]"){const e=new Error(t.message,t.cause?{cause:t.cause}:{});return t.stack&&(e.stack=t.stack),t.cause&&!e.cause&&(e.cause=t.cause),t.name&&(e.name=t.name),e}}catch{}try{return new Error(JSON.stringify(t))}catch{}}return new Error(t)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class xs extends Error{}class is extends xs{constructor(e,s,n,r){super(`${is.makeMessage(e,s,n)}`),this.status=e,this.headers=r,this.error=s}static makeMessage(e,s,n){const r=s!=null&&s.message?typeof s.message=="string"?s.message:JSON.stringify(s.message):s?JSON.stringify(s):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,s,n,r){if(!e||!r)return new Xa({message:n,cause:uc(s)});const o=s;return e===400?new h0(e,o,n,r):e===401?new m0(e,o,n,r):e===403?new f0(e,o,n,r):e===404?new p0(e,o,n,r):e===409?new g0(e,o,n,r):e===422?new x0(e,o,n,r):e===429?new y0(e,o,n,r):e>=500?new v0(e,o,n,r):new is(e,o,n,r)}}class hc extends is{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Xa extends is{constructor({message:e,cause:s}){super(void 0,void 0,e||"Connection error.",void 0),s&&(this.cause=s)}}class u0 extends Xa{constructor({message:e}={}){super({message:e??"Request timed out."})}}class h0 extends is{}class m0 extends is{}class f0 extends is{}class p0 extends is{}class g0 extends is{}class x0 extends is{}class y0 extends is{}class v0 extends is{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Dj=/^[a-z][a-z0-9+.-]*:/i,Mj=t=>Dj.test(t);let mc=t=>(mc=Array.isArray,mc(t));const Lj=mc;let Vj=Lj;const Af=Vj;function Uj(t){if(!t)return!0;for(const e in t)return!1;return!0}function Fj(t,e){return Object.prototype.hasOwnProperty.call(t,e)}const Oj=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new xs(`${t} must be an integer`);if(e<0)throw new xs(`${t} must be a positive integer`);return e},zj=t=>{try{return JSON.parse(t)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Bj=t=>new Promise(e=>setTimeout(e,t));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const wr="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function qj(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const Gj=()=>{var t,e,s,n,r;const o=qj();if(o==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wr,"X-Stainless-OS":Pf(Deno.build.os),"X-Stainless-Arch":Rf(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(t=Deno.version)===null||t===void 0?void 0:t.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(o==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wr,"X-Stainless-OS":Pf((s=globalThis.process.platform)!==null&&s!==void 0?s:"unknown"),"X-Stainless-Arch":Rf((n=globalThis.process.arch)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(r=globalThis.process.version)!==null&&r!==void 0?r:"unknown"};const a=$j();return a?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${a.browser}`,"X-Stainless-Runtime-Version":a.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function $j(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:s}of t){const n=s.exec(navigator.userAgent);if(n){const r=n[1]||0,o=n[2]||0,a=n[3]||0;return{browser:e,version:`${r}.${o}.${a}`}}}return null}const Rf=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",Pf=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let _o;const Hj=()=>_o??(_o=Gj());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Wj(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function b0(...t){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...t)}function Jj(t){let e=Symbol.asyncIterator in t?t[Symbol.asyncIterator]():t[Symbol.iterator]();return b0({start(){},async pull(s){const{done:n,value:r}=await e.next();n?s.close():s.enqueue(r)},async cancel(){var s;await((s=e.return)===null||s===void 0?void 0:s.call(e))}})}function w0(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const s=await e.read();return s!=null&&s.done&&e.releaseLock(),s}catch(s){throw e.releaseLock(),s}},async return(){const s=e.cancel();return e.releaseLock(),await s,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Kj(t){var e,s;if(t===null||typeof t!="object")return;if(t[Symbol.asyncIterator]){await((s=(e=t[Symbol.asyncIterator]()).return)===null||s===void 0?void 0:s.call(e));return}const n=t.getReader(),r=n.cancel();n.releaseLock(),await r}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Yj=({headers:t,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const _0=()=>{var t;if(typeof File>"u"){const{process:e}=globalThis,s=typeof((t=e==null?void 0:e.versions)===null||t===void 0?void 0:t.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(s?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Sl(t,e,s){return _0(),new File(t,e??"unknown_file",s)}function Xj(t){return(typeof t=="object"&&t!==null&&("name"in t&&t.name&&String(t.name)||"url"in t&&t.url&&String(t.url)||"filename"in t&&t.filename&&String(t.filename)||"path"in t&&t.path&&String(t.path))||"").split(/[\\/]/).pop()||void 0}const Qj=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const N0=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",Zj=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&N0(t),ek=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function";async function tk(t,e,s){if(_0(),t=await t,Zj(t))return t instanceof File?t:Sl([await t.arrayBuffer()],t.name);if(ek(t)){const r=await t.blob();return e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()),Sl(await fc(r),e,s)}const n=await fc(t);if(e||(e=Xj(t)),!(s!=null&&s.type)){const r=n.find(o=>typeof o=="object"&&"type"in o&&o.type);typeof r=="string"&&(s=Object.assign(Object.assign({},s),{type:r}))}return Sl(n,e,s)}async function fc(t){var e,s,n,r,o;let a=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)a.push(t);else if(N0(t))a.push(t instanceof Blob?t:await t.arrayBuffer());else if(Qj(t))try{for(var l=!0,u=_s(t),d;d=await u.next(),e=d.done,!e;l=!0){r=d.value,l=!1;const f=r;a.push(...await fc(f))}}catch(f){s={error:f}}finally{try{!l&&!e&&(n=u.return)&&await n.call(u)}finally{if(s)throw s.error}}else{const f=(o=t==null?void 0:t.constructor)===null||o===void 0?void 0:o.name;throw new Error(`Unexpected data type: ${typeof t}${f?`; constructor: ${f}`:""}${sk(t)}`)}return a}function sk(t){return typeof t!="object"||t===null?"":`; props: [${Object.getOwnPropertyNames(t).map(s=>`"${s}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class E0{constructor(e){this._client=e}}E0._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function T0(t){return t.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const jf=Object.freeze(Object.create(null)),nk=(t=T0)=>function(s,...n){if(s.length===1)return s[0];let r=!1;const o=[],a=s.reduce((f,p,g)=>{var v,A,k;/[?#]/.test(p)&&(r=!0);const S=n[g];let L=(r?encodeURIComponent:t)(""+S);return g!==n.length&&(S==null||typeof S=="object"&&S.toString===((k=Object.getPrototypeOf((A=Object.getPrototypeOf((v=S.hasOwnProperty)!==null&&v!==void 0?v:jf))!==null&&A!==void 0?A:jf))===null||k===void 0?void 0:k.toString))&&(L=S+"",o.push({start:f.length+p.length,length:L.length,error:`Value of type ${Object.prototype.toString.call(S).slice(8,-1)} is not a valid path parameter`})),f+p+(g===n.length?"":L)},""),l=a.split(/[?#]/,1)[0],u=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let d;for(;(d=u.exec(l))!==null;)o.push({start:d.index,length:d[0].length,error:`Value "${d[0]}" can't be safely passed as a path parameter`});if(o.sort((f,p)=>f.start-p.start),o.length>0){let f=0;const p=o.reduce((g,v)=>{const A=" ".repeat(v.start-f),k="^".repeat(v.length);return f=v.start+v.length,g+A+k},"");throw new xs(`Path parameters result in path with invalid segments:
${o.map(g=>g.error).join(`
`)}
${a}
${p}`)}return a},No=nk(T0);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class I0 extends E0{create(e,s){var n;const{api_version:r=this._client.apiVersion}=e,o=pa(e,["api_version"]);if("model"in o&&"agent_config"in o)throw new xs("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in o&&"generation_config"in o)throw new xs("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(No`/${r}/interactions`,Object.assign(Object.assign({body:o},s),{stream:(n=e.stream)!==null&&n!==void 0?n:!1}))}delete(e,s={},n){const{api_version:r=this._client.apiVersion}=s??{};return this._client.delete(No`/${r}/interactions/${e}`,n)}cancel(e,s={},n){const{api_version:r=this._client.apiVersion}=s??{};return this._client.post(No`/${r}/interactions/${e}/cancel`,n)}get(e,s={},n){var r;const o=s??{},{api_version:a=this._client.apiVersion}=o,l=pa(o,["api_version"]);return this._client.get(No`/${a}/interactions/${e}`,Object.assign(Object.assign({query:l},n),{stream:(r=s==null?void 0:s.stream)!==null&&r!==void 0?r:!1}))}}I0._key=Object.freeze(["interactions"]);class C0 extends I0{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function rk(t){let e=0;for(const r of t)e+=r.length;const s=new Uint8Array(e);let n=0;for(const r of t)s.set(r,n),n+=r.length;return s}let Eo;function Rd(t){let e;return(Eo??(e=new globalThis.TextEncoder,Eo=e.encode.bind(e)))(t)}let To;function kf(t){let e;return(To??(e=new globalThis.TextDecoder,To=e.decode.bind(e)))(t)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Qa{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];const s=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Rd(e):e;this.buffer=rk([this.buffer,s]);const n=[];let r;for(;(r=ik(this.buffer,this.carriageReturnIndex))!=null;){if(r.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=r.index;continue}if(this.carriageReturnIndex!=null&&(r.index!==this.carriageReturnIndex+1||r.carriage)){n.push(kf(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const o=this.carriageReturnIndex!==null?r.preceding-1:r.preceding,a=kf(this.buffer.subarray(0,o));n.push(a),this.buffer=this.buffer.subarray(r.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode(`
`):[]}}Qa.NEWLINE_CHARS=new Set([`
`,"\r"]);Qa.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function ik(t,e){for(let r=e??0;r<t.length;r++){if(t[r]===10)return{preceding:r,index:r+1,carriage:!1};if(t[r]===13)return{preceding:r,index:r+1,carriage:!0}}return null}function ok(t){for(let n=0;n<t.length-1;n++){if(t[n]===10&&t[n+1]===10||t[n]===13&&t[n+1]===13)return n+2;if(t[n]===13&&t[n+1]===10&&n+3<t.length&&t[n+2]===13&&t[n+3]===10)return n+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ga={off:0,error:200,warn:300,info:400,debug:500},Df=(t,e,s)=>{if(t){if(Fj(ga,t))return t;ts(s).warn(`${e} was set to ${JSON.stringify(t)}, expected one of ${JSON.stringify(Object.keys(ga))}`)}};function pi(){}function Io(t,e,s){return!e||ga[t]>ga[s]?pi:e[t].bind(e)}const ak={error:pi,warn:pi,info:pi,debug:pi};let Mf=new WeakMap;function ts(t){var e;const s=t.logger,n=(e=t.logLevel)!==null&&e!==void 0?e:"off";if(!s)return ak;const r=Mf.get(s);if(r&&r[0]===n)return r[1];const o={error:Io("error",s,n),warn:Io("warn",s,n),info:Io("info",s,n),debug:Io("debug",s,n)};return Mf.set(s,[n,o]),o}const Wn=t=>(t.options&&(t.options=Object.assign({},t.options),delete t.options.headers),t.headers&&(t.headers=Object.fromEntries((t.headers instanceof Headers?[...t.headers]:Object.entries(t.headers)).map(([e,s])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":s]))),"retryOfRequestLogID"in t&&(t.retryOfRequestLogID&&(t.retryOf=t.retryOfRequestLogID),delete t.retryOfRequestLogID),t);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Er{constructor(e,s,n){this.iterator=e,this.controller=s,this.client=n}static fromSSEResponse(e,s,n){let r=!1;const o=n?ts(n):console;function a(){return ws(this,arguments,function*(){var u,d,f,p;if(r)throw new xs("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let g=!1;try{try{for(var v=!0,A=_s(lk(e,s)),k;k=yield Re(A.next()),u=k.done,!u;v=!0){p=k.value,v=!1;const S=p;if(!g)if(S.data.startsWith("[DONE]")){g=!0;continue}else try{yield yield Re(JSON.parse(S.data))}catch(L){throw o.error("Could not parse message into JSON:",S.data),o.error("From chunk:",S.raw),L}}}catch(S){d={error:S}}finally{try{!v&&!u&&(f=A.return)&&(yield Re(f.call(A)))}finally{if(d)throw d.error}}g=!0}catch(S){if(dc(S))return yield Re(void 0);throw S}finally{g||s.abort()}})}return new Er(a,s,n)}static fromReadableStream(e,s,n){let r=!1;function o(){return ws(this,arguments,function*(){var u,d,f,p;const g=new Qa,v=w0(e);try{for(var A=!0,k=_s(v),S;S=yield Re(k.next()),u=S.done,!u;A=!0){p=S.value,A=!1;const L=p;for(const D of g.decode(L))yield yield Re(D)}}catch(L){d={error:L}}finally{try{!A&&!u&&(f=k.return)&&(yield Re(f.call(k)))}finally{if(d)throw d.error}}for(const L of g.flush())yield yield Re(L)})}function a(){return ws(this,arguments,function*(){var u,d,f,p;if(r)throw new xs("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let g=!1;try{try{for(var v=!0,A=_s(o()),k;k=yield Re(A.next()),u=k.done,!u;v=!0){p=k.value,v=!1;const S=p;g||S&&(yield yield Re(JSON.parse(S)))}}catch(S){d={error:S}}finally{try{!v&&!u&&(f=A.return)&&(yield Re(f.call(A)))}finally{if(d)throw d.error}}g=!0}catch(S){if(dc(S))return yield Re(void 0);throw S}finally{g||s.abort()}})}return new Er(a,s,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],s=[],n=this.iterator(),r=o=>({next:()=>{if(o.length===0){const a=n.next();e.push(a),s.push(a)}return o.shift()}});return[new Er(()=>r(e),this.controller,this.client),new Er(()=>r(s),this.controller,this.client)]}toReadableStream(){const e=this;let s;return b0({async start(){s=e[Symbol.asyncIterator]()},async pull(n){try{const{value:r,done:o}=await s.next();if(o)return n.close();const a=Rd(JSON.stringify(r)+`
`);n.enqueue(a)}catch(r){n.error(r)}},async cancel(){var n;await((n=s.return)===null||n===void 0?void 0:n.call(s))}})}}function lk(t,e){return ws(this,arguments,function*(){var n,r,o,a;if(!t.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new xs("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new xs("Attempted to iterate over a response with no body");const l=new dk,u=new Qa,d=w0(t.body);try{for(var f=!0,p=_s(ck(d)),g;g=yield Re(p.next()),n=g.done,!n;f=!0){a=g.value,f=!1;const v=a;for(const A of u.decode(v)){const k=l.decode(A);k&&(yield yield Re(k))}}}catch(v){r={error:v}}finally{try{!f&&!n&&(o=p.return)&&(yield Re(o.call(p)))}finally{if(r)throw r.error}}for(const v of u.flush()){const A=l.decode(v);A&&(yield yield Re(A))}})}function ck(t){return ws(this,arguments,function*(){var s,n,r,o;let a=new Uint8Array;try{for(var l=!0,u=_s(t),d;d=yield Re(u.next()),s=d.done,!s;l=!0){o=d.value,l=!1;const f=o;if(f==null)continue;const p=f instanceof ArrayBuffer?new Uint8Array(f):typeof f=="string"?Rd(f):f;let g=new Uint8Array(a.length+p.length);g.set(a),g.set(p,a.length),a=g;let v;for(;(v=ok(a))!==-1;)yield yield Re(a.slice(0,v)),a=a.slice(v)}}catch(f){n={error:f}}finally{try{!l&&!s&&(r=u.return)&&(yield Re(r.call(u)))}finally{if(n)throw n.error}}a.length>0&&(yield yield Re(a))})}class dk{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(e),e.startsWith(":"))return null;let[s,n,r]=uk(e,":");return r.startsWith(" ")&&(r=r.substring(1)),s==="event"?this.event=r:s==="data"&&this.data.push(r),null}}function uk(t,e){const s=t.indexOf(e);return s!==-1?[t.substring(0,s),e,t.substring(s+e.length)]:[t,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function hk(t,e){const{response:s,requestLogID:n,retryOfRequestLogID:r,startTime:o}=e,a=await(async()=>{var l;if(e.options.stream)return ts(t).debug("response",s.status,s.url,s.headers,s.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(s,e.controller,t):Er.fromSSEResponse(s,e.controller,t);if(s.status===204)return null;if(e.options.__binaryResponse)return s;const u=s.headers.get("content-type"),d=(l=u==null?void 0:u.split(";")[0])===null||l===void 0?void 0:l.trim();return(d==null?void 0:d.includes("application/json"))||(d==null?void 0:d.endsWith("+json"))?await s.json():await s.text()})();return ts(t).debug(`[${n}] response parsed`,Wn({retryOfRequestLogID:r,url:s.url,status:s.status,body:a,durationMs:Date.now()-o})),a}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Pd extends Promise{constructor(e,s,n=hk){super(r=>{r(null)}),this.responsePromise=s,this.parseResponse=n,this.client=e}_thenUnwrap(e){return new Pd(this.client,this.responsePromise,async(s,n)=>e(await this.parseResponse(s,n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,s]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:s}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,s){return this.parse().then(e,s)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const S0=Symbol("brand.privateNullableHeaders");function*mk(t){if(!t)return;if(S0 in t){const{values:n,nulls:r}=t;yield*n.entries();for(const o of r)yield[o,null];return}let e=!1,s;t instanceof Headers?s=t.entries():Af(t)?s=t:(e=!0,s=Object.entries(t??{}));for(let n of s){const r=n[0];if(typeof r!="string")throw new TypeError("expected header name to be a string");const o=Af(n[1])?n[1]:[n[1]];let a=!1;for(const l of o)l!==void 0&&(e&&!a&&(a=!0,yield[r,null]),yield[r,l])}}const li=t=>{const e=new Headers,s=new Set;for(const n of t){const r=new Set;for(const[o,a]of mk(n)){const l=o.toLowerCase();r.has(l)||(e.delete(o),r.add(l)),a===null?(e.delete(o),s.add(l)):(e.append(o,a),s.delete(l))}}return{[S0]:!0,values:e,nulls:s}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Al=t=>{var e,s,n,r,o,a;if(typeof globalThis.process<"u")return(n=(s=(e=FC)===null||e===void 0?void 0:e[t])===null||s===void 0?void 0:s.trim())!==null&&n!==void 0?n:void 0;if(typeof globalThis.Deno<"u")return(a=(o=(r=globalThis.Deno.env)===null||r===void 0?void 0:r.get)===null||o===void 0?void 0:o.call(r,t))===null||a===void 0?void 0:a.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var A0;class Za{constructor(e){var s,n,r,o,a,l,u,{baseURL:d=Al("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:f=(s=Al("GEMINI_API_KEY"))!==null&&s!==void 0?s:null,apiVersion:p="v1beta"}=e,g=pa(e,["baseURL","apiKey","apiVersion"]);const v=Object.assign(Object.assign({apiKey:f,apiVersion:p},g),{baseURL:d||"https://generativelanguage.googleapis.com"});this.baseURL=v.baseURL,this.timeout=(n=v.timeout)!==null&&n!==void 0?n:Za.DEFAULT_TIMEOUT,this.logger=(r=v.logger)!==null&&r!==void 0?r:console;const A="warn";this.logLevel=A,this.logLevel=(a=(o=Df(v.logLevel,"ClientOptions.logLevel",this))!==null&&o!==void 0?o:Df(Al("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&a!==void 0?a:A,this.fetchOptions=v.fetchOptions,this.maxRetries=(l=v.maxRetries)!==null&&l!==void 0?l:2,this.fetch=(u=v.fetch)!==null&&u!==void 0?u:Wj(),this.encoder=Yj,this._options=v,this.apiKey=f,this.apiVersion=p,this.clientAdapter=v.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:s}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!s.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){const s=li([e.headers]);if(!(s.values.has("authorization")||s.values.has("x-goog-api-key"))){if(this.apiKey)return li([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return li([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([s,n])=>typeof n<"u").map(([s,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(s)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(s)}=`;throw new xs(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${wr}`}defaultIdempotencyKey(){return`stainless-node-retry-${kj()}`}makeStatusError(e,s,n,r){return is.generate(e,s,n,r)}buildURL(e,s,n){const r=!this.baseURLOverridden()&&n||this.baseURL,o=Mj(e)?new URL(e):new URL(r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return Uj(a)||(s=Object.assign(Object.assign({},a),s)),typeof s=="object"&&s&&!Array.isArray(s)&&(o.search=this.stringifyQuery(s)),o.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){const s=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${s}`}}async prepareRequest(e,{url:s,options:n}){}get(e,s){return this.methodRequest("get",e,s)}post(e,s){return this.methodRequest("post",e,s)}patch(e,s){return this.methodRequest("patch",e,s)}put(e,s){return this.methodRequest("put",e,s)}delete(e,s){return this.methodRequest("delete",e,s)}methodRequest(e,s,n){return this.request(Promise.resolve(n).then(r=>Object.assign({method:e,path:s},r)))}request(e,s=null){return new Pd(this,this.makeRequest(e,s,void 0))}async makeRequest(e,s,n){var r,o,a;const l=await e,u=(r=l.maxRetries)!==null&&r!==void 0?r:this.maxRetries;s==null&&(s=u),await this.prepareOptions(l);const{req:d,url:f,timeout:p}=await this.buildRequest(l,{retryCount:u-s});await this.prepareRequest(d,{url:f,options:l});const g="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),v=n===void 0?"":`, retryOf: ${n}`,A=Date.now();if(ts(this).debug(`[${g}] sending request`,Wn({retryOfRequestLogID:n,method:l.method,url:f,options:l,headers:d.headers})),!((o=l.signal)===null||o===void 0)&&o.aborted)throw new hc;const k=new AbortController,S=await this.fetchWithTimeout(f,d,p,k).catch(uc),L=Date.now();if(S instanceof globalThis.Error){const j=`retrying, ${s} attempts remaining`;if(!((a=l.signal)===null||a===void 0)&&a.aborted)throw new hc;const F=dc(S)||/timed? ?out/i.test(String(S)+("cause"in S?String(S.cause):""));if(s)return ts(this).info(`[${g}] connection ${F?"timed out":"failed"} - ${j}`),ts(this).debug(`[${g}] connection ${F?"timed out":"failed"} (${j})`,Wn({retryOfRequestLogID:n,url:f,durationMs:L-A,message:S.message})),this.retryRequest(l,s,n??g);throw ts(this).info(`[${g}] connection ${F?"timed out":"failed"} - error; no more retries left`),ts(this).debug(`[${g}] connection ${F?"timed out":"failed"} (error; no more retries left)`,Wn({retryOfRequestLogID:n,url:f,durationMs:L-A,message:S.message})),F?new u0:new Xa({cause:S})}const D=`[${g}${v}] ${d.method} ${f} ${S.ok?"succeeded":"failed"} with status ${S.status} in ${L-A}ms`;if(!S.ok){const j=await this.shouldRetry(S);if(s&&j){const _=`retrying, ${s} attempts remaining`;return await Kj(S.body),ts(this).info(`${D} - ${_}`),ts(this).debug(`[${g}] response error (${_})`,Wn({retryOfRequestLogID:n,url:S.url,status:S.status,headers:S.headers,durationMs:L-A})),this.retryRequest(l,s,n??g,S.headers)}const F=j?"error; no more retries left":"error; not retryable";ts(this).info(`${D} - ${F}`);const q=await S.text().catch(_=>uc(_).message),E=zj(q),w=E?void 0:q;throw ts(this).debug(`[${g}] response error (${F})`,Wn({retryOfRequestLogID:n,url:S.url,status:S.status,headers:S.headers,message:w,durationMs:Date.now()-A})),this.makeStatusError(S.status,E,w,S.headers)}return ts(this).info(D),ts(this).debug(`[${g}] response start`,Wn({retryOfRequestLogID:n,url:S.url,status:S.status,headers:S.headers,durationMs:L-A})),{response:S,options:l,controller:k,requestLogID:g,retryOfRequestLogID:n,startTime:A}}async fetchWithTimeout(e,s,n,r){const o=s||{},{signal:a,method:l}=o,u=pa(o,["signal","method"]);a&&a.addEventListener("abort",()=>r.abort());const d=setTimeout(()=>r.abort(),n),f=globalThis.ReadableStream&&u.body instanceof globalThis.ReadableStream||typeof u.body=="object"&&u.body!==null&&Symbol.asyncIterator in u.body,p=Object.assign(Object.assign(Object.assign({signal:r.signal},f?{duplex:"half"}:{}),{method:"GET"}),u);l&&(p.method=l.toUpperCase());try{return await this.fetch.call(void 0,e,p)}finally{clearTimeout(d)}}async shouldRetry(e){const s=e.headers.get("x-should-retry");return s==="true"?!0:s==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,s,n,r){var o;let a;const l=r==null?void 0:r.get("retry-after-ms");if(l){const d=parseFloat(l);Number.isNaN(d)||(a=d)}const u=r==null?void 0:r.get("retry-after");if(u&&!a){const d=parseFloat(u);Number.isNaN(d)?a=Date.parse(u)-Date.now():a=d*1e3}if(!(a&&0<=a&&a<60*1e3)){const d=(o=e.maxRetries)!==null&&o!==void 0?o:this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(s,d)}return await Bj(a),this.makeRequest(e,s-1,n)}calculateDefaultRetryTimeoutMillis(e,s){const o=s-e,a=Math.min(.5*Math.pow(2,o),8),l=1-Math.random()*.25;return a*l*1e3}async buildRequest(e,{retryCount:s=0}={}){var n,r,o;const a=Object.assign({},e),{method:l,path:u,query:d,defaultBaseURL:f}=a,p=this.buildURL(u,d,f);"timeout"in a&&Oj("timeout",a.timeout),a.timeout=(n=a.timeout)!==null&&n!==void 0?n:this.timeout;const{bodyHeaders:g,body:v}=this.buildBody({options:a}),A=await this.buildHeaders({options:e,method:l,bodyHeaders:g,retryCount:s});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:l,headers:A},a.signal&&{signal:a.signal}),globalThis.ReadableStream&&v instanceof globalThis.ReadableStream&&{duplex:"half"}),v&&{body:v}),(r=this.fetchOptions)!==null&&r!==void 0?r:{}),(o=a.fetchOptions)!==null&&o!==void 0?o:{}),url:p,timeout:a.timeout}}async buildHeaders({options:e,method:s,bodyHeaders:n,retryCount:r}){let o={};this.idempotencyHeader&&s!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);const a=await this.authHeaders(e);let l=li([o,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),Hj()),this._options.defaultHeaders,n,e.headers,a]);return this.validateHeaders(l),l.values}buildBody({options:{body:e,headers:s}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=li([s]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:Jj(e)}:this.encoder({body:e,headers:n})}}Za.DEFAULT_TIMEOUT=6e4;class Ft extends Za{constructor(){super(...arguments),this.interactions=new C0(this)}}A0=Ft;Ft.GeminiNextGenAPIClient=A0;Ft.GeminiNextGenAPIClientError=xs;Ft.APIError=is;Ft.APIConnectionError=Xa;Ft.APIConnectionTimeoutError=u0;Ft.APIUserAbortError=hc;Ft.NotFoundError=p0;Ft.ConflictError=g0;Ft.RateLimitError=y0;Ft.BadRequestError=h0;Ft.AuthenticationError=m0;Ft.InternalServerError=v0;Ft.PermissionDeniedError=f0;Ft.UnprocessableEntityError=x0;Ft.toFile=tk;Ft.Interactions=C0;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function fk(t,e){const s={},n=c(t,["name"]);return n!=null&&h(s,["_url","name"],n),s}function pk(t,e){const s={},n=c(t,["name"]);return n!=null&&h(s,["_url","name"],n),s}function gk(t,e){const s={},n=c(t,["sdkHttpResponse"]);return n!=null&&h(s,["sdkHttpResponse"],n),s}function xk(t,e){const s={},n=c(t,["sdkHttpResponse"]);return n!=null&&h(s,["sdkHttpResponse"],n),s}function yk(t,e,s){const n={};if(c(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const r=c(t,["tunedModelDisplayName"]);if(e!==void 0&&r!=null&&h(e,["displayName"],r),c(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const o=c(t,["epochCount"]);e!==void 0&&o!=null&&h(e,["tuningTask","hyperparameters","epochCount"],o);const a=c(t,["learningRateMultiplier"]);if(a!=null&&h(n,["tuningTask","hyperparameters","learningRateMultiplier"],a),c(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(c(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(c(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const l=c(t,["batchSize"]);e!==void 0&&l!=null&&h(e,["tuningTask","hyperparameters","batchSize"],l);const u=c(t,["learningRate"]);if(e!==void 0&&u!=null&&h(e,["tuningTask","hyperparameters","learningRate"],u),c(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(c(t,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return n}function vk(t,e,s){const n={};let r=c(s,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){const v=c(t,["validationDataset"]);e!==void 0&&v!=null&&h(e,["supervisedTuningSpec"],Lf(v))}else if(r==="PREFERENCE_TUNING"){const v=c(t,["validationDataset"]);e!==void 0&&v!=null&&h(e,["preferenceOptimizationSpec"],Lf(v))}const o=c(t,["tunedModelDisplayName"]);e!==void 0&&o!=null&&h(e,["tunedModelDisplayName"],o);const a=c(t,["description"]);e!==void 0&&a!=null&&h(e,["description"],a);let l=c(s,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){const v=c(t,["epochCount"]);e!==void 0&&v!=null&&h(e,["supervisedTuningSpec","hyperParameters","epochCount"],v)}else if(l==="PREFERENCE_TUNING"){const v=c(t,["epochCount"]);e!==void 0&&v!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],v)}let u=c(s,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const v=c(t,["learningRateMultiplier"]);e!==void 0&&v!=null&&h(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],v)}else if(u==="PREFERENCE_TUNING"){const v=c(t,["learningRateMultiplier"]);e!==void 0&&v!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],v)}let d=c(s,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const v=c(t,["exportLastCheckpointOnly"]);e!==void 0&&v!=null&&h(e,["supervisedTuningSpec","exportLastCheckpointOnly"],v)}else if(d==="PREFERENCE_TUNING"){const v=c(t,["exportLastCheckpointOnly"]);e!==void 0&&v!=null&&h(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],v)}let f=c(s,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const v=c(t,["adapterSize"]);e!==void 0&&v!=null&&h(e,["supervisedTuningSpec","hyperParameters","adapterSize"],v)}else if(f==="PREFERENCE_TUNING"){const v=c(t,["adapterSize"]);e!==void 0&&v!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],v)}if(c(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(c(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const p=c(t,["labels"]);e!==void 0&&p!=null&&h(e,["labels"],p);const g=c(t,["beta"]);return e!==void 0&&g!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","beta"],g),n}function bk(t,e){const s={},n=c(t,["baseModel"]);n!=null&&h(s,["baseModel"],n);const r=c(t,["preTunedModel"]);r!=null&&h(s,["preTunedModel"],r);const o=c(t,["trainingDataset"]);o!=null&&Pk(o);const a=c(t,["config"]);return a!=null&&yk(a,s),s}function wk(t,e){const s={},n=c(t,["baseModel"]);n!=null&&h(s,["baseModel"],n);const r=c(t,["preTunedModel"]);r!=null&&h(s,["preTunedModel"],r);const o=c(t,["trainingDataset"]);o!=null&&jk(o,s,e);const a=c(t,["config"]);return a!=null&&vk(a,s,e),s}function _k(t,e){const s={},n=c(t,["name"]);return n!=null&&h(s,["_url","name"],n),s}function Nk(t,e){const s={},n=c(t,["name"]);return n!=null&&h(s,["_url","name"],n),s}function Ek(t,e,s){const n={},r=c(t,["pageSize"]);e!==void 0&&r!=null&&h(e,["_query","pageSize"],r);const o=c(t,["pageToken"]);e!==void 0&&o!=null&&h(e,["_query","pageToken"],o);const a=c(t,["filter"]);return e!==void 0&&a!=null&&h(e,["_query","filter"],a),n}function Tk(t,e,s){const n={},r=c(t,["pageSize"]);e!==void 0&&r!=null&&h(e,["_query","pageSize"],r);const o=c(t,["pageToken"]);e!==void 0&&o!=null&&h(e,["_query","pageToken"],o);const a=c(t,["filter"]);return e!==void 0&&a!=null&&h(e,["_query","filter"],a),n}function Ik(t,e){const s={},n=c(t,["config"]);return n!=null&&Ek(n,s),s}function Ck(t,e){const s={},n=c(t,["config"]);return n!=null&&Tk(n,s),s}function Sk(t,e){const s={},n=c(t,["sdkHttpResponse"]);n!=null&&h(s,["sdkHttpResponse"],n);const r=c(t,["nextPageToken"]);r!=null&&h(s,["nextPageToken"],r);const o=c(t,["tunedModels"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>R0(l))),h(s,["tuningJobs"],a)}return s}function Ak(t,e){const s={},n=c(t,["sdkHttpResponse"]);n!=null&&h(s,["sdkHttpResponse"],n);const r=c(t,["nextPageToken"]);r!=null&&h(s,["nextPageToken"],r);const o=c(t,["tuningJobs"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>pc(l))),h(s,["tuningJobs"],a)}return s}function Rk(t,e){const s={},n=c(t,["name"]);n!=null&&h(s,["model"],n);const r=c(t,["name"]);return r!=null&&h(s,["endpoint"],r),s}function Pk(t,e){const s={};if(c(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(c(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const n=c(t,["examples"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),h(s,["examples","examples"],r)}return s}function jk(t,e,s){const n={};let r=c(s,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){const a=c(t,["gcsUri"]);e!==void 0&&a!=null&&h(e,["supervisedTuningSpec","trainingDatasetUri"],a)}else if(r==="PREFERENCE_TUNING"){const a=c(t,["gcsUri"]);e!==void 0&&a!=null&&h(e,["preferenceOptimizationSpec","trainingDatasetUri"],a)}let o=c(s,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const a=c(t,["vertexDatasetResource"]);e!==void 0&&a!=null&&h(e,["supervisedTuningSpec","trainingDatasetUri"],a)}else if(o==="PREFERENCE_TUNING"){const a=c(t,["vertexDatasetResource"]);e!==void 0&&a!=null&&h(e,["preferenceOptimizationSpec","trainingDatasetUri"],a)}if(c(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function R0(t,e){const s={},n=c(t,["sdkHttpResponse"]);n!=null&&h(s,["sdkHttpResponse"],n);const r=c(t,["name"]);r!=null&&h(s,["name"],r);const o=c(t,["state"]);o!=null&&h(s,["state"],Hx(o));const a=c(t,["createTime"]);a!=null&&h(s,["createTime"],a);const l=c(t,["tuningTask","startTime"]);l!=null&&h(s,["startTime"],l);const u=c(t,["tuningTask","completeTime"]);u!=null&&h(s,["endTime"],u);const d=c(t,["updateTime"]);d!=null&&h(s,["updateTime"],d);const f=c(t,["description"]);f!=null&&h(s,["description"],f);const p=c(t,["baseModel"]);p!=null&&h(s,["baseModel"],p);const g=c(t,["_self"]);return g!=null&&h(s,["tunedModel"],Rk(g)),s}function pc(t,e){const s={},n=c(t,["sdkHttpResponse"]);n!=null&&h(s,["sdkHttpResponse"],n);const r=c(t,["name"]);r!=null&&h(s,["name"],r);const o=c(t,["state"]);o!=null&&h(s,["state"],Hx(o));const a=c(t,["createTime"]);a!=null&&h(s,["createTime"],a);const l=c(t,["startTime"]);l!=null&&h(s,["startTime"],l);const u=c(t,["endTime"]);u!=null&&h(s,["endTime"],u);const d=c(t,["updateTime"]);d!=null&&h(s,["updateTime"],d);const f=c(t,["error"]);f!=null&&h(s,["error"],f);const p=c(t,["description"]);p!=null&&h(s,["description"],p);const g=c(t,["baseModel"]);g!=null&&h(s,["baseModel"],g);const v=c(t,["tunedModel"]);v!=null&&h(s,["tunedModel"],v);const A=c(t,["preTunedModel"]);A!=null&&h(s,["preTunedModel"],A);const k=c(t,["supervisedTuningSpec"]);k!=null&&h(s,["supervisedTuningSpec"],k);const S=c(t,["preferenceOptimizationSpec"]);S!=null&&h(s,["preferenceOptimizationSpec"],S);const L=c(t,["tuningDataStats"]);L!=null&&h(s,["tuningDataStats"],L);const D=c(t,["encryptionSpec"]);D!=null&&h(s,["encryptionSpec"],D);const j=c(t,["partnerModelTuningSpec"]);j!=null&&h(s,["partnerModelTuningSpec"],j);const F=c(t,["customBaseModel"]);F!=null&&h(s,["customBaseModel"],F);const q=c(t,["experiment"]);q!=null&&h(s,["experiment"],q);const E=c(t,["labels"]);E!=null&&h(s,["labels"],E);const w=c(t,["outputUri"]);w!=null&&h(s,["outputUri"],w);const b=c(t,["pipelineJob"]);b!=null&&h(s,["pipelineJob"],b);const _=c(t,["serviceAccount"]);_!=null&&h(s,["serviceAccount"],_);const T=c(t,["tunedModelDisplayName"]);T!=null&&h(s,["tunedModelDisplayName"],T);const R=c(t,["veoTuningSpec"]);return R!=null&&h(s,["veoTuningSpec"],R),s}function kk(t,e){const s={},n=c(t,["sdkHttpResponse"]);n!=null&&h(s,["sdkHttpResponse"],n);const r=c(t,["name"]);r!=null&&h(s,["name"],r);const o=c(t,["metadata"]);o!=null&&h(s,["metadata"],o);const a=c(t,["done"]);a!=null&&h(s,["done"],a);const l=c(t,["error"]);return l!=null&&h(s,["error"],l),s}function Lf(t,e){const s={},n=c(t,["gcsUri"]);n!=null&&h(s,["validationDatasetUri"],n);const r=c(t,["vertexDatasetResource"]);return r!=null&&h(s,["validationDatasetUri"],r),s}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Dk extends cn{constructor(e){super(),this.apiClient=e,this.list=async(s={})=>new fr(rn.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(s),s),this.get=async s=>await this.getInternal(s),this.tune=async s=>{var n;if(this.apiClient.isVertexAI())if(s.baseModel.startsWith("projects/")){const r={tunedModelName:s.baseModel};!((n=s.config)===null||n===void 0)&&n.preTunedModelCheckpointId&&(r.checkpointId=s.config.preTunedModelCheckpointId);const o=Object.assign(Object.assign({},s),{preTunedModel:r});return o.baseModel=void 0,await this.tuneInternal(o)}else{const r=Object.assign({},s);return await this.tuneInternal(r)}else{const r=Object.assign({},s),o=await this.tuneMldevInternal(r);let a="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?a=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(a=o.name.split("/operations/")[0]),{name:a,state:nc.JOB_STATE_QUEUED}}}}async getInternal(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=Nk(e);return l=me("{name}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>pc(f))}else{const d=_k(e);return l=me("{name}",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>R0(f))}}async listInternal(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=Ck(e);return l=me("tuningJobs",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=Ak(f),g=new lf;return Object.assign(g,p),g})}else{const d=Ik(e);return l=me("tunedModels",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=Sk(f),g=new lf;return Object.assign(g,p),g})}}async cancel(e){var s,n,r,o;let a,l="",u={};if(this.apiClient.isVertexAI()){const d=pk(e);return l=me("{name}:cancel",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=xk(f),g=new cf;return Object.assign(g,p),g})}else{const d=fk(e);return l=me("{name}:cancel",d._url),u=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),a.then(f=>{const p=gk(f),g=new cf;return Object.assign(g,p),g})}}async tuneInternal(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI()){const l=wk(e,e);return o=me("tuningJobs",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(d=>{const f=d;return f.sdkHttpResponse={headers:u.headers},f})),r.then(u=>pc(u))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var s,n;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=bk(e);return o=me("tunedModels",l._url),a=l._query,delete l._url,delete l._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json().then(d=>{const f=d;return f.sdkHttpResponse={headers:u.headers},f})),r.then(u=>kk(u))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Mk{async download(e,s){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const Lk=1024*1024*8,Vk=3,Uk=1e3,Fk=2,xa="x-goog-upload-status";async function Ok(t,e,s){var n;const r=await P0(t,e,s),o=await(r==null?void 0:r.json());if(((n=r==null?void 0:r.headers)===null||n===void 0?void 0:n[xa])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}async function zk(t,e,s){var n;const r=await P0(t,e,s),o=await(r==null?void 0:r.json());if(((n=r==null?void 0:r.headers)===null||n===void 0?void 0:n[xa])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const a=Ox(o),l=new Ed;return Object.assign(l,a),l}async function P0(t,e,s){var n,r;let o=0,a=0,l=new rc(new Response),u="upload";for(o=t.size;a<o;){const d=Math.min(Lk,o-a),f=t.slice(a,a+d);a+d>=o&&(u+=", finalize");let p=0,g=Uk;for(;p<Vk&&(l=await s.request({path:"",body:f,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(a),"Content-Length":String(d)}}}),!(!((n=l==null?void 0:l.headers)===null||n===void 0)&&n[xa]));)p++,await qk(g),g=g*Fk;if(a+=d,((r=l==null?void 0:l.headers)===null||r===void 0?void 0:r[xa])!=="active")break;if(o<=a)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return l}async function Bk(t){return{size:t.size,type:t.type}}function qk(t){return new Promise(e=>setTimeout(e,t))}class Gk{async upload(e,s,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Ok(e,s,n)}async uploadToFileSearchStore(e,s,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await zk(e,s,n)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Bk(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class $k{create(e,s,n){return new Hk(e,s,n)}}class Hk{constructor(e,s,n){this.url=e,this.headers=s,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Vf="x-goog-api-key";class Wk{constructor(e){this.apiKey=e}async addAuthHeaders(e,s){if(e.get(Vf)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(Vf,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Jk="gl-node/";class Kk{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const e=this.httpOptions;e!=null&&e.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const s=new Ft({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e==null?void 0:e.timeout});return this._interactions=s.interactions,this._interactions}constructor(e){var s;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(s=e.vertexai)!==null&&s!==void 0?s:!1,this.apiKey=e.apiKey;const n=qC(e.httpOptions,e.vertexai,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;const r=new Wk(this.apiKey);this.apiClient=new BP({auth:r,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:Jk+"web",uploader:new Gk,downloader:new Mk}),this.models=new aj(this.apiClient),this.live=new tj(this.apiClient,r,new $k),this.batches=new yA(this.apiClient),this.chats=new ZA(this.models,this.apiClient),this.caches=new YA(this.apiClient),this.files=new cR(this.apiClient),this.operations=new lj(this.apiClient),this.authTokens=new Ej(this.apiClient),this.tunings=new Dk(this.apiClient),this.fileSearchStores=new jj(this.apiClient)}}var Yk={};const Xk=new Kk({apiKey:Yk.API_KEY}),Qk=async(t,e="formal")=>{try{const s=`Escreva um pargrafo curto e profissional para uma newsletter interna de empresa sobre o tpico: "${t}". O tom deve ser ${e}. Mantenha o texto pronto para publicao, sem introdues como 'Aqui est o texto'.`;return(await Xk.models.generateContent({model:"gemini-3-flash-preview",contents:s})).text||"No foi possvel gerar o contedo."}catch(s){return console.error("Gemini API Error:",s),"Erro ao comunicar com a IA."}},Zk=()=>{const t=ir(),{currentUser:e}=Ut(),[s,n]=I.useState("editor"),[r,o]=I.useState([]),[a,l]=I.useState(!1),[u,d]=I.useState(null),[f,p]=I.useState(""),[g,v]=I.useState("Geral"),[A,k]=I.useState(!0),[S,L]=I.useState("https://picsum.photos/800/400"),[D,j]=I.useState([{id:"1",type:"header",content:"Novo Ttulo",style:{fontSize:"24px",fontWeight:"bold",color:"#1f2937"}},{id:"2",type:"paragraph",content:"Comece a escrever sua notcia...",style:{fontSize:"16px",color:"#4b5563",textAlign:"left"}}]),[F,q]=I.useState(!1),[E,w]=I.useState(""),[b,_]=I.useState(!1),[T,R]=I.useState(!1);I.useEffect(()=>{s==="list"&&M()},[s,e]);const M=async()=>{if(e){l(!0);try{const se=(await wd()).filter(le=>le.authorUid===e.uid||le.author===e.name);o(se)}catch(z){console.error("Erro ao carregar posts",z)}finally{l(!1)}}},C=z=>{d(z.id),p(z.title),v(z.category),k(z.isPublic??!0),L(z.thumbnail),j(z.blocks),n("editor")},ge=async z=>{if(window.confirm("Tem certeza que deseja excluir esta publicao?"))try{await _C(z),M()}catch{alert("Erro ao excluir postagem.")}},_e=()=>{d(null),p(""),v("Geral"),k(!0),L("https://picsum.photos/800/400"),j([{id:"1",type:"header",content:"Novo Ttulo",style:{fontSize:"24px",fontWeight:"bold",color:"#1f2937"}},{id:"2",type:"paragraph",content:"Comece a escrever sua notcia...",style:{fontSize:"16px",color:"#4b5563",textAlign:"left"}}]),n("editor")},P=z=>{let se="Novo bloco...",le={fontSize:"16px",color:"#333"},be="";z==="image"?se="https://picsum.photos/800/400":z==="header"?(se="Novo Ttulo",le={fontSize:"20px",fontWeight:"bold",color:"#111827"}):z==="button"?(se="Clique Aqui",be="https://google.com",le={backgroundColor:"#059669",color:"#ffffff",fontSize:"14px",fontWeight:"bold",textAlign:"center",padding:"12px 24px",borderRadius:"8px"}):z==="side-by-side"&&(se="Descreva aqui o contedo que ficar ao lado da imagem.",be="https://picsum.photos/600/400",le={layoutDirection:"row"});const qe={id:Date.now().toString(),type:z,content:se,url:be||void 0,style:le};j([...D,qe])},Z=z=>{j(D.filter(se=>se.id!==z))},B=(z,se)=>{const le=[...D];se==="up"&&z>0?[le[z-1],le[z]]=[le[z],le[z-1]]:se==="down"&&z<le.length-1&&([le[z+1],le[z]]=[le[z],le[z+1]]),j(le)},$=(z,se)=>{j(D.map(le=>le.id===z?{...le,content:se}:le))},U=(z,se)=>{j(D.map(le=>le.id===z?{...le,url:se}:le))},te=(z,se)=>{j(D.map(le=>le.id===z?{...le,style:{...le.style,...se}}:le))},re=async()=>{if(!E)return;_(!0);const z=await Qk(E),se={id:Date.now().toString(),type:"paragraph",content:z,style:{fontSize:"16px",color:"#4b5563"}};j([...D,se]),_(!1),w("")},ie=async()=>{if(!f)return alert("O ttulo  obrigatrio");if(!e)return alert("Voc precisa estar logado para publicar");R(!0);try{const z=D.map(le=>({...le,url:le.url||null,style:{...le.style}})),se={title:f,category:g,isPublic:A,thumbnail:S,blocks:z,date:new Date().toISOString(),published:!0,author:e.name,authorUid:e.uid,authorAvatar:e.avatar||null,externalUrl:null};u?(await wC(u,se),alert("Postagem atualizada com sucesso!")):(await bC(se),alert("Postagem publicada com sucesso!")),t("/dashboard")}catch(z){console.error("Erro ao salvar post:",z),alert(`Erro ao salvar postagem: ${z.message||"Erro desconhecido"}`)}finally{R(!1)}},K=(z,se)=>{const le="w-full bg-white border border-slate-200 rounded-lg p-3 text-sm text-slate-900 focus:ring-2 focus:ring-emerald-500 shadow-sm transition-all outline-none";return i.jsxs("div",{className:"relative group border border-slate-100 hover:border-emerald-300 rounded-2xl p-5 bg-white transition-all shadow-sm",children:[i.jsxs("div",{className:"absolute -top-3 right-6 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity bg-white shadow-xl rounded-full px-3 py-1.5 border border-slate-200 z-20",children:[i.jsxs("div",{className:"flex gap-0.5 mr-2 pr-2 border-r border-slate-100",children:[i.jsx("button",{onClick:()=>B(se,"up"),disabled:se===0,className:"p-1 text-slate-400 hover:text-emerald-600 disabled:opacity-20",children:i.jsx(Ri,{size:16})}),i.jsx("button",{onClick:()=>B(se,"down"),disabled:se===D.length-1,className:"p-1 text-slate-400 hover:text-emerald-600 disabled:opacity-20",children:i.jsx(Pi,{size:16})})]}),i.jsx("button",{onClick:()=>Z(z.id),className:"p-1.5 text-red-500 hover:bg-red-50 rounded-lg",title:"Remover",children:i.jsx(st,{size:16})}),z.type==="side-by-side"&&i.jsxs("button",{onClick:()=>te(z.id,{layoutDirection:z.style.layoutDirection==="row"?"row-reverse":"row"}),className:"p-1.5 text-emerald-600 hover:bg-emerald-50 rounded-lg flex items-center gap-1 text-xs font-bold",title:"Inverter Lados",children:[i.jsx(yy,{size:14})," Inverter"]}),z.type!=="image"&&z.type!=="button"&&z.type!=="side-by-side"&&i.jsx("div",{className:"flex items-center gap-2 ml-2 pl-2 border-l border-slate-100",children:i.jsx("input",{type:"color",value:z.style.color||"#000000",onChange:be=>te(z.id,{color:be.target.value}),className:"w-6 h-6 p-0 border-0 rounded-full overflow-hidden cursor-pointer shadow-sm",title:"Cor do Texto"})})]}),i.jsx("div",{className:"space-y-4",children:z.type==="image"?i.jsxs("div",{className:"space-y-2",children:[i.jsx("div",{className:"bg-slate-50 h-48 rounded-xl flex items-center justify-center overflow-hidden border border-slate-200",children:i.jsx("img",{src:z.content,alt:"Preview",className:"h-full object-cover"})}),i.jsxs("div",{className:"relative",children:[i.jsx(As,{className:"absolute left-3 top-3 text-slate-400",size:16}),i.jsx("input",{type:"text",value:z.content,onChange:be=>$(z.id,be.target.value),className:`${le} pl-10`,placeholder:"URL da Imagem..."})]})]}):z.type==="side-by-side"?i.jsxs("div",{className:`flex flex-col md:flex-row gap-6 items-center ${z.style.layoutDirection==="row-reverse"?"md:flex-row-reverse":""}`,children:[i.jsxs("div",{className:"w-full md:w-1/2 space-y-2",children:[i.jsx("div",{className:"aspect-video bg-slate-50 rounded-xl overflow-hidden border border-slate-200",children:i.jsx("img",{src:z.url,alt:"",className:"w-full h-full object-cover"})}),i.jsxs("div",{className:"relative",children:[i.jsx(As,{className:"absolute left-3 top-3 text-slate-400",size:16}),i.jsx("input",{type:"text",value:z.url||"",onChange:be=>U(z.id,be.target.value),className:`${le} pl-10 text-xs`,placeholder:"URL da Imagem lateral..."})]})]}),i.jsxs("div",{className:"w-full md:w-1/2",children:[i.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-400 mb-1 block",children:"Texto Lateral"}),i.jsx("textarea",{value:z.content,onChange:be=>$(z.id,be.target.value),className:`${le} min-h-[140px]`,placeholder:"Escreva aqui..."})]})]}):z.type==="button"?i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-400 mb-1 block",children:"Texto do Boto"}),i.jsxs("div",{className:"relative",children:[i.jsx(gi,{className:"absolute left-3 top-3 text-slate-400",size:16}),i.jsx("input",{type:"text",value:z.content,onChange:be=>$(z.id,be.target.value),className:`${le} pl-10`,placeholder:"Ex: Acessar Link"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-400 mb-1 block",children:"Link de Destino (URL)"}),i.jsxs("div",{className:"relative",children:[i.jsx(ya,{className:"absolute left-3 top-3 text-slate-400",size:16}),i.jsx("input",{type:"text",value:z.url||"",onChange:be=>U(z.id,be.target.value),className:`${le} pl-10`,placeholder:"Ex: https://..."})]})]})]}),i.jsx("div",{className:"p-4 bg-slate-50 border border-slate-100 rounded-xl flex justify-center shadow-inner",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("span",{className:"text-xs text-slate-400 font-bold uppercase tracking-tight",children:"Estilo do Boto:"}),i.jsx("input",{type:"color",value:z.style.backgroundColor||"#059669",onChange:be=>te(z.id,{backgroundColor:be.target.value}),className:"w-8 h-8 p-0 border-0 rounded-lg cursor-pointer shadow-sm",title:"Cor de Fundo"}),i.jsx("input",{type:"color",value:z.style.color||"#ffffff",onChange:be=>te(z.id,{color:be.target.value}),className:"w-8 h-8 p-0 border-0 rounded-lg cursor-pointer shadow-sm",title:"Cor do Texto"}),i.jsx("div",{className:"h-8 w-px bg-slate-200 mx-2"}),i.jsx("div",{className:"px-4 py-2 rounded-lg text-sm font-bold shadow-sm",style:{backgroundColor:z.style.backgroundColor,color:z.style.color},children:z.content||"Preview"})]})})]}):i.jsx("textarea",{value:z.content,onChange:be=>$(z.id,be.target.value),style:{...z.style},className:`${le} resize-y min-h-[100px] border-none bg-transparent shadow-none focus:ring-0 px-0`,placeholder:z.type==="header"?"Digite o ttulo aqui...":"Escreva o pargrafo aqui..."})}),i.jsx("div",{className:"absolute bottom-2 right-4 text-[9px] uppercase text-slate-300 font-black tracking-[0.2em] pointer-events-none select-none flex items-center gap-1",children:z.type})]},z.id)},ve=z=>{const se={...z.style};switch(z.type){case"header":return i.jsx("h2",{style:se,className:"mb-4 text-3xl font-extrabold",children:z.content},z.id);case"image":return i.jsx("img",{src:z.content,alt:"Content",className:"w-full rounded-2xl shadow-lg mb-8"},z.id);case"side-by-side":return i.jsxs("div",{className:`flex flex-col md:flex-row gap-8 items-center mb-10 ${z.style.layoutDirection==="row-reverse"?"md:flex-row-reverse":""}`,children:[i.jsx("div",{className:"w-full md:w-1/2",children:i.jsx("img",{src:z.url,alt:"",className:"w-full rounded-2xl shadow-md object-cover"})}),i.jsx("div",{className:"w-full md:w-1/2 text-slate-700 leading-relaxed text-lg italic md:not-italic",children:z.content})]},z.id);case"quote":return i.jsxs("blockquote",{style:se,className:"border-l-8 border-emerald-500 pl-6 py-4 italic my-8 bg-slate-50 text-xl text-slate-600 rounded-r-2xl",children:['"',z.content,'"']},z.id);case"button":return i.jsx("div",{className:"my-10 text-center",children:i.jsx("a",{href:z.url,target:"_blank",rel:"noopener noreferrer",className:"inline-block transition-all hover:scale-105 shadow-xl hover:shadow-2xl px-10 py-4 font-black uppercase tracking-wider",style:{backgroundColor:z.style.backgroundColor,color:z.style.color,borderRadius:"12px",fontSize:"16px",textDecoration:"none"},children:z.content})},z.id);default:return i.jsx("p",{style:se,className:"mb-6 leading-relaxed text-slate-700 text-lg whitespace-pre-wrap",children:z.content},z.id)}};return i.jsxs("div",{className:"h-[calc(100vh-100px)] flex flex-col gap-4",children:[i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 p-2 flex justify-between items-center shrink-0",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("button",{onClick:()=>n("editor"),className:`flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-bold transition-all ${s==="editor"?"bg-emerald-600 text-white shadow-lg shadow-emerald-100":"text-slate-500 hover:bg-slate-50"}`,children:[i.jsx(hy,{size:20})," ",u?"Editando Notcia":"Editor"]}),i.jsxs("button",{onClick:()=>n("list"),className:`flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-bold transition-all ${s==="list"?"bg-emerald-600 text-white shadow-lg shadow-emerald-100":"text-slate-500 hover:bg-slate-50"}`,children:[i.jsx(yu,{size:20})," Minhas Publicaes"]})]}),s==="editor"&&u&&i.jsx("button",{onClick:_e,className:"text-xs text-emerald-600 font-bold hover:underline px-4",children:"Criar Nova Notcia (Limpar)"})]}),s==="list"?i.jsxs("div",{className:"bg-white rounded-[2rem] shadow-sm border border-slate-200 overflow-hidden flex-1 flex flex-col animate-fade-in",children:[i.jsxs("div",{className:"p-8 border-b border-slate-100 bg-slate-50/50 flex justify-between items-end",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-black text-slate-800 uppercase tracking-tight",children:"Suas publicaes"}),i.jsxs("p",{className:"text-slate-500 text-sm",children:["Gerenciando contedo como: ",i.jsx("span",{className:"font-bold text-emerald-600",children:e==null?void 0:e.name})]})]}),i.jsxs("button",{onClick:_e,className:"bg-emerald-600 text-white px-5 py-2 rounded-xl text-xs font-black uppercase tracking-wider hover:bg-emerald-700 transition-all shadow-lg shadow-emerald-100 flex items-center gap-2",children:[i.jsx(Pt,{size:16})," Nova Postagem"]})]}),i.jsx("div",{className:"flex-1 overflow-y-auto p-8 custom-scrollbar",children:a?i.jsxs("div",{className:"flex flex-col items-center justify-center p-20 gap-3 text-slate-400",children:[i.jsx(Ne,{className:"animate-spin",size:40}),i.jsx("p",{className:"font-bold",children:"Buscando seus posts..."})]}):r.length>0?i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:r.map(z=>i.jsxs("div",{className:"flex gap-5 p-5 border border-slate-100 rounded-3xl hover:shadow-xl hover:border-emerald-100 transition-all bg-white group",children:[i.jsx("img",{src:z.thumbnail,alt:"",className:"w-32 h-32 object-cover rounded-2xl shadow-sm group-hover:scale-105 transition-transform"}),i.jsxs("div",{className:"flex-1 flex flex-col justify-between",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("span",{className:"text-[10px] uppercase font-black text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-lg border border-emerald-100",children:z.category}),z.isPublic?i.jsxs("span",{className:"text-[10px] uppercase font-black text-blue-600 bg-blue-50 px-2 py-0.5 rounded-lg border border-blue-100 flex items-center gap-1",children:[i.jsx(Js,{size:10})," Pblico"]}):i.jsxs("span",{className:"text-[10px] uppercase font-black text-slate-500 bg-slate-50 px-2 py-0.5 rounded-lg border border-slate-200 flex items-center gap-1",children:[i.jsx(jt,{size:10})," Interno"]})]}),i.jsx("h3",{className:"font-bold text-slate-800 mt-2 line-clamp-2 leading-snug",children:z.title}),i.jsxs("p",{className:"text-[10px] text-slate-400 flex items-center gap-1 mt-1 font-bold",children:[i.jsx(Gt,{size:12})," ",new Date(z.date).toLocaleDateString()]})]}),i.jsxs("div",{className:"flex gap-2 mt-4",children:[i.jsxs("button",{onClick:()=>C(z),className:"flex-1 flex items-center justify-center gap-2 py-2 bg-slate-100 text-slate-700 rounded-xl text-xs font-bold hover:bg-emerald-600 hover:text-white transition-all shadow-sm",children:[i.jsx(my,{size:14})," Editar"]}),i.jsx("button",{onClick:()=>ge(z.id),className:"p-2 bg-slate-50 text-slate-400 hover:text-red-600 rounded-xl transition-colors border border-transparent hover:border-red-100",children:i.jsx(st,{size:16})})]})]})]},z.id))}):i.jsxs("div",{className:"text-center py-32 text-slate-400",children:[i.jsx("div",{className:"w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6",children:i.jsx(yu,{size:40,className:"opacity-20"})}),i.jsx("p",{className:"text-xl font-bold text-slate-500",children:"Nenhuma postagem encontrada."}),i.jsx("button",{onClick:_e,className:"text-emerald-600 font-bold hover:underline mt-2",children:"Clique para criar sua primeira notcia"})]})})]}):i.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 flex-1 overflow-hidden relative animate-fade-in",children:[i.jsxs("div",{className:`flex-1 flex flex-col bg-white rounded-[2rem] shadow-sm border border-slate-200 overflow-hidden transition-all duration-500 ${F?"hidden lg:flex":"flex"}`,children:[i.jsxs("div",{className:"p-5 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 bg-white rounded-lg border border-slate-200 shadow-sm text-slate-500",children:i.jsx(Ws,{size:18})}),i.jsx("span",{className:"font-black text-slate-800 uppercase tracking-widest text-xs",children:"Configurao do Contedo"})]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsxs("button",{onClick:()=>q(!F),className:`flex items-center gap-2 px-5 py-2 text-sm font-bold rounded-xl transition-all shadow-sm border ${F?"bg-emerald-50 border-emerald-100 text-emerald-700":"bg-white border-slate-200 text-emerald-600 hover:bg-emerald-50 hover:border-emerald-100"}`,children:[F?i.jsx(ba,{size:18}):i.jsx(Ks,{size:18}),F?"Voltar para Editor":"Visualizar Post"]}),i.jsxs("button",{onClick:ie,disabled:T,className:"flex items-center gap-2 px-6 py-2 text-sm font-bold text-white bg-emerald-600 rounded-xl hover:bg-emerald-700 disabled:opacity-50 shadow-lg shadow-emerald-100",children:[T?i.jsx(Ne,{className:"animate-spin",size:18}):i.jsx(hs,{size:18}),u?"Salvar Alteraes":"Publicar Notcia"]})]})]}),i.jsxs("div",{className:"flex-1 overflow-y-auto p-8 space-y-8 custom-scrollbar",children:[i.jsxs("div",{className:"space-y-6",children:[i.jsx("input",{type:"text",value:f,onChange:z=>p(z.target.value),className:"w-full text-4xl font-black text-slate-900 bg-transparent border-none focus:ring-0 placeholder:text-slate-200 transition-all outline-none",placeholder:"TTULO DA NOTCIA..."}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 bg-slate-50 p-5 rounded-3xl border border-slate-200 shadow-inner",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2 ml-1",children:"Categoria"}),i.jsxs("div",{className:"relative",children:[i.jsx($f,{size:16,className:"absolute left-3 top-3 text-slate-400"}),i.jsxs("select",{value:g,onChange:z=>v(z.target.value),className:"bg-white border border-slate-200 text-slate-900 text-sm rounded-xl focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 pl-10 shadow-sm transition-all outline-none",children:[i.jsx("option",{value:"Geral",children:"Geral"}),i.jsx("option",{value:"RH",children:"RH"}),i.jsx("option",{value:"TI",children:"TI"}),i.jsx("option",{value:"Segurana",children:"Segurana"}),i.jsx("option",{value:"Eventos",children:"Eventos"}),i.jsx("option",{value:"Financeiro",children:"Financeiro"}),i.jsx("option",{value:"Institucional",children:"Institucional"})]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2 ml-1",children:"Visibilidade"}),i.jsxs("div",{className:"flex bg-white rounded-xl p-1 border border-slate-200",children:[i.jsxs("button",{onClick:()=>k(!0),className:`flex-1 flex items-center justify-center gap-2 py-1.5 rounded-lg text-xs font-bold transition-all ${A?"bg-emerald-600 text-white shadow-sm":"text-slate-500 hover:bg-slate-50"}`,children:[i.jsx(Js,{size:14})," Pblico"]}),i.jsxs("button",{onClick:()=>k(!1),className:`flex-1 flex items-center justify-center gap-2 py-1.5 rounded-lg text-xs font-bold transition-all ${A?"text-slate-500 hover:bg-slate-50":"bg-slate-700 text-white shadow-sm"}`,children:[i.jsx(jt,{size:14})," Interno"]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2 ml-1",children:"Imagem de Capa (URL)"}),i.jsxs("div",{className:"relative",children:[i.jsx(As,{size:16,className:"absolute left-3 top-3 text-slate-400"}),i.jsx("input",{type:"text",value:S,onChange:z=>L(z.target.value),className:"bg-white border border-slate-200 text-slate-900 text-sm rounded-xl focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2.5 pl-10 shadow-sm transition-all outline-none",placeholder:"URL da Capa..."})]})]})]}),i.jsxs("div",{className:`p-3 rounded-xl border flex items-start gap-3 transition-all ${A?"bg-blue-50 border-blue-100 text-blue-700":"bg-slate-50 border-slate-100 text-slate-600"}`,children:[i.jsx(Bi,{size:18,className:"shrink-0 mt-0.5"}),i.jsx("p",{className:"text-[11px] font-medium leading-relaxed",children:A?"Este comunicado ser exibido no Portal do Visitante (pblico) e no Dashboard de todos os colaboradores.":"Este comunicado ser visvel apenas internamente para colaboradores que acessam o sistema com login."})]})]}),i.jsx("div",{className:"space-y-6",children:D.map((z,se)=>K(z,se))}),i.jsxs("div",{className:"bg-slate-50 border-2 border-dashed border-slate-200 rounded-[2rem] p-8 shadow-inner",children:[i.jsx("p",{className:"text-center text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] mb-6",children:"Inserir novos elements no layout"}),i.jsxs("div",{className:"flex flex-wrap justify-center gap-4",children:[i.jsxs("button",{onClick:()=>P("paragraph"),className:"flex flex-col items-center gap-2 p-4 min-w-[100px] bg-white text-slate-600 rounded-2xl hover:bg-emerald-50 hover:text-emerald-600 transition-all border border-slate-200 hover:border-emerald-100 group shadow-sm",children:[i.jsx("div",{className:"p-3 bg-slate-50 rounded-xl group-hover:bg-white transition-all",children:i.jsx(gi,{size:20})}),i.jsx("span",{className:"text-[10px] font-bold uppercase",children:"Pargrafo"})]}),i.jsxs("button",{onClick:()=>P("header"),className:"flex flex-col items-center gap-2 p-4 min-w-[100px] bg-white text-slate-600 rounded-2xl hover:bg-emerald-50 hover:text-emerald-600 transition-all border border-slate-200 hover:border-emerald-100 group shadow-sm",children:[i.jsx("div",{className:"p-3 bg-slate-50 rounded-xl group-hover:bg-white transition-all",children:i.jsx(gi,{size:20,className:"font-bold"})}),i.jsx("span",{className:"text-[10px] font-bold uppercase",children:"Ttulo"})]}),i.jsxs("button",{onClick:()=>P("image"),className:"flex flex-col items-center gap-2 p-4 min-w-[100px] bg-white text-slate-600 rounded-2xl hover:bg-emerald-50 hover:text-emerald-600 transition-all border border-slate-200 hover:border-emerald-100 group shadow-sm",children:[i.jsx("div",{className:"p-3 bg-slate-50 rounded-xl group-hover:bg-white transition-all",children:i.jsx(As,{size:20})}),i.jsx("span",{className:"text-[10px] font-bold uppercase",children:"Imagem Full"})]}),i.jsxs("button",{onClick:()=>P("side-by-side"),className:"flex flex-col items-center gap-2 p-4 min-w-[100px] bg-white text-emerald-600 rounded-2xl hover:bg-emerald-50 transition-all border border-slate-200 hover:border-emerald-200 group shadow-sm",children:[i.jsx("div",{className:"p-3 bg-emerald-50 rounded-xl group-hover:bg-white transition-all",children:i.jsx(fy,{size:20})}),i.jsx("span",{className:"text-[10px] font-bold uppercase",children:"Lado a Lado"})]}),i.jsxs("button",{onClick:()=>P("quote"),className:"flex flex-col items-center gap-2 p-4 min-w-[100px] bg-white text-slate-600 rounded-2xl hover:bg-emerald-50 hover:text-emerald-600 transition-all border border-slate-200 hover:border-emerald-100 group shadow-sm",children:[i.jsx("div",{className:"p-3 bg-slate-50 rounded-xl group-hover:bg-white transition-all",children:i.jsx(py,{size:20})}),i.jsx("span",{className:"text-[10px] font-bold uppercase",children:"Citao"})]}),i.jsxs("button",{onClick:()=>P("button"),className:"flex flex-col items-center gap-2 p-4 min-w-[100px] bg-white text-emerald-700 rounded-2xl hover:bg-emerald-50 transition-all border border-slate-200 hover:border-emerald-100 group shadow-sm",children:[i.jsx("div",{className:"p-3 bg-emerald-50 rounded-xl group-hover:bg-white transition-all",children:i.jsx(gy,{size:20})}),i.jsx("span",{className:"text-[10px] font-bold uppercase",children:"Boto Link"})]})]})]})]}),i.jsxs("div",{className:"p-6 bg-slate-900 text-white rounded-b-[2rem]",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[i.jsx("div",{className:"p-1.5 bg-purple-500/20 rounded-lg text-purple-400",children:i.jsx(xy,{size:18})}),i.jsx("span",{className:"text-sm font-black uppercase tracking-widest text-purple-200",children:"Redao Assistida (IA)"})]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("input",{type:"text",value:E,onChange:z=>w(z.target.value),placeholder:"Ex: Escreva um comunicado sobre o dia do trabalhador...",className:"flex-1 bg-white/5 border-none rounded-2xl px-5 py-3 text-sm text-white focus:ring-2 focus:ring-purple-500 placeholder:text-slate-600 transition-all outline-none",onKeyDown:z=>z.key==="Enter"&&re()}),i.jsx("button",{onClick:re,disabled:b,className:"px-8 py-3 bg-purple-600 hover:bg-purple-700 rounded-2xl text-sm font-bold disabled:opacity-50 transition-all shadow-lg shadow-purple-900/40",children:b?"Escrevendo...":"Gerar Texto"})]})]})]}),i.jsxs("div",{className:`flex-1 bg-white shadow-2xl border border-slate-200 rounded-[2.5rem] overflow-hidden flex flex-col transition-all duration-500 ${F?"flex fixed inset-0 z-50 m-0 rounded-none lg:static lg:m-0 lg:rounded-[2.5rem] lg:flex":"hidden"}`,children:[F&&i.jsxs("div",{className:"lg:hidden p-5 bg-slate-900 text-white flex justify-between items-center shrink-0",children:[i.jsx("span",{className:"font-black uppercase tracking-widest",children:"Visualizao Final"}),i.jsx("button",{onClick:()=>q(!1),className:"p-2 bg-white/10 rounded-full hover:bg-white/20",children:i.jsx(St,{size:20})})]}),i.jsx("div",{className:"flex-1 overflow-y-auto bg-white p-6 md:p-12 custom-scrollbar",children:i.jsxs("div",{className:"max-w-3xl mx-auto",children:[i.jsx("div",{className:"h-64 md:h-96 w-full rounded-[2.5rem] overflow-hidden shadow-2xl mb-12 border-8 border-white",children:i.jsx("img",{src:S,alt:"Cover",className:"w-full h-full object-cover"})}),i.jsxs("div",{className:"px-4",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[i.jsx("span",{className:"bg-emerald-600 text-white text-[10px] font-black px-4 py-1 rounded-full uppercase tracking-wider shadow-lg shadow-emerald-100",children:g}),A?i.jsxs("span",{className:"text-[10px] uppercase font-black text-blue-600 flex items-center gap-1",children:[i.jsx(Js,{size:12})," Pblico"]}):i.jsxs("span",{className:"text-[10px] uppercase font-black text-slate-400 flex items-center gap-1",children:[i.jsx(jt,{size:12})," Interno"]}),i.jsx("div",{className:"h-px flex-1 bg-slate-100"}),i.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:new Date().toLocaleDateString()})]}),i.jsx("h1",{className:"text-4xl md:text-6xl font-black text-slate-900 mb-6 leading-tight tracking-tight",children:f||i.jsx("span",{className:"text-slate-100",children:"TTULO DA NOTCIA"})}),i.jsxs("div",{className:"flex items-center gap-4 mb-12 pb-8 border-b border-slate-100",children:[i.jsx("div",{className:"w-14 h-14 rounded-full overflow-hidden border-2 border-emerald-100 shadow-sm shrink-0",children:i.jsx("img",{src:(e==null?void 0:e.avatar)||`https://ui-avatars.com/api/?name=${encodeURIComponent((e==null?void 0:e.name)||"User")}&background=0d9488&color=fff`,className:"w-full h-full object-cover"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest leading-none mb-1",children:"Autor da Publicao"}),i.jsx("p",{className:"text-lg font-bold text-slate-800 leading-none",children:(e==null?void 0:e.name)||"Comunicao Interna"})]})]}),i.jsx("div",{className:"space-y-2",children:D.map(ve)})]})]})})]})]})]})},e2=()=>{const[t,e]=I.useState(""),[s,n]=I.useState("Todos"),[r,o]=I.useState([]),[a,l]=I.useState(!0),u={name:"Abel Silva",department:"TI"};I.useEffect(()=>{(async()=>{l(!0);try{const v=(await Fx()).filter(A=>A.allowedDepartments.includes("Todos")||A.allowedDepartments.includes(u.department));o(v)}catch(g){console.error("Erro ao carregar sistemas",g)}finally{l(!1)}})()},[]);const d=["Todos",...Array.from(new Set(r.map(p=>p.category)))],f=r.filter(p=>{const g=p.name.toLowerCase().includes(t.toLowerCase())||p.description.toLowerCase().includes(t.toLowerCase()),v=s==="Todos"||p.category===s;return g&&v});return a?i.jsx("div",{className:"flex justify-center p-12",children:i.jsx(Ne,{className:"animate-spin text-emerald-600",size:32})}):i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[i.jsx(xc,{className:"text-emerald-600"})," Meus Sistemas & Links"]}),i.jsxs("p",{className:"text-slate-500 text-sm mt-1",children:["Exibindo ferramentas liberadas para: ",i.jsx("span",{className:"font-bold text-emerald-700",children:u.department})]})]}),i.jsxs("div",{className:"relative w-full md:w-auto",children:[i.jsx(Zs,{className:"absolute left-3 top-3 text-slate-400 w-4 h-4"}),i.jsx("input",{type:"text",placeholder:"Buscar sistema...",value:t,onChange:p=>e(p.target.value),className:"pl-10 pr-4 py-2.5 bg-white border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 w-full md:w-64 shadow-sm"})]})]}),i.jsx("div",{className:"flex flex-wrap gap-2 pb-2 border-b border-slate-200",children:d.map(p=>i.jsx("button",{onClick:()=>n(p),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${s===p?"bg-emerald-600 text-white shadow-md shadow-emerald-200":"bg-white text-slate-600 hover:bg-slate-50 border border-slate-200"}`,children:p},p))}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[f.map(p=>i.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-slate-100 hover:shadow-lg hover:-translate-y-1 transition-all duration-200 group flex flex-col h-full",children:[i.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i.jsx("div",{className:"w-14 h-14 rounded-xl overflow-hidden bg-slate-50 shadow-inner",children:i.jsx("img",{src:p.logo,alt:p.name,className:"w-full h-full object-cover"})}),i.jsx("span",{className:"text-[10px] uppercase font-bold tracking-wider text-slate-400 bg-slate-50 px-2 py-1 rounded",children:p.category})]}),i.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2 group-hover:text-emerald-600 transition-colors",children:p.name}),i.jsx("p",{className:"text-slate-500 text-sm mb-6 line-clamp-2 flex-grow",children:p.description}),i.jsxs("a",{href:p.url,target:"_blank",rel:"noopener noreferrer",className:"mt-auto flex items-center justify-center gap-2 w-full py-2.5 bg-slate-50 text-slate-700 font-medium rounded-lg hover:bg-emerald-600 hover:text-white transition-all duration-200 group-hover:shadow-md",children:["Acessar ",i.jsx(ya,{size:14})]})]},p.id)),f.length===0&&i.jsxs("div",{className:"col-span-full py-16 text-center text-slate-400 bg-slate-50/50 rounded-xl border border-dashed border-slate-200",children:[i.jsx(zo,{size:48,className:"mx-auto mb-4 opacity-20"}),i.jsx("p",{className:"text-lg font-medium",children:"Nenhum sistema encontrado."}),i.jsxs("p",{className:"text-sm mt-2 max-w-md mx-auto",children:["Voc est visualizando apenas os sistemas liberados para ",i.jsx("strong",{children:u.department}),". Se precisar de acesso a outro sistema, contate o Suporte TI."]}),t&&i.jsx("button",{onClick:()=>{e(""),n("Todos")},className:"mt-4 text-emerald-600 text-sm font-medium hover:underline",children:"Limpar filtros de busca"})]})]})]})},t2=()=>{const t=[];for(let e=0;e<=23;e++)t.push(`${String(e).padStart(2,"0")}:00`),t.push(`${String(e).padStart(2,"0")}:30`);return t},s2=t2(),n2=()=>{var Et;const{currentUser:t,isAdmin:e,isMaster:s}=Ut(),n=gc(),[r,o]=I.useState([]),[a,l]=I.useState([]),[u,d]=I.useState([]),[f,p]=I.useState(""),[g,v]=I.useState(""),[A,k]=I.useState([]),[S,L]=I.useState(0),[D,j]=I.useState(new Date),[F,q]=I.useState(!0),[E,w]=I.useState(!1),[b,_]=I.useState(null),[T,R]=I.useState([]),[M,C]=I.useState(""),[ge,_e]=I.useState([]),[P,Z]=I.useState(""),[B,$]=I.useState(!1),[U,te]=I.useState(null),[re,ie]=I.useState(!1),[K,ve]=I.useState(null);I.useEffect(()=>{(async()=>{var fe;q(!0);try{const[ye,De,Ae]=await Promise.all([Ha(),Fn(),ln()]);o(ye),d(De),l(Ae);const He=n.state;if(He!=null&&He.selectedRoomId){const Ge=ye.find(Ze=>Ze.id===He.selectedRoomId);Ge&&(p(Ge.unitId||""),v(Ge.id))}else if(t!=null&&t.unit&&Ae.length>0){const Ge=Ae.find(V=>V.name===t.unit),Ze=Ge?Ge.id:((fe=Ae[0])==null?void 0:fe.id)||"";p(Ze);const it=ye.find(V=>V.unitId===Ze);it&&v(it.id)}else if(Ae.length>0){p(Ae[0].id);const Ge=ye.find(Ze=>Ze.unitId===Ae[0].id);Ge&&v(Ge.id)}}catch(ye){console.error("Erro ao carregar dados",ye)}finally{q(!1)}})()},[n.state,t]),I.useEffect(()=>{if(!g)return;const Y=Nt(Ee(he,"appointments"),Lt("roomId","==",g)),fe=es(Y,ye=>{const De=[];ye.forEach(Ae=>{De.push({id:Ae.id,...Ae.data()})}),k(De)});return()=>fe()},[g]);const z=I.useMemo(()=>r.filter(Y=>Y.unitId===f),[r,f]),se=I.useMemo(()=>r.find(Y=>Y.id===g),[r,g]),le=I.useMemo(()=>{if(!se)return[];const Y=D.getDay(),fe=Y===6,ye=Y===0;if(fe&&!se.worksSaturday||ye&&!se.worksSunday)return[];const De=se.startTime||"08:00",Ae=se.endTime||"18:00";return s2.filter(He=>He>=De&&He<Ae)},[se,D]),be=I.useMemo(()=>{const Y=new Date,fe=Y.getDay(),ye=Y.getDate()-fe+(fe===0?-6:1),De=new Date(Y.setDate(ye));De.setDate(De.getDate()+S*7);const Ae=[];for(let He=0;He<7;He++){const Ge=new Date(De);Ge.setDate(De.getDate()+He),Ae.push(Ge)}return Ae},[S]),qe=Y=>Y.toISOString().split("T")[0],Le=Y=>{j(Y)},ee=Y=>{p(Y);const fe=r.find(ye=>ye.unitId===Y);v(fe?fe.id:"")},xe=Y=>{const fe=new Date,ye=new Date(D),[De,Ae]=Y.split(":").map(Number);ye.setHours(De,Ae,0,0);const He=new Date(ye);if(He.setMinutes(ye.getMinutes()+30),He<=fe){alert("Este horrio j foi encerrado.");return}te(null),_({date:D,time:Y}),R([Y]),C(""),_e([]),Z(""),w(!0)},Fe=(Y,fe)=>{Y.preventDefault(),Y.stopPropagation();const[ye,De,Ae]=fe.date.split("-").map(Number),He=new Date(ye,De-1,Ae);te(fe),_({date:He,time:fe.time}),R([fe.time]),C(fe.subject),_e(fe.participants||[]),Z(""),w(!0)},Je=Y=>{R(fe=>fe.includes(Y)?fe.length===1?fe:fe.filter(ye=>ye!==Y):[...fe,Y].sort())},mt=()=>{P.trim()&&(ge.includes(P.trim())||_e([...ge,P.trim()]),Z(""))},ft=Y=>{ge.includes(Y)||_e([...ge,Y]),Z("")},H=Y=>{_e(ge.filter(fe=>fe!==Y))},ce=P.length>1?u.filter(Y=>Y.name.toLowerCase().includes(P.toLowerCase())&&!ge.includes(Y.name)&&Y.name!==(t==null?void 0:t.name)).slice(0,3):[],de=async()=>{if(!(T.length===0||!t||!M.trim())){$(!0);try{if(U)await CC(U.id,{subject:M.trim(),participants:ge});else{const Y=qe(D),fe=T.map(ye=>IC({roomId:g,date:Y,time:ye,userId:t.id,userName:t.name,subject:M.trim(),participants:ge,createdAt:new Date().toISOString()}));await Promise.all(fe)}w(!1),_(null),R([]),te(null)}catch{alert("Erro ao salvar agendamento. Tente novamente.")}finally{$(!1)}}},Ue=(Y,fe)=>{if(Y.preventDefault(),Y.stopPropagation(),!(fe.userId===(t==null?void 0:t.id))&&!e&&!s){alert("Voc no tem permisso para cancelar este agendamento.");return}ve(fe),ie(!0)},pt=async()=>{if(K){$(!0);try{await SC(K.id),ie(!1),ve(null)}catch(Y){console.error(Y),alert("Ocorreu um erro ao cancelar o agendamento.")}finally{$(!1)}}},Ve=Y=>{const fe=qe(D);return A.find(ye=>ye.date===fe&&ye.time===Y)};return F?i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsxs("div",{className:"flex flex-col items-center gap-2 text-emerald-600",children:[i.jsx(Ne,{className:"animate-spin",size:48}),i.jsx("span",{className:"font-medium",children:"Carregando agenda..."})]})}):r.length===0?i.jsxs("div",{className:"text-center p-12 bg-white rounded-2xl shadow-sm border border-slate-200",children:[i.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"Nenhuma Sala Encontrada"}),i.jsx("p",{className:"text-slate-500",children:"Contate o administrador para cadastrar salas de reunio."})]}):i.jsxs("div",{className:"space-y-6 max-w-6xl mx-auto pb-10",children:[i.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[i.jsx(Gt,{className:"text-emerald-600",size:24})," Salas de Reunio"]}),i.jsx("p",{className:"text-slate-500 text-sm",children:"Agendamentos dinmicos por sala e unidade."})]}),i.jsxs("div",{className:"flex flex-col gap-3 w-full md:w-auto",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-2 bg-slate-100 p-1 rounded-xl border border-slate-200 shadow-inner",children:[i.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase px-2",children:"Unidade:"}),a.map(Y=>i.jsx("button",{onClick:()=>ee(Y.id),className:`px-3 py-1.5 text-xs font-bold rounded-lg transition-all ${f===Y.id?"bg-white text-emerald-700 shadow-sm border border-emerald-100":"text-slate-500 hover:text-slate-700"}`,children:Y.name},Y.id))]}),i.jsxs("div",{className:"flex flex-wrap items-center gap-2 bg-white p-1 rounded-xl border border-slate-200 shadow-sm",children:[i.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase px-2",children:"Sala:"}),z.length>0?z.map(Y=>i.jsx("button",{onClick:()=>v(Y.id),className:`px-4 py-2 text-sm font-medium rounded-lg transition-all ${g===Y.id?"bg-emerald-600 text-white shadow-md":"text-slate-600 hover:bg-slate-50"}`,children:Y.name},Y.id)):i.jsx("span",{className:"text-xs text-slate-400 px-4 py-2",children:"Nenhuma sala nesta unidade"})]})]})]}),se&&i.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-4 flex flex-wrap gap-4 items-center text-sm text-slate-600 shadow-sm animate-fade-in",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx($t,{className:"text-emerald-500",size:18}),i.jsx("span",{className:"font-semibold",children:se.name})]}),i.jsx("div",{className:"w-px h-4 bg-slate-300 hidden sm:block"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(zr,{className:"text-slate-400",size:18}),i.jsx("span",{className:"font-semibold",children:(Et=a.find(Y=>Y.id===se.unitId))==null?void 0:Et.name})]}),i.jsx("div",{className:"w-px h-4 bg-slate-300 hidden sm:block"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Ci,{className:"text-slate-400",size:18}),i.jsxs("span",{children:["Capacidade: ",i.jsxs("strong",{children:[se.capacity," pessoas"]})]})]}),i.jsx("div",{className:"w-px h-4 bg-slate-300 hidden sm:block"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Rs,{size:18,className:"text-slate-400"}),i.jsxs("span",{children:["Funcionamento: ",i.jsxs("strong",{children:[se.startTime||"08:00"," - ",se.endTime||"18:00"]})]})]}),se.worksSaturday&&i.jsx("span",{className:"px-2 py-0.5 rounded text-[10px] font-black bg-emerald-50 text-emerald-600 border border-emerald-100",children:"SB ABERTO"}),se.worksSunday&&i.jsx("span",{className:"px-2 py-0.5 rounded text-[10px] font-black bg-emerald-50 text-emerald-600 border border-emerald-100",children:"DOM ABERTO"})]}),i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[i.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-100 bg-slate-50",children:[i.jsx("button",{onClick:()=>L(Y=>Y-1),className:"p-2 hover:bg-white rounded-lg transition-colors text-slate-500 hover:text-emerald-600",children:i.jsx(wc,{size:20})}),i.jsx("span",{className:"font-bold text-slate-700 capitalize",children:D.toLocaleDateString("pt-BR",{month:"long",year:"numeric"})}),i.jsx("button",{onClick:()=>L(Y=>Y+1),className:"p-2 hover:bg-white rounded-lg transition-colors text-slate-500 hover:text-emerald-600",children:i.jsx(kr,{size:20})})]}),i.jsx("div",{className:"grid grid-cols-7 divide-x divide-slate-100 border-b border-slate-200",children:be.map(Y=>{const fe=qe(Y)===qe(D),ye=qe(Y)===qe(new Date),De=Y.getDay(),Ae=De===0||De===6;return i.jsxs("button",{onClick:()=>Le(Y),className:`py-3 flex flex-col items-center justify-center transition-colors hover:bg-emerald-50/50 ${fe?"bg-white border-b-2 border-emerald-600":Ae?"bg-slate-50/20":"bg-slate-50/50"}`,children:[i.jsx("span",{className:`text-[10px] font-bold uppercase mb-1 ${fe?"text-emerald-600":Ae?"text-slate-300":"text-slate-400"}`,children:Y.toLocaleDateString("pt-BR",{weekday:"short"}).replace(".","")}),i.jsx("div",{className:`w-7 h-7 flex items-center justify-center rounded-full text-xs font-bold ${ye?"bg-emerald-600 text-white shadow-md":fe?"bg-emerald-100 text-emerald-800":Ae?"text-slate-400":"text-slate-700"}`,children:Y.getDate()})]},Y.toString())})}),i.jsxs("div",{className:"p-6",children:[i.jsxs("h3",{className:"font-bold text-slate-800 mb-4 flex items-center gap-2",children:[i.jsx(Rs,{size:18,className:"text-slate-400"}),"Horrios para ",D.toLocaleDateString("pt-BR")]}),le.length>0?i.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:le.map(Y=>{const fe=Ve(Y),[ye,De]=Y.split(":").map(Number),Ae=new Date,He=new Date(D);He.setHours(ye,De+30,0,0);const Ge=He<=Ae;if(fe){const Ze=fe.userId===(t==null?void 0:t.id),it=Ze||e||s,V=fe.participants||[];return i.jsxs("div",{className:`relative p-4 rounded-2xl border text-left flex flex-col justify-between min-h-[140px] shadow-sm transition-all hover:shadow-md ${Ge?"bg-slate-100 border-slate-200 opacity-70 grayscale-[50%]":Ze?"bg-emerald-50 border-emerald-200":"bg-red-50 border-red-200"}`,children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("span",{className:`text-[10px] font-black px-2 py-0.5 rounded-full border ${Ge?"bg-slate-200 text-slate-500":Ze?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"}`,children:Y}),Ge&&i.jsx("span",{className:"text-[8px] uppercase font-black tracking-widest text-slate-400",children:"Encerrado"})]}),i.jsx("h4",{className:"text-xs font-black text-slate-800 line-clamp-2 uppercase tracking-tight leading-tight mb-1",title:fe.subject,children:fe.subject}),i.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-slate-500 font-bold mb-2",children:[i.jsx(Ps,{size:10,className:"text-slate-400"}),i.jsx("span",{className:"truncate",children:fe.userName})]}),V.length>0&&i.jsxs("div",{className:"border-t border-black/5 pt-2 mt-2",children:[i.jsx("p",{className:"text-[8px] font-black text-slate-400 uppercase tracking-widest mb-1",children:"Participantes:"}),i.jsx("div",{className:"flex flex-wrap gap-1",children:V.map((W,oe)=>i.jsx("span",{className:`text-[9px] px-1.5 py-0.5 rounded border leading-none font-medium truncate max-w-[100px] ${Ze?"bg-emerald-100/50 border-emerald-200 text-emerald-800":"bg-red-100/50 border-red-200 text-red-800"}`,children:W},oe))})]})]}),it&&i.jsxs("div",{className:"flex items-center justify-end gap-1 mt-3 pt-2 border-t border-black/5",children:[!Ge&&i.jsx("button",{type:"button",onClick:W=>Fe(W,fe),className:"text-slate-400 hover:text-indigo-600 transition-colors p-2 rounded-lg hover:bg-white/50",title:"Editar Assunto",children:i.jsx(Fs,{size:16})}),i.jsx("button",{type:"button",onClick:W=>Ue(W,fe),className:"text-slate-400 hover:text-red-600 transition-colors p-2 rounded-lg hover:bg-white/50",title:"Cancelar agendamento",children:i.jsx(st,{size:16})})]})]},Y)}return Ge?i.jsxs("div",{className:"p-4 rounded-2xl border border-slate-100 bg-slate-50 text-slate-300 flex flex-col items-center justify-center min-h-[140px] cursor-not-allowed border-dashed",children:[i.jsx("span",{className:"text-sm font-black mb-1 opacity-50",children:Y}),i.jsx("span",{className:"text-[9px] uppercase font-black tracking-widest opacity-40",children:"Horrio Encerrado"})]},Y):i.jsxs("button",{type:"button",onClick:()=>xe(Y),className:"p-4 rounded-2xl border border-slate-200 bg-white hover:border-emerald-500 hover:shadow-lg hover:-translate-y-1 transition-all flex flex-col items-center justify-center min-h-[140px] group text-slate-400 hover:text-emerald-600",children:[i.jsx("span",{className:"text-2xl font-black mb-1 group-hover:scale-110 transition-transform text-slate-700 group-hover:text-emerald-600",children:Y}),i.jsxs("div",{className:"flex items-center gap-1 text-[10px] uppercase font-black tracking-widest text-emerald-600 opacity-0 group-hover:opacity-100 transition-all transform translate-y-2 group-hover:translate-y-0",children:[i.jsx(Pt,{size:12,strokeWidth:3})," Agendar"]})]},Y)})}):i.jsxs("div",{className:"py-12 text-center bg-slate-50 rounded-2xl border border-dashed border-slate-200 flex flex-col items-center",children:[i.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center text-slate-400 mb-4",children:i.jsx(Rs,{size:32})}),i.jsx("h4",{className:"text-lg font-bold text-slate-700 uppercase tracking-tight",children:"Sala Fechada"}),i.jsxs("p",{className:"text-sm text-slate-500 max-w-xs mx-auto mt-1",children:["A sala ",i.jsx("strong",{children:se==null?void 0:se.name})," no possui funcionamento configurado para este dia."]})]})]})]}),E&&b&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-[70] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in overflow-y-auto",children:i.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh]",children:[i.jsxs("div",{className:"p-4 md:p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50 shrink-0",children:[i.jsxs("h3",{className:"font-black text-slate-800 flex items-center gap-2 uppercase tracking-tight",children:[U?i.jsx(Fs,{className:"text-indigo-600",size:20}):i.jsx(Gt,{className:"text-emerald-600",size:20}),U?"Editar Agendamento":"Novo Agendamento"]}),i.jsx("button",{onClick:()=>w(!1),className:"p-2 hover:bg-slate-200 rounded-full transition-colors text-slate-400",children:i.jsx(St,{size:24})})]}),i.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto custom-scrollbar flex-1",children:[i.jsxs("div",{className:`p-4 rounded-2xl border space-y-2 text-[11px] font-bold uppercase tracking-wide ${U?"bg-indigo-50 border-indigo-100 text-indigo-800":"bg-emerald-50 border-emerald-100 text-emerald-800"}`,children:[i.jsxs("p",{className:"flex items-center gap-2",children:[i.jsx($t,{size:14})," ",i.jsxs("span",{children:["Sala: ",se==null?void 0:se.name]})]}),i.jsxs("p",{className:"flex items-center gap-2",children:[i.jsx(Gt,{size:14})," ",i.jsxs("span",{children:["Data: ",b.date.toLocaleDateString("pt-BR")]})]}),i.jsxs("p",{className:"flex items-center gap-2",children:[i.jsx(Rs,{size:14})," ",i.jsxs("span",{children:["Horrios: ",T.join(", ")]})]})]}),!U&&i.jsxs("div",{className:"space-y-3",children:[i.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Facilitador: Selecione outros horrios livres:"}),i.jsx("div",{className:"grid grid-cols-4 gap-2 p-3 border border-slate-100 rounded-2xl bg-slate-50/50",children:le.map(Y=>{const fe=!!Ve(Y),ye=(()=>{const[Ae,He]=Y.split(":").map(Number),Ge=new Date(D);return Ge.setHours(Ae,He+30,0,0),Ge<=new Date})(),De=T.includes(Y);return fe||ye?null:i.jsxs("button",{type:"button",onClick:()=>Je(Y),className:`flex items-center justify-center gap-1.5 p-2 rounded-xl text-[10px] font-black transition-all border ${De?"bg-emerald-600 text-white border-emerald-700 shadow-md":"bg-white text-slate-400 border-slate-200 hover:border-emerald-300"}`,children:[De?i.jsx(ss,{size:12}):i.jsx(Jn,{size:12})," ",Y]},Y)})})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-black text-slate-400 uppercase tracking-widest mb-1.5",children:"Assunto da Reunio"}),i.jsx("input",{type:"text",value:M,onChange:Y=>C(Y.target.value),placeholder:"Ex: ALINHAMENTO DE PROJETOS",className:"w-full p-4 border border-slate-200 rounded-2xl text-sm font-bold bg-slate-50 focus:bg-white focus:ring-2 focus:ring-emerald-500 text-slate-900 transition-all uppercase placeholder:text-slate-300 shadow-inner",autoFocus:!0})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-xs font-black text-slate-400 uppercase tracking-widest mb-1.5 flex justify-between",children:["Participantes Opcionais ",i.jsx("span",{className:"font-bold text-slate-300 text-[10px] italic",children:"Externos ou Internos"})]}),i.jsxs("div",{className:"flex gap-2 mb-3",children:[i.jsx("input",{type:"text",value:P,onChange:Y=>Z(Y.target.value),onKeyDown:Y=>Y.key==="Enter"&&mt(),placeholder:"Digite o nome e pressione Enter...",className:"flex-1 p-4 bg-white border-2 border-slate-100 rounded-2xl text-sm font-bold text-slate-800 focus:border-emerald-500 focus:ring-0 shadow-sm transition-all placeholder:text-slate-300"}),i.jsx("button",{onClick:mt,type:"button",disabled:!P.trim(),className:"bg-emerald-600 text-white p-4 rounded-2xl hover:bg-emerald-700 disabled:opacity-50 transition-all shadow-lg active:scale-95",children:i.jsx(Pt,{size:20,strokeWidth:3})})]}),ce.length>0&&i.jsx("div",{className:"mb-4 flex flex-wrap gap-2 p-2 bg-slate-50 rounded-xl animate-fade-in border border-slate-100",children:ce.map(Y=>i.jsxs("button",{onClick:()=>ft(Y.name),className:"text-[10px] font-black uppercase bg-white text-emerald-700 px-3 py-1.5 rounded-lg border border-emerald-100 hover:bg-emerald-50 flex items-center gap-1.5 shadow-sm",children:[i.jsx(Hf,{size:12})," ",Y.name]},Y.id))}),i.jsx("div",{className:"flex flex-wrap gap-2 mt-3 p-3 bg-slate-50 rounded-2xl min-h-[50px] border border-slate-100 border-dashed",children:ge.length>0?ge.map((Y,fe)=>i.jsxs("span",{className:"bg-white text-slate-700 text-[10px] font-black uppercase px-3 py-2 rounded-xl flex items-center gap-2 border border-slate-200 shadow-sm animate-fade-in",children:[Y,i.jsx("button",{onClick:()=>H(Y),className:"text-red-400 hover:text-red-600 transition-colors",children:i.jsx(St,{size:14})})]},fe)):i.jsx("p",{className:"text-[10px] text-slate-300 font-bold uppercase tracking-widest italic m-auto",children:"Nenhum participante na lista"})})]}),!U&&i.jsxs("div",{className:"text-[10px] text-slate-500 font-bold bg-amber-50 p-4 rounded-2xl border border-amber-100 flex gap-3",children:[i.jsx(Bi,{size:18,className:"text-amber-500 shrink-0"}),i.jsx("p",{children:"DICA: Ao selecionar vrios horrios, o sistema criar reservas individuais de 30 min cada, mantendo o mesmo assunto e participantes."})]})]}),i.jsxs("div",{className:"p-4 md:p-6 bg-slate-50 border-t border-slate-100 flex justify-end gap-3 shrink-0",children:[i.jsx("button",{onClick:()=>w(!1),className:"px-6 py-3 text-slate-500 font-black uppercase tracking-widest text-xs hover:bg-slate-200 rounded-2xl transition-all",disabled:B,children:"Cancelar"}),i.jsxs("button",{onClick:de,disabled:!M.trim()||B||T.length===0,className:`px-10 py-3 text-white rounded-2xl font-black uppercase tracking-widest text-xs hover:opacity-90 flex items-center gap-2 disabled:opacity-50 shadow-xl transition-all active:scale-95 ${U?"bg-indigo-600 shadow-indigo-100":"bg-emerald-600 shadow-emerald-200"}`,children:[B?i.jsx(Ne,{className:"animate-spin",size:18}):U?"Salvar Alteraes":"Confirmar Reserva(s)",!B&&i.jsx(Qn,{size:18})]})]})]})}),re&&K&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-[80] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:i.jsx("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-sm overflow-hidden border-2 border-red-100",children:i.jsxs("div",{className:"p-8 text-center",children:[i.jsx("div",{className:"w-20 h-20 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-6 text-red-500",children:i.jsx(ms,{size:40})}),i.jsx("h3",{className:"text-lg font-black text-slate-800 mb-2 uppercase tracking-tight",children:"Cancelar Reunio?"}),i.jsxs("p",{className:"text-sm text-slate-500 mb-8 leading-relaxed",children:["Voc est prestes a cancelar a reserva ",i.jsxs("strong",{children:['"',K.subject,'"']}),". Esta vaga voltar a ficar disponvel para outros colaboradores."]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>ie(!1),className:"flex-1 py-4 text-slate-400 font-black uppercase text-xs hover:bg-slate-100 rounded-2xl transition-all",disabled:B,children:"Manter"}),i.jsx("button",{onClick:pt,className:"flex-1 py-4 bg-red-600 text-white rounded-2xl font-black uppercase text-xs hover:bg-red-700 transition-colors flex items-center justify-center gap-2 shadow-lg shadow-red-100",disabled:B,children:B?i.jsx(Ne,{size:16,className:"animate-spin"}):"Sim, cancelar"})]})]})})})]})},r2=({size:t=18,className:e=""})=>i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[i.jsx("path",{d:"M3 21l1.65-3.8a9 9 0 1 1 3.4 2.9L3 21"}),i.jsx("path",{d:"M9 10a.5.5 0 0 0 1 0V9a.5.5 0 0 0-1 0v1a5 5 0 0 0 5 5h1a.5.5 0 0 0 0-1h-1a.5.5 0 0 0 0 1"})]}),i2=t=>{if(!t)return"";const e=["de","do","da","dos","das","e","em","com","para"],s=["i","ii","iii","iv","v","vi","vii","viii","ix","x"],n=["ti","rh","sesmt","dp","it","ceo","cfo","coo","cto","adm","qhse","comex"];return t.toLowerCase().split(" ").filter(r=>r.length>0).map((r,o)=>o>0&&e.includes(r)?r:s.includes(r)||n.includes(r)?r.toUpperCase():r.charAt(0).toUpperCase()+r.slice(1)).join(" ")},o2=({extension:t})=>{const[e,s]=I.useState(0),[n,r]=I.useState(!1),[o,a]=I.useState(!1),l=I.useRef(null),u=I.useRef(null),d=I.useRef(0),f=I.useRef(0),p=q=>{r(!0),d.current=q,a(!1)},g=q=>{if(!n||!l.current||!u.current||o)return;const E=l.current.offsetWidth,w=u.current.offsetWidth,b=E-w;let _=f.current+(q-d.current);_<0&&(_=0),_>b&&(_=b),s(_)},v=()=>{if(!n||!l.current||!u.current)return;const q=l.current.offsetWidth,E=u.current.offsetWidth,w=q-E,b=w*.9;e>=b?(a(!0),s(w),window.location.href=`tel:713879${t}`,setTimeout(()=>{a(!1),s(0),f.current=0},2e3)):(s(0),f.current=0),r(!1)},A=q=>{p(q.clientX),f.current=e},k=q=>{n&&g(q.clientX)},S=()=>{v()},L=()=>{n&&v()},D=q=>{p(q.touches[0].clientX),f.current=e},j=q=>{n&&g(q.touches[0].clientX)},F=()=>{v()};return i.jsxs("div",{ref:l,className:`relative h-12 rounded-full overflow-hidden select-none transition-colors duration-300 ${o?"bg-green-500":"bg-slate-100 border border-slate-200"}`,onMouseMove:k,onMouseUp:S,onMouseLeave:L,onTouchMove:j,onTouchEnd:F,children:[i.jsx("div",{className:`absolute inset-0 flex items-center justify-center text-sm font-medium transition-opacity duration-300 ${n?"opacity-50":"opacity-100"}`,children:o?i.jsxs("span",{className:"text-white font-bold flex items-center gap-2",children:[i.jsx(qf,{size:16})," Ligando..."]}):i.jsxs("span",{className:"text-slate-500 flex items-center gap-2 pl-4",children:["Ramal ",i.jsx("span",{className:"text-slate-800 font-bold",children:t})," ",i.jsx(kr,{size:14,className:"opacity-50"})]})}),i.jsx("div",{ref:u,style:{transform:`translateX(${e}px)`,touchAction:"none"},className:`absolute top-1 bottom-1 w-10 h-10 rounded-full flex items-center justify-center shadow-md cursor-grab active:cursor-grabbing z-10 transition-colors duration-200 ${o?"bg-white text-green-600":"bg-emerald-600 text-white left-1"}`,onMouseDown:A,onTouchStart:D,children:i.jsx(or,{size:18,className:o?"animate-pulse":""})})]})},a2=t=>{if(!t)return"";try{const e=new Date(t);return new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(e)}catch{return t}},l2=()=>{const t=[];for(let e=8;e<=18;e++)t.push(`${String(e).padStart(2,"0")}:00`),t.push(`${String(e).padStart(2,"0")}:30`);return t},c2=l2(),d2=t=>{var e;switch(t.type){case"header":return i.jsx("h3",{className:"text-xl md:text-2xl font-black text-slate-800 mt-6 mb-3 leading-tight",children:t.content},t.id);case"image":return i.jsx("img",{src:t.content,alt:"",className:"w-full rounded-2xl shadow-md my-6"},t.id);case"quote":return i.jsxs("blockquote",{className:"border-l-4 border-emerald-500 pl-4 py-3 italic my-6 bg-slate-50 text-lg text-slate-600 rounded-r-xl",children:['"',t.content,'"']},t.id);case"button":return i.jsx("div",{className:"my-8 text-center",children:i.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"inline-block transition-all hover:scale-105 shadow-lg hover:shadow-xl px-8 py-3 font-bold uppercase tracking-wider bg-emerald-600 text-white rounded-xl text-sm no-underline",children:t.content})},t.id);case"side-by-side":return i.jsxs("div",{className:`flex flex-col md:flex-row gap-6 items-center my-8 ${((e=t.style)==null?void 0:e.layoutDirection)==="row-reverse"?"md:flex-row-reverse":""}`,children:[i.jsx("div",{className:"w-full md:w-1/2",children:i.jsx("img",{src:t.url,alt:"",className:"w-full rounded-xl shadow-sm object-cover"})}),i.jsx("div",{className:"w-full md:w-1/2 text-slate-600 leading-relaxed text-base",children:t.content})]},t.id);default:return i.jsx("p",{className:"text-base md:text-lg leading-relaxed text-slate-600 whitespace-pre-wrap mb-4",children:t.content},t.id)}},u2=()=>{const{currentUser:t,globalSettings:e,loading:s}=Ut(),n=ir(),[r,o]=I.useState("Todas"),[a,l]=I.useState([]),[u,d]=I.useState([]),[f,p]=I.useState([]),[g,v]=I.useState([]),[A,k]=I.useState([]),[S,L]=I.useState([]),[D,j]=I.useState([]),[F,q]=I.useState(!0),[E,w]=I.useState(null),[b,_]=I.useState(new Date().getMonth()),[T,R]=I.useState([]),[M,C]=I.useState(!1),ge=I.useRef(null),_e=["Janeiro","Fevereiro","Maro","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],[P,Z]=I.useState(new Set),[B,$]=I.useState(""),[U,te]=I.useState("All"),[re,ie]=I.useState("All");I.useEffect(()=>{if(!t)return;const H=Nt(Ee(he,"notifications"),Lt("userId","==",t.id),ur("createdAt","desc"));return es(H,ce=>{R(ce.docs.map(de=>({id:de.id,...de.data()})))})},[t]),I.useEffect(()=>{(async()=>{q(!0);try{const ce=new Date().toISOString().split("T")[0],[de,Ue,pt,Ve,Et,Y]=await Promise.all([Fn(),wd(),Fx(),Ha(),mr(),ln()]),ye=(await Vt(Nt(Ee(he,"appointments"),Lt("date","==",ce)))).docs.map(Ae=>({id:Ae.id,...Ae.data()})),De=Ue.filter(Ae=>Ae.published&&Ae.isPublic===!0);l(de),d(De),p(pt),v(Ve),k(Y),L(ye),j(Et),De.length>0&&w(De[0].id)}catch(ce){console.error("Erro ao carregar portal:",ce)}finally{q(!1)}})()},[]);const K=T.filter(H=>!H.read).length,ve=async H=>{H.read||await Lx(H.id),C(!1),H.link&&(H.type==="chat"&&H.senderId?n(H.link,{state:{openChatWith:H.senderId}}):n(H.link))},z=H=>{Z(ce=>{const de=new Set(ce);return de.has(H)?de.delete(H):de.add(H),de})},se=()=>_(H=>H===0?11:H-1),le=()=>_(H=>H===11?0:H+1),be=I.useMemo(()=>{if(!(e!=null&&e.publicDirectory))return[];let H=a.filter(ce=>ce.showInPublicDirectory!==!1);if(B.trim()){const ce=B.toLowerCase();H=H.filter(de=>de.name.toLowerCase().includes(ce)||de.extension&&de.extension.includes(ce)||de.department.toLowerCase().includes(ce)||de.role.toLowerCase().includes(ce))}return U!=="All"&&(H=H.filter(ce=>ce.department===U)),re!=="All"&&(H=H.filter(ce=>ce.unit===re)),H.sort((ce,de)=>ce.name.localeCompare(de.name))},[a,B,U,re,e]),qe=I.useMemo(()=>{const H=new Set(u.map(ce=>ce.category));return["Todas",...Array.from(H)]},[u]),Le=I.useMemo(()=>{const H=new Date,ce=H.getDate(),de=H.getMonth(),Ue=b===de,pt=a.filter(Ve=>Ve.birthday?parseInt(Ve.birthday.split("-")[1])===b+1:!1).sort((Ve,Et)=>{const Y=parseInt(Ve.birthday.split("-")[2]),fe=parseInt(Et.birthday.split("-")[2]);return Y-fe});return Ue?{isCurrentMonth:Ue,todaysBirthdays:pt.filter(Ve=>parseInt(Ve.birthday.split("-")[2])===ce),pastBirthdays:pt.filter(Ve=>parseInt(Ve.birthday.split("-")[2])<ce),upcomingBirthdays:pt.filter(Ve=>parseInt(Ve.birthday.split("-")[2])>ce)}:{isCurrentMonth:Ue,todaysBirthdays:[],pastBirthdays:[],upcomingBirthdays:pt}},[a,b]),ee=H=>{const ce=new Date,de=ce.getDay(),Ue=ce.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit",hour12:!1}),pt=de===6,Ve=de===0,Et=pt&&!H.worksSaturday||Ve&&!H.worksSunday,Y=Ue<(H.startTime||"08:00")||Ue>=(H.endTime||"18:00"),fe=Et||Y,ye=S.filter(Ae=>Ae.roomId===H.id).sort((Ae,He)=>{const[Ge,Ze]=Ae.time.split(":").map(Number),[it,V]=He.time.split(":").map(Number);return Ge*60+Ze-(it*60+V)}),De=ye.find(Ae=>{const[He,Ge]=Ae.time.split(":").map(Number),Ze=new Date;Ze.setHours(He,Ge,0,0);const it=new Date(Ze);return it.setMinutes(Ze.getMinutes()+30),ce>=Ze&&ce<it});return{isOccupied:!!De&&!fe,isClosed:fe,currentMeeting:De,schedule:ye}},xe=I.useMemo(()=>r==="Todas"?u:u.filter(H=>H.category===r),[r,u]);if(F||s)return i.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50",children:i.jsxs("div",{className:"flex flex-col items-center gap-4",children:[i.jsx(Qs,{className:"h-10 w-auto animate-pulse"}),i.jsxs("div",{className:"flex items-center gap-2 text-emerald-700 font-medium",children:[i.jsx(Ne,{className:"animate-spin"})," Carregando portal..."]})]})});const Fe=(e==null?void 0:e.welcomeTitle)||"Bem-vindo ao iRamais Hub",Je=(e==null?void 0:e.welcomeDescription)||"Gesto inteligente de ramais, reservas de salas, notcias corporativas e acesso unificado aos sistemas da empresa.",mt=e!=null&&e.welcomeBannerImage?e.welcomeDisableOverlay?`url(${e.welcomeBannerImage}) center/cover`:`linear-gradient(to right, ${e.welcomePrimaryColor||"#065f46"}CC, ${e.welcomeSecondaryColor||"#115e59"}CC), url(${e.welcomeBannerImage}) center/cover`:`linear-gradient(to right, ${e.welcomePrimaryColor||"#065f46"}, ${e.welcomeSecondaryColor||"#115e59"})`,ft=(e==null?void 0:e.welcomeTextAlignment)==="left"?"text-left items-start":(e==null?void 0:e.welcomeTextAlignment)==="right"?"text-right items-end":"text-center items-center";return i.jsxs("div",{className:"min-h-screen bg-slate-50 font-sans text-slate-900",children:[i.jsx("header",{className:"bg-slate-900 text-white shadow-lg sticky top-0 z-50",children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between",children:[i.jsx(Qs,{className:"h-10 w-auto"}),t?i.jsxs("div",{className:"flex items-center gap-6",children:[i.jsxs("div",{className:"relative",ref:ge,children:[i.jsxs("button",{onClick:()=>C(!M),className:`p-2 transition-colors rounded-full relative ${M?"bg-emerald-50/20 text-emerald-400":"text-slate-400 hover:text-emerald-400"}`,children:[i.jsx(Fo,{size:22}),K>0&&i.jsx("span",{className:"absolute top-1 right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-slate-900 animate-pulse"})]}),M&&i.jsxs("div",{className:"absolute right-0 mt-3 w-80 bg-white rounded-2xl shadow-xl border border-slate-200 z-[100] overflow-hidden animate-fade-in text-slate-900",children:[i.jsxs("div",{className:"p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50",children:[i.jsx("h3",{className:"font-bold text-slate-700 text-sm",children:"Notificaes"}),T.length>0&&i.jsx("button",{onClick:()=>Vx(t.id),className:"text-[10px] text-slate-400 hover:text-red-500 font-bold uppercase tracking-widest",children:"Limpar tudo"})]}),i.jsx("div",{className:"max-h-[350px] overflow-y-auto custom-scrollbar",children:T.length>0?T.map(H=>i.jsx("div",{onClick:()=>ve(H),className:`p-4 border-b border-slate-50 cursor-pointer hover:bg-slate-50 transition-colors ${H.read?"":"bg-emerald-50/30"}`,children:i.jsxs("div",{className:"flex gap-3",children:[i.jsx("div",{className:`mt-1.5 w-2 h-2 rounded-full shrink-0 ${H.read?"bg-slate-300":"bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]"}`}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsx("p",{className:"text-sm leading-tight font-bold text-slate-800",children:H.title}),i.jsx("span",{className:"text-[10px] text-slate-400 whitespace-nowrap ml-2",children:new Date(H.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),i.jsx("p",{className:"text-xs text-slate-500 mt-1 line-clamp-2 leading-relaxed",children:H.message})]})]})},H.id)):i.jsxs("div",{className:"p-12 text-center text-slate-400",children:[i.jsx(Fo,{size:32,className:"mx-auto mb-2 opacity-10"}),i.jsx("p",{className:"text-xs font-medium",children:"Nenhuma notificao por aqui."})]})}),i.jsx("div",{className:"p-3 bg-slate-50 text-center border-t border-slate-100",children:i.jsx(Rt,{to:"/tasks",onClick:()=>C(!1),className:"text-[10px] font-black uppercase text-emerald-600 hover:underline tracking-widest",children:"Ver todas as tarefas"})})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("img",{src:t.avatar,className:"w-10 h-10 rounded-full border-2 border-emerald-500 object-cover shadow-lg"}),i.jsxs("div",{className:"text-left hidden sm:block",children:[i.jsx("p",{className:"text-[9px] uppercase font-black text-slate-500 mb-0.5",children:"Ol,"}),i.jsx("p",{className:"text-sm font-bold text-white",children:t.name.split(" ")[0]})]})]}),i.jsxs(Rt,{to:"/dashboard",className:"flex items-center gap-2 text-xs md:text-sm font-bold bg-emerald-600 hover:bg-emerald-500 px-5 py-2.5 rounded-full shadow-lg border border-emerald-500",children:[i.jsx(Ff,{size:18}),i.jsx("span",{className:"hidden md:inline",children:"Ir para Dashboard"})]})]})]}):i.jsxs(Rt,{to:"/login",className:"flex items-center gap-2 text-sm font-medium bg-white/10 hover:bg-white/20 px-4 py-2 rounded-full transition-colors",children:[i.jsx(vy,{size:16}),"rea do Colaborador"]})]})}),i.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12",children:[(e==null?void 0:e.showWelcomeSection)!==!1&&i.jsxs("section",{className:`rounded-[2.5rem] p-6 md:p-10 shadow-2xl relative overflow-hidden flex flex-col justify-center min-h-[240px] ${ft}`,style:{background:mt},children:[i.jsxs("div",{className:"relative z-10 max-w-4xl",children:[i.jsx("h1",{className:"text-3xl md:text-4xl lg:text-5xl font-black mb-4 tracking-tight drop-shadow-md text-white",children:Fe}),i.jsx("p",{className:"text-white text-base md:text-lg lg:text-xl opacity-90 leading-relaxed font-medium drop-shadow-sm whitespace-pre-wrap",children:Je})]}),i.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-white/5 rounded-full blur-3xl -mr-32 -mt-32"}),i.jsx("div",{className:"absolute bottom-0 left-0 w-64 h-64 bg-black/5 rounded-full blur-2xl -ml-24 -mb-24"})]}),(e==null?void 0:e.publicDirectory)&&i.jsxs("section",{className:"bg-white rounded-[2rem] shadow-sm border border-slate-200 p-6 md:p-10 animate-fade-in",children:[i.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6 mb-10 border-b border-slate-100 pb-8",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-3xl font-black text-slate-800 flex items-center gap-3 tracking-tight",children:[i.jsx(or,{className:"text-emerald-600",size:32})," Diretrio de Pessoas"]}),i.jsx("p",{className:"text-slate-500 mt-1 font-medium",children:"Encontre contatos e ramais de todos os colaboradores em tempo real"})]}),i.jsxs("div",{className:"flex flex-wrap items-center gap-3 w-full lg:w-auto",children:[i.jsxs("div",{className:"relative w-full sm:w-72 lg:w-80",children:[i.jsx(Zs,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"}),i.jsx("input",{type:"text",placeholder:"Buscar por nome ou ramal...",value:B,onChange:H=>$(H.target.value),className:"pl-12 pr-4 py-3.5 bg-slate-50 border border-slate-200 rounded-2xl text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 w-full text-slate-900 shadow-inner"})]}),i.jsxs("div",{className:"relative flex-1 min-w-[140px]",children:[i.jsxs("select",{value:U,onChange:H=>te(H.target.value),className:"w-full px-4 py-3.5 bg-white border border-slate-200 rounded-2xl text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 text-slate-900 appearance-none pr-10 shadow-sm",children:[i.jsx("option",{value:"All",children:"Departamentos"}),D.map(H=>i.jsx("option",{value:H.name,children:H.name},H.id))]}),i.jsx(zo,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4 pointer-events-none"})]}),i.jsxs("div",{className:"relative flex-1 min-w-[140px]",children:[i.jsxs("select",{value:re,onChange:H=>ie(H.target.value),className:"w-full px-4 py-3.5 bg-white border border-slate-200 rounded-2xl text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 text-slate-900 appearance-none pr-10 shadow-sm",children:[i.jsx("option",{value:"All",children:"Unidades"}),A.map(H=>i.jsx("option",{value:H.name,children:H.name},H.id))]}),i.jsx($t,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4 pointer-events-none"})]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-h-[700px] overflow-y-auto custom-scrollbar p-2",children:[be.map(H=>i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-100 p-6 flex flex-col items-center text-center transition-all hover:shadow-2xl hover:-translate-y-2 group relative",children:[i.jsxs("div",{className:"w-24 h-24 mb-4 relative",children:[i.jsx("img",{src:H.avatar,alt:H.name,className:"w-full h-full rounded-full object-cover border-4 border-slate-50 group-hover:border-emerald-50 transition-colors shadow-md"}),i.jsx("div",{className:"absolute bottom-1 right-1 w-5 h-5 bg-emerald-500 rounded-full border-2 border-white shadow-sm",title:"Online"})]}),i.jsx("h3",{className:"font-bold text-lg text-slate-900 leading-tight mb-1",children:H.name}),(e==null?void 0:e.showRolePublicly)&&H.showRole!==!1&&i.jsx("p",{className:"text-emerald-600 text-sm font-bold mb-2",children:i2(H.role)}),i.jsxs("div",{className:"flex flex-col items-center gap-1.5 mb-6",children:[i.jsxs("p",{className:"text-slate-400 text-xs flex items-center gap-1.5 bg-slate-50 px-2.5 py-1 rounded-full font-medium",children:[i.jsx(zr,{size:12,className:"text-slate-400"})," ",H.department]}),H.unit&&i.jsxs("p",{className:"text-slate-400 text-[10px] flex items-center gap-1.5 font-bold uppercase tracking-widest",children:[i.jsx($t,{size:10,className:"text-slate-300"})," ",H.unit]})]}),i.jsxs("div",{className:"w-full space-y-3 mt-auto",children:[H.extension?i.jsx(o2,{extension:H.extension}):i.jsx("div",{className:"h-12 flex items-center justify-center bg-slate-50 rounded-xl border border-dashed border-slate-200 text-slate-400 text-[10px] uppercase font-black tracking-widest",children:"Sem Ramal"}),i.jsxs("div",{className:"flex gap-2",children:[t?i.jsxs("button",{onClick:()=>n("/directory",{state:{openChatWith:H.id}}),className:"flex-1 flex items-center justify-center py-2.5 bg-emerald-600 text-white rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-emerald-700 transition-all shadow-lg shadow-emerald-900/20 flex items-center gap-2",children:[i.jsx(Oo,{size:16})," Chat"]}):i.jsxs("button",{disabled:!0,className:"flex-1 flex items-center justify-center py-2.5 bg-slate-100 text-slate-400 rounded-xl text-[10px] font-black uppercase tracking-widest border border-slate-200 cursor-not-allowed group-hover:bg-slate-200 transition-all shadow-sm",title:"Faa login para utilizar o chat corporativo",children:[i.jsx(Oo,{size:16,className:"mr-2"})," Chat"]}),H.whatsapp&&i.jsx("a",{href:`https://wa.me/${H.whatsapp.replace(/\D/g,"")}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center p-2.5 border border-emerald-200 bg-emerald-50 rounded-xl text-green-600 hover:bg-emerald-600 hover:text-white transition-all shadow-sm",title:"WhatsApp",children:i.jsx(r2,{size:18})}),i.jsx("a",{href:`mailto:${H.email}`,className:"flex items-center justify-center p-2.5 border border-slate-200 rounded-xl text-slate-400 hover:bg-emerald-600 hover:text-white hover:border-emerald-600 transition-all shadow-sm",title:"Enviar E-mail",children:i.jsx(Dr,{size:18})})]})]})]},H.id)),be.length===0&&i.jsxs("div",{className:"col-span-full py-20 text-center text-slate-400 bg-slate-50 rounded-[2rem] border border-dashed border-slate-200",children:[i.jsx(Zs,{size:40,className:"mx-auto mb-4 opacity-10"}),i.jsx("p",{className:"font-bold text-lg",children:"Nenhum colaborador encontrado."})]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-10",children:[i.jsx("div",{className:"lg:col-span-2 space-y-10",children:(e==null?void 0:e.showNewsPublicly)&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center justify-between border-l-8 border-emerald-600 pl-4",children:[i.jsx("h2",{className:"text-3xl font-black text-slate-800 tracking-tight",children:r==="Todas"?"Mural Corporativo":`Notcias: ${r}`}),r!=="Todas"&&i.jsx("button",{onClick:()=>o("Todas"),className:"text-sm font-black uppercase text-emerald-600 hover:underline tracking-widest",children:"Ver todas"})]}),i.jsx("div",{className:"space-y-6",children:xe.length>0?xe.map(H=>{var pt;const ce=E===H.id,de=a.find(Ve=>Ve.name===H.author),Ue=H.authorAvatar||(de==null?void 0:de.avatar)||`https://ui-avatars.com/api/?name=${encodeURIComponent(H.author)}&background=0d9488&color=fff`;return i.jsxs("div",{id:`news-${H.id}`,className:`bg-white rounded-[2rem] p-0 shadow-sm border transition-all duration-500 overflow-hidden ${ce?"border-emerald-200 ring-4 ring-emerald-50 shadow-xl":"border-slate-100 hover:shadow-md"}`,children:[i.jsxs("div",{className:`flex flex-col md:flex-row ${ce?"bg-slate-50/50":""}`,children:[i.jsxs("div",{className:`h-48 md:h-auto md:w-1/3 bg-slate-200 relative shrink-0 transition-all duration-500 ${ce?"md:h-72":""}`,children:[i.jsx("img",{src:H.thumbnail,alt:H.title,className:"w-full h-full object-cover"}),ce&&i.jsx("div",{className:"absolute inset-0 bg-black/20 flex items-center justify-center md:hidden",children:i.jsx("span",{className:"bg-white/90 px-4 py-2 rounded-full text-xs font-bold text-slate-800",children:"Visualizando Comunicado"})})]}),i.jsxs("div",{className:"p-6 md:p-8 md:w-2/3 flex flex-col justify-center",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 mb-3",children:[i.jsx("span",{className:"bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full font-black uppercase tracking-wider text-[9px]",children:H.category}),i.jsx("span",{className:"font-bold text-slate-400",children:a2(H.date)})]}),i.jsx("h4",{className:`font-black text-slate-900 leading-tight mb-3 transition-all ${ce?"text-2xl md:text-3xl":"text-xl"}`,children:H.title}),!ce&&i.jsx("p",{className:"text-slate-500 text-sm line-clamp-2 mb-6 font-medium",children:((pt=H.blocks.find(Ve=>Ve.type==="paragraph"))==null?void 0:pt.content)||"Clique para ler mais..."}),i.jsx("div",{className:"flex gap-4 items-center",children:H.externalUrl?i.jsxs("a",{href:H.externalUrl,target:"_blank",rel:"noopener noreferrer",className:"bg-emerald-600 text-white px-6 py-2.5 rounded-xl font-black text-xs uppercase tracking-widest hover:bg-emerald-700 transition-all shadow-lg shadow-emerald-200 flex items-center gap-2",children:["Acessar Notcia ",i.jsx(ya,{size:14})]}):i.jsx("button",{onClick:()=>w(ce?null:H.id),className:`font-black text-xs uppercase tracking-widest flex items-center gap-2 transition-all px-6 py-2.5 rounded-xl shadow-sm ${ce?"bg-slate-200 text-slate-700 hover:bg-slate-300":"bg-emerald-50 text-emerald-600 hover:bg-emerald-100"}`,children:ce?i.jsxs(i.Fragment,{children:[i.jsx(Ri,{size:16})," Recolher"]}):i.jsxs(i.Fragment,{children:[i.jsx(Pi,{size:16})," Ler Comunicado"]})})})]})]}),ce&&i.jsxs("div",{className:"p-6 md:p-12 animate-fade-in bg-white",children:[i.jsxs("div",{className:"flex items-center gap-4 mb-10 pb-6 border-b border-slate-50",children:[i.jsx("div",{className:"w-14 h-14 rounded-full overflow-hidden border-4 border-emerald-50 shadow-md shrink-0",children:i.jsx("img",{src:Ue,alt:H.author,className:"w-full h-full object-cover"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest leading-none mb-1",children:"Autor da Publicao"}),i.jsx("p",{className:"text-lg font-bold text-slate-700 leading-none",children:H.author})]})]}),i.jsx("div",{className:"max-w-none space-y-2",children:H.blocks.map(Ve=>d2(Ve))}),i.jsx("div",{className:"mt-12 pt-8 border-t border-slate-100 flex justify-center",children:i.jsxs("button",{onClick:()=>{var Ve;w(null),(Ve=document.getElementById(`news-${H.id}`))==null||Ve.scrollIntoView({behavior:"smooth"})},className:"group flex flex-col items-center gap-2 text-slate-300 hover:text-emerald-600 transition-all",children:[i.jsx(zf,{size:40,className:"group-hover:scale-110 transition-transform"}),i.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Fechar Visualizao"})]})})]})]},H.id)}):i.jsxs("div",{className:"p-20 text-center bg-slate-100 rounded-[2.5rem] text-slate-400 border border-slate-200 border-dashed",children:[i.jsx(Ai,{size:48,className:"mx-auto mb-4 opacity-10"}),i.jsx("p",{className:"font-bold",children:"Nenhuma notcia encontrada nesta categoria."})]})})]})}),i.jsxs("div",{className:"space-y-10",children:[(e==null?void 0:e.showNewsPublicly)&&i.jsxs("div",{className:"bg-white rounded-[2rem] shadow-sm border border-slate-100 p-8",children:[i.jsxs("h3",{className:"font-black text-slate-800 mb-6 flex items-center gap-3 uppercase tracking-tighter text-sm",children:[i.jsx($f,{size:18,className:"text-emerald-600"})," Categorias"]}),i.jsx("div",{className:"space-y-2",children:qe.length>1?qe.map(H=>i.jsxs("button",{onClick:()=>{o(H),w(null)},className:`w-full flex items-center justify-between px-4 py-3 rounded-2xl text-sm font-bold transition-all ${r===H?"bg-emerald-600 text-white shadow-lg shadow-emerald-200":"text-slate-600 hover:bg-slate-50"}`,children:[i.jsx("span",{children:H}),r===H&&i.jsx(kr,{size:16})]},H)):i.jsx("p",{className:"text-sm text-slate-400 italic",children:"Sem categorias disponveis."})})]}),(e==null?void 0:e.showRoomsPublicly)&&i.jsxs("div",{className:"bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100",children:[i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsxs("h3",{className:"font-black text-slate-800 flex items-center gap-3 uppercase tracking-tighter text-sm",children:[i.jsx(Gt,{size:18,className:"text-indigo-600"})," Agenda de Salas"]}),i.jsx("span",{className:"text-[10px] font-black uppercase bg-slate-100 text-slate-500 px-3 py-1 rounded-full",children:"Hoje"})]}),i.jsx("div",{className:"space-y-4",children:g.length>0?g.map(H=>{const{isOccupied:ce,isClosed:de,schedule:Ue}=ee(H),pt=P.has(H.id),Ve=A.find(ye=>ye.id===H.unitId),Et=H.startTime||"08:00",Y=H.endTime||"18:00",fe=c2.filter(ye=>ye>=Et&&ye<Y);return i.jsxs("div",{className:"border border-slate-100 rounded-2xl p-4 bg-slate-50/50 hover:bg-white hover:shadow-md transition-all shadow-sm",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2 cursor-pointer select-none",onClick:()=>z(H.id),children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx($t,{size:16,className:"text-slate-400"}),i.jsxs("div",{children:[i.jsx("span",{className:"text-sm font-bold text-slate-800 block leading-tight",children:H.name}),i.jsx("span",{className:"text-[10px] text-slate-400 font-bold uppercase",children:(Ve==null?void 0:Ve.name)||"SEDE"})]}),de?i.jsx("span",{className:"text-[10px] uppercase font-bold px-2 py-0.5 rounded-full border bg-slate-100 text-slate-500 border-slate-200",children:"Fechado"}):i.jsx("span",{className:`text-[10px] uppercase font-bold px-2 py-0.5 rounded-full border ${ce?"bg-red-50 text-red-600 border-red-100":"bg-emerald-50 text-emerald-600 border-emerald-100"}`,children:ce?"Ocupada":"Livre"})]}),i.jsx("div",{className:"text-slate-400",children:pt?i.jsx(Ri,{size:18}):i.jsx(Pi,{size:18})})]}),pt&&i.jsxs("div",{className:"mt-4 animate-fade-in space-y-4",children:[i.jsxs("div",{className:"flex justify-between items-center text-[10px] font-black text-slate-400 uppercase tracking-widest px-1",children:[i.jsx("span",{children:"Agenda Hoje:"}),i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(Rs,{size:10})," ",Et," - ",Y]})]}),i.jsx("div",{className:"grid grid-cols-1 gap-3 max-h-[400px] overflow-y-auto custom-scrollbar pr-1",children:fe.map(ye=>{const De=Ue.find(V=>V.time===ye),Ae=!!De,[He,Ge]=ye.split(":").map(Number),Ze=new Date,it=Ze.getHours()>He||Ze.getHours()===He&&Ze.getMinutes()>=Ge+30;if(Ae){const V=De.participants||[];return i.jsxs("div",{className:`flex flex-col border rounded-xl p-3.5 shadow-sm ${it?"bg-slate-100 border-slate-200 opacity-60 grayscale-[50%]":"bg-red-50 border-red-100"}`,children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${it?"bg-slate-200 text-slate-600":"bg-red-100 text-red-700"}`,children:ye}),i.jsxs("div",{className:`flex items-center gap-1.5 text-[9px] font-black uppercase ${it?"text-slate-500":"text-red-700"}`,children:[i.jsx("span",{className:"truncate max-w-[100px]",children:De.userName}),i.jsx(Ps,{size:12,className:it?"text-slate-400":"text-red-500"})]})]}),i.jsx("div",{className:"mb-2",children:i.jsx("p",{className:`text-[10px] font-black uppercase leading-tight tracking-tight ${it?"text-slate-500":"text-slate-800"}`,children:De.subject})}),V.length>0&&i.jsx("div",{className:"pt-1.5 mt-1 border-t border-black/5",children:i.jsxs("p",{className:`text-[8px] italic leading-tight ${it?"text-slate-400":"text-slate-500"}`,children:["Convidados: ",V.join(", ")]})})]},ye)}return i.jsxs("div",{className:`flex items-center justify-between border rounded-xl p-2 px-3 ${it||de?"bg-slate-100 border-slate-200 opacity-50":"bg-emerald-50 border-emerald-100"}`,children:[i.jsx("span",{className:"text-[10px] font-bold text-slate-400",children:ye}),i.jsx("span",{className:"text-[8px] uppercase tracking-wide text-slate-400 font-bold",children:de?"Fechado":it?"Encerrado":"Livre"})]},ye)})}),t&&i.jsx("button",{onClick:()=>n("/meeting-rooms",{state:{selectedRoomId:H.id}}),className:"w-full py-3 bg-emerald-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-[0.2em] shadow-lg shadow-emerald-200 hover:bg-emerald-700 hover:-translate-y-0.5 transition-all",children:"Reservar Agora"})]})]},H.id)}):i.jsx("p",{className:"text-sm text-slate-400 text-center py-4",children:"Nenhuma sala cadastrada."})})]}),(e==null?void 0:e.showBirthdaysPublicly)&&i.jsxs("div",{className:"bg-white rounded-[2rem] shadow-sm border border-slate-100 overflow-hidden",children:[i.jsxs("div",{className:"p-6 border-b border-slate-50 bg-slate-50/50 flex flex-col justify-between gap-4",children:[i.jsxs("h3",{className:"font-black text-slate-800 flex items-center gap-3 uppercase tracking-tighter text-sm",children:[i.jsx(bc,{size:18,className:"text-pink-500"})," Aniversariantes"]}),i.jsxs("div",{className:"flex items-center justify-between bg-white rounded-2xl p-1.5 border border-slate-100 shadow-inner",children:[i.jsx("button",{onClick:se,className:"p-2 hover:bg-slate-50 rounded-xl transition-all text-slate-400 hover:text-emerald-600",children:i.jsx(wc,{size:20})}),i.jsx("span",{className:"text-xs font-black text-emerald-700 uppercase tracking-[0.2em]",children:_e[b]}),i.jsx("button",{onClick:le,className:"p-2 hover:bg-slate-50 rounded-xl transition-all text-slate-400 hover:text-emerald-600",children:i.jsx(kr,{size:20})})]})]}),i.jsx("div",{className:"p-6",children:i.jsxs("div",{className:"space-y-5 max-h-[450px] overflow-y-auto pr-1 custom-scrollbar",children:[Le.todaysBirthdays.length>0&&i.jsxs("div",{className:"space-y-3 animate-fade-in mb-8",children:[i.jsxs("p",{className:"text-[10px] font-black text-orange-600 uppercase tracking-[0.2em] flex items-center gap-2 mb-4",children:[i.jsx(Bf,{size:14,className:"animate-bounce"}),"  HOJE!"]}),Le.todaysBirthdays.map(H=>i.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white rounded-[2rem] relative group overflow-hidden shadow-xl border border-pink-100 border-l-4 border-l-pink-500 hover:scale-[1.02] transition-all",children:[i.jsx("div",{className:"w-14 h-14 rounded-full border-2 border-slate-50 shadow-md overflow-hidden shrink-0",children:i.jsx("img",{src:H.avatar,className:"w-full h-full object-cover"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-sm font-black text-slate-800 truncate uppercase tracking-tight",children:H.name}),i.jsx("p",{className:"text-[10px] text-slate-400 truncate font-bold uppercase",children:H.department})]}),i.jsx("div",{className:"text-2xl drop-shadow-sm",children:""})]},H.id))]}),i.jsxs("div",{className:"space-y-4",children:[Le.isCurrentMonth&&Le.pastBirthdays.length>0&&i.jsxs("div",{className:"space-y-2",children:[i.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-3",children:"Aconteceu este ms"}),Le.pastBirthdays.map(H=>i.jsxs("div",{className:"flex items-center gap-4 p-3 hover:bg-slate-50 transition-all border border-transparent hover:border-slate-100 rounded-2xl",children:[i.jsx("img",{src:H.avatar,className:"w-10 h-10 rounded-full border-2 border-slate-100 object-cover"}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-sm font-bold text-slate-800 truncate uppercase tracking-tight",children:H.name}),i.jsx("p",{className:"text-[10px] text-slate-400 font-bold uppercase",children:H.department})]}),i.jsxs("div",{className:"text-[10px] font-black text-slate-400 bg-slate-50 px-3 py-1.5 rounded-full border border-slate-100 shadow-sm",children:["DIA ",H.birthday.split("-")[2]]})]},H.id))]}),(Le.upcomingBirthdays.length>0||!Le.isCurrentMonth&&Le.upcomingBirthdays.length>0)&&i.jsxs("div",{className:"space-y-2 pt-2",children:[i.jsx("p",{className:"text-[10px] font-black text-emerald-600 uppercase tracking-[0.2em] mb-4",children:"Prximos deste ms"}),Le.upcomingBirthdays.map(H=>i.jsxs("div",{className:"flex items-center gap-4 p-3 hover:bg-slate-50 rounded-2xl transition-all border border-transparent hover:border-slate-100",children:[i.jsx("img",{src:H.avatar,className:"w-10 h-10 rounded-full border-2 border-white shadow-sm object-cover"}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-sm font-bold text-slate-800 truncate uppercase tracking-tight",children:H.name}),i.jsx("p",{className:"text-[10px] text-slate-400 font-bold uppercase",children:H.department})]}),i.jsxs("div",{className:"text-[10px] font-black text-emerald-600 bg-emerald-50 px-3 py-1.5 rounded-full border border-emerald-100 shadow-sm",children:["DIA ",H.birthday.split("-")[2]]})]},H.id))]}),Le.todaysBirthdays.length===0&&Le.pastBirthdays.length===0&&Le.upcomingBirthdays.length===0&&i.jsxs("div",{className:"text-center py-12 text-slate-300",children:[i.jsx(Gt,{size:40,className:"mx-auto mb-3 opacity-10"}),i.jsx("p",{className:"text-sm font-bold uppercase tracking-widest",children:"Vazio"})]})]})]})})]})]})]}),i.jsxs("section",{className:"bg-slate-900 rounded-[3rem] p-10 md:p-16 text-white flex flex-col md:flex-row items-center justify-between gap-10 relative overflow-hidden shadow-2xl",children:[i.jsx("div",{className:"absolute top-0 right-0 w-[500px] h-[500px] bg-emerald-600/5 rounded-full blur-[100px] -mr-64 -mt-64 pointer-events-none"}),i.jsxs("div",{className:"relative z-10 text-center md:text-left",children:[i.jsxs("h3",{className:"text-3xl font-black mb-4 flex items-center justify-center md:justify-start gap-4 tracking-tighter",children:[i.jsx(by,{className:"text-emerald-400",size:32})," Central de TI"]}),i.jsx("p",{className:"text-slate-400 text-lg max-w-md leading-relaxed",children:"Nossa equipe de tecnologia est pronta para auxiliar em qualquer demanda tcnica ou operacional."})]}),i.jsxs("div",{className:"relative z-10 flex flex-col lg:flex-row gap-6 w-full md:w-auto",children:[i.jsxs("div",{className:"flex items-center gap-5 bg-white/5 border border-white/10 px-8 py-6 rounded-[2rem] flex-1 lg:flex-none hover:bg-white/10 transition-all cursor-default shadow-inner",children:[i.jsxs("div",{className:"bg-emerald-500/20 p-4 rounded-2xl text-emerald-400 shadow-lg",children:[i.jsx(Dr,{size:28})," "]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[10px] text-emerald-500 uppercase tracking-[0.2em] font-black mb-1",children:"Contato"}),i.jsx("p",{className:"font-bold text-lg text-white",children:"TI Suporte"})]})]}),i.jsxs("a",{href:"https://sisos.intermaritima.com.br/",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-5 bg-emerald-600 px-8 py-6 rounded-[2rem] flex-1 lg:flex-none hover:bg-emerald-700 transition-all cursor-pointer group shadow-xl shadow-emerald-900/40",children:[i.jsxs("div",{className:"bg-white/20 p-4 rounded-2xl text-white shadow-lg",children:[i.jsx(wy,{size:28})," "]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[10px] text-white/60 uppercase tracking-[0.2em] font-black mb-1",children:"Chamados"}),i.jsx("p",{className:"font-black text-xl text-white uppercase tracking-tight",children:"SISOS"})]})]})]})]})]}),i.jsx("footer",{className:"bg-white border-t border-slate-100 mt-20 py-12",children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 text-center",children:[i.jsx(Qs,{className:"h-8 w-auto mx-auto mb-6"}),i.jsxs("p",{className:"text-slate-400 text-xs font-bold uppercase tracking-[0.3em]",children:[" ",new Date().getFullYear()," Intermartima Portos e Logstica S/A"]})]})})]})},h2=()=>{const t=ir(),{currentUser:e,loading:s}=Ut(),[n,r]=I.useState(!1),[o,a]=I.useState(!1),[l,u]=I.useState(!1),[d,f]=I.useState(""),[p,g]=I.useState(""),[v,A]=I.useState(""),[k,S]=I.useState(""),[L,D]=I.useState(""),[j,F]=I.useState(""),[q,E]=I.useState(""),[w,b]=I.useState([]),[_,T]=I.useState([]),R="#006c5b",M="#0b1424";I.useEffect(()=>{!s&&e&&t("/dashboard")},[e,s,t]),I.useEffect(()=>{n&&(async()=>{try{const[Z,B]=await Promise.all([ln(),mr()]);b(Z),T(B)}catch(Z){console.error("Erro ao carregar opes de cadastro",Z)}})()},[n]);const C=async P=>{P.preventDefault(),f(""),a(!0);try{await FE(Ti,v,k),t("/dashboard")}catch(Z){console.error("Erro Login:",Z.code);let B="Erro ao fazer login. Tente novamente.";if(Z.code==="auth/invalid-credential"||Z.code==="auth/user-not-found"||Z.code==="auth/wrong-password")try{const $=Nt(Ee(he,"people"),Lt("email","==",v)),U=await Vt($);U.empty||U.docs[0].data().uid?B="E-mail ou senha invlidos.":B='Encontramos seu e-mail na base de colaboradores, mas voc ainda no ativou seu acesso. Por favor, clique na aba "Criar Cadastro" abaixo para definir sua senha.'}catch{B="E-mail ou senha invlidos."}else Z.code==="auth/too-many-requests"&&(B="Muitas tentativas falhas. Tente novamente mais tarde.");f(B)}finally{a(!1)}},ge=async P=>{if(P.preventDefault(),f(""),g(""),!v||!k||!L||!j){f("Preencha todos os campos obrigatrios.");return}if(k.length<6){f("A senha deve ter pelo menos 6 caracteres.");return}a(!0);try{const Z=Nt(Ee(he,"people"),Lt("email","==",v)),B=await Vt(Z);if(B.empty)throw new Error("EMAIL_NOT_FOUND_IN_BASE");const $=B.docs[0],U=$.data(),te=L.trim().toLowerCase(),re=(U.unit||"").trim().toLowerCase(),ie=j.trim().toLowerCase(),K=(U.department||U.sector||"").trim().toLowerCase();if(te!==re||ie!==K)throw new Error("DATA_MISMATCH");const se={uid:(await UE(Ti,v,k)).user.uid,status:"available",online:!0,lastSeen:new Date().toISOString()};q&&(se.extension=q,se.ramal=q),await Wt(yt(he,"people",$.id),se),g("Conta criada com sucesso! Redirecionando..."),setTimeout(()=>{t("/dashboard")},2e3)}catch(Z){console.error(Z),Z.message==="EMAIL_NOT_FOUND_IN_BASE"?f("E-mail no cadastrado na base de colaboradores. Solicite ao RH ou TI."):Z.message==="DATA_MISMATCH"?f("Unidade ou Setor incorretos para este e-mail. Verifique se selecionou os dados corretos conforme seu cadastro no RH."):Z.code==="auth/email-already-in-use"?f("Este e-mail j possui cadastro ativo. Por favor, faa login."):f("Erro ao realizar cadastro: "+Z.message)}finally{a(!1)}},_e=async()=>{if(!v){f("Digite seu e-mail no campo acima para redefinir a senha.");return}try{a(!0),await VE(Ti,v),g("Link de redefinio enviado para seu e-mail."),f("")}catch{f("Erro ao enviar e-mail de redefinio. Verifique se o e-mail est correto.")}finally{a(!1)}};return s||e?i.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50",children:i.jsx(Ne,{className:"animate-spin text-emerald-600",size:48})}):i.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 font-sans transition-colors duration-500",style:{backgroundColor:M},children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-[420px] overflow-hidden border border-white/10",children:[i.jsxs("div",{className:"p-8 pb-6 flex flex-col items-center text-center",children:[i.jsx("div",{className:"w-48 mb-6",children:i.jsx(Qs,{className:"w-full h-auto"})}),i.jsx("h1",{className:"text-2xl font-bold mb-1",style:{color:R},children:n?"Criar Acesso":"Acesso ao iRamais"}),i.jsx("p",{className:"text-slate-400 text-sm",children:n?"Valide seus dados para criar sua senha":"Entre com suas credenciais corporativas"})]}),i.jsxs("div",{className:"px-8 pb-8",children:[d&&i.jsxs("div",{className:"bg-red-50 text-red-600 p-3 rounded-lg text-sm mb-4 flex items-start gap-2 animate-fade-in border border-red-100",children:[i.jsx(Bi,{size:16,className:"mt-0.5 shrink-0"}),i.jsx("span",{className:"leading-snug",children:d})]}),p&&i.jsxs("div",{className:"bg-green-50 text-green-700 p-3 rounded-lg text-sm mb-4 flex items-start gap-2 animate-fade-in border border-green-100",children:[i.jsx(Qn,{size:16,className:"mt-0.5 shrink-0"}),i.jsx("span",{className:"leading-snug",children:p})]}),i.jsxs("form",{onSubmit:n?ge:C,className:"space-y-4",children:[i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-500",children:"E-mail Corporativo"}),i.jsxs("div",{className:"relative",children:[i.jsx(Dr,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),i.jsx("input",{type:"email",value:v,onChange:P=>A(P.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:bg-white transition-all text-slate-800",style:{"--tw-ring-color":R},placeholder:"nome@intermaritima.com.br",required:!0})]})]}),n&&i.jsxs("div",{className:"space-y-4 animate-fade-in",children:[i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-500",children:"Unidade"}),i.jsxs("div",{className:"relative",children:[i.jsx($t,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),i.jsxs("select",{value:L,onChange:P=>D(P.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:bg-white transition-all text-slate-800 appearance-none",style:{"--tw-ring-color":R},required:!0,children:[i.jsx("option",{value:"",children:"Selecione sua unidade..."}),w.map(P=>i.jsx("option",{value:P.name,children:P.name},P.id))]})]})]}),i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-500",children:"Setor / Departamento"}),i.jsxs("div",{className:"relative",children:[i.jsx(vc,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),i.jsxs("select",{value:j,onChange:P=>F(P.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-600 focus:bg-white transition-all text-slate-800 appearance-none",style:{"--tw-ring-color":R},required:!0,children:[i.jsx("option",{value:"",children:"Selecione seu setor..."}),_.map(P=>i.jsx("option",{value:P.name,children:P.name},P.id))]})]})]}),i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-500",children:"Ramal (Opcional)"}),i.jsxs("div",{className:"relative",children:[i.jsx(or,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),i.jsx("input",{type:"text",value:q,onChange:P=>E(P.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:bg-white transition-all text-slate-800",style:{"--tw-ring-color":R},placeholder:"Seu ramal atual"})]})]})]}),i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-500",children:n?"Crie uma Senha":"Senha"}),i.jsxs("div",{className:"relative",children:[i.jsx(jt,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),i.jsx("input",{type:l?"text":"password",value:k,onChange:P=>S(P.target.value),className:"w-full pl-10 pr-12 py-3 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:bg-white transition-all text-slate-800",style:{"--tw-ring-color":R},placeholder:"",required:!0}),i.jsx("button",{type:"button",onClick:()=>u(!l),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-emerald-600 transition-colors",children:l?i.jsx(ba,{size:18}):i.jsx(Ks,{size:18})})]}),n&&i.jsx("p",{className:"text-[10px] text-slate-400",children:"Mnimo de 6 caracteres."})]}),i.jsx("button",{type:"submit",disabled:o,className:"w-full py-3.5 text-white font-bold text-lg rounded-xl hover:opacity-90 transition-all flex items-center justify-center gap-2 shadow-lg hover:shadow-emerald-900/20 active:scale-[0.98]",style:{backgroundColor:R},children:o?i.jsx(Ne,{className:"animate-spin"}):n?"Finalizar Cadastro":"Entrar no Sistema"})]}),i.jsxs("div",{className:"mt-6 space-y-3 text-center",children:[i.jsxs(Rt,{to:"/",className:"flex items-center justify-center gap-2 w-full py-2.5 text-sm font-bold text-emerald-700 bg-emerald-50 rounded-xl hover:bg-emerald-100 transition-colors border border-emerald-100",children:[i.jsx(Js,{size:16})," Acessar Portal do Visitante (Sem login)"]}),!n&&i.jsx("button",{type:"button",onClick:_e,className:"text-sm text-slate-500 hover:text-emerald-700 font-medium transition-colors mt-4 block mx-auto",children:"Esqueci minha senha"}),i.jsx("div",{className:"pt-4 border-t border-slate-100 mt-4",children:n?i.jsxs("p",{className:"text-sm text-slate-600",children:["J possui conta? "," ",i.jsx("button",{onClick:()=>r(!1),className:"font-bold hover:underline",style:{color:R},children:"Fazer Login"})]}):i.jsxs("p",{className:"text-sm text-slate-600",children:["Primeiro acesso? "," ",i.jsx("button",{onClick:()=>r(!0),className:"font-bold hover:underline",style:{color:R},children:"Criar Cadastro"})]})})]})]})]})})},m2=()=>{const{isMaster:t}=Ut(),[e,s]=I.useState([]),[n,r]=I.useState(!1),[o,a]=I.useState(!0),[l,u]=I.useState(!1),[d,f]=I.useState({}),[p,g]=I.useState(void 0),[v,A]=I.useState([]),[k,S]=I.useState([]),[L,D]=I.useState(null),[j,F]=I.useState(""),[q,E]=I.useState("All"),[w,b]=I.useState("All");I.useEffect(()=>{a(!0);const P=VI(Z=>{s(Z),a(!1)});return Promise.all([mr(),ln()]).then(([Z,B])=>{A(Z),S(B)}),()=>P()},[]);const _=()=>{f({name:"",role:"",department:"",unit:"",extension:"",whatsapp:"",email:"",avatar:"",birthday:"",showRole:!0,showInPublicDirectory:!0}),g(void 0),r(!0)},T=P=>{f({...P}),g(void 0),r(!0)},R=(P,Z)=>{P.preventDefault(),P.stopPropagation(),t&&D(Z)},M=async()=>{if(!L||!L.id)return;const P=L.id;u(!0);try{await BI(P),D(null)}catch(Z){console.error("Erro ao excluir colaborador:",Z),alert(`Erro na excluso: ${Z.message}`)}finally{u(!1)}},C=P=>{var B;const Z=(B=P.target.files)==null?void 0:B[0];if(Z){const $=new FileReader;$.onloadend=()=>{g($.result),f(U=>({...U,avatar:$.result}))},$.readAsDataURL(Z)}},ge=async()=>{if(!d.name||!d.email)return alert("Nome e Email so obrigatrios");u(!0);try{d.id?await bd(d.id,d,p):await Mx(d,p),r(!1)}catch(P){alert(`Erro ao salvar: ${P.message}`)}finally{u(!1)}},_e=e.filter(P=>{const Z=j.toLowerCase(),B=P.name.toLowerCase().includes(Z)||P.email.toLowerCase().includes(Z)||P.extension&&P.extension.includes(Z),$=q==="All"||P.department===q,U=w==="All"||P.unit&&P.unit===w;return B&&$&&U});return o?i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsx(Ne,{className:"animate-spin text-emerald-600",size:48})}):i.jsxs("div",{className:"space-y-6 relative",children:[i.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Gesto de Colaboradores"}),i.jsx("p",{className:"text-slate-500 text-sm",children:"Controle total sobre o diretrio da empresa."})]}),!n&&i.jsxs("button",{onClick:_,className:"bg-emerald-600 text-white px-4 py-2 rounded-lg flex items-center justify-center gap-2 hover:bg-emerald-700 shadow-sm w-full md:w-auto font-medium",children:[i.jsx(Pt,{size:18})," Novo Colaborador"]})]}),n?i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-200 animate-fade-in",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6 border-b border-slate-100 pb-4",children:[i.jsx("h3",{className:"text-lg font-bold text-slate-800",children:d.id?"Editar Colaborador":"Novo Cadastro"}),i.jsx("button",{onClick:()=>r(!1),className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:i.jsx(St,{size:20})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{className:"col-span-full flex flex-col items-center gap-3",children:[i.jsxs("div",{className:"relative group",children:[i.jsx("div",{className:"w-24 h-24 rounded-full bg-slate-100 flex items-center justify-center overflow-hidden border-2 border-emerald-500",children:d.avatar?i.jsx("img",{src:d.avatar,alt:"",className:"w-full h-full object-cover"}):i.jsx(Ps,{className:"text-slate-300",size:40})}),i.jsxs("label",{className:"absolute bottom-0 right-0 bg-emerald-600 text-white p-2 rounded-full cursor-pointer hover:bg-emerald-700 shadow-sm transition-colors",children:[i.jsx(Si,{size:14}),i.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:C})]})]}),i.jsx("p",{className:"text-[10px] uppercase font-bold text-slate-400",children:"Foto do Perfil"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Nome Completo"}),i.jsx("input",{type:"text",value:d.name,onChange:P=>f({...d,name:P.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Email Corporativo"}),i.jsx("input",{type:"email",value:d.email,onChange:P=>f({...d,email:P.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Ramal"}),i.jsx("input",{type:"text",value:d.extension,onChange:P=>f({...d,extension:P.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"WhatsApp"}),i.jsx("input",{type:"text",value:d.whatsapp||"",onChange:P=>f({...d,whatsapp:P.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900",placeholder:"5571..."})]})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Cargo"}),i.jsx("input",{type:"text",value:d.role,onChange:P=>f({...d,role:P.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Departamento"}),i.jsxs("select",{value:d.department,onChange:P=>f({...d,department:P.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900",children:[i.jsx("option",{value:"",children:"Selecione..."}),v.map(P=>i.jsx("option",{value:P.name,children:P.name},P.id))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Unidade"}),i.jsxs("select",{value:d.unit||"",onChange:P=>f({...d,unit:P.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900",children:[i.jsx("option",{value:"",children:"Selecione..."}),k.map(P=>i.jsx("option",{value:P.name,children:P.name},P.id))]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Data de Nascimento"}),i.jsx("input",{type:"date",value:d.birthday,onChange:P=>f({...d,birthday:P.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900"})]})]})]}),i.jsxs("div",{className:"flex justify-end gap-3 mt-8 pt-4 border-t border-slate-100",children:[i.jsx("button",{onClick:()=>r(!1),className:"px-6 py-2 text-slate-600 hover:bg-slate-100 rounded-lg font-medium",disabled:l,children:"Cancelar"}),i.jsxs("button",{onClick:ge,disabled:l,className:"px-8 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 flex items-center justify-center gap-2 shadow-md disabled:opacity-50 transition-all",children:[l?i.jsx(Ne,{className:"animate-spin",size:18}):i.jsx(hs,{size:18})," Salvar Colaborador"]})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex flex-col md:flex-row gap-3",children:[i.jsxs("div",{className:"flex-1 relative",children:[i.jsx(Zs,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"}),i.jsx("input",{type:"text",placeholder:"Buscar por nome, e-mail ou ramal...",value:j,onChange:P=>F(P.target.value),className:"w-full pl-10 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-slate-50 text-slate-900 text-sm"})]}),i.jsxs("select",{value:q,onChange:P=>E(P.target.value),className:"w-full md:w-48 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900 text-sm",children:[i.jsx("option",{value:"All",children:"Todos Setores"}),v.map(P=>i.jsx("option",{value:P.name,children:P.name},P.id))]}),i.jsxs("select",{value:w,onChange:P=>b(P.target.value),className:"w-full md:w-48 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900 text-sm",children:[i.jsx("option",{value:"All",children:"Todas Unidades"}),k.map(P=>i.jsx("option",{value:P.name,children:P.name},P.id))]})]}),i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full text-left border-collapse min-w-[800px]",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"bg-slate-50 border-b border-slate-200 text-[10px] uppercase text-slate-500 font-bold tracking-wider",children:[i.jsx("th",{className:"px-6 py-4",children:"Colaborador"}),i.jsx("th",{className:"px-6 py-4",children:"Contato"}),i.jsx("th",{className:"px-6 py-4",children:"Setor / Unidade"}),i.jsx("th",{className:"px-6 py-4 text-right",children:"Aes"})]})}),i.jsx("tbody",{className:"divide-y divide-slate-100",children:_e.map(P=>i.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[i.jsx("td",{className:"px-6 py-4",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("img",{src:P.avatar,alt:"",className:"w-10 h-10 rounded-full bg-slate-200 object-cover border border-slate-100"}),i.jsxs("div",{children:[i.jsx("p",{className:"font-bold text-slate-800 text-sm",children:P.name}),i.jsx("p",{className:"text-[10px] text-slate-500 uppercase",children:P.role})]})]})}),i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("p",{className:"text-xs text-slate-600 font-medium",children:P.email}),i.jsxs("p",{className:"text-[10px] text-emerald-600 font-bold mt-1",children:["RAMAL: ",P.extension||"---"]})]}),i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("span",{className:"bg-slate-100 text-slate-600 px-2 py-0.5 rounded text-[10px] font-bold border border-slate-200 block w-fit mb-1",children:P.department}),P.unit&&i.jsxs("span",{className:"text-[10px] text-slate-400 flex items-center gap-1",children:[i.jsx($t,{size:10})," ",P.unit]})]}),i.jsx("td",{className:"px-6 py-4 text-right",children:i.jsxs("div",{className:"flex justify-end gap-2",children:[i.jsx("button",{onClick:()=>T(P),className:"p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",children:i.jsx(Fs,{size:16})}),i.jsx("button",{onClick:Z=>R(Z,P),disabled:!t,title:t?"Excluir colaborador":"Apenas usurios Master podem excluir",className:`p-2 transition-colors rounded-lg ${t?"text-slate-400 hover:text-red-600 hover:bg-red-50":"text-slate-200 cursor-not-allowed opacity-50"}`,children:t?i.jsx(st,{size:16}):i.jsx(jt,{size:16})})]})})]},P.id))})]})}),_e.length===0&&i.jsx("div",{className:"p-12 text-center text-slate-400 italic",children:"Nenhum colaborador encontrado."})]})]}),L&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:i.jsx("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-sm overflow-hidden border-2 border-red-100",children:i.jsxs("div",{className:"p-6 text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4 text-red-500",children:i.jsx(ms,{size:32})}),i.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:"Excluir Colaborador?"}),i.jsxs("p",{className:"text-sm text-slate-500 mb-6",children:["Voc est prestes a remover ",i.jsx("strong",{children:L.name}),".",i.jsx("br",{}),"Esta ao  irreversvel."]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>D(null),className:"flex-1 py-3 text-slate-600 hover:bg-slate-100 rounded-xl font-bold text-sm",disabled:l,children:"Cancelar"}),i.jsxs("button",{onClick:M,className:"flex-1 py-3 bg-red-600 text-white rounded-xl font-bold text-sm hover:bg-red-700 flex items-center justify-center gap-2 shadow-lg shadow-red-200",disabled:l,children:[l?i.jsx(Ne,{size:16,className:"animate-spin"}):i.jsx(st,{size:16})," Sim, Excluir"]})]})]})})})]})},f2=()=>{var q;const{isMaster:t}=Ut(),[e,s]=I.useState([]),[n,r]=I.useState(!1),[o,a]=I.useState(!0),[l,u]=I.useState(!1),[d,f]=I.useState({}),[p,g]=I.useState(null),[v,A]=I.useState([]);I.useEffect(()=>{a(!0);const E=UI(w=>{s(w),a(!1)});return mr().then(w=>{A(w.map(b=>b.name).sort())}),()=>E()},[]);const k=()=>{f({logo:"",name:"",description:"",category:"Geral",url:"https://",allowedDepartments:["Todos"]}),r(!0)},S=E=>{f({...E}),r(!0)},L=(E,w)=>{E.preventDefault(),E.stopPropagation(),t&&g(w)},D=async()=>{if(!(!p||!p.id)){u(!0);try{await vC(p.id),g(null)}catch{alert("Erro ao excluir sistema.")}finally{u(!1)}}},j=async()=>{if(!d.name||!d.url)return alert("Nome e URL so obrigatrios");u(!0);try{const E={...d,logo:d.logo||`https://ui-avatars.com/api/?name=${d.name}&background=047857&color=fff`,allowedDepartments:d.allowedDepartments&&d.allowedDepartments.length>0?d.allowedDepartments:["Todos"]};d.id?await yC(d.id,E):await xC(E),r(!1)}catch{alert("Erro ao salvar sistema.")}finally{u(!1)}},F=E=>{const w=d.allowedDepartments||[];let b;if(E==="Todos")w.includes("Todos")?b=[]:b=["Todos"];else{const _=w.filter(T=>T!=="Todos");_.includes(E)?b=_.filter(T=>T!==E):b=[..._,E]}f({...d,allowedDepartments:b})};return o?i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsx(Ne,{className:"animate-spin text-emerald-600",size:48})}):i.jsxs("div",{className:"space-y-6 relative",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Gesto de Sistemas & Links"}),i.jsx("p",{className:"text-slate-500 text-sm",children:"Gerencie o acesso s ferramentas corporativas."})]}),!n&&i.jsxs("button",{onClick:k,className:"bg-emerald-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-emerald-700 transition-all font-bold shadow-md",children:[i.jsx(Pt,{size:18})," Novo Sistema"]})]}),n?i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-200 animate-fade-in",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[i.jsx(xc,{size:20,className:"text-emerald-600"})," ",d.id?"Editar Sistema":"Novo Sistema"]}),i.jsx("button",{onClick:()=>r(!1),className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:i.jsx(St,{size:20})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Nome do Sistema"}),i.jsx("input",{type:"text",value:d.name||"",onChange:E=>f({...d,name:E.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900 shadow-sm"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Link de Acesso (URL)"}),i.jsx("input",{type:"text",value:d.url||"",onChange:E=>f({...d,url:E.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900 shadow-sm"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Categoria"}),i.jsx("input",{type:"text",value:d.category||"",onChange:E=>f({...d,category:E.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900 shadow-sm",placeholder:"Ex: Financeiro"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Logo (URL)"}),i.jsx("input",{type:"text",value:d.logo||"",onChange:E=>f({...d,logo:E.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900 shadow-sm",placeholder:"Vazio = Gerado"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Descrio Curta"}),i.jsx("textarea",{value:d.description||"",onChange:E=>f({...d,description:E.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900 shadow-sm",rows:2})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"Permitir acesso para:"}),i.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200 max-h-[280px] overflow-y-auto space-y-2 custom-scrollbar",children:[i.jsxs("label",{className:"flex items-center gap-3 p-2 bg-white rounded-lg border border-slate-100 cursor-pointer hover:border-emerald-200 transition-colors",children:[i.jsx("input",{type:"checkbox",checked:(q=d.allowedDepartments)==null?void 0:q.includes("Todos"),onChange:()=>F("Todos"),className:"rounded text-emerald-600 focus:ring-emerald-500 w-4 h-4"}),i.jsx("span",{className:"text-sm font-bold text-slate-700",children:"Todos (Acesso Global)"})]}),i.jsx("div",{className:"h-px bg-slate-200 my-2"}),v.map(E=>{var w,b,_;return i.jsxs("label",{className:`flex items-center gap-3 p-2 bg-white rounded-lg border border-slate-100 cursor-pointer hover:border-emerald-200 transition-colors ${(w=d.allowedDepartments)!=null&&w.includes("Todos")?"opacity-50 grayscale pointer-events-none":""}`,children:[i.jsx("input",{type:"checkbox",checked:(b=d.allowedDepartments)==null?void 0:b.includes(E),onChange:()=>F(E),disabled:(_=d.allowedDepartments)==null?void 0:_.includes("Todos"),className:"rounded text-emerald-600 focus:ring-emerald-500 w-4 h-4"}),i.jsx("span",{className:"text-sm text-slate-600",children:E})]},E)})]})]})]}),i.jsxs("div",{className:"flex justify-end gap-3 mt-8 pt-4 border-t border-slate-100",children:[i.jsx("button",{onClick:()=>r(!1),className:"px-6 py-2 text-slate-600 hover:bg-slate-100 rounded-lg font-medium",disabled:l,children:"Cancelar"}),i.jsxs("button",{onClick:j,className:"px-8 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 shadow-md transition-all flex items-center gap-2",disabled:l,children:[l?i.jsx(Ne,{className:"animate-spin",size:18}):i.jsx(hs,{size:18})," Salvar Sistema"]})]})]}):i.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.map(E=>i.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex items-center justify-between hover:shadow-md transition-all",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-12 h-12 rounded-lg bg-slate-50 border border-slate-100 overflow-hidden flex items-center justify-center p-1",children:i.jsx("img",{src:E.logo,alt:"",className:"w-full h-full object-contain"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-800 text-sm",children:E.name}),i.jsxs("p",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-wider",children:[E.category,"  ",E.allowedDepartments.includes("Todos")?"Acesso Global":`Restrito a: ${E.allowedDepartments.length} setor(es)`]})]})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("button",{onClick:()=>S(E),className:"p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",children:i.jsx(Fs,{size:16})}),i.jsx("button",{onClick:w=>L(w,E),disabled:!t,title:t?"Excluir sistema":"Apenas usurios Master podem excluir",className:`p-2 transition-colors rounded-lg ${t?"text-slate-400 hover:text-red-600 hover:bg-red-50":"text-slate-200 cursor-not-allowed opacity-50"}`,children:t?i.jsx(st,{size:16}):i.jsx(jt,{size:16})})]})]},E.id)),e.length===0&&i.jsx("div",{className:"p-12 text-center text-slate-400 italic",children:"Nenhum sistema cadastrado."})]}),p&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:i.jsx("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-sm overflow-hidden border-2 border-red-100",children:i.jsxs("div",{className:"p-6 text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4 text-red-500",children:i.jsx(ms,{size:32})}),i.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:"Remover Sistema?"}),i.jsxs("p",{className:"text-sm text-slate-500 mb-6",children:["Voc est prestes a excluir permanentemente o sistema ",i.jsxs("strong",{children:['"',p.name,'"']}),".",i.jsx("br",{}),"Esta ao no pode ser desfeita."]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>g(null),className:"flex-1 py-3 text-slate-600 hover:bg-slate-100 rounded-xl font-bold text-sm transition-colors",disabled:l,children:"Cancelar"}),i.jsxs("button",{onClick:D,className:"flex-1 py-3 bg-red-600 text-white rounded-xl font-bold text-sm hover:bg-red-700 flex items-center justify-center gap-2 shadow-lg shadow-red-200 transition-colors",disabled:l,children:[l?i.jsx(Ne,{size:16,className:"animate-spin"}):i.jsx(st,{size:16})," Sim, Excluir"]})]})]})})})]})},p2=()=>{const{isMaster:t}=Ut(),[e,s]=I.useState("units"),[n,r]=I.useState(!0),[o,a]=I.useState(!1),[l,u]=I.useState([]),[d,f]=I.useState(!1),[p,g]=I.useState({}),[v,A]=I.useState(null),[k,S]=I.useState([]),[L,D]=I.useState(!1),[j,F]=I.useState({}),[q,E]=I.useState(null),[w,b]=I.useState({publicDirectory:!0,showBirthdaysPublicly:!0,showRoomsPublicly:!0,showNewsPublicly:!0,showRolePublicly:!0,companyLogo:"",showWelcomeSection:!0,welcomeTitle:"Bem-vindo ao iRamais Hub",welcomeDescription:"Gesto inteligente de ramais, reservas de salas, notcias corporativas e acesso unificado aos sistemas da empresa.",welcomePrimaryColor:"#065f46",welcomeSecondaryColor:"#115e59",welcomeBannerImage:"",welcomeTextAlignment:"center",welcomeDisableOverlay:!1,dashboardShowRooms:!0,dashboardShowNews:!0,dashboardShowBirthdays:!0,showRoleInternal:!0}),[_,T]=I.useState(!1);I.useEffect(()=>{r(!0);const $=MI(te=>{u(te),r(!1)}),U=LI(te=>{S(te)});return zI().then(te=>{b(re=>({...re,...te,showWelcomeSection:te.showWelcomeSection??!0,welcomeTitle:te.welcomeTitle||"Bem-vindo ao iRamais Hub",welcomeDescription:te.welcomeDescription||"Gesto inteligente de ramais, reservas de salas, notcias corporativas e acesso unificado aos sistemas da empresa.",welcomePrimaryColor:te.welcomePrimaryColor||"#065f46",welcomeSecondaryColor:te.welcomeSecondaryColor||"#115e59",welcomeBannerImage:te.welcomeBannerImage||"",welcomeTextAlignment:te.welcomeTextAlignment||"center",welcomeDisableOverlay:te.welcomeDisableOverlay??!1,dashboardShowRooms:te.dashboardShowRooms??!0,dashboardShowNews:te.dashboardShowNews??!0,dashboardShowBirthdays:te.dashboardShowBirthdays??!0,showRoleInternal:te.showRoleInternal??!0}))}),()=>{$(),U()}},[]);const R=$=>{g($||{name:"",address:""}),f(!0)},M=async()=>{if(!p.name)return alert("Nome da unidade  obrigatrio");a(!0);try{p.id?await WI(p):await HI(p),f(!1)}catch($){alert(`Erro ao salvar unidade: ${$.message}`)}finally{a(!1)}},C=async()=>{if(!(!v||!v.id)){a(!0);try{await JI(v.id),A(null)}catch($){alert(`Falha na excluso: ${$.message}`)}finally{a(!1)}}},ge=async()=>{if(!j.name)return alert("Nome do departamento  obrigatrio");a(!0);try{j.id?await YI(j):await KI(j),D(!1)}catch($){alert(`Erro ao salvar departamento: ${$.message}`)}finally{a(!1)}},_e=async()=>{if(!(!q||!q.id)){a(!0);try{await XI(q.id),E(null)}catch($){alert(`Falha na excluso: ${$.message}`)}finally{a(!1)}}},P=($,U)=>{var re;const te=(re=$.target.files)==null?void 0:re[0];if(te){const ie=new FileReader;ie.onloadend=()=>{b(U==="logo"?K=>({...K,companyLogo:ie.result}):K=>({...K,welcomeBannerImage:ie.result}))},ie.readAsDataURL(te)}},Z=$=>{b(U=>({...U,[$]:!U[$]}))},B=async()=>{T(!0);try{await Dx(w),alert("Configuraes aplicadas com sucesso!")}catch{alert("Erro ao salvar configuraes.")}finally{T(!1)}};return n?i.jsxs("div",{className:"p-8 text-center text-slate-500",children:[i.jsx(Ne,{className:"animate-spin inline mr-2"})," Carregando estrutura..."]}):i.jsxs("div",{className:"space-y-6 relative",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Gesto Organizacional"}),i.jsx("p",{className:"text-slate-500 text-sm",children:"Gerencie a estrutura fsica e as regras de exibio do sistema."})]}),i.jsxs("div",{className:"flex gap-4 border-b border-slate-200 overflow-x-auto",children:[i.jsxs("button",{onClick:()=>s("units"),className:`pb-3 px-2 text-sm font-medium transition-colors flex items-center gap-2 whitespace-nowrap ${e==="units"?"text-emerald-600 border-b-2 border-emerald-600":"text-slate-500 hover:text-slate-800"}`,children:[i.jsx($t,{size:18})," Unidades Fsicas"]}),i.jsxs("button",{onClick:()=>s("depts"),className:`pb-3 px-2 text-sm font-medium transition-colors flex items-center gap-2 whitespace-nowrap ${e==="depts"?"text-emerald-600 border-b-2 border-emerald-600":"text-slate-500 hover:text-slate-800"}`,children:[i.jsx(vc,{size:18})," Departamentos"]}),i.jsxs("button",{onClick:()=>s("settings"),className:`pb-3 px-2 text-sm font-medium transition-colors flex items-center gap-2 whitespace-nowrap ${e==="settings"?"text-emerald-600 border-b-2 border-emerald-600":"text-slate-500 hover:text-slate-800"}`,children:[i.jsx(Ws,{size:18})," Configuraes Gerais"]})]}),e==="units"&&i.jsxs("div",{className:"space-y-6 animate-fade-in",children:[i.jsx("div",{className:"flex justify-end",children:i.jsxs("button",{onClick:()=>R(),className:"bg-emerald-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-emerald-700 shadow-sm transition-all font-bold",children:[i.jsx(Pt,{size:18})," Nova Unidade"]})}),d&&i.jsxs("div",{className:"bg-white p-6 rounded-xl border border-emerald-200 shadow-sm animate-fade-in",children:[i.jsxs("div",{className:"flex justify-between items-center mb-4",children:[i.jsx("h3",{className:"font-bold text-lg text-slate-800",children:p.id?"Editar Unidade":"Nova Unidade"}),i.jsx("button",{onClick:()=>f(!1),className:"text-slate-400 hover:text-slate-600 p-1 hover:bg-slate-100 rounded-full transition-colors",children:i.jsx(St,{size:20})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx("input",{type:"text",value:p.name||"",onChange:$=>g({...p,name:$.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900",placeholder:"Nome da Unidade"}),i.jsx("input",{type:"text",value:p.address||"",onChange:$=>g({...p,address:$.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900",placeholder:"Endereo"})]}),i.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[i.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors font-medium",children:"Cancelar"}),i.jsxs("button",{onClick:M,className:"px-6 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 flex items-center gap-2 shadow-md transition-all font-bold",disabled:o,children:[o?i.jsx(Ne,{className:"animate-spin",size:18}):i.jsx(hs,{size:18})," Salvar"]})]})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map($=>i.jsxs("div",{className:"bg-white p-5 rounded-xl border border-slate-200 shadow-sm flex flex-col hover:shadow-md transition-shadow group",children:[i.jsxs("div",{className:"flex justify-between items-start mb-2",children:[i.jsx("div",{className:"bg-emerald-50 p-2 rounded-lg text-emerald-600 group-hover:bg-emerald-100 transition-colors",children:i.jsx($t,{size:24})}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx("button",{onClick:()=>R($),className:"p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all",children:i.jsx(Fs,{size:16})}),i.jsx("button",{onClick:U=>{U.preventDefault(),U.stopPropagation(),t&&A($)},disabled:!t,className:`p-2 transition-colors rounded-lg ${t?"text-slate-400 hover:text-red-600 hover:bg-red-50":"text-slate-200 cursor-not-allowed opacity-50"}`,children:t?i.jsx(st,{size:16}):i.jsx(jt,{size:16})})]})]}),i.jsx("h4",{className:"font-bold text-slate-800 text-lg leading-tight",children:$.name}),i.jsx("p",{className:"text-slate-500 text-sm mt-1 line-clamp-1",children:$.address||"Sem endereo"})]},$.id))})]}),e==="depts"&&i.jsxs("div",{className:"space-y-6 animate-fade-in",children:[i.jsx("div",{className:"flex justify-end",children:i.jsxs("button",{onClick:()=>{F({name:""}),D(!0)},className:"bg-emerald-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-emerald-700 shadow-sm transition-all font-bold",children:[i.jsx(Pt,{size:18})," Novo Setor"]})}),L&&i.jsxs("div",{className:"bg-white p-6 rounded-xl border border-emerald-200 shadow-sm animate-fade-in",children:[i.jsxs("div",{className:"flex justify-between items-center mb-4",children:[i.jsx("h3",{className:"font-bold text-lg text-slate-800",children:j.id?"Editar Setor":"Novo Setor"}),i.jsx("button",{onClick:()=>D(!1),className:"text-slate-400 hover:text-slate-600 p-1 hover:bg-slate-100 rounded-full transition-colors",children:i.jsx(St,{size:20})})]}),i.jsx("input",{type:"text",value:j.name||"",onChange:$=>F({...j,name:$.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900",placeholder:"Nome do Departamento"}),i.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[i.jsx("button",{onClick:()=>D(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors font-medium",children:"Cancelar"}),i.jsxs("button",{onClick:ge,className:"px-6 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 flex items-center gap-2 shadow-md transition-all font-bold",disabled:o,children:[o?i.jsx(Ne,{className:"animate-spin",size:18}):i.jsx(hs,{size:18})," Salvar"]})]})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4",children:k.map($=>i.jsxs("div",{className:"bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex items-center justify-between hover:shadow-md transition-all group",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"bg-indigo-50 p-2 rounded-lg text-indigo-600 group-hover:bg-indigo-100 transition-colors",children:i.jsx(xi,{size:20})}),i.jsx("span",{className:"font-semibold text-slate-700",children:$.name})]}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx("button",{onClick:()=>{F($),D(!0)},className:"p-1.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all",children:i.jsx(Fs,{size:14})}),i.jsx("button",{onClick:U=>{U.preventDefault(),U.stopPropagation(),t&&E($)},disabled:!t,className:`p-1.5 transition-colors rounded-lg ${t?"text-slate-400 hover:text-red-600 hover:bg-red-50":"text-slate-200 cursor-not-allowed opacity-50"}`,children:t?i.jsx(st,{size:14}):i.jsx(jt,{size:14})})]})]},$.id))})]}),e==="settings"&&i.jsxs("div",{className:"animate-fade-in space-y-8",children:[i.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-sm border border-slate-200",children:[i.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[i.jsx(As,{className:"text-emerald-600"})," Logomarca da Empresa"]}),i.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-10",children:[i.jsxs("div",{className:"relative group",children:[i.jsx("div",{className:"w-64 h-32 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200 flex items-center justify-center overflow-hidden shadow-inner",children:w.companyLogo?i.jsx("img",{src:w.companyLogo,className:"max-w-full max-h-full object-contain p-4"}):i.jsxs("div",{className:"text-slate-300 text-center",children:[i.jsx(As,{size:40,className:"mx-auto mb-1 opacity-20"}),i.jsx("p",{className:"text-[10px] uppercase font-bold",children:"Logo Padro"})]})}),i.jsxs("label",{className:"absolute -bottom-3 -right-3 bg-emerald-600 text-white p-3 rounded-full shadow-xl cursor-pointer hover:bg-emerald-700 transition-all hover:scale-110 active:scale-95 z-20",children:[i.jsx(Si,{size:20}),i.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:$=>P($,"logo")})]}),w.companyLogo&&i.jsx("button",{onClick:()=>b($=>({...$,companyLogo:""})),className:"absolute top-2 right-2 bg-red-500 text-white p-1.5 rounded-full shadow-lg hover:bg-red-600 transition-all hover:scale-110 active:scale-95 z-20",title:"Remover Logomarca",children:i.jsx(st,{size:14})})]}),i.jsxs("div",{className:"flex-1 space-y-4",children:[i.jsx("p",{className:"text-sm text-slate-500 leading-relaxed",children:"A logomarca enviada aqui substituir a marca padro em todas as telas do sistema, incluindo o Portal do Visitante, tela de Login e Sidebar."}),i.jsxs("div",{className:"flex flex-wrap gap-3",children:[i.jsx("div",{className:"text-[10px] uppercase font-black px-3 py-1 bg-slate-100 text-slate-400 rounded-full",children:"PNG ou SVG"}),i.jsx("div",{className:"text-[10px] uppercase font-black px-3 py-1 bg-slate-100 text-slate-400 rounded-full",children:"Fundo Transparente"}),i.jsx("div",{className:"text-[10px] uppercase font-black px-3 py-1 bg-slate-100 text-slate-400 rounded-full",children:"Proporo 2:1 recomendada"})]})]})]})]}),i.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-sm border border-slate-200",children:[i.jsxs("div",{className:"flex items-center justify-between mb-8",children:[i.jsxs("h3",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[i.jsx(Tr,{className:"text-emerald-600"})," Personalizao da Boas-vindas (Hero)"]}),i.jsx("button",{onClick:()=>Z("showWelcomeSection"),className:`relative inline-flex h-7 w-12 items-center rounded-full transition-all duration-300 shrink-0 ${w.showWelcomeSection?"bg-emerald-600":"bg-slate-300"}`,children:i.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full bg-white transition-transform duration-300 ${w.showWelcomeSection?"translate-x-6":"translate-x-1"}`})})]}),i.jsxs("div",{className:`space-y-8 transition-opacity duration-300 ${w.showWelcomeSection?"opacity-100":"opacity-40 pointer-events-none"}`,children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsxs("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1 flex items-center gap-1",children:[i.jsx(gi,{size:14})," Ttulo de Boas-vindas"]}),i.jsx("input",{type:"text",value:w.welcomeTitle,onChange:$=>b({...w,welcomeTitle:$.target.value}),className:"w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none text-sm font-bold bg-white text-slate-900"})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1 flex items-center gap-1",children:[i.jsx(gi,{size:14})," Descrio Curta (Respeita pargrafos)"]}),i.jsx("textarea",{value:w.welcomeDescription,onChange:$=>b({...w,welcomeDescription:$.target.value}),className:"w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none text-sm min-h-[120px] bg-white text-slate-900",placeholder:"Digite aqui e use Enter para novos pargrafos..."})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2 flex items-center gap-1",children:"Alinhamento do Contedo"}),i.jsx("div",{className:"flex bg-slate-50 p-1 rounded-xl border border-slate-200 w-fit",children:[{id:"left",icon:Gf},{id:"center",icon:_y},{id:"right",icon:Ny}].map($=>i.jsx("button",{onClick:()=>b({...w,welcomeTextAlignment:$.id}),className:`p-2.5 rounded-lg transition-all ${w.welcomeTextAlignment===$.id?"bg-white text-emerald-600 shadow-sm border border-slate-100":"text-slate-400 hover:text-slate-600"}`,children:i.jsx($.icon,{size:20})},$.id))})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsxs("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1 flex items-center gap-1",children:[i.jsx(vu,{size:14})," Cor Primria"]}),i.jsxs("div",{className:"flex gap-2 items-center p-2 border border-slate-300 rounded-xl bg-white shadow-sm",children:[i.jsx("input",{type:"color",value:w.welcomePrimaryColor,onChange:$=>b({...w,welcomePrimaryColor:$.target.value}),className:"w-10 h-10 p-0 border-0 rounded-lg cursor-pointer shadow-sm bg-white"}),i.jsx("span",{className:"text-xs font-mono text-slate-800 font-bold",children:w.welcomePrimaryColor})]})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1 flex items-center gap-1",children:[i.jsx(vu,{size:14})," Cor Secundria"]}),i.jsxs("div",{className:"flex gap-2 items-center p-2 border border-slate-300 rounded-xl bg-white shadow-sm",children:[i.jsx("input",{type:"color",value:w.welcomeSecondaryColor,onChange:$=>b({...w,welcomeSecondaryColor:$.target.value}),className:"w-10 h-10 p-0 border-0 rounded-lg cursor-pointer shadow-sm bg-white"}),i.jsx("span",{className:"text-xs font-mono text-slate-800 font-bold",children:w.welcomeSecondaryColor})]})]})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsxs("label",{className:"block text-xs font-bold text-slate-500 uppercase flex items-center gap-1",children:[i.jsx(As,{size:14})," Imagem de Fundo (Opcional)"]}),w.welcomeBannerImage&&i.jsxs("button",{onClick:()=>Z("welcomeDisableOverlay"),className:`flex items-center gap-1 px-2 py-1 rounded-lg text-[10px] font-black uppercase transition-all ${w.welcomeDisableOverlay?"bg-amber-100 text-amber-700":"bg-slate-100 text-slate-500"}`,title:w.welcomeDisableOverlay?"Mostrando imagem original":"Aplicando degrad por cima",children:[w.welcomeDisableOverlay?i.jsx(Ks,{size:12}):i.jsx(ba,{size:12}),w.welcomeDisableOverlay?"Original":"Com Sobreposio"]})]}),i.jsxs("div",{className:"relative group",children:[i.jsx("div",{className:"w-full h-32 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200 flex items-center justify-center overflow-hidden shadow-inner",children:w.welcomeBannerImage?i.jsx("img",{src:w.welcomeBannerImage,className:"w-full h-full object-cover"}):i.jsxs("div",{className:"text-slate-300 text-center",children:[i.jsx(As,{size:32,className:"mx-auto mb-1 opacity-20"}),i.jsx("p",{className:"text-[10px] uppercase font-bold",children:"Sem imagem (Usar degrad)"})]})}),i.jsxs("label",{className:"absolute bottom-2 right-2 bg-emerald-600 text-white p-2.5 rounded-full shadow-lg cursor-pointer hover:bg-emerald-700 transition-all hover:scale-110 active:scale-95",children:[i.jsx(Si,{size:16}),i.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:$=>P($,"banner")})]}),w.welcomeBannerImage&&i.jsx("button",{onClick:()=>b({...w,welcomeBannerImage:"",welcomeDisableOverlay:!1}),className:"absolute top-2 right-2 bg-red-500 text-white p-1.5 rounded-full shadow-sm hover:bg-red-600 transition-all",children:i.jsx(st,{size:12})})]})]})]})]}),i.jsxs("div",{className:"mt-8 border-t border-slate-100 pt-6",children:[i.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4",children:"Prvia Rpida"}),i.jsxs("div",{className:`rounded-3xl p-6 text-white shadow-lg overflow-hidden relative min-h-[120px] flex flex-col justify-center ${w.welcomeTextAlignment==="left"?"text-left items-start":w.welcomeTextAlignment==="right"?"text-right items-end":"text-center items-center"}`,style:{background:w.welcomeBannerImage?w.welcomeDisableOverlay?`url(${w.welcomeBannerImage}) center/cover`:`linear-gradient(to right, ${w.welcomePrimaryColor}CC, ${w.welcomeSecondaryColor}CC), url(${w.welcomeBannerImage}) center/cover`:`linear-gradient(to right, ${w.welcomePrimaryColor}, ${w.welcomeSecondaryColor})`},children:[i.jsx("h4",{className:"text-xl font-black mb-1",children:w.welcomeTitle}),i.jsx("p",{className:"text-[10px] opacity-90 max-w-xl whitespace-pre-wrap",children:w.welcomeDescription})]})]})]})]}),i.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-sm border border-slate-200",children:[i.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[i.jsx(Tr,{className:"text-emerald-600"})," Visibilidade no Dashboard Interno"]}),i.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[{key:"dashboardShowRooms",label:"Widget: Agenda de Salas",icon:Gt,color:"text-indigo-600",desc:"Exibe o status de ocupao das salas na lateral do Dashboard."},{key:"dashboardShowNews",label:"Widget: Mural de Notcias",icon:Ai,color:"text-orange-500",desc:"Exibe a lista de comunicados recentes no centro do Dashboard."},{key:"dashboardShowBirthdays",label:"Widget: Aniversariantes",icon:bc,color:"text-pink-500",desc:"Exibe os aniversariantes do ms na lateral do Dashboard."},{key:"showRoleInternal",label:"Exibir Cargos no Sistema",icon:xi,color:"text-emerald-600",desc:"Exibe o cargo abaixo do nome nos diretrios e menus internos."}].map($=>i.jsxs("div",{className:"flex items-center justify-between gap-4 p-5 bg-slate-50 rounded-2xl border border-slate-100 hover:border-emerald-200 transition-all group",children:[i.jsxs("div",{className:"flex items-start gap-4 min-w-0 flex-1",children:[i.jsx("div",{className:`p-3 bg-white rounded-xl shadow-sm shrink-0 ${$.color}`,children:i.jsx($.icon,{size:20})}),i.jsxs("div",{className:"min-w-0",children:[i.jsx("h4",{className:"font-bold text-slate-800 text-sm truncate",children:$.label}),i.jsx("p",{className:"text-[11px] text-slate-400 mt-0.5 leading-tight",children:$.desc})]})]}),i.jsx("button",{onClick:()=>Z($.key),className:`relative inline-flex h-7 w-12 items-center rounded-full transition-all duration-300 shrink-0 ${w[$.key]?"bg-emerald-600":"bg-slate-300"}`,children:i.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full bg-white transition-transform duration-300 ${w[$.key]?"translate-x-6":"translate-x-1"}`})})]},$.key))})]}),i.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-sm border border-slate-200",children:[i.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[i.jsx(Js,{className:"text-emerald-600"})," Visibilidade no Portal do Visitante"]}),i.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[{key:"publicDirectory",label:"Diretrio de Ramais",icon:or,color:"text-emerald-500",desc:"Permite que qualquer visitante busque nomes e ramais da empresa."},{key:"showRolePublicly",label:"Exibir Cargo de Colaborador",icon:xi,color:"text-emerald-600",desc:"Exibe o cargo abaixo do nome nos cards de ramal do diretrio pblico."},{key:"showBirthdaysPublicly",label:"Aniversariantes do Ms",icon:Ci,color:"text-pink-500",desc:"Exibe a lista de colaboradores que fazem aniversrio no ms atual."},{key:"showRoomsPublicly",label:"Agenda de Salas",icon:Gt,color:"text-indigo-50",desc:"Exibe o status de ocupao das salas de reunio em tempo real."},{key:"showNewsPublicly",label:"Mural de Notcias",icon:Ai,color:"text-orange-500",desc:"Exibe comunicados e notcias corporativas para visitantes."}].map($=>i.jsxs("div",{className:"flex items-center justify-between gap-4 p-5 bg-slate-50 rounded-2xl border border-slate-100 hover:border-emerald-200 transition-all group",children:[i.jsxs("div",{className:"flex items-start gap-4 min-w-0 flex-1",children:[i.jsx("div",{className:`p-3 bg-white rounded-xl shadow-sm shrink-0 ${$.color}`,children:i.jsx($.icon,{size:20})}),i.jsxs("div",{className:"min-w-0",children:[i.jsx("h4",{className:"font-bold text-slate-800 text-sm truncate",children:$.label}),i.jsx("p",{className:"text-[11px] text-slate-400 mt-0.5 leading-tight",children:$.desc})]})]}),i.jsx("button",{onClick:()=>Z($.key),className:`relative inline-flex h-7 w-12 items-center rounded-full transition-all duration-300 shrink-0 ${w[$.key]?"bg-emerald-600":"bg-slate-300"}`,children:i.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full bg-white transition-transform duration-300 ${w[$.key]?"translate-x-6":"translate-x-1"}`})})]},$.key))}),i.jsx("div",{className:"mt-10 pt-6 border-t border-slate-100 flex justify-end",children:i.jsxs("button",{onClick:B,disabled:_,className:"px-12 py-3 bg-emerald-600 text-white rounded-2xl font-black uppercase tracking-widest text-xs hover:bg-emerald-700 shadow-xl shadow-emerald-900/20 flex items-center gap-3 transition-all active:scale-95 disabled:opacity-50",children:[_?i.jsx(Ne,{className:"animate-spin",size:16}):i.jsx(hs,{size:16}),"Aplicar Configuraes"]})})]})]}),v&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:i.jsx("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-sm overflow-hidden border-2 border-red-100",children:i.jsxs("div",{className:"p-6 text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4 text-red-500",children:i.jsx(ms,{size:32})}),i.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:"Excluir Unidade?"}),i.jsxs("p",{className:"text-sm text-slate-500 mb-6",children:["Voc est prestes a remover permanentemente ",i.jsxs("strong",{children:['"',v.name,'"']}),"."]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>A(null),className:"flex-1 py-3 text-slate-600 hover:bg-slate-100 rounded-xl font-bold text-sm",children:"Cancelar"}),i.jsxs("button",{onClick:C,className:"flex-1 py-3 bg-red-600 text-white rounded-xl font-bold text-sm hover:bg-red-700 flex items-center justify-center gap-2",children:[o?i.jsx(Ne,{className:"animate-spin",size:16}):i.jsx(st,{size:16})," Sim, Excluir"]})]})]})})}),q&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:i.jsx("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-sm overflow-hidden border-2 border-red-100",children:i.jsxs("div",{className:"p-6 text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4 text-red-500",children:i.jsx(ms,{size:32})}),i.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:"Excluir Setor?"}),i.jsxs("p",{className:"text-sm text-slate-500 mb-6",children:["Deseja remover o departamento ",i.jsxs("strong",{children:['"',q.name,'"']}),"?"]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>E(null),className:"flex-1 py-3 text-slate-600 hover:bg-slate-100 rounded-xl font-bold text-sm",children:"Cancelar"}),i.jsxs("button",{onClick:_e,className:"flex-1 py-3 bg-red-600 text-white rounded-xl font-bold text-sm hover:bg-red-700 flex items-center justify-center gap-2",children:[o?i.jsx(Ne,{className:"animate-spin",size:16}):i.jsx(st,{size:16})," Sim, Excluir"]})]})]})})})]})},g2=()=>{const{isMaster:t}=Ut(),e=ir(),[s,n]=I.useState([]),[r,o]=I.useState([]),[a,l]=I.useState([]),[u,d]=I.useState(!0),[f,p]=I.useState(""),[g,v]=I.useState("All"),[A,k]=I.useState("All"),[S,L]=I.useState(null);if(!t)return i.jsxs("div",{className:"min-h-[60vh] flex flex-col items-center justify-center text-center p-6 animate-fade-in",children:[i.jsx("div",{className:"w-20 h-20 bg-red-50 text-red-500 rounded-full flex items-center justify-center mb-6 shadow-sm border border-red-100",children:i.jsx(ms,{size:40})}),i.jsx("h2",{className:"text-2xl font-black text-slate-800 uppercase tracking-tight mb-2",children:"Acesso Restrito"}),i.jsxs("p",{className:"text-slate-500 max-w-md mb-8 leading-relaxed",children:["Esta rea  exclusiva para usurios com nvel de acesso ",i.jsx("strong",{children:"Master"}),". Suas permisses atuais no permitem visualizar ou gerenciar os acessos do sistema."]}),i.jsxs("button",{onClick:()=>e("/dashboard"),className:"flex items-center gap-2 px-8 py-3 bg-emerald-600 text-white rounded-2xl font-black uppercase text-xs hover:bg-emerald-700 transition-all shadow-xl shadow-emerald-900/20 active:scale-95",children:[i.jsx(Ey,{size:16})," Voltar ao Incio"]})]});I.useEffect(()=>{D()},[]);const D=async()=>{d(!0);try{const[E,w,b]=await Promise.all([Fn(),mr(),ln()]),_=E.sort((T,R)=>{const M={[wt.MASTER]:0,[wt.ADMIN]:1,[wt.COMMUNICATION]:2,[wt.USER]:3};return(M[T.systemRole]??3)-(M[R.systemRole]??3)});n(_),o(w),l(b)}catch(E){console.error("Erro ao carregar dados de usurios:",E)}finally{d(!1)}},j=async(E,w)=>{if(E.systemRole!==w){L(E.id);try{await bd(E.id,{...E,systemRole:w}),n(b=>b.map(_=>_.id===E.id?{..._,systemRole:w}:_))}catch{alert("Erro ao atualizar permisso.")}finally{L(null)}}},F=s.filter(E=>{const w=f.toLowerCase(),b=E.name.toLowerCase().includes(w)||E.email.toLowerCase().includes(w),_=g==="All"||E.department===g,T=A==="All"||E.unit&&E.unit===A;return b&&_&&T}),q={[wt.MASTER]:{label:"Nvel Master",icon:Iy,color:"text-amber-600",bg:"bg-amber-50",border:"border-amber-200"},[wt.ADMIN]:{label:"Administrador",icon:Ty,color:"text-red-600",bg:"bg-red-50",border:"border-red-200"},[wt.COMMUNICATION]:{label:"Comunicao",icon:Wf,color:"text-purple-600",bg:"bg-purple-50",border:"border-purple-200"},[wt.USER]:{label:"Colaborador",icon:Ps,color:"text-slate-600",bg:"bg-slate-50",border:"border-slate-200"}};return u?i.jsx("div",{className:"flex justify-center p-12",children:i.jsx(Ne,{className:"animate-spin text-emerald-600",size:32})}):i.jsxs("div",{className:"space-y-6",children:[i.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Gesto de Usurios"}),i.jsx("p",{className:"text-slate-500 text-sm",children:"Defina os nveis de acesso e permisses do sistema."})]})}),i.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex flex-col md:flex-row gap-3",children:[i.jsxs("div",{className:"flex-1 relative",children:[i.jsx(Zs,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"}),i.jsx("input",{type:"text",placeholder:"Buscar por nome ou e-mail...",value:f,onChange:E=>p(E.target.value),className:"w-full pl-10 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-slate-50 text-slate-900 text-sm"})]}),i.jsxs("div",{className:"relative w-full md:w-48",children:[i.jsx(zo,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4 pointer-events-none"}),i.jsxs("select",{value:g,onChange:E=>v(E.target.value),className:"w-full pl-9 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900 text-sm appearance-none",children:[i.jsx("option",{value:"All",children:"Todos Setores"}),r.sort((E,w)=>E.name.localeCompare(w.name)).map(E=>i.jsx("option",{value:E.name,children:E.name},E.id))]})]}),i.jsxs("div",{className:"relative w-full md:w-48",children:[i.jsx($t,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4 pointer-events-none"}),i.jsxs("select",{value:A,onChange:E=>k(E.target.value),className:"w-full pl-9 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900 text-sm appearance-none",children:[i.jsx("option",{value:"All",children:"Todas Unidades"}),a.sort((E,w)=>E.name.localeCompare(w.name)).map(E=>i.jsx("option",{value:E.name,children:E.name},E.id))]})]})]}),i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full text-left border-collapse min-w-[800px]",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"bg-slate-50 border-b border-slate-200 text-xs uppercase text-slate-500 font-semibold",children:[i.jsx("th",{className:"px-6 py-4",children:"Usurio"}),i.jsx("th",{className:"px-6 py-4",children:"E-mail"}),i.jsx("th",{className:"px-6 py-4",children:"Setor / Unidade"}),i.jsx("th",{className:"px-6 py-4",children:"Nvel de Acesso"})]})}),i.jsx("tbody",{className:"divide-y divide-slate-100",children:F.map(E=>{var _;const w=((_=q[E.systemRole])==null?void 0:_.icon)||Ps,b=q[E.systemRole]||q[wt.USER];return i.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[i.jsx("td",{className:"px-6 py-4",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("img",{src:E.avatar,alt:"",className:"w-9 h-9 rounded-full object-cover bg-slate-200 border border-slate-100"}),i.jsx("span",{className:"font-semibold text-slate-800",children:E.name})]})}),i.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:E.email}),i.jsx("td",{className:"px-6 py-4",children:i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsx("span",{className:"bg-slate-100 text-slate-600 px-2 py-0.5 rounded text-[10px] font-bold border border-slate-200 w-fit",children:E.department}),E.unit&&i.jsxs("span",{className:"text-[10px] text-slate-400 flex items-center gap-1",children:[i.jsx($t,{size:10})," ",E.unit]})]})}),i.jsx("td",{className:"px-6 py-4",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:`p-2 rounded-lg ${b.bg} ${b.color}`,children:i.jsx(w,{size:18})}),i.jsxs("div",{className:"relative flex-1 max-w-[200px]",children:[S===E.id&&i.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2",children:i.jsx(Ne,{className:"animate-spin text-slate-400",size:14})}),i.jsxs("select",{value:E.systemRole,onChange:T=>j(E,T.target.value),disabled:S===E.id,className:`w-full text-sm font-medium py-2 pl-2 pr-8 rounded-lg border focus:ring-2 focus:ring-emerald-500 cursor-pointer disabled:opacity-50 appearance-none ${b.border} ${b.color} bg-white transition-all`,children:[i.jsx("option",{value:wt.MASTER,children:"Nvel Master (Total)"}),i.jsx("option",{value:wt.ADMIN,children:"Administrador"}),i.jsx("option",{value:wt.COMMUNICATION,children:"Comunicao"}),i.jsx("option",{value:wt.USER,children:"Colaborador"})]})]})]})})]},E.id)})})]})}),F.length===0&&i.jsxs("div",{className:"p-12 text-center text-slate-400",children:[i.jsx(zo,{size:40,className:"mx-auto mb-3 opacity-20"}),i.jsx("p",{children:"Nenhum usurio encontrado com os filtros aplicados."})]})]}),i.jsxs("div",{className:"bg-amber-50 border border-amber-100 rounded-xl p-4 text-sm text-amber-800 flex items-start gap-3",children:[i.jsx(yc,{className:"shrink-0 mt-0.5",size:18}),i.jsxs("div",{children:[i.jsx("p",{className:"font-bold mb-1 uppercase text-[10px] tracking-widest",children:"Hierarquia de Permisses:"}),i.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs opacity-90",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Nvel Master:"})," Super-usurio com controle total, incluindo excluso de registros e gesto de acessos."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Administrador:"})," Gesto operacional completa de salas, ramais e sistemas."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Comunicao:"})," Permisso para criar e editar postagens e notcias no mural."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Colaborador:"})," Acesso padro s ferramentas e diretrios do sistema."]})]})]})]})]})},x2=["TV","Projetor","Videoconferncia","Quadro Branco","Ar Condicionado","Computador","Mesa Redonda","Frigobar","Diretoria"],y2=()=>{const{isMaster:t}=Ut(),[e,s]=I.useState([]),[n,r]=I.useState([]),[o,a]=I.useState(!1),[l,u]=I.useState(!0),[d,f]=I.useState(!1),[p,g]=I.useState({}),[v,A]=I.useState(null);I.useEffect(()=>{k()},[]);const k=async()=>{u(!0);try{const[E,w]=await Promise.all([Ha(),ln()]);s(E),r(w)}catch(E){console.error("Erro ao carregar salas",E)}finally{u(!1)}},S=()=>{var E;g({name:"",capacity:4,features:[],unitId:((E=n[0])==null?void 0:E.id)||"",startTime:"08:00",endTime:"18:00",worksSaturday:!1,worksSunday:!1}),a(!0)},L=E=>{g({...E}),a(!0)},D=(E,w)=>{E.preventDefault(),E.stopPropagation(),t&&A(w)},j=async()=>{if(!(!v||!v.id)){f(!0);try{await TC(v.id),A(null),await k()}catch{alert("Erro ao excluir sala.")}finally{f(!1)}}},F=async()=>{if(!p.name)return alert("Nome da sala  obrigatrio");if(!p.unitId)return alert("Selecione a unidade da sala");f(!0);try{const E={...p,worksSaturday:!!p.worksSaturday,worksSunday:!!p.worksSunday};p.id?await EC(p.id,E):await NC(E),a(!1),k()}catch{alert("Erro ao salvar sala.")}finally{f(!1)}},q=E=>{const w=p.features||[];let b;w.includes(E)?b=w.filter(_=>_!==E):b=[...w,E],g({...p,features:b})};return l?i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsx(Ne,{className:"animate-spin text-emerald-600",size:48})}):i.jsxs("div",{className:"space-y-6 relative",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Gesto de Salas de Reunio"}),i.jsx("p",{className:"text-slate-500 text-sm",children:"Cadastre salas, defina a unidade e os horrios de funcionamento."})]}),!o&&i.jsxs("button",{onClick:S,className:"bg-emerald-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-emerald-700 transition-all font-bold shadow-md",children:[i.jsx(Pt,{size:18})," Nova Sala"]})]}),o?i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-200 animate-fade-in",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[i.jsx(Tr,{size:20,className:"text-emerald-600"}),p.id?"Editar Sala":"Nova Sala"]}),i.jsx("button",{onClick:()=>a(!1),className:"p-2 hover:bg-slate-100 rounded-full transition-colors text-slate-400",children:i.jsx(St,{size:20})})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"col-span-1",children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Nome da Sala"}),i.jsx("input",{type:"text",value:p.name||"",onChange:E=>g({...p,name:E.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900 shadow-sm",placeholder:"Ex: Sala de Inovao"})]}),i.jsxs("div",{className:"col-span-1",children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Unidade"}),i.jsxs("select",{value:p.unitId||"",onChange:E=>g({...p,unitId:E.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900 shadow-sm",children:[i.jsx("option",{value:"",children:"Selecione a Unidade"}),n.map(E=>i.jsx("option",{value:E.id,children:E.name},E.id))]})]}),i.jsxs("div",{className:"col-span-1",children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Capacidade (Pessoas)"}),i.jsx("input",{type:"number",min:"1",value:p.capacity||4,onChange:E=>g({...p,capacity:parseInt(E.target.value)}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900 shadow-sm"})]}),i.jsxs("div",{className:"col-span-1",children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Horrio de Funcionamento (Seg-Sex)"}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsxs("div",{className:"relative",children:[i.jsx(Rs,{size:14,className:"absolute left-2.5 top-3 text-slate-400"}),i.jsx("input",{type:"time",value:p.startTime||"08:00",onChange:E=>g({...p,startTime:E.target.value}),className:"w-full p-2.5 pl-8 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900 shadow-sm"})]}),i.jsxs("div",{className:"relative",children:[i.jsx(Rs,{size:14,className:"absolute left-2.5 top-3 text-slate-400"}),i.jsx("input",{type:"time",value:p.endTime||"18:00",onChange:E=>g({...p,endTime:E.target.value}),className:"w-full p-2.5 pl-8 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 bg-white text-slate-900 shadow-sm"})]})]})]})]}),i.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200",children:[i.jsxs("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-3 flex items-center gap-2",children:[i.jsx(Gt,{size:14})," Funcionamento Extra"]}),i.jsxs("div",{className:"flex gap-6",children:[i.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[i.jsx("input",{type:"checkbox",checked:!!p.worksSaturday,onChange:E=>g({...p,worksSaturday:E.target.checked}),className:"w-4 h-4 rounded text-emerald-600 focus:ring-emerald-500 border-slate-300"}),i.jsx("span",{className:"text-sm font-medium text-slate-700 group-hover:text-emerald-600 transition-colors",children:"Funciona aos Sbados"})]}),i.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[i.jsx("input",{type:"checkbox",checked:!!p.worksSunday,onChange:E=>g({...p,worksSunday:E.target.checked}),className:"w-4 h-4 rounded text-emerald-600 focus:ring-emerald-500 border-slate-300"}),i.jsx("span",{className:"text-sm font-medium text-slate-700 group-hover:text-emerald-600 transition-colors",children:"Funciona aos Domingos"})]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-3",children:"Recursos e Equipamentos"}),i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:x2.map(E=>{var w,b;return i.jsxs("button",{type:"button",onClick:()=>q(E),className:`flex items-center gap-2 p-3 rounded-lg border text-sm font-medium transition-all ${(w=p.features)!=null&&w.includes(E)?"bg-emerald-50 border-emerald-500 text-emerald-700":"bg-white border-slate-200 text-slate-600 hover:border-emerald-300"}`,children:[(b=p.features)!=null&&b.includes(E)?i.jsx(ss,{size:18}):i.jsx(Jn,{size:18}),E]},E)})})]})]}),i.jsxs("div",{className:"flex justify-end gap-3 mt-8 pt-4 border-t border-slate-100",children:[i.jsx("button",{onClick:()=>a(!1),className:"px-6 py-2 text-slate-600 hover:bg-slate-100 rounded-lg font-medium transition-colors",disabled:d,children:"Cancelar"}),i.jsxs("button",{onClick:F,className:"px-8 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 shadow-md transition-all flex items-center gap-2 disabled:opacity-50",disabled:d,children:[d?i.jsx(Ne,{className:"animate-spin",size:18}):i.jsx(hs,{size:18}),"Salvar Sala"]})]})]}):i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.map(E=>{const w=n.find(b=>b.id===E.unitId);return i.jsxs("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition-all group",children:[i.jsxs("div",{className:"flex items-start justify-between mb-3",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 bg-indigo-50 rounded-xl flex items-center justify-center text-indigo-600 border border-indigo-100",children:i.jsx(Tr,{size:24})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-800 leading-tight",children:E.name}),i.jsxs("p",{className:"text-[10px] uppercase font-bold text-slate-400 flex items-center gap-1 mt-1",children:[i.jsx(zr,{size:12})," ",(w==null?void 0:w.name)||"Sede"]})]})]}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx("button",{onClick:()=>L(E),className:"p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",children:i.jsx(Fs,{size:16})}),i.jsx("button",{onClick:b=>D(b,E),disabled:!t,title:t?"Excluir sala":"Apenas usurios Master podem excluir",className:`p-2 transition-colors rounded-lg ${t?"text-slate-400 hover:text-red-600 hover:bg-red-50":"text-slate-200 cursor-not-allowed opacity-50"}`,children:t?i.jsx(st,{size:16}):i.jsx(jt,{size:16})})]})]}),i.jsxs("div",{className:"space-y-2 mt-4 text-[10px] font-bold text-slate-500 bg-slate-50 p-3 rounded-lg",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx(Ci,{size:12,className:"text-slate-400"})," ",E.capacity," Lugares"]}),i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx(Rs,{size:12,className:"text-slate-400"})," ",E.startTime||"08:00"," - ",E.endTime||"18:00"]})]}),i.jsxs("div",{className:"flex flex-wrap gap-2 pt-1 border-t border-slate-200",children:[i.jsxs("span",{className:E.worksSaturday?"text-emerald-600":"text-slate-300",children:["SB: ",E.worksSaturday?"ABERTO":"FECHADO"]}),i.jsxs("span",{className:E.worksSunday?"text-emerald-600":"text-slate-300",children:["DOM: ",E.worksSunday?"ABERTO":"FECHADO"]})]})]}),i.jsx("div",{className:"border-t border-slate-100 pt-3 mt-3",children:i.jsx("div",{className:"flex flex-wrap gap-1",children:E.features&&E.features.length>0?E.features.map(b=>i.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] border font-medium ${b==="Diretoria"?"bg-amber-100 text-amber-800 border-amber-200 font-bold":"bg-slate-50 text-slate-600 border-slate-200"}`,children:b},b)):i.jsx("span",{className:"text-[10px] text-slate-400 italic",children:"Sem recursos listados"})})})]},E.id)}),e.length===0&&i.jsxs("div",{className:"col-span-full py-16 text-center text-slate-400 bg-slate-50 rounded-xl border border-dashed border-slate-200",children:[i.jsx(Tr,{size:48,className:"mx-auto mb-4 opacity-20"}),i.jsx("p",{className:"font-medium",children:"Nenhuma sala cadastrada no momento."})]})]}),v&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:i.jsx("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-sm overflow-hidden border-2 border-red-100",children:i.jsxs("div",{className:"p-6 text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4 text-red-500",children:i.jsx(ms,{size:32})}),i.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:"Remover Sala?"}),i.jsxs("p",{className:"text-sm text-slate-500 mb-6",children:["Voc est prestes a excluir permanentemente a sala ",i.jsxs("strong",{children:['"',v.name,'"']}),".",i.jsx("br",{}),"Esta ao  irreversvel."]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>A(null),className:"flex-1 py-3 text-slate-600 hover:bg-slate-100 rounded-xl font-bold text-sm transition-colors",disabled:d,children:"Cancelar"}),i.jsxs("button",{onClick:j,className:"flex-1 py-3 bg-red-600 text-white rounded-xl font-bold text-sm hover:bg-red-700 flex items-center justify-center gap-2 shadow-lg shadow-red-200 transition-colors",disabled:d,children:[d?i.jsx(Ne,{size:16,className:"animate-spin"}):i.jsx(st,{size:16})," Sim, Excluir"]})]})]})})})]})},Ii=async(t,e,s)=>{const n=t.getContext("2d",{alpha:!0});if(!n)return;const r=s.find(_=>_.id===e.unitId);if(!r)return;const o=1.5;if(t.width=710*o,t.height=240*o,n.scale(o,o),n.clearRect(0,0,710,240),r.image){const _=new Image;_.src=r.image,await new Promise(T=>{_.onload=()=>{n.drawImage(_,24,40,180,65),T()},_.onerror=()=>T()})}n.setLineDash([5,5]),n.beginPath(),n.moveTo(250,20),n.lineTo(250,190),n.strokeStyle="#808080",n.lineWidth=1,n.stroke(),n.setLineDash([]);const a=r.site?r.site.replace(/^https?:\/\//,""):"www.intermaritima.com.br";n.font="bold 14px Arial",n.fillStyle="#666666";const l=n.measureText(a).width;if(n.fillText(a,40+(150-l)/2,140),r.certifications&&r.certifications.length>0){n.font="12px Arial",n.fillStyle="#666666";const _=160,T=15;for(let R=0;R<r.certifications.length;R+=2){const C=r.certifications.slice(R,R+2).join(" / "),ge=n.measureText(C).width;n.fillText(C,40+(150-ge)/2,_+Math.floor(R/2)*T)}}const d=e.sector.replace("*",`
`).split(`
`),f=d.length>1,p=f?30:40,g=f?90:80,v=f?105:95,A=f?125:115;n.fillStyle="#666666",n.font="bold 14px Arial",n.fillText(e.name,270,p),n.font="14px Arial",f?(n.fillText(d[0].trim(),270,50),n.fillText(d[1].trim(),270,70)):n.fillText(e.sector,270,60),n.fillText(e.email,270,g),n.setLineDash([5,5]),n.beginPath(),n.moveTo(270,v),n.lineTo(710,v),n.strokeStyle="#808080",n.stroke(),n.setLineDash([]),n.font="12px Arial";const k=`${r.address||""}, ${r.number||""}${r.complement?" - "+r.complement:""}${r.neighborhood?", "+r.neighborhood:""}`;n.fillText(k,270,A),n.fillText(`${r.city||""} - ${r.state||""} CEP: ${r.cep||""}`,270,A+20);const S=e.phones.filter(_=>_.type==="fixo"&&_.number&&_.number.trim()),L=e.phones.filter(_=>_.type==="celular"&&_.number&&_.number.trim());let D="";S.length>0&&(D+=`Fixo: ${S.map(_=>_.number).join(" / ")}`),L.length>0&&(D&&(D+="   "),D+=`Celular: +55 ${L.map(_=>_.number).join(" / ")}`),D&&(n.font="bold 12px Arial",n.fillText(D,270,165)),n.fillStyle="#28a745",n.font="12px Arial";const j="Antes de imprimir, pense em seu compromisso com o ",F="Meio Ambiente",q=" e o comprometimento com os ",E="Custos.";let b=(710-n.measureText(j+F+q+E).width)/2;n.font="12px Arial",n.fillText(j,b,230),b+=n.measureText(j).width,n.font="bold 12px Arial",n.fillText(F,b,230),b+=n.measureText(F).width,n.font="12px Arial",n.fillText(q,b,230),b+=n.measureText(q).width,n.font="bold 12px Arial",n.fillText(E,b,230)},v2=()=>{const{currentUser:t,isMaster:e}=Ut(),[s,n]=I.useState("requests"),[r,o]=I.useState(!0),[a,l]=I.useState([]),[u,d]=I.useState([]),[f,p]=I.useState([]),[g,v]=I.useState([]),[A,k]=I.useState([]),[S,L]=I.useState(""),[D,j]=I.useState({name:"",email:"",unitId:"",sector:""}),[F,q]=I.useState([{number:"",type:"celular"}]),[E,w]=I.useState(null),[b,_]=I.useState(""),[T,R]=I.useState("units"),[M,C]=I.useState(!1),[ge,_e]=I.useState(null),[P,Z]=I.useState({}),[B,$]=I.useState([]),[U,te]=I.useState(""),[re,ie]=I.useState(null),[K,ve]=I.useState(null),[z,se]=I.useState(null),[le,be]=I.useState(!1),[qe,Le]=I.useState(!1),[ee,xe]=I.useState(!1),[Fe,Je]=I.useState(null),mt=I.useRef(null),ft=I.useRef(null),[H,ce]=I.useState(null),[de,Ue]=I.useState(!1),[pt,Ve]=I.useState(!1),Et=O=>{let ne=O.replace(/\D/g,"").substring(0,11);return ne.length>10?ne=ne.replace(/^(\d\d)(\d{5})(\d{4}).*/,"($1) $2-$3"):ne.length>6?ne=ne.replace(/^(\d\d)(\d{4})(\d{0,4}).*/,"($1) $2-$3"):ne.length>2?ne=ne.replace(/^(\d\d)(\d{0,5})/,"($1) $2"):ne.length>0&&(ne=ne.replace(/^(\d*)/,"($1")),ne},Y=O=>{if(w(O),ce(null),O.requestedData){j({name:O.requestedData.name,email:O.requestedData.email,unitId:"",sector:O.requestedData.sector});const ne=[];O.requestedData.phoneMobile&&ne.push({number:O.requestedData.phoneMobile,type:"celular"}),O.requestedData.phoneFixed&&ne.push({number:O.requestedData.phoneFixed,type:"fixo"}),q(ne.length>0?ne:[{number:"",type:"celular"}]);const Se=A.find(je=>je.email===O.userEmail);if(Se){const je=f.find(tt=>tt.name===Se.unit);je&&j(tt=>({...tt,unitId:je.id})),_(Se.id)}}else{const ne=A.find($e=>$e.email===O.userEmail),Se=ne?f.find($e=>$e.name===ne.unit):null,je=ne?g.find($e=>$e.name.toLowerCase()===ne.role.toLowerCase()||$e.name.toLowerCase()===ne.department.toLowerCase()):null;j({name:O.userName,email:O.userEmail,unitId:Se?Se.id:"",sector:je?je.name:""});const tt=[];ne&&ne.whatsapp&&ne.whatsapp.trim()&&tt.push({number:Et(ne.whatsapp),type:"celular"}),ne&&ne.extension&&ne.extension.trim()&&tt.push({number:`(71) 3879-${ne.extension.trim()}`,type:"fixo"}),q(tt.length>0?tt:[{number:"",type:"celular"}]),ne&&_(ne.id)}n("create")};I.useEffect(()=>{o(!0);const O=kx($e=>{d($e),o(!1)}),ne=OI($e=>{l($e)}),Se=jx($e=>p($e)),je=FI($e=>v($e));return(async()=>{try{const $e=await Fn();k($e)}catch($e){console.error("Erro ao carregar dados bsicos:",$e)}})(),()=>{O(),ne(),Se(),je()}},[]);const fe=()=>{ce(null),w(null),_(""),j({name:"",email:"",unitId:"",sector:""}),q([{number:"",type:"celular"}]),xe(!0),setTimeout(()=>xe(!1),3e3)},ye=()=>{ce(null),w(null),_(""),j({name:"",email:"",unitId:"",sector:""}),q([{number:"",type:"celular"}])},De=O=>{const ne=O.target.value;if(_(ne),ne){const Se=A.find(je=>je.id===ne);if(Se){const je=f.find(zn=>zn.name===Se.unit),tt=g.find(zn=>zn.name.toLowerCase()===Se.role.toLowerCase()||zn.name.toLowerCase()===Se.department.toLowerCase());j({name:Se.name,email:Se.email,unitId:je?je.id:"",sector:tt?tt.name:""});const $e=[];Se.whatsapp&&$e.push({number:Et(Se.whatsapp),type:"celular"}),Se.extension&&$e.push({number:`(71) 3879-${Se.extension}`,type:"fixo"}),q($e.length>0?$e:[{number:"",type:"celular"}])}}},Ae=async()=>{if(!D.unitId||!D.name||!D.sector)return alert("Preencha Unidade, Nome e selecione um Cargo/Setor vlido.");Ue(!0);try{if(!mt.current)return;const O=F.filter(Se=>Se.number&&Se.number.trim()!==""),ne={...D,phones:O};await Ii(mt.current,ne,f),ce(mt.current.toDataURL("image/png"))}catch{alert("Erro ao gerar prvia.")}finally{Ue(!1)}},He=async()=>{var O;if(!(!E||!H||de)){Ue(!0);try{const ne=F.filter($e=>$e.number&&$e.number.trim()!==""),Se={name:D.name,email:D.email,unitId:D.unitId,sector:D.sector,phones:ne},je=(t==null?void 0:t.name)||"Administrador",tt=((O=f.find($e=>$e.id===D.unitId))==null?void 0:O.name)||"N/A";await hC(E.id,"COMPLETED",je,E.userId,Se),await sm({employeeName:D.name,employeeEmail:D.email,department:D.sector,unitName:tt,createdAt:new Date().toISOString(),generatedBy:je,signatureData:Se,origin:"REQUEST"}),be(!1),fe(),n("requests")}catch(ne){console.error("Erro na finalizao:",ne),alert(`Erro ao processar: ${ne.message}`)}finally{Ue(!1)}}},Ge=async()=>{var je;if(!H||de)return;Ue(!0);const O=F.filter(tt=>tt.number&&tt.number.trim()!==""),ne={name:D.name,email:D.email,unitId:D.unitId,sector:D.sector,phones:O},Se=((je=f.find(tt=>tt.id===D.unitId))==null?void 0:je.name)||"Desconhecida";try{await sm({employeeName:D.name,employeeEmail:D.email,department:D.sector,unitName:Se,createdAt:new Date().toISOString(),generatedBy:(t==null?void 0:t.name)||"Admin",signatureData:ne,origin:"MANUAL"}),Le(!1),fe()}catch{alert("Erro ao salvar no histrico.")}finally{Ue(!1)}},Ze=async O=>{if(!O.signatureData||!ft.current)return alert("Dados insuficientes.");await Ii(ft.current,O.signatureData,f);const ne=document.createElement("a");ne.download=`assinatura_${O.employeeName}.png`,ne.href=ft.current.toDataURL("image/png"),ne.click()},it=async O=>{if(!O.signatureData||!ft.current)return alert("Dados insuficientes.");Ue(!0);try{await Ii(ft.current,O.signatureData,f),Je(ft.current.toDataURL("image/png"))}catch{alert("Erro ao gerar visualizao.")}finally{Ue(!1)}},V=O=>{O?(_e(O),Z({...O}),$(O.certifications||[])):(_e(null),Z(T==="units"?{name:"",cnpj:"",site:"",city:"",state:"",address:"",number:"",complement:"",neighborhood:"",cep:"",phone:"",image:""}:{name:"",description:""}),$([])),te(""),C(!0)},W=(O,ne)=>{O.preventDefault(),O.stopPropagation(),ie(ne)},oe=async()=>{if(!(!re||!re.id)){Ue(!0);try{T==="units"?await oC(re.id):await cC(re.id),ie(null)}catch(O){alert(`Erro ao excluir: ${O.message}`)}finally{Ue(!1)}}},Te=async()=>{if(K){Ue(!0);try{await mC(K.id),ve(null)}catch(O){alert(`Erro ao excluir solicitao: ${O.message}`)}finally{Ue(!1)}}},ot=async()=>{if(z){Ue(!0);try{await dC(z.id),se(null)}catch(O){alert(`Erro ao excluir histrico: ${O.message}`)}finally{Ue(!1)}}},Ke=async O=>{const ne=O.replace(/\D/g,"").substring(0,8),Se=ne.length>5?`${ne.slice(0,5)}-${ne.slice(5)}`:ne;if(Z(je=>({...je,cep:Se})),ne.length===8){Ve(!0);try{const je=await fetch(`https://brasilapi.com.br/api/cep/v2/${ne}`);if(je.status===404){console.warn("CEP no encontrado."),Ve(!1);return}if(!je.ok)throw new Error("Erro na rede");const tt=await je.json();tt&&Z($e=>({...$e,address:tt.street||"",neighborhood:tt.neighborhood||"",city:tt.city||"",state:tt.state||"",cep:Se}))}catch(je){console.error("Erro ao buscar CEP (BrasilAPI):",je)}finally{Ve(!1)}}},at=O=>{var Se;const ne=(Se=O.target.files)==null?void 0:Se[0];if(ne){const je=new FileReader;je.onloadend=()=>Z(tt=>({...tt,image:je.result})),je.readAsDataURL(ne)}},Qe=()=>{U.trim()&&($([...B,U.trim()]),te(""))},dt=async()=>{if(!P.name)return alert("Nome obrigatrio.");Ue(!0);try{const O={...P,certifications:B,site:P.site||"",phone:P.phone||"",cnpj:P.cnpj||"",number:P.number||"",complement:P.complement||"",neighborhood:P.neighborhood||"",city:P.city||"",state:P.state||"",cep:P.cep||"",image:P.image||""};T==="units"?ge?await iC(ge.id,O):await rC(O):ge?await lC(ge.id,O):await aC(O),C(!1)}catch(O){alert(`Erro ao salvar: ${O.message}`)}finally{Ue(!1)}},ls=a.filter(O=>O.employeeName.toLowerCase().includes(S.toLowerCase())),Ot=u.filter(O=>O.status==="PENDING"&&O.userName.toLowerCase().includes(S.toLowerCase())),et="w-full p-2.5 border border-slate-300 rounded-lg text-sm bg-white text-slate-900 focus:ring-2 focus:ring-emerald-500 shadow-sm transition-all";return r?i.jsx("div",{className:"flex justify-center p-12",children:i.jsx(Ne,{className:"animate-spin text-emerald-600",size:32})}):i.jsxs("div",{className:"space-y-6 relative",children:[i.jsx("canvas",{ref:ft,className:"hidden"}),i.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[i.jsx("div",{children:i.jsxs("h2",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[i.jsx(Bo,{className:"text-emerald-600"})," Gesto de Assinaturas"]})}),i.jsxs("div",{className:"relative w-full md:w-auto",children:[i.jsx(Zs,{className:"absolute left-3 top-3 text-slate-400 w-4 h-4"}),i.jsx("input",{type:"text",placeholder:"Buscar colaborador...",value:S,onChange:O=>L(O.target.value),className:"pl-10 pr-4 py-2 bg-white border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 w-full md:w-64 shadow-sm"})]})]}),i.jsxs("div",{className:"flex gap-2 border-b border-slate-200 overflow-x-auto",children:[i.jsxs("button",{type:"button",onClick:()=>n("requests"),className:`px-4 py-2 text-sm font-medium border-b-2 whitespace-nowrap flex items-center gap-2 transition-all ${s==="requests"?"border-emerald-600 text-emerald-700 bg-emerald-50/50":"border-transparent text-slate-500 hover:text-slate-700"}`,children:[i.jsx(jr,{size:16})," Solicitaes ",Ot.length>0&&i.jsx("span",{className:"bg-emerald-600 text-white text-[10px] px-1.5 py-0.5 rounded-full ml-1",children:Ot.length})]}),i.jsxs("button",{type:"button",onClick:()=>n("create"),className:`px-4 py-2 text-sm font-medium border-b-2 whitespace-nowrap flex items-center gap-2 transition-all ${s==="create"?"border-emerald-600 text-emerald-700 bg-emerald-50/50":"border-transparent text-slate-500 hover:text-slate-700"}`,children:[i.jsx(ys,{size:16})," Criar Assinatura ",E&&i.jsx("span",{className:"bg-amber-100 text-amber-700 px-1.5 py-0.5 rounded text-[10px] animate-pulse ml-1",children:"Processando"})]}),i.jsxs("button",{type:"button",onClick:()=>n("logs"),className:`px-4 py-2 text-sm font-medium border-b-2 whitespace-nowrap flex items-center gap-2 transition-all ${s==="logs"?"border-emerald-600 text-emerald-700 bg-emerald-50/50":"border-transparent text-slate-500 hover:text-slate-700"}`,children:[i.jsx(ss,{size:16})," Histrico"]}),i.jsxs("button",{type:"button",onClick:()=>n("management"),className:`px-4 py-2 text-sm font-medium border-b-2 whitespace-nowrap flex items-center gap-2 transition-all ${s==="management"?"border-emerald-600 text-emerald-700 bg-emerald-50/50":"border-transparent text-slate-500 hover:text-slate-700"}`,children:[i.jsx(Ws,{size:16})," Configuraes"]})]}),s==="create"&&i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-200 animate-fade-in relative",children:[ee&&i.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 bg-emerald-500 text-white px-6 py-2 rounded-full shadow-lg flex items-center gap-2 animate-bounce z-20",children:[i.jsx(Qn,{size:18})," Assinatura salva com sucesso!"]}),E&&i.jsxs("div",{className:"mb-6 p-4 bg-amber-50 border border-amber-100 rounded-xl flex items-center justify-between animate-fade-in",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 bg-amber-100 rounded-full text-amber-600",children:i.jsx(Bi,{size:20})}),i.jsxs("div",{children:[i.jsxs("p",{className:"text-sm font-bold text-amber-800",children:["Processando solicitao de ",E.userName]}),i.jsxs("p",{className:"text-xs text-amber-600",children:['Observaes: "',E.notes,'"']})]})]}),i.jsx("button",{type:"button",onClick:()=>{w(null),_("")},className:"text-xs font-bold text-amber-700 hover:underline",children:"Cancelar vnculo"})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[i.jsxs("div",{className:"lg:col-span-1 space-y-5",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-[10px] uppercase font-bold text-slate-400 mb-1",children:"Colaborador (Opcional)"}),i.jsxs("select",{value:b,onChange:De,className:et,children:[i.jsx("option",{value:"",children:"Selecionar manualmente..."}),A.sort((O,ne)=>O.name.localeCompare(ne.name)).map(O=>i.jsxs("option",{value:O.id,children:[O.name," (",O.department,")"]},O.id))]})]}),i.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-[10px] uppercase font-bold text-slate-400 mb-1",children:"Unidade"}),i.jsxs("select",{value:D.unitId,onChange:O=>j({...D,unitId:O.target.value}),className:et,children:[i.jsx("option",{value:"",children:"Selecione Unidade"}),f.map(O=>i.jsx("option",{value:O.id,children:O.name},O.id))]})]}),i.jsx("input",{value:D.name,onChange:O=>j({...D,name:O.target.value}),className:et,placeholder:"Nome Completo"}),i.jsx("input",{value:D.email,onChange:O=>j({...D,email:O.target.value}),className:et,placeholder:"E-mail"}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-[10px] uppercase font-bold text-slate-400 mb-1",children:"Cargo / Setor (Exclusivo)"}),i.jsxs("select",{value:D.sector,onChange:O=>j({...D,sector:O.target.value}),className:et,children:[i.jsx("option",{value:"",children:"Selecione um Cargo/Setor..."}),g.sort((O,ne)=>O.name.localeCompare(ne.name)).map(O=>i.jsx("option",{value:O.name,children:O.name},O.id))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-[10px] uppercase font-bold text-slate-400 mb-1",children:"Telefones (WhatsApp e Ramal)"}),F.map((O,ne)=>i.jsxs("div",{className:"flex gap-1 mb-1 animate-fade-in",children:[i.jsx("input",{value:O.number,onChange:Se=>{const je=[...F];je[ne].number=Et(Se.target.value),q(je)},className:`${et} flex-1`,placeholder:"(XX) XXXXX-XXXX"}),i.jsxs("select",{value:O.type,onChange:Se=>{const je=[...F];je[ne].type=Se.target.value,q(je)},className:"border border-slate-300 rounded-lg p-2 text-sm bg-white w-24",children:[i.jsx("option",{value:"celular",children:"Cel"}),i.jsx("option",{value:"fixo",children:"Fixo"})]}),i.jsx("button",{type:"button",onClick:()=>q(F.filter((Se,je)=>je!==ne)),className:"text-red-400 px-1 hover:bg-red-50 rounded",children:i.jsx(Cy,{size:16})})]},ne)),i.jsxs("button",{type:"button",onClick:()=>q([...F,{number:"",type:"celular"}]),className:"text-xs text-emerald-600 flex items-center gap-1 font-bold mt-1 hover:underline",children:[i.jsx(Pt,{size:12})," Adicionar Telefone"]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsxs("button",{type:"button",onClick:ye,className:"bg-slate-100 text-slate-600 p-2.5 rounded-lg font-bold hover:bg-slate-200 flex items-center justify-center gap-2 transition-all border border-slate-200",children:[i.jsx(Sy,{size:16})," Limpar"]}),i.jsxs("button",{type:"button",onClick:Ae,disabled:de,className:"bg-emerald-600 text-white p-2.5 rounded-lg font-bold hover:bg-emerald-700 flex items-center justify-center gap-2 shadow-md shadow-emerald-100 disabled:opacity-50 transition-all",children:[de?i.jsx(Ne,{className:"animate-spin",size:16}):i.jsx(Ay,{size:16})," Preview"]})]})]})]}),i.jsxs("div",{className:"lg:col-span-2 bg-slate-100 rounded-xl p-6 flex flex-col items-center justify-center border min-h-[400px]",children:[i.jsx("canvas",{ref:mt,className:"hidden"}),H?i.jsxs("div",{className:"text-center space-y-6 w-full max-w-2xl animate-fade-in",children:[i.jsx("div",{className:"bg-white p-4 shadow-xl border border-slate-200 rounded-lg overflow-hidden",children:i.jsx("img",{src:H,alt:"Preview",className:"max-w-full"})}),i.jsxs("div",{className:"flex flex-wrap justify-center gap-3",children:[E?i.jsxs("button",{type:"button",onClick:()=>be(!0),disabled:de,className:"bg-emerald-600 text-white px-6 py-2.5 rounded-lg text-sm font-bold hover:bg-emerald-700 flex items-center gap-2 shadow-md shadow-emerald-200 transition-all active:scale-95",children:[de?i.jsx(Ne,{className:"animate-spin",size:18}):i.jsx(ss,{size:18})," Finalizar e Notificar Solicitante"]}):i.jsxs("button",{type:"button",onClick:()=>Le(!0),disabled:de,className:"bg-emerald-600 text-white px-6 py-2.5 rounded-lg text-sm font-bold hover:bg-emerald-700 flex items-center gap-2 shadow-md shadow-emerald-200",children:[de?i.jsx(Ne,{className:"animate-spin",size:18}):i.jsx(hs,{size:18})," Salvar no Histrico"]}),i.jsxs("a",{href:H,download:`assinatura_${D.name}.png`,className:"bg-white border border-slate-200 text-slate-700 px-6 py-2.5 rounded-lg text-sm font-bold hover:bg-slate-50 flex items-center gap-2 shadow-sm",children:[i.jsx(yi,{size:18})," Baixar PNG"]})]})]}):i.jsxs("div",{className:"flex flex-col items-center gap-2 text-slate-400",children:[i.jsx(ys,{size:48,className:"opacity-20 mb-2"}),i.jsx("p",{className:"italic",children:"Gere o preview para habilitar a finalizao."})]})]})]})]}),s==="requests"&&i.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden animate-fade-in",children:Ot.length>0?i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full text-left border-collapse min-w-[800px]",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"bg-slate-50 border-b border-slate-200 text-xs uppercase text-slate-500 font-bold",children:[i.jsx("th",{className:"px-6 py-4",children:"Data"}),i.jsx("th",{className:"px-6 py-4",children:"Colaborador"}),i.jsx("th",{className:"px-6 py-4",children:"Observaes"}),i.jsx("th",{className:"px-6 py-4",children:"Status"}),i.jsx("th",{className:"px-6 py-4 text-right",children:"Aes"})]})}),i.jsx("tbody",{className:"divide-y divide-slate-100",children:Ot.map(O=>i.jsxs("tr",{className:"hover:bg-slate-50/50 transition-colors",children:[i.jsx("td",{className:"px-6 py-4 text-sm text-slate-500",children:new Date(O.createdAt).toLocaleDateString()}),i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("p",{className:"font-bold text-slate-800 text-sm",children:O.userName}),i.jsx("p",{className:"text-xs text-slate-500",children:O.userEmail})]}),i.jsxs("td",{className:"px-6 py-4 text-xs text-slate-500 italic max-w-xs truncate",children:['"',O.notes,'"']}),i.jsx("td",{className:"px-6 py-4",children:i.jsx("span",{className:"text-[10px] uppercase font-bold px-2 py-1 rounded-full border bg-amber-50 text-amber-600 border-amber-100",children:"Pendente"})}),i.jsx("td",{className:"px-6 py-4 text-right",children:i.jsxs("div",{className:"flex justify-end gap-2",children:[i.jsxs("button",{type:"button",onClick:()=>Y(O),className:"text-xs bg-emerald-600 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2 hover:bg-emerald-700 shadow-sm shadow-emerald-100 transition-all",children:[i.jsx(ys,{size:14})," Processar Agora"]}),i.jsx("button",{type:"button",onClick:()=>ve(O),disabled:!e,title:e?"Excluir solicitao":"Apenas usurios Master podem excluir",className:`p-2 transition-colors rounded-lg ${e?"text-slate-400 hover:text-red-600 hover:bg-red-50":"text-slate-200 cursor-not-allowed opacity-50"}`,children:e?i.jsx(st,{size:16}):i.jsx(jt,{size:16})})]})})]},O.id))})]})}):i.jsxs("div",{className:"p-20 text-center bg-slate-50/50 flex flex-col items-center justify-center animate-fade-in",children:[i.jsx("div",{className:"w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mb-6 text-slate-300",children:i.jsx(jr,{size:40})}),i.jsx("h3",{className:"text-xl font-black text-slate-800 uppercase tracking-tight mb-2",children:"Sem solicitaes no momento"}),i.jsx("p",{className:"text-slate-500 max-w-md mx-auto leading-relaxed text-sm",children:"Nenhum colaborador solicitou uma nova assinatura de e-mail recentemente. Quando houver solicitaes pendentes, elas aparecero nesta lista."})]})}),s==="logs"&&i.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden animate-fade-in",children:ls.length>0?i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full text-left border-collapse min-w-[800px]",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"bg-slate-50 border-b border-slate-200 text-xs uppercase text-slate-500 font-bold",children:[i.jsx("th",{className:"px-6 py-4",children:"Data/Hora"}),i.jsx("th",{className:"px-6 py-4",children:"Origem"}),i.jsx("th",{className:"px-6 py-4",children:"Colaborador"}),i.jsx("th",{className:"px-6 py-4",children:"Setor / Unidade"}),i.jsx("th",{className:"px-6 py-4",children:"Processado Por"}),i.jsx("th",{className:"px-6 py-4 text-right",children:"Ao"})]})}),i.jsx("tbody",{className:"divide-y divide-slate-100",children:ls.map(O=>i.jsxs("tr",{className:"hover:bg-slate-50/50 transition-colors",children:[i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("p",{className:"text-xs font-bold text-slate-700",children:new Date(O.createdAt).toLocaleDateString()}),i.jsx("p",{className:"text-[10px] text-slate-400",children:new Date(O.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),i.jsx("td",{className:"px-6 py-4",children:i.jsxs("span",{className:`text-[9px] uppercase font-black px-2 py-0.5 rounded-full flex items-center gap-1 w-fit border ${O.origin==="REQUEST"?"bg-emerald-50 text-emerald-600 border-emerald-100":"bg-slate-50 text-slate-500 border-slate-200"}`,children:[O.origin==="REQUEST"?i.jsx(Oo,{size:10}):i.jsx(Hf,{size:10}),O.origin==="REQUEST"?"Solicitao":"Avulso"]})}),i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("p",{className:"font-bold text-slate-800 text-sm",children:O.employeeName}),i.jsx("p",{className:"text-xs text-slate-500",children:O.employeeEmail})]}),i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("span",{className:"bg-slate-100 px-2 py-0.5 rounded text-[10px] font-bold text-slate-600 border border-slate-200",children:O.department}),i.jsx("p",{className:"text-[10px] text-slate-400 mt-1",children:O.unitName})]}),i.jsx("td",{className:"px-6 py-4",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"p-1.5 bg-slate-100 rounded-full text-slate-500",children:i.jsx(Jf,{size:14})}),i.jsx("span",{className:"text-xs font-bold text-slate-700",children:O.generatedBy})]})}),i.jsx("td",{className:"px-6 py-4 text-right",children:i.jsxs("div",{className:"flex justify-end gap-2",children:[i.jsxs("button",{type:"button",onClick:()=>it(O),className:"text-xs bg-slate-100 text-slate-600 px-3 py-2 rounded-lg font-bold flex items-center gap-2 hover:bg-slate-200 transition-all border border-slate-200",children:[i.jsx(Ks,{size:14})," Visualizar"]}),i.jsxs("button",{type:"button",onClick:()=>Ze(O),className:"text-xs bg-emerald-600 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2 hover:bg-emerald-700 shadow-sm shadow-emerald-100 transition-all",children:[i.jsx(yi,{size:14})," Baixar"]}),i.jsx("button",{type:"button",onClick:()=>se(O),disabled:!e,title:e?"Excluir histrico":"Apenas usurios Master podem excluir",className:`p-2 transition-colors rounded-lg ${e?"text-slate-400 hover:text-red-600 hover:bg-red-50":"text-slate-200 cursor-not-allowed opacity-50"}`,children:e?i.jsx(st,{size:16}):i.jsx(jt,{size:16})})]})})]},O.id))})]})}):i.jsxs("div",{className:"p-20 text-center bg-slate-50/50 flex flex-col items-center justify-center animate-fade-in",children:[i.jsx("div",{className:"w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mb-6 text-slate-300",children:i.jsx(Ry,{size:40})}),i.jsx("h3",{className:"text-xl font-black text-slate-800 uppercase tracking-tight mb-2",children:"Histrico de Geraco Vazio"}),i.jsx("p",{className:"text-slate-500 max-w-md mx-auto leading-relaxed text-sm",children:"Ainda no foram geradas assinaturas oficiais atravs desta ferramenta. Comece processando uma solicitao ou criando uma manualmente."}),i.jsxs("button",{onClick:()=>n("create"),className:"mt-6 text-emerald-600 font-black text-xs uppercase tracking-widest flex items-center gap-2 hover:underline",children:[i.jsx(ys,{size:14})," Criar Primeira Assinatura"]})]})}),s==="management"&&i.jsxs("div",{className:"space-y-6 animate-fade-in",children:[i.jsxs("div",{className:"flex gap-4 border-b border-slate-200",children:[i.jsx("button",{type:"button",onClick:()=>R("units"),className:`pb-2 px-4 text-sm font-bold transition-all ${T==="units"?"border-b-2 border-emerald-600 text-emerald-700":"text-slate-400 hover:text-slate-600"}`,children:"Unidades Fsicas"}),i.jsx("button",{type:"button",onClick:()=>R("sectors"),className:`pb-2 px-4 text-sm font-bold transition-all ${T==="sectors"?"border-b-2 border-emerald-600 text-emerald-700":"text-slate-400 hover:text-slate-600"}`,children:"Cargos / Setores"})]}),i.jsx("div",{className:"flex justify-end",children:i.jsxs("button",{type:"button",onClick:()=>V(),className:"bg-emerald-600 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 hover:bg-emerald-700 shadow-sm shadow-emerald-100",children:[i.jsx(Pt,{size:16})," Adicionar ",T==="units"?"Unidade":"Setor"]})}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:T==="units"?f.map(O=>i.jsxs("div",{className:"bg-white p-6 rounded-[2rem] border border-slate-200 shadow-sm flex flex-col hover:border-emerald-300 hover:shadow-xl transition-all group overflow-hidden relative",children:[i.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i.jsx("div",{className:"w-24 h-12 flex items-center justify-center bg-slate-50 rounded-xl overflow-hidden border border-slate-100 group-hover:bg-white transition-colors p-2 shadow-inner",children:O.image?i.jsx("img",{src:O.image,alt:O.name,className:"max-w-full max-h-full object-contain"}):i.jsxs("div",{className:"text-emerald-600 flex items-center gap-1.5 font-black uppercase text-[10px]",children:[i.jsx($t,{size:16})," UNID"]})}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx("button",{type:"button",onClick:()=>V(O),className:"p-2 text-slate-400 hover:text-emerald-600 hover:bg-emerald-50 rounded-lg transition-all",children:i.jsx(Fs,{size:16})}),i.jsx("button",{type:"button",onClick:ne=>W(ne,O),disabled:!e,className:`p-2 transition-colors rounded-lg ${e?"text-slate-400 hover:text-red-600 hover:bg-red-50":"text-slate-200 cursor-not-allowed opacity-50"}`,children:e?i.jsx(st,{size:16}):i.jsx(jt,{size:16})})]})]}),i.jsxs("div",{className:"space-y-3 mb-6",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-black text-slate-800 uppercase tracking-tight text-lg leading-tight group-hover:text-emerald-600 transition-colors",children:O.name}),i.jsxs("p",{className:"text-[10px] font-bold text-slate-400 flex items-center gap-1 uppercase tracking-widest mt-1",children:[i.jsx(Py,{size:10})," ",O.cnpj||"CNPJ no informado"]})]}),i.jsxs("div",{className:"space-y-1.5",children:[i.jsxs("p",{className:"text-xs text-slate-600 flex items-start gap-2 leading-snug",children:[i.jsx($t,{size:14,className:"text-slate-400 shrink-0 mt-0.5"}),i.jsxs("span",{children:[O.address,", ",O.number,O.complement?` - ${O.complement}`:"",i.jsx("br",{}),O.neighborhood," - ",O.city,"/",O.state]})]}),i.jsxs("p",{className:"text-[10px] text-slate-400 font-bold pl-5",children:["CEP: ",O.cep||"---"]})]})]}),i.jsxs("div",{className:"mt-auto space-y-4 pt-4 border-t border-slate-50",children:[i.jsxs("div",{className:"flex flex-wrap gap-4",children:[O.phone&&i.jsxs("p",{className:"text-[11px] font-bold text-slate-700 flex items-center gap-1.5",children:[i.jsx(or,{size:12,className:"text-emerald-500"})," ",O.phone]}),O.site&&i.jsxs("p",{className:"text-[11px] font-bold text-slate-700 flex items-center gap-1.5",children:[i.jsx(Js,{size:12,className:"text-blue-500"})," ",O.site.replace(/^https?:\/\//,"")]})]}),O.certifications&&O.certifications.length>0&&i.jsx("div",{className:"flex flex-wrap gap-1.5",children:O.certifications.map((ne,Se)=>i.jsxs("span",{className:"bg-amber-50 text-amber-700 text-[9px] font-black uppercase tracking-wider px-2 py-0.5 rounded-full border border-amber-100 flex items-center gap-1",children:[i.jsx(Kf,{size:10})," ",ne]},Se))})]})]},O.id)):g.sort((O,ne)=>O.name.localeCompare(ne.name)).map(O=>i.jsxs("div",{className:"bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex items-center justify-between hover:border-emerald-300 transition-all group",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 bg-emerald-50 rounded-lg text-emerald-600",children:i.jsx(xi,{size:18})}),i.jsx("span",{className:"font-bold text-slate-700 text-sm",children:O.name})]}),i.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[i.jsx("button",{type:"button",onClick:()=>V(O),className:"p-1.5 text-slate-400 hover:text-emerald-600 hover:bg-emerald-50 rounded-lg",children:i.jsx(Fs,{size:14})}),i.jsx("button",{type:"button",onClick:ne=>W(ne,O),disabled:!e,className:`p-1.5 transition-colors rounded-lg ${e?"text-slate-400 hover:text-red-600 hover:bg-red-50":"text-slate-200 cursor-not-allowed opacity-50"}`,children:e?i.jsx(st,{size:14}):i.jsx(jt,{size:14})})]})]},O.id))})]}),Fe&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/70 backdrop-blur-sm z-[200] flex items-center justify-center p-4 animate-fade-in",children:i.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-2xl w-full max-w-2xl overflow-hidden p-8 flex flex-col items-center",children:[i.jsxs("div",{className:"w-full flex justify-between items-center mb-8",children:[i.jsx("h3",{className:"font-black text-slate-800 uppercase text-xs tracking-[0.3em]",children:"Visualizao: Assinatura Gerada"}),i.jsx("button",{onClick:()=>Je(null),className:"p-2 hover:bg-slate-100 rounded-full text-slate-400 transition-all",children:i.jsx(St,{size:24})})]}),i.jsx("div",{className:"bg-white p-6 shadow-2xl border border-slate-100 rounded-xl overflow-hidden mb-10 w-full flex justify-center",children:i.jsx("img",{src:Fe,alt:"Log Signature Preview",className:"max-w-full"})}),i.jsx("div",{className:"flex gap-3",children:i.jsx("button",{onClick:()=>Je(null),className:"px-8 py-3 text-slate-400 font-black uppercase text-xs hover:bg-slate-100 rounded-xl transition-all",children:"Fechar"})})]})}),M&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:i.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh]",children:[i.jsxs("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50",children:[i.jsxs("h3",{className:"font-black text-slate-800 uppercase tracking-widest text-sm flex items-center gap-2",children:[T==="units"?i.jsx($t,{size:18,className:"text-emerald-600"}):i.jsx(xi,{size:18,className:"text-emerald-600"}),ge?"Editar":"Adicionar"," ",T==="units"?"Unidade":"Setor"]}),i.jsx("button",{onClick:()=>C(!1),className:"p-2 hover:bg-slate-200 rounded-full text-slate-400",children:i.jsx(St,{size:24})})]}),i.jsx("div",{className:"p-8 overflow-y-auto custom-scrollbar space-y-6",children:T==="units"?i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"col-span-full flex flex-col items-center gap-2 mb-4",children:[i.jsxs("div",{className:"w-48 h-20 bg-slate-100 rounded-xl border-2 border-dashed border-slate-300 flex items-center justify-center overflow-hidden relative group",children:[P.image?i.jsx("img",{src:P.image,className:"w-full h-full object-contain p-2",alt:"Logo preview"}):i.jsx(As,{size:24,className:"text-slate-400"}),i.jsxs("label",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center cursor-pointer",children:[i.jsx(Si,{size:20,className:"text-white"}),i.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:at})]})]}),i.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-400",children:"Logo da Unidade (PNG)"})]}),i.jsxs("div",{className:"col-span-full",children:[i.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Nome da Unidade"}),i.jsx("input",{value:P.name||"",onChange:O=>Z({...P,name:O.target.value}),className:et})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"CNPJ"}),i.jsx("input",{value:P.cnpj||"",onChange:O=>Z({...P,cnpj:O.target.value}),className:et})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"text-[10px] font-bold text-slate-400 uppercase flex justify-between",children:["CEP (Auto-busca)",pt&&i.jsx(Ne,{size:10,className:"animate-spin text-emerald-500"})]}),i.jsx("input",{value:P.cep||"",onChange:O=>Ke(O.target.value),className:et,placeholder:"00000-000"})]}),i.jsxs("div",{className:"col-span-full",children:[i.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Logradouro / Endereo"}),i.jsx("input",{value:P.address||"",onChange:O=>Z({...P,address:O.target.value}),className:et})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Nmero"}),i.jsx("input",{value:P.number||"",onChange:O=>Z({...P,number:O.target.value}),className:et})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Complemento"}),i.jsx("input",{value:P.complement||"",onChange:O=>Z({...P,complement:O.target.value}),className:et})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Bairro"}),i.jsx("input",{value:P.neighborhood||"",onChange:O=>Z({...P,neighborhood:O.target.value}),className:et})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Cidade / UF"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("input",{value:P.city||"",onChange:O=>Z({...P,city:O.target.value}),className:`${et} flex-1`}),i.jsx("input",{value:P.state||"",onChange:O=>Z({...P,state:O.target.value}),className:`${et} w-16 uppercase`,maxLength:2})]})]}),i.jsxs("div",{className:"col-span-full border-t border-slate-100 pt-4 mt-2",children:[i.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-1",children:"Contato Adicional"}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-[8px] uppercase font-bold text-slate-400",children:"Site Oficial"}),i.jsx("input",{value:P.site||"",onChange:O=>Z({...P,site:O.target.value}),className:et,placeholder:"Ex: www.site.com.br"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[8px] uppercase font-bold text-slate-400",children:"Telefone Geral"}),i.jsx("input",{value:P.phone||"",onChange:O=>Z({...P,phone:O.target.value}),className:et,placeholder:"Ex: (71) 0000-0000"})]})]})]}),i.jsxs("div",{className:"col-span-full border-t border-slate-100 pt-4 mt-2",children:[i.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-3",children:"Certificaes / Selos (Mx 4)"}),i.jsxs("div",{className:"flex gap-2 mb-4",children:[i.jsx("input",{value:U,onChange:O=>te(O.target.value),className:`${et} flex-1`,placeholder:"Ex: ISO 9001"}),i.jsx("button",{type:"button",onClick:Qe,className:"bg-slate-100 px-4 rounded-lg font-bold text-slate-600 hover:bg-slate-200 transition-all",children:i.jsx(Pt,{size:18})})]}),i.jsx("div",{className:"flex flex-wrap gap-2",children:B.map((O,ne)=>i.jsxs("span",{className:"bg-emerald-50 text-emerald-700 text-[10px] font-bold px-3 py-1.5 rounded-full border border-emerald-100 flex items-center gap-2",children:[O," ",i.jsx("button",{type:"button",onClick:()=>$(B.filter((Se,je)=>je!==ne)),"aria-label":"Remover certificao",children:i.jsx(St,{size:12})})]},ne))})]})]}):i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Nome do Cargo / Setor"}),i.jsx("input",{value:P.name||"",onChange:O=>Z({...P,name:O.target.value}),className:et,placeholder:"Ex: Gerente de Operaes"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Observaes Internas (Opcional)"}),i.jsx("textarea",{value:P.description||"",onChange:O=>Z({...P,description:O.target.value}),className:`${et} min-h-[100px]`})]})]})}),i.jsxs("div",{className:"p-6 bg-slate-50 border-t border-slate-100 flex justify-end gap-3",children:[i.jsx("button",{onClick:()=>C(!1),className:"px-6 py-2 text-slate-600 font-bold text-sm hover:bg-slate-200 rounded-xl transition-all",disabled:de,children:"Cancelar"}),i.jsxs("button",{onClick:dt,className:"px-10 py-2 bg-emerald-600 text-white font-bold text-sm hover:bg-emerald-700 rounded-xl shadow-lg shadow-emerald-200 flex items-center gap-2",disabled:de,children:[de?i.jsx(Ne,{className:"animate-spin",size:18}):i.jsx(hs,{size:18})," Salvar"]})]})]})}),le&&E&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:i.jsx("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-sm overflow-hidden border-2 border-emerald-100",children:i.jsxs("div",{className:"p-6 text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-emerald-50 rounded-full flex items-center justify-center mx-auto mb-4 text-emerald-600",children:i.jsx(va,{size:32})}),i.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:"Finalizar Processamento?"}),i.jsxs("p",{className:"text-sm text-slate-500 mb-6",children:["Deseja finalizar e notificar ",i.jsx("strong",{children:E.userName}),"?",i.jsx("br",{}),"A assinatura ser salva no histrico e a tarefa correspondente no iRamais ser concluda."]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>be(!1),className:"flex-1 py-3 text-slate-600 hover:bg-slate-100 rounded-xl font-bold text-sm transition-colors",disabled:de,children:"Cancelar"}),i.jsxs("button",{onClick:He,className:"flex-1 py-3 bg-emerald-600 text-white rounded-xl font-bold text-sm hover:bg-emerald-700 flex items-center justify-center gap-2 shadow-lg shadow-emerald-200 transition-colors",disabled:de,children:[de?i.jsx(Ne,{size:16,className:"animate-spin"}):i.jsx(ss,{size:16})," Confirmar e Notificar"]})]})]})})}),qe&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:i.jsx("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-sm overflow-hidden border-2 border-emerald-100",children:i.jsxs("div",{className:"p-6 text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-emerald-50 rounded-full flex items-center justify-center mx-auto mb-4 text-emerald-600",children:i.jsx(hs,{size:32})}),i.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:"Salvar no Histrico?"}),i.jsx("p",{className:"text-sm text-slate-500 mb-6",children:"Esta assinatura no est vinculada a uma solicitao. Deseja salv-la no histrico para futuras consultas e downloads?"}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>Le(!1),className:"flex-1 py-3 text-slate-600 hover:bg-slate-100 rounded-xl font-bold text-sm transition-colors",disabled:de,children:"No, apenas ver"}),i.jsxs("button",{onClick:Ge,className:"flex-1 py-3 bg-emerald-600 text-white rounded-xl font-bold text-sm hover:bg-emerald-700 flex items-center justify-center gap-2 shadow-lg shadow-emerald-200 transition-all",disabled:de,children:[de?i.jsx(Ne,{size:16,className:"animate-spin"}):i.jsx(ss,{size:16})," Confirmar e Salvar"]})]})]})})}),re&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-[120] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:i.jsx("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-sm overflow-hidden border-2 border-red-100",children:i.jsxs("div",{className:"p-6 text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4 text-red-500",children:i.jsx(ms,{size:32})}),i.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:["Excluir ",T==="units"?"Unidade":"Setor","?"]}),i.jsxs("p",{className:"text-sm text-slate-500 mb-6",children:["Tem certeza que deseja remover ",i.jsxs("strong",{children:['"',re.name,'"']}),"?",i.jsx("br",{}),"Isso no apagar as assinaturas geradas anteriormente, mas impedir novas."]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>ie(null),className:"flex-1 py-3 text-slate-600 hover:bg-slate-100 rounded-xl font-bold text-sm",disabled:de,children:"Cancelar"}),i.jsxs("button",{onClick:oe,className:"flex-1 py-3 bg-red-600 text-white rounded-xl font-bold text-sm hover:bg-red-700 transition-all flex items-center justify-center gap-2",disabled:de,children:[de?i.jsx(Ne,{size:16,className:"animate-spin"}):i.jsx(st,{size:16})," Sim, Excluir"]})]})]})})}),K&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-[120] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:i.jsx("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-sm overflow-hidden border-2 border-red-100",children:i.jsxs("div",{className:"p-6 text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4 text-red-500",children:i.jsx(ms,{size:32})}),i.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:"Excluir Solicitao?"}),i.jsxs("p",{className:"text-sm text-slate-500 mb-6",children:["Deseja remover permanentemente a solicitao de ",i.jsx("strong",{children:K.userName}),"?"]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>ve(null),className:"flex-1 py-3 text-slate-600 hover:bg-slate-100 rounded-xl font-bold text-sm",disabled:de,children:"Cancelar"}),i.jsxs("button",{onClick:Te,className:"flex-1 py-3 bg-red-600 text-white rounded-xl font-bold text-sm hover:bg-red-700 flex items-center justify-center gap-2",disabled:de,children:[de?i.jsx(Ne,{size:16,className:"animate-spin"}):i.jsx(st,{size:16})," Sim, Excluir"]})]})]})})}),z&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-[120] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:i.jsx("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-sm overflow-hidden border-2 border-red-100",children:i.jsxs("div",{className:"p-6 text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4 text-red-500",children:i.jsx(ms,{size:32})}),i.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:"Excluir do Histrico?"}),i.jsxs("p",{className:"text-sm text-slate-500 mb-6",children:["Deseja remover o registro de ",i.jsx("strong",{children:z.employeeName})," do histrico?",i.jsx("br",{}),"Isso no impedir o colaborador de baixar a assinatura dele."]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>se(null),className:"flex-1 py-3 text-slate-600 hover:bg-slate-100 rounded-xl font-bold text-sm",disabled:de,children:"Cancelar"}),i.jsxs("button",{onClick:ot,className:"flex-1 py-3 bg-red-600 text-white rounded-xl font-bold text-sm hover:bg-red-700 flex items-center justify-center gap-2",disabled:de,children:[de?i.jsx(Ne,{size:16,className:"animate-spin"}):i.jsx(st,{size:16})," Sim, Excluir"]})]})]})})})]})},Uf=[{label:"Ttulo do Termo",key:"titulo_documento",mapping:"doc_title",type:"text"},{label:"Nome do Colaborador",key:"nome_colaborador",mapping:"emp_name",type:"text"},{label:"Departamento/Setor",key:"departamento",mapping:"emp_dept",type:"text"},{label:"Cargo do Colaborador",key:"cargo",mapping:"emp_role",type:"text"},{label:"Unidade de Trabalho",key:"unidade",mapping:"emp_unit",type:"text"},{label:"Data (DD/MM/AAAA)",key:"data_documento",mapping:"doc_date",type:"text"},{label:"Data por Extenso",key:"dia_mesescrito_ano",mapping:"doc_date_full",type:"text"}],b2=t=>{if(!t)return"";let e=t.replace(/\\pict[\s\S]*?\}|\\bin[0-9 ]+.*?\}/g," ");return e=e.replace(/\{\\\*\\generated.*?\}|\\blipuid[\s\S]*?\}/g," "),e=e.replace(/\\([a-z]{1,32})(-?\d+)? ?/g,(s,n)=>n==="par"||n==="line"?`
`:n==="tab"?"	":""),e=e.replace(/[\{\}]/g,""),e.trim().replace(/[ ]{2,}/g," ")},w2=()=>{var Ge,Ze,it;const{currentUser:t,isMaster:e,isAdmin:s,globalSettings:n}=Ut(),[r,o]=I.useState("issued"),[a,l]=I.useState([]),[u,d]=I.useState([]),[f,p]=I.useState([]),[g,v]=I.useState([]),[A,k]=I.useState([]),[S,L]=I.useState([]),[D,j]=I.useState(!0),[F,q]=I.useState(!1),[E,w]=I.useState(""),[b,_]=I.useState(null),[T,R]=I.useState(null),[M,C]=I.useState(""),[ge,_e]=I.useState(!1),[P,Z]=I.useState(null),[B,$]=I.useState(null),[U,te]=I.useState(null),[re,ie]=I.useState({name:"",title:"",type:"entrega",responsibleDepartment:(t==null?void 0:t.department)||"TI",content:"",tableFields:[],customVariables:[...Uf],certificationImages:[]}),[K,ve]=I.useState({templateId:"",employeeId:"",dataDoc:new Date().toISOString().split("T")[0],dynamicData:{}}),z=I.useMemo(()=>{var V;return e||s?{enabled:!0,canCreateTemplates:!0,canIssueTerms:!0,canDelete:!0,canReturn:!0,canSeeAllSectors:!0}:((V=n==null?void 0:n.termsDeptPermissions)==null?void 0:V[(t==null?void 0:t.department)||""])||{enabled:!1,canCreateTemplates:!1,canIssueTerms:!1,canDelete:!1,canReturn:!1,canSeeAllSectors:!1}},[n,t,e,s]);I.useEffect(()=>{j(!0);const V=DI(l),W=Px(d);return Fn().then(p),ln().then(k),gC().then(v),mr().then(L),j(!1),()=>{V(),W()}},[]);const se=I.useMemo(()=>e||s||z.canSeeAllSectors?a:a.filter(V=>V.responsibleDepartment===(t==null?void 0:t.department)),[a,e,s,z.canSeeAllSectors,t]),le=I.useMemo(()=>{const V=new Set(se.map(oe=>oe.id));return(e||s||z.canSeeAllSectors?u:u.filter(oe=>V.has(oe.templateId))).filter(oe=>oe.employeeName.toLowerCase().includes(E.toLowerCase()))},[u,se,e,s,z.canSeeAllSectors,E]),be=I.useMemo(()=>{const V=new Map;return le.forEach(W=>{W.originalTermId&&W.type==="devolucao"&&V.set(W.originalTermId,{status:W.status,id:W.id})}),V},[le]),qe=I.useMemo(()=>{const V=new Map(u.map(W=>[W.id,W]));return[...le].sort((W,oe)=>{const Te=W.originalTermId||W.id,ot=oe.originalTermId||oe.id;if(Te===ot)return W.type==="devolucao"?1:-1;const Ke=V.get(Te)||W,at=V.get(ot)||oe;return new Date(at.createdAt).getTime()-new Date(Ke.createdAt).getTime()})},[le,u]),Le=async V=>{q(!0);try{const W=await new Promise((Te,ot)=>{const Ke=new FileReader;Ke.onload=at=>{var Qe;return Te((Qe=at.target)==null?void 0:Qe.result)},Ke.onerror=ot,Ke.readAsText(V,"windows-1252")}),oe=b2(W);ie(Te=>({...Te,content:oe}))}catch{alert("Erro ao ler arquivo RTF.")}finally{q(!1)}},ee=(V,W,oe,Te)=>{const ot=a.find(Qe=>Qe.id===V),Ke=f.find(Qe=>Qe.id===W);if(!ot)return Te;const at={...Te};return ot.customVariables.forEach(Qe=>{if(Qe.mapping&&Qe.mapping!=="none"&&Ke)switch(Qe.mapping){case"doc_title":at[Qe.key]=ot.title;break;case"emp_name":at[Qe.key]=Ke.name;break;case"emp_dept":at[Qe.key]=Ke.department;break;case"emp_role":at[Qe.key]=Ke.role;break;case"emp_unit":at[Qe.key]=Ke.unit||"MATRIZ";break;case"doc_date":at[Qe.key]=new Date(oe).toLocaleDateString("pt-BR");break;case"doc_date_full":at[Qe.key]=new Date(oe).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric"});break}else at[Qe.key]||(at[Qe.key]="")}),at},xe=V=>{const W=ee(V,K.employeeId,K.dataDoc,{});ve(oe=>({...oe,templateId:V,dynamicData:W}))},Fe=V=>{const W=ee(K.templateId,V,K.dataDoc,K.dynamicData);ve(oe=>({...oe,employeeId:V,dynamicData:W}))},Je=V=>{const W=ee(K.templateId,K.employeeId,V,K.dynamicData);ve(oe=>({...oe,dataDoc:V,dynamicData:W}))},mt=(V,W)=>{ve(oe=>({...oe,dynamicData:{...oe.dynamicData,[V]:W}}))},ft=async V=>{if(V.preventDefault(),!K.templateId||!K.employeeId)return alert("Selecione modelo e colaborador.");q(!0);try{const W=f.find(Ke=>Ke.id===K.employeeId),oe=a.find(Ke=>Ke.id===K.templateId);if(!W||!oe)throw new Error;const Te=oe.customVariables.find(Ke=>Ke.mapping==="emp_name"),ot=Te&&K.dynamicData[Te.key]||W.name;await tC({templateId:oe.id,employeeId:W.id,employeeName:ot,type:oe.type,data:K.dynamicData,originalTermId:K.originalTermId||"",issuerName:(t==null?void 0:t.name)||"Administrador"}),alert("Termo emitido com sucesso!"),ve({templateId:"",employeeId:"",dataDoc:new Date().toISOString().split("T")[0],dynamicData:{}}),o("issued")}catch{alert("Erro ao emitir termo.")}finally{q(!1)}},H=async()=>{if(!re.name||!re.content)return alert("Preencha o nome e o contedo do termo.");q(!0);try{P?await eC(P.id,{...re}):await ZI({...re,active:!0,createdAt:new Date().toISOString()}),_e(!1)}catch{alert("Erro ao salvar modelo.")}finally{q(!1)}},ce=async(V,W,oe)=>{if(!(!e||!n)){q(!0);try{const Te=n.termsDeptPermissions||{},ot=Te[V]||{enabled:!1,canCreateTemplates:!1,canIssueTerms:!1,canDelete:!1,canReturn:!1,canSeeAllSectors:!1},Ke={...Te,[V]:{...ot,[W]:oe}};await Dx({termsDeptPermissions:Ke})}catch{alert("Erro ao atualizar permisso.")}finally{q(!1)}}},de=()=>ie(V=>({...V,customVariables:[...V.customVariables||[],{key:"",label:"",mapping:"none",type:"text"}]})),Ue=V=>ie(W=>({...W,customVariables:(W.customVariables||[]).filter((oe,Te)=>Te!==V)})),pt=(V,W)=>ie(oe=>{const Te=[...oe.customVariables||[]];return W.key&&(W.key=W.key.toLowerCase().replace(/[^a-z0-9_]/g,"")),Te[V]={...Te[V],...W},{...oe,customVariables:Te}}),Ve=()=>ie(V=>({...V,tableFields:[...V.tableFields||[],{label:"",variable:""}]})),Et=V=>ie(W=>({...W,tableFields:(W.tableFields||[]).filter((oe,Te)=>Te!==V)})),Y=(V,W)=>ie(oe=>{const Te=[...oe.tableFields||[]];return Te[V]={...Te[V],...W},{...oe,tableFields:Te}}),fe=V=>{var oe;const W=(oe=V.target.files)==null?void 0:oe[0];if(W){const Te=new FileReader;Te.onload=ot=>{var at;const Ke=new Image;Ke.onload=()=>{const Qe=document.createElement("canvas");let dt=Ke.width,ls=Ke.height;const Ot=400;dt>ls?dt>Ot&&(ls*=Ot/dt,dt=Ot):ls>Ot&&(dt*=Ot/ls,ls=Ot),Qe.width=dt,Qe.height=ls;const et=Qe.getContext("2d");et==null||et.drawImage(Ke,0,0,dt,ls);const O=Qe.toDataURL("image/png",.8);ie(ne=>({...ne,certificationImages:[...ne.certificationImages||[],O]}))},Ke.src=(at=ot.target)==null?void 0:at.result},Te.readAsDataURL(W)}},ye=V=>{ie(W=>({...W,certificationImages:(W.certificationImages||[]).filter((oe,Te)=>Te!==V)}))},De=V=>{let W=V.content;const oe={};V.customVariables.forEach(Te=>{oe[Te.key]=`[${Te.label.toUpperCase()}]`;const ot=new RegExp(`{{${Te.key}}}`,"g");W=W.replace(ot,oe[Te.key])}),C(W),R(V)},Ae=async()=>{if(B){q(!0);try{await nC(B.id),$(null)}catch{alert("Erro ao excluir documento.")}finally{q(!1)}}},He=V=>{const W=se.find(oe=>oe.type==="devolucao");ve({templateId:W?W.id:"",employeeId:V.employeeId,originalTermId:V.id,dataDoc:new Date().toISOString().split("T")[0],dynamicData:{...V.data}}),o("new"),window.scrollTo({top:0,behavior:"smooth"})};return i.jsxs("div",{className:"space-y-6 animate-fade-in",children:[i.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[i.jsx(jr,{className:"text-emerald-600"})," Gesto de Termos"]}),i.jsxs("p",{className:"text-slate-500 text-sm",children:["Setor: ",i.jsx("span",{className:"font-bold text-emerald-600 uppercase",children:t==null?void 0:t.department})]})]}),i.jsxs("div",{className:"flex gap-2",children:[(e||s||z.canCreateTemplates)&&i.jsxs("button",{type:"button",onClick:()=>{Z(null),ie({name:"",title:"",type:"entrega",responsibleDepartment:(t==null?void 0:t.department)||"",content:"",tableFields:[],customVariables:[...Uf],certificationImages:[]}),_e(!0)},className:"bg-white border border-slate-200 text-slate-700 px-4 py-2 rounded-lg font-bold flex items-center gap-2 hover:bg-slate-50 transition-all text-sm shadow-sm",children:[i.jsx(Pt,{size:18})," Novo Modelo"]}),(e||s||z.canIssueTerms)&&i.jsxs("button",{type:"button",onClick:()=>{ve({...K,originalTermId:void 0}),o("new")},className:"bg-emerald-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-emerald-700 transition-all flex items-center gap-2 shadow-md text-sm",children:[i.jsx(Pt,{size:18})," Emitir Termo"]})]})]}),i.jsxs("div",{className:"flex gap-4 border-b border-slate-200 overflow-x-auto",children:[i.jsx("button",{onClick:()=>o("issued"),className:`pb-2 px-2 text-sm font-bold border-b-2 transition-all whitespace-nowrap ${r==="issued"?"border-emerald-600 text-emerald-700":"border-transparent text-slate-400"}`,children:"Termos Emitidos"}),i.jsx("button",{onClick:()=>o("templates"),className:`pb-2 px-2 text-sm font-bold border-b-2 transition-all whitespace-nowrap ${r==="templates"?"border-emerald-600 text-emerald-700":"border-transparent text-slate-400"}`,children:"Modelos de Termo"}),e&&i.jsxs("button",{onClick:()=>o("permissions"),className:`pb-2 px-2 text-sm font-bold border-b-2 transition-all whitespace-nowrap flex items-center gap-2 ${r==="permissions"?"border-emerald-600 text-emerald-700":"border-transparent text-slate-400"}`,children:[i.jsx(yc,{size:16})," Permisses por Setor"]})]}),r==="permissions"&&e&&i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 animate-fade-in overflow-hidden",children:[i.jsxs("div",{className:"p-6 bg-slate-50 border-b border-slate-100 flex items-center gap-3",children:[i.jsx("div",{className:"p-3 bg-white rounded-xl text-emerald-600 shadow-sm",children:i.jsx(Ws,{size:20})}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-black text-slate-800 uppercase text-sm tracking-tight",children:"Matriz de Permisses: Gesto de Termos"}),i.jsx("p",{className:"text-xs text-slate-500 font-medium",children:"Defina detalhadamente o que cada setor pode realizar no mdulo administrativo."})]})]}),i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full text-left border-collapse min-w-[1000px]",children:[i.jsx("thead",{className:"bg-slate-50 border-b border-slate-200 text-[10px] uppercase text-slate-400 font-black",children:i.jsxs("tr",{children:[i.jsx("th",{className:"px-6 py-4",children:"Departamento"}),i.jsx("th",{className:"px-6 py-4 text-center",children:"Habilitar Menu"}),i.jsx("th",{className:"px-6 py-4 text-center",children:"Criar Modelos"}),i.jsx("th",{className:"px-6 py-4 text-center",children:"Emitir Termos"}),i.jsx("th",{className:"px-6 py-4 text-center",children:"Deletar Registros"}),i.jsx("th",{className:"px-6 py-4 text-center",children:"Gerar Devolues"}),i.jsx("th",{className:"px-6 py-4 text-center bg-emerald-50/50 text-emerald-600",children:"Viso Global (RH/DP)"})]})}),i.jsx("tbody",{className:"divide-y divide-slate-100",children:S.sort((V,W)=>V.name.localeCompare(W.name)).map(V=>{var oe;const W=((oe=n==null?void 0:n.termsDeptPermissions)==null?void 0:oe[V.name])||{enabled:!1,canCreateTemplates:!1,canIssueTerms:!1,canDelete:!1,canReturn:!1,canSeeAllSectors:!1};return i.jsxs("tr",{className:"hover:bg-slate-50/50 transition-all",children:[i.jsx("td",{className:"px-6 py-4 font-black text-slate-700 uppercase text-xs tracking-tight",children:V.name}),i.jsx("td",{className:"px-6 py-4 text-center",children:i.jsx("button",{onClick:()=>ce(V.name,"enabled",!W.enabled),className:`p-1.5 rounded-lg transition-all ${W.enabled?"bg-emerald-600 text-white":"bg-slate-100 text-slate-300 hover:text-slate-500"}`,children:W.enabled?i.jsx(jy,{size:18}):i.jsx(jt,{size:18})})}),i.jsx("td",{className:"px-6 py-4 text-center",children:i.jsx("button",{onClick:()=>ce(V.name,"canCreateTemplates",!W.canCreateTemplates),className:`p-1.5 rounded-lg transition-all ${W.canCreateTemplates?"bg-emerald-600 text-white":"bg-slate-100 text-slate-300 hover:text-slate-500"}`,children:W.canCreateTemplates?i.jsx(ss,{size:18}):i.jsx(Jn,{size:18})})}),i.jsx("td",{className:"px-6 py-4 text-center",children:i.jsx("button",{onClick:()=>ce(V.name,"canIssueTerms",!W.canIssueTerms),className:`p-1.5 rounded-lg transition-all ${W.canIssueTerms?"bg-emerald-600 text-white":"bg-slate-100 text-slate-300 hover:text-slate-500"}`,children:W.canIssueTerms?i.jsx(ss,{size:18}):i.jsx(Jn,{size:18})})}),i.jsx("td",{className:"px-6 py-4 text-center",children:i.jsx("button",{onClick:()=>ce(V.name,"canDelete",!W.canDelete),className:`p-1.5 rounded-lg transition-all ${W.canDelete?"bg-red-600 text-white":"bg-slate-100 text-slate-300 hover:text-slate-500"}`,children:W.canDelete?i.jsx(ss,{size:18}):i.jsx(Jn,{size:18})})}),i.jsx("td",{className:"px-6 py-4 text-center",children:i.jsx("button",{onClick:()=>ce(V.name,"canReturn",!W.canReturn),className:`p-1.5 rounded-lg transition-all ${W.canReturn?"bg-emerald-600 text-white":"bg-slate-100 text-slate-300 hover:text-slate-500"}`,children:W.canReturn?i.jsx(ss,{size:18}):i.jsx(Jn,{size:18})})}),i.jsx("td",{className:"px-6 py-4 text-center bg-emerald-50/20",children:i.jsx("button",{onClick:()=>ce(V.name,"canSeeAllSectors",!W.canSeeAllSectors),className:`p-1.5 rounded-lg transition-all ${W.canSeeAllSectors?"bg-emerald-600 text-white":"bg-slate-100 text-slate-300 hover:text-slate-500"}`,title:"Permitir visualizar termos de todos os outros setores",children:W.canSeeAllSectors?i.jsx(Js,{size:18}):i.jsx(Jn,{size:18})})})]},V.id)})})]})})]}),r==="issued"&&i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden animate-fade-in",children:[i.jsxs("div",{className:"p-4 border-b border-slate-100 flex items-center gap-3",children:[i.jsxs("div",{className:"relative flex-1 max-w-md",children:[i.jsx(Zs,{className:"absolute left-3 top-2.5 text-slate-400 w-4 h-4"}),i.jsx("input",{type:"text",placeholder:"Filtrar colaborador...",value:E,onChange:V=>w(V.target.value),className:"w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-emerald-500"})]}),z.canSeeAllSectors&&i.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-emerald-50 text-emerald-700 rounded-lg border border-emerald-100 text-[10px] font-black uppercase",children:[i.jsx(Js,{size:14})," Viso Global Ativa"]})]}),i.jsxs("table",{className:"w-full text-left border-collapse",children:[i.jsx("thead",{className:"bg-slate-50 border-b text-xs uppercase text-slate-500 font-bold",children:i.jsxs("tr",{children:[i.jsx("th",{className:"px-6 py-4",children:"Data"}),i.jsx("th",{className:"px-6 py-4",children:"Colaborador"}),i.jsx("th",{className:"px-6 py-4",children:"Equipamento/Info"}),i.jsx("th",{className:"px-6 py-4",children:"Status / Vnculo"}),i.jsx("th",{className:"px-6 py-4 text-right",children:"Aes"})]})}),i.jsx("tbody",{className:"divide-y divide-slate-100",children:qe.map(V=>{const W=V.type==="devolucao",oe=be.get(V.id);return i.jsxs("tr",{className:`hover:bg-slate-50/50 transition-colors ${W?"bg-slate-50/30":""}`,children:[i.jsx("td",{className:"px-6 py-4 text-xs text-slate-500",children:i.jsxs("div",{className:"flex items-center gap-2",children:[W&&i.jsx(ky,{size:14,className:"text-slate-300 ml-2"}),new Date(V.createdAt).toLocaleDateString()]})}),i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("p",{className:`font-bold text-slate-800 text-sm ${W?"ml-4":""}`,children:V.employeeName}),i.jsx("p",{className:`text-[10px] text-slate-400 uppercase font-black ${W?"ml-4":""}`,children:V.type})]}),i.jsx("td",{className:"px-6 py-4 text-xs text-slate-600 font-medium uppercase line-clamp-1",children:V.data.marca_equipamento||V.data.item||V.data.modelo_equipamento||"---"}),i.jsx("td",{className:"px-6 py-4",children:i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsx("span",{className:`text-[9px] font-black uppercase px-2 py-1 rounded-full border w-fit ${V.status==="ASSINADO"?"bg-emerald-50 text-emerald-600 border-emerald-100":"bg-amber-50 text-amber-600 border-amber-100"}`,children:V.status}),(V.type==="entrega"||V.type==="emprestimo")&&oe&&i.jsxs("div",{className:`text-[8px] font-black uppercase flex items-center gap-1 mt-1 ${oe.status==="ASSINADO"?"text-blue-600":"text-amber-500 animate-pulse"}`,children:[oe.status==="ASSINADO"?i.jsx(ss,{size:10}):i.jsx(Rs,{size:10}),oe.status==="ASSINADO"?"Devoluo Concluda":"Devoluo em Aberto"]})]})}),i.jsx("td",{className:"px-6 py-4 text-right",children:i.jsxs("div",{className:"flex justify-end gap-1",children:[(e||s||z.canReturn)&&(V.type==="entrega"||V.type==="emprestimo")&&!oe&&V.status==="ASSINADO"&&i.jsx("button",{type:"button",onClick:()=>He(V),title:"Gerar Termo de Devoluo",className:"p-2 text-slate-400 hover:text-amber-600 transition-colors",children:i.jsx(Dy,{size:18})}),i.jsx("button",{type:"button",onClick:()=>{const Te=a.find(ot=>ot.id===V.templateId);if(Te){let ot=Te.content;Object.entries(V.data).forEach(([Ke,at])=>{const Qe=new RegExp(`{{${Ke}}}`,"g");ot=ot.replace(Qe,at||"")}),C(ot),_(V)}},className:"p-2 text-slate-400 hover:text-emerald-600 transition-colors",children:i.jsx(Ks,{size:18})}),(e||s||z.canDelete)&&i.jsx("button",{type:"button",onClick:()=>$(V),className:"p-2 text-slate-400 hover:text-red-600 transition-colors",children:i.jsx(st,{size:18})})]})})]},V.id)})})]})]}),r==="templates"&&i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-fade-in",children:[se.map(V=>i.jsx("div",{className:"bg-white p-6 rounded-3xl border border-slate-200 shadow-sm hover:shadow-md transition-all group flex flex-col justify-between",children:i.jsxs("div",{children:[i.jsxs("div",{className:"flex justify-between items-start mb-4",children:[i.jsx("div",{className:"bg-emerald-50 p-3 rounded-2xl text-emerald-600 group-hover:bg-emerald-600 group-hover:text-white transition-all",children:i.jsx(Bo,{size:24})}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx("button",{type:"button",onClick:()=>De(V),className:"p-2 text-slate-300 hover:text-emerald-600 transition-colors",title:"Ver modelo do documento",children:i.jsx(Ks,{size:18})}),(e||s||z.canCreateTemplates)&&i.jsxs(i.Fragment,{children:[i.jsx("button",{type:"button",onClick:()=>{Z(V),ie({...V,tableFields:V.tableFields||[],customVariables:V.customVariables||[],certificationImages:V.certificationImages||[]}),_e(!0)},className:"p-2 text-slate-300 hover:text-indigo-600 transition-colors",children:i.jsx(Fs,{size:18})}),i.jsx("button",{type:"button",onClick:()=>te(V),className:"p-2 text-slate-300 hover:text-red-600 transition-colors",children:i.jsx(st,{size:18})})]})]})]}),i.jsx("h4",{className:"font-black text-slate-800 uppercase text-base leading-tight mb-1",children:V.name}),i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsxs("p",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-widest",children:["Tipo: ",V.type,"  ",(V.customVariables||[]).length," Variveis"]}),i.jsxs("p",{className:"text-[10px] text-emerald-600 font-black uppercase tracking-widest flex items-center gap-1",children:[i.jsx(zr,{size:12})," Setor: ",V.responsibleDepartment]})]})]})},V.id)),se.length===0&&i.jsx("div",{className:"col-span-full py-20 text-center text-slate-400 italic",children:"Nenhum modelo cadastrado para seu setor."})]}),r==="new"&&i.jsxs("div",{className:"bg-white p-8 rounded-[2.5rem] border border-emerald-100 shadow-xl animate-fade-in max-w-4xl mx-auto",children:[i.jsxs("h3",{className:"text-xl font-black text-slate-800 mb-8 flex items-center gap-3 uppercase tracking-tight",children:[i.jsx(va,{className:"text-emerald-600"})," ",K.originalTermId?"Emisso de Termo de Devoluo":"Emisso de Termo Digital"]}),i.jsxs("form",{onSubmit:ft,className:"space-y-8",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1",children:"Modelo de Documento"}),i.jsxs("select",{required:!0,value:K.templateId,onChange:V=>xe(V.target.value),className:"w-full p-4 border-2 border-slate-100 rounded-2xl text-sm font-bold focus:ring-2 focus:ring-emerald-500 outline-none bg-white text-slate-700 uppercase shadow-sm",children:[i.jsx("option",{value:"",children:"Selecione o Modelo..."}),se.map(V=>i.jsxs("option",{value:V.id,children:["[",V.responsibleDepartment,"] ",V.name," (",V.type,")"]},V.id))]})]}),i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1",children:"Colaborador Destinatrio"}),i.jsxs("select",{required:!0,value:K.employeeId,onChange:V=>Fe(V.target.value),className:"w-full p-4 border-2 border-slate-100 rounded-2xl text-sm font-bold focus:ring-2 focus:ring-emerald-500 outline-none bg-white text-slate-700 uppercase shadow-sm",children:[i.jsx("option",{value:"",children:"Selecione o Colaborador..."}),f.sort((V,W)=>V.name.localeCompare(W.name)).map(V=>i.jsxs("option",{value:V.id,children:[V.name," (",V.department,")"]},V.id))]})]})]}),K.templateId&&i.jsxs("div",{className:"bg-slate-50/50 p-8 rounded-[2rem] border border-slate-200 space-y-6 animate-fade-in shadow-inner",children:[i.jsx("div",{className:"flex items-center justify-between mb-4",children:i.jsxs("div",{className:"flex items-center gap-2 text-slate-400 font-black uppercase text-[10px] tracking-[0.2em]",children:[i.jsx(My,{size:14})," Dados do Documento"]})}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(()=>{const V=a.find(W=>W.id===K.templateId);return((V==null?void 0:V.customVariables)||[]).map(W=>{const oe=W.type==="textarea";return i.jsxs("div",{className:`space-y-1 ${oe?"md:col-span-2":""}`,children:[i.jsxs("div",{className:"flex items-center justify-between ml-1",children:[i.jsx("label",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest",children:W.label}),W.mapping&&W.mapping!=="none"&&i.jsxs("span",{className:"text-[8px] font-black text-emerald-500 uppercase bg-emerald-50 px-1.5 rounded border border-emerald-100 flex items-center gap-1",title:"Sugerido automaticamente",children:[i.jsx(Ly,{size:8})," Auto"]})]}),oe?i.jsx("textarea",{value:K.dynamicData[W.key]||"",onChange:Te=>mt(W.key,Te.target.value),placeholder:W.placeholder||`Valor para ${W.label}`,rows:4,className:"w-full p-3 bg-white border border-slate-200 rounded-xl text-xs uppercase font-bold text-slate-700 focus:ring-2 focus:ring-emerald-500 outline-none shadow-sm placeholder:text-slate-300 resize-none"}):i.jsx("input",{value:K.dynamicData[W.key]||"",onChange:Te=>mt(W.key,Te.target.value),placeholder:W.placeholder||`Valor para ${W.label}`,className:"w-full p-3 bg-white border border-slate-200 rounded-xl text-xs uppercase font-bold text-slate-700 focus:ring-2 focus:ring-emerald-500 outline-none shadow-sm placeholder:text-slate-300"})]},W.key)})})(),i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest ml-1",children:"Data de Emisso (Ref.)"}),i.jsx("input",{type:"date",required:!0,value:K.dataDoc,onChange:V=>Je(V.target.value),className:"w-full p-3 bg-white border border-slate-200 rounded-xl text-xs uppercase font-bold text-slate-700 outline-none shadow-sm"})]})]})]}),i.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[i.jsx("button",{type:"button",onClick:()=>o("issued"),className:"px-8 py-3 text-slate-400 font-black uppercase text-xs hover:bg-slate-100 rounded-2xl transition-all",children:"Cancelar"}),i.jsxs("button",{type:"submit",disabled:F||!K.templateId,className:"px-12 py-3 bg-emerald-600 text-white font-black uppercase text-xs rounded-2xl shadow-xl shadow-emerald-200 hover:bg-emerald-700 transition-all flex items-center gap-2 active:scale-95 disabled:opacity-50",children:[F?i.jsx(Ne,{className:"animate-spin",size:16}):i.jsx(Qn,{size:16})," Emitir Termo Digital"]})]})]})]}),ge&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-[110] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in overflow-y-auto",children:i.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-4xl overflow-hidden flex flex-col max-h-[95vh]",children:[i.jsxs("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50",children:[i.jsxs("h3",{className:"font-bold text-slate-800 uppercase text-sm flex items-center gap-2",children:[i.jsx(Ws,{size:18,className:"text-emerald-600"})," ",P?"Editar":"Novo"," Modelo de Termo"]}),i.jsx("button",{type:"button",onClick:()=>_e(!1),className:"p-2 hover:bg-slate-200 rounded-full text-slate-400",children:i.jsx(St,{size:24})})]}),i.jsxs("div",{className:"p-8 overflow-y-auto custom-scrollbar space-y-8",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Nome Interno"}),i.jsx("input",{value:re.name||"",onChange:V=>ie({...re,name:V.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg text-sm bg-white text-slate-900 focus:ring-2 focus:ring-emerald-500 outline-none",placeholder:"Nome para identificao interna"})]}),i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Tipo Movimentao"}),i.jsxs("select",{value:re.type,onChange:V=>ie({...re,type:V.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg text-sm bg-white text-slate-900 uppercase font-bold outline-none",children:[i.jsx("option",{value:"entrega",children:"Entrega"}),i.jsx("option",{value:"emprestimo",children:"Emprstimo"}),i.jsx("option",{value:"devolucao",children:"Devoluo"})]})]}),i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Setor Responsvel"}),i.jsxs("select",{value:re.responsibleDepartment,disabled:!(e||s),onChange:V=>ie({...re,responsibleDepartment:V.target.value}),className:`w-full p-2.5 border border-slate-300 rounded-lg text-sm bg-white text-slate-900 uppercase font-bold outline-none ${e||s?"":"bg-slate-50 opacity-60"}`,children:[i.jsx("option",{value:"",children:"Selecione o Setor..."}),S.sort((V,W)=>V.name.localeCompare(W.name)).map(V=>i.jsx("option",{value:V.name,children:V.name},V.id))]})]})]}),i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Ttulo no Documento"}),i.jsx("input",{value:re.title||"",onChange:V=>ie({...re,title:V.target.value}),className:"w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none bg-white text-slate-900",placeholder:"Ex: TERMO DE ENTREGA DE EQUIPAMENTO"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between border-b border-slate-100 pb-2",children:[i.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Variveis Dinmicas"}),i.jsxs("button",{type:"button",onClick:de,className:"text-[10px] font-black uppercase text-emerald-600 bg-emerald-50 px-3 py-1 rounded-full hover:bg-emerald-100 flex items-center gap-1 transition-colors border border-emerald-100",children:[i.jsx(Pt,{size:12})," Adicionar"]})]}),i.jsx("div",{className:"space-y-3 max-h-[350px] overflow-y-auto pr-3 custom-scrollbar",children:(re.customVariables||[]).map((V,W)=>i.jsxs("div",{className:"flex flex-col gap-2 bg-slate-50 p-4 rounded-2xl border border-slate-100 relative group",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsx("input",{value:V.label||"",onChange:oe=>pt(oe.target.value,W),className:"flex-1 p-2 border border-slate-200 rounded-lg bg-white text-slate-900 text-xs font-bold",placeholder:"Rtulo (ex: Modelo)"}),i.jsx("button",{type:"button",onClick:()=>Ue(W),className:"text-red-400 p-2 hover:bg-red-100 hover:text-red-600 rounded-xl transition-all ml-2",title:"Remover varivel",children:i.jsx(st,{size:16})})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsx("input",{value:V.key||"",onChange:oe=>pt(W,{key:oe.target.value}),className:"p-2 border border-slate-200 rounded-lg bg-white text-slate-800 text-[10px] font-mono",placeholder:"tag_exemplo"}),i.jsxs("select",{value:V.mapping||"none",onChange:oe=>pt(W,{mapping:oe.target.value}),className:"p-2 border border-slate-200 rounded-lg bg-white text-slate-700 text-[9px] font-bold",children:[i.jsx("option",{value:"none",children:"Manual"}),i.jsx("option",{value:"doc_title",children:"Doc: Ttulo"}),i.jsx("option",{value:"emp_name",children:"Colab: Nome"}),i.jsx("option",{value:"emp_role",children:"Colab: Cargo"}),i.jsx("option",{value:"emp_dept",children:"Colab: Setor"}),i.jsx("option",{value:"emp_unit",children:"Colab: Unidade"}),i.jsx("option",{value:"doc_date",children:"Data: Simples"}),i.jsx("option",{value:"doc_date_full",children:"Data: Extenso"})]})]})]},W))})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between border-b border-slate-100 pb-2",children:[i.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Tabela de Ativos (Opcional)"}),i.jsxs("button",{type:"button",onClick:Ve,className:"text-[10px] font-black uppercase text-indigo-600 bg-indigo-50 px-3 py-1 rounded-full hover:bg-indigo-100 flex items-center gap-1 transition-colors border border-indigo-100",children:[i.jsx(Pt,{size:12})," Adicionar"]})]}),i.jsx("div",{className:"space-y-3 max-h-[350px] overflow-y-auto pr-3 custom-scrollbar",children:(re.tableFields||[]).map((V,W)=>i.jsxs("div",{className:"flex gap-2 bg-indigo-50/30 p-4 rounded-2xl border border-indigo-100",children:[i.jsxs("div",{className:"flex-1 space-y-2",children:[i.jsx("input",{value:V.label||"",onChange:oe=>Y(W,{label:oe.target.value}),className:"w-full p-2 border border-slate-200 rounded-lg bg-white text-slate-900 text-xs font-bold",placeholder:"Rtulo da Tabela"}),i.jsx("input",{value:V.variable||"",onChange:oe=>Y(W,{variable:oe.target.value}),className:"w-full p-2 border border-slate-200 rounded-lg bg-white text-slate-800 text-[10px] font-mono",placeholder:"tag_da_variavel"})]}),i.jsx("button",{type:"button",onClick:()=>Et(W),className:"text-red-400 p-2 hover:bg-red-100 hover:text-red-600 rounded-xl transition-all",children:i.jsx(st,{size:16})})]},W))})]})]}),i.jsxs("div",{className:"space-y-4 border-t border-slate-100 pt-6",children:[i.jsxs("div",{className:"flex items-center justify-between border-b border-slate-100 pb-2",children:[i.jsxs("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2",children:[i.jsx(Kf,{size:14,className:"text-amber-500"})," Selos de Certificao (Rodap)"]}),i.jsxs("label",{className:"text-[10px] font-black uppercase text-amber-600 bg-amber-50 px-3 py-1 rounded-full hover:bg-amber-100 flex items-center gap-1 transition-colors border border-amber-100 cursor-pointer",children:[i.jsx(Pt,{size:12})," Adicionar Selo",i.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:fe})]})]}),i.jsxs("div",{className:"flex flex-wrap gap-4",children:[(re.certificationImages||[]).map((V,W)=>i.jsxs("div",{className:"relative group w-24 h-24 bg-slate-50 border border-slate-200 rounded-xl flex items-center justify-center p-2 overflow-hidden shadow-sm",children:[i.jsx("img",{src:V,className:"max-w-full max-h-full object-contain mix-blend-multiply"}),i.jsx("button",{type:"button",onClick:()=>ye(W),className:"absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:i.jsx(st,{size:10})})]},W)),(re.certificationImages||[]).length===0&&i.jsxs("div",{className:"w-full py-6 text-center text-slate-300 border-2 border-dashed border-slate-100 rounded-2xl flex flex-col items-center",children:[i.jsx(As,{size:24,className:"opacity-20 mb-1"}),i.jsx("p",{className:"text-[9px] uppercase font-black",children:"Nenhum selo configurado para este modelo"})]})]})]}),i.jsxs("div",{className:"space-y-3 pt-6 border-t",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Contedo do Documento (Corpo do Texto)"}),i.jsxs("label",{className:"text-[10px] font-black uppercase text-emerald-600 bg-emerald-50 px-3 py-1.5 rounded-full cursor-pointer hover:bg-emerald-100 flex items-center gap-2 border border-emerald-100 transition-all",children:[i.jsx(Vy,{size:12})," Importar RTF",i.jsx("input",{type:"file",accept:".rtf",className:"hidden",onChange:V=>{var W;return((W=V.target.files)==null?void 0:W[0])&&Le(V.target.files[0])}})]})]}),i.jsx("textarea",{value:re.content||"",onChange:V=>ie({...re,content:V.target.value}),className:"w-full p-6 border border-slate-200 rounded-2xl text-sm font-serif min-h-[400px] leading-relaxed bg-white text-slate-800 outline-none focus:ring-2 focus:ring-emerald-500 shadow-inner",placeholder:"Escreva o texto completo do termo aqui..."})]})]}),i.jsxs("div",{className:"p-6 bg-slate-50 border-t flex justify-end gap-3 shrink-0",children:[i.jsx("button",{type:"button",onClick:()=>_e(!1),className:"px-6 py-2 text-slate-600 font-bold text-sm hover:bg-slate-200 rounded-xl transition-all",disabled:F,children:"Cancelar"}),i.jsxs("button",{type:"button",onClick:H,className:"px-10 py-2.5 bg-emerald-600 text-white font-bold text-sm hover:bg-emerald-700 rounded-xl shadow-lg shadow-emerald-200 flex items-center gap-2 transition-all active:scale-95",disabled:F,children:[F?i.jsx(Ne,{className:"animate-spin",size:18}):i.jsx(hs,{size:18})," Salvar Modelo"]})]})]})}),(b||T)&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/90 backdrop-blur-md z-[200] flex items-center justify-center p-4 overflow-y-auto animate-fade-in",children:i.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-2xl w-full max-w-[210mm] my-8 overflow-hidden flex flex-col h-full max-h-[95vh] relative",children:[i.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-slate-50 sticky top-0 z-20",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 bg-emerald-100 rounded-xl text-emerald-600",children:i.jsx(Bo,{size:20})}),i.jsx("h3",{className:"font-black text-slate-800 uppercase text-sm tracking-tight",children:T?"Prvia do Modelo":"Documento Oficial"})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("button",{type:"button",onClick:()=>window.print(),className:"bg-emerald-600 text-white px-5 py-2 rounded-xl text-xs font-black uppercase hover:bg-emerald-700 shadow-md flex items-center gap-2",children:[i.jsx(Yf,{size:16})," Imprimir / PDF"]}),i.jsx("button",{type:"button",onClick:()=>{_(null),R(null)},className:"p-2 hover:bg-slate-200 rounded-full text-slate-400 transition-colors",children:i.jsx(St,{size:24})})]})]}),i.jsx("div",{className:"flex-1 overflow-y-auto p-4 md:p-10 bg-slate-200/50 flex justify-center custom-scrollbar",children:i.jsxs("div",{className:"bg-white shadow-2xl w-full max-w-[210mm] min-h-[297mm] pt-[5mm] md:pt-[8mm] px-[10mm] md:px-[20mm] pb-[10mm] md:pb-[20mm] text-slate-900 print:shadow-none print:p-0 flex flex-col relative",children:[i.jsxs("div",{className:"flex justify-between items-start border-b-2 border-emerald-800 pb-4 mb-8",children:[i.jsx(Qs,{className:"h-14 w-auto"}),i.jsxs("div",{className:"text-right text-[9px] text-slate-500 font-bold uppercase leading-tight",children:[i.jsx("p",{className:"text-slate-800",children:"Intermartima Portos e Logstica S/A"}),i.jsx("p",{children:"Rua da Grcia, 08, Edf. Serra da Raiz, 3 andar."}),i.jsx("p",{children:"Comrcio - CEP. 40.010-010 - Salvador / BA"}),i.jsx("p",{className:"text-emerald-700",children:"www.intermaritima.com.br"})]})]}),i.jsx("h1",{className:"text-center font-black text-lg md:text-xl mb-10 uppercase tracking-tight",children:(b==null?void 0:b.data.titulo_documento)||(T==null?void 0:T.title)||(b==null?void 0:b.employeeName)||"[TTULO DO DOCUMENTO]"}),i.jsxs("div",{className:"space-y-1 mb-6 text-[10px] md:text-[11px] font-bold uppercase text-slate-900",children:[i.jsxs("p",{children:["COLABORADOR: ",i.jsx("span",{className:"font-medium",children:(b==null?void 0:b.employeeName)||"[NOME DO COLABORADOR]"})]}),i.jsxs("p",{children:["SETOR: ",i.jsx("span",{className:"font-medium",children:(b==null?void 0:b.data.departamento)||(T==null?void 0:T.responsibleDepartment)||"[SETOR RESPONSVEL]"})]}),i.jsxs("p",{children:["CARGO: ",i.jsx("span",{className:"font-medium",children:(b==null?void 0:b.data.cargo)||"[CARGO DO COLABORADOR]"})]})]}),i.jsxs("table",{className:"w-full border-collapse mb-8 border border-emerald-800",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"bg-[#006c5b] text-white text-[9px] md:text-[10px] font-black uppercase",children:[i.jsx("th",{className:"border border-emerald-800 px-4 py-2 w-1/2 text-center",children:"DESCRIO"}),i.jsx("th",{className:"border border-emerald-800 px-4 py-2 w-1/2 text-center",children:"DADOS"})]})}),i.jsx("tbody",{className:"text-[10px] md:text-[11px] font-bold uppercase text-slate-800",children:(((Ge=a.find(V=>V.id===((b==null?void 0:b.templateId)||(T==null?void 0:T.id))))==null?void 0:Ge.tableFields)||[]).map((V,W)=>i.jsxs("tr",{children:[i.jsx("td",{className:"border border-emerald-800 px-4 py-1.5 bg-slate-50 text-slate-700 font-black",children:V.label}),i.jsx("td",{className:"border border-emerald-800 px-4 py-1.5 font-medium text-slate-900 whitespace-pre-wrap",children:(b==null?void 0:b.data[V.variable])||`[${V.label.toUpperCase()}]`})]},W))})]}),i.jsx("div",{className:"text-xs md:text-sm leading-relaxed text-justify whitespace-pre-wrap mb-16 font-serif flex-1 text-slate-900",children:M}),i.jsxs("div",{className:"mt-auto pt-4 space-y-8",children:[i.jsx("div",{className:"flex justify-center w-full",children:(b==null?void 0:b.status)==="ASSINADO"?i.jsxs("div",{className:"text-center relative",children:[b.signatureImage&&i.jsx("img",{src:b.signatureImage,className:"h-10 md:h-12 object-contain mx-auto mix-blend-multiply mb-0 relative z-10"}),i.jsx("div",{className:"w-64 h-px bg-slate-400 mx-auto mt-1 mb-2"}),i.jsx("p",{className:"font-black uppercase text-xs md:text-sm text-slate-900",children:b.employeeName}),i.jsxs("p",{className:"text-[10px] text-slate-500 font-bold",children:["CPF: ",(Ze=b.employeeCpf)==null?void 0:Ze.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-**")]}),b.signedAt&&i.jsxs("p",{className:"text-[8px] text-emerald-600 font-black uppercase mt-1",children:["Assinado digitalmente em: ",new Date(b.signedAt).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})]}),i.jsxs("p",{className:"text-[8px] text-slate-400 font-mono mt-2 break-all max-w-[300px] mx-auto uppercase",children:["CDIGO DE VERIFICAO: ",b.token]})]}):T?i.jsxs("div",{className:"text-center relative opacity-20 grayscale",children:[i.jsx("div",{className:"w-64 h-px bg-slate-400 mx-auto mt-16 mb-2"}),i.jsx("p",{className:"font-black uppercase text-xs md:text-sm text-slate-900",children:"[NOME DO COLABORADOR]"}),i.jsx("p",{className:"text-[10px] text-slate-500 font-bold",children:"CPF: 000.000.000-**"})]}):null}),i.jsx("div",{className:"flex justify-end gap-3",children:(((it=a.find(V=>V.id===((b==null?void 0:b.templateId)||(T==null?void 0:T.id))))==null?void 0:it.certificationImages)||[]).map((V,W)=>i.jsx("div",{className:"bg-white border border-slate-200 p-1.5 rounded-lg flex items-center justify-center h-12 md:h-16 w-fit shadow-sm",children:i.jsx("img",{src:V,className:"h-full object-contain mix-blend-multiply",alt:"Selo"})},W))})]})]})})]})}),B&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-[250] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:i.jsx("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-sm overflow-hidden border-2 border-red-100",children:i.jsxs("div",{className:"p-8 text-center",children:[i.jsx("div",{className:"w-20 h-20 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-6 text-red-500",children:i.jsx(ms,{size:40})}),i.jsx("h3",{className:"text-lg font-black text-slate-800 mb-2 uppercase tracking-tight",children:"Excluir Termo?"}),i.jsx("p",{className:"text-sm text-slate-500 mb-8",children:"Ao irreversvel."}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{type:"button",onClick:()=>$(null),className:"flex-1 py-4 text-slate-400 font-black uppercase text-xs hover:bg-slate-100 rounded-2xl transition-all",children:"Manter"}),i.jsxs("button",{type:"button",onClick:Ae,className:"flex-1 py-4 bg-red-600 text-white rounded-2xl font-black uppercase text-xs hover:bg-red-700 transition-colors flex items-center justify-center gap-2 shadow-lg shadow-red-100",disabled:F,children:[F?i.jsx(Ne,{className:"animate-spin",size:16}):i.jsx(st,{size:16})," Sim, excluir"]})]})]})})})]})},_2=()=>{var be,qe,Le;const{currentUser:t,user:e,isAdmin:s}=Ut(),[n,r]=I.useState("terms"),[o,a]=I.useState([]),[l,u]=I.useState([]),[d,f]=I.useState([]),[p,g]=I.useState([]),[v,A]=I.useState(!1),[k,S]=I.useState(!1),[L,D]=I.useState(null),[j,F]=I.useState({name:"",email:"",sector:"",phoneFixed:"",phoneMobile:"",notes:""}),[q,E]=I.useState(!0),[w,b]=I.useState(null),[_,T]=I.useState(null),[R,M]=I.useState(""),[C,ge]=I.useState(""),[_e,P]=I.useState(""),[Z,B]=I.useState(!1),[$,U]=I.useState(""),te=I.useRef(null);I.useEffect(()=>{if(!t)return;E(!0);const ee=Px(Je=>a(Je),t.id),xe=kx(Je=>f(Je),t.id),Fe=jx(g);return Promise.all([QI()]).then(([Je])=>{u(Je),E(!1)}).catch(()=>E(!1)),()=>{ee(),xe(),Fe()}},[t]);const re=async ee=>{const xe=l.find(Je=>Je.id===ee.templateId);if(!xe)return alert("Modelo no encontrado.");let Fe=xe.content;Object.entries(ee.data).forEach(([Je,mt])=>{const ft=new RegExp(`{{${Je}}}`,"g");Fe=Fe.replace(ft,mt||"")}),M(Fe),T(ee),ee.status==="PENDENTE"?b(ee):b(null)},ie=()=>{t&&F({name:t.name,email:t.email,sector:t.role||t.department,phoneFixed:`(71) 3879-${t.extension||""}`,phoneMobile:t.whatsapp||"",notes:""}),A(!0)},K=async ee=>{if(ee.preventDefault(),!!t){S(!0);try{await uC({userId:t.id,userName:t.name,userEmail:t.email,notes:j.notes,requestedData:{name:j.name,email:j.email,sector:j.sector,phoneFixed:j.phoneFixed,phoneMobile:j.phoneMobile}}),alert("Solicitao enviada com sucesso! O TI processar sua assinatura em breve."),A(!1)}catch{alert("Erro ao enviar solicitao.")}finally{S(!1)}}},ve=async ee=>{if(!(!ee.signatureData||!te.current)){S(!0);try{await Ii(te.current,ee.signatureData,p),D(te.current.toDataURL("image/png"))}catch{alert("Erro ao gerar visualizao.")}finally{S(!1)}}},z=async ee=>{if(!(!ee.signatureData||!te.current)){S(!0);try{await Ii(te.current,ee.signatureData,p);const xe=document.createElement("a");xe.download=`assinatura_${t==null?void 0:t.name}.png`,xe.href=te.current.toDataURL("image/png"),xe.click()}catch{alert("Erro ao gerar download.")}finally{S(!1)}}},se=async()=>{U("");const ee=C.replace(/\D/g,"");if(!w||!ee||!_e){U("Preencha o CPF e a sua senha de acesso.");return}if(ee.length<11){U("O CPF deve conter 11 dgitos.");return}S(!0);try{if(e&&e.email){const xe=hr.credential(e.email,_e);await LE(e,xe);const Fe=(t==null?void 0:t.signatureImage)||"";await sC(w.id,ee,Fe),alert("Documento assinado digitalmente com sucesso!"),b(null),T(null),P(""),ge(""),B(!1)}else throw new Error("Erro na sesso.")}catch(xe){xe.code==="auth/wrong-password"||xe.code==="auth/invalid-credential"?U("Senha incorreta. Use a mesma senha do iRamais."):U("Erro ao validar assinatura.")}finally{S(!1)}},le=ee=>{const xe=ee.replace(/\D/g,"").substring(0,11);return xe.length<=3?xe:xe.length<=6?`${xe.slice(0,3)}.${xe.slice(3)}`:xe.length<=9?`${xe.slice(0,3)}.${xe.slice(3,6)}.${xe.slice(6)}`:`${xe.slice(0,3)}.${xe.slice(3,6)}.${xe.slice(6,9)}-${xe.slice(9)}`};return q?i.jsx("div",{className:"h-[60vh] flex flex-col items-center justify-center",children:i.jsx(Ne,{className:"animate-spin text-emerald-600 mb-4",size:48})}):i.jsxs("div",{className:"space-y-8 max-w-6xl mx-auto pb-20 animate-fade-in",children:[i.jsx("canvas",{ref:te,className:"hidden"}),i.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-2xl font-black text-slate-800 flex items-center gap-2 uppercase tracking-tight",children:[i.jsx(Wf,{className:"text-emerald-600",size:32})," Central de Assinaturas"]}),i.jsx("p",{className:"text-slate-500 text-sm font-medium",children:"Gesto de termos de responsabilidade e assinaturas de e-mail."})]}),s&&i.jsxs(Rt,{to:"/admin-terms",className:"px-5 py-2.5 bg-white border border-slate-200 rounded-xl text-slate-700 text-xs font-black uppercase flex items-center gap-2 shadow-sm hover:bg-slate-50 transition-all",children:[i.jsx(Ws,{size:16})," Painel Administrativo"]})]}),i.jsxs("div",{className:"flex gap-2 p-1 bg-slate-100 rounded-2xl w-fit",children:[i.jsxs("button",{onClick:()=>r("terms"),className:`px-6 py-2.5 rounded-xl text-xs font-black uppercase transition-all flex items-center gap-2 ${n==="terms"?"bg-white text-emerald-700 shadow-md":"text-slate-500 hover:text-slate-700"}`,children:[i.jsx(jr,{size:16})," Assinatura de Termos",o.filter(ee=>ee.status==="PENDENTE").length>0&&i.jsx("span",{className:"bg-red-500 text-white text-[9px] px-1.5 py-0.5 rounded-full animate-pulse",children:o.filter(ee=>ee.status==="PENDENTE").length})]}),i.jsxs("button",{onClick:()=>r("email"),className:`px-6 py-2.5 rounded-xl text-xs font-black uppercase transition-all flex items-center gap-2 ${n==="email"?"bg-white text-emerald-700 shadow-md":"text-slate-500 hover:text-slate-700"}`,children:[i.jsx(Dr,{size:16})," Assinatura de E-mail"]})]}),n==="terms"&&i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-fade-in",children:o.length>0?o.map(ee=>{const xe=l.find(Fe=>Fe.id===ee.templateId);return i.jsxs("div",{className:`bg-white rounded-[2rem] border shadow-sm flex flex-col h-full transition-all hover:shadow-xl ${ee.status==="ASSINADO"?"border-slate-100 opacity-90":"border-emerald-200 ring-4 ring-emerald-50"}`,children:[i.jsxs("div",{className:"p-8 flex-1",children:[i.jsxs("div",{className:"flex justify-between items-start mb-6",children:[i.jsx("span",{className:`px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest border ${ee.status==="ASSINADO"?"bg-slate-50 text-slate-400":"bg-emerald-600 text-white animate-pulse"}`,children:ee.status}),ee.type==="devolucao"&&i.jsxs("span",{className:"bg-amber-100 text-amber-700 text-[9px] font-black uppercase px-2 py-0.5 rounded-full flex items-center gap-1 border border-amber-200",children:[i.jsx(Uy,{size:10})," Devoluo"]})]}),i.jsx("h4",{className:"font-black text-slate-800 text-lg mb-4 uppercase leading-tight tracking-tight",children:ee.data.titulo_documento}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("p",{className:"text-[10px] text-emerald-600 font-black uppercase flex items-center gap-2",children:[i.jsx(zr,{size:14,className:"text-emerald-500"})," Emitido por: ",(xe==null?void 0:xe.responsibleDepartment)||"Intermartima"]}),ee.issuerName&&i.jsxs("p",{className:"text-[10px] text-slate-500 font-bold uppercase flex items-center gap-2 ml-5",children:["Gerado por: ",ee.issuerName]}),i.jsxs("p",{className:"text-[10px] text-slate-400 font-black uppercase flex items-center gap-2",children:[i.jsx($t,{size:14,className:"text-slate-300"})," ",ee.data.marca_equipamento," ",ee.data.modelo_equipamento]}),i.jsxs("p",{className:"text-[10px] text-slate-400 font-black uppercase flex items-center gap-2",children:[i.jsx(Gt,{size:14,className:"text-slate-300"})," Emitido: ",new Date(ee.createdAt).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),ee.status==="ASSINADO"&&ee.signedAt&&i.jsxs("p",{className:"text-[10px] text-emerald-600 font-black uppercase flex items-center gap-2",children:[i.jsx(Qn,{size:14,className:"text-emerald-500"})," Assinado: ",new Date(ee.signedAt).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),i.jsx("div",{className:"p-6 bg-slate-50/50 border-t mt-auto rounded-b-[2rem] space-y-2",children:ee.status==="ASSINADO"?i.jsxs("button",{onClick:()=>re(ee),className:"w-full py-4 bg-white border-2 border-slate-200 rounded-2xl text-[10px] font-black uppercase text-slate-600 hover:bg-slate-100 flex items-center justify-center gap-2 transition-all shadow-sm",children:[i.jsx(yi,{size:14})," Ver Comprovante Digital"]}):i.jsxs("button",{onClick:()=>re(ee),className:"w-full py-5 bg-emerald-600 text-white rounded-2xl text-[10px] font-black uppercase hover:bg-emerald-700 flex items-center justify-center gap-2 shadow-xl shadow-emerald-200 transition-all active:scale-95",children:[i.jsx(Ks,{size:18})," Visualizar para Assinar"]})})]},ee.id)}):i.jsxs("div",{className:"col-span-full py-20 text-center bg-white rounded-[3rem] border-2 border-dashed border-slate-200 text-slate-400",children:[i.jsx(jr,{size:48,className:"mx-auto mb-4 opacity-10"}),i.jsx("p",{className:"font-black uppercase text-xs tracking-widest",children:"Nenhum termo vinculado ao seu CPF"})]})}),n==="email"&&i.jsxs("div",{className:"space-y-6 animate-fade-in",children:[i.jsxs("div",{className:"bg-emerald-600 rounded-[2.5rem] p-8 md:p-12 text-white shadow-xl flex flex-col md:flex-row items-center justify-between gap-8 relative overflow-hidden",children:[i.jsxs("div",{className:"relative z-10 space-y-4 max-w-xl",children:[i.jsx("h3",{className:"text-2xl md:text-3xl font-black uppercase tracking-tight",children:"Sua Assinatura Oficial"}),i.jsx("p",{className:"text-emerald-50 text-sm md:text-base opacity-90 leading-relaxed font-medium",children:"Solicite ao TI a gerao da sua assinatura de e-mail padronizada com seus dados atualizados e logomarca da unidade."}),i.jsxs("button",{onClick:ie,className:"bg-white text-emerald-700 px-8 py-3 rounded-2xl font-black uppercase text-xs hover:bg-emerald-50 transition-all shadow-lg flex items-center gap-2 active:scale-95",children:[i.jsx(Pt,{size:18,strokeWidth:3})," Nova Solicitao"]})]}),i.jsx("div",{className:"relative z-10 flex-shrink-0 bg-white/10 p-6 rounded-[2rem] border border-white/20 backdrop-blur-sm shadow-inner animate-float",children:i.jsx(ys,{size:80,className:"text-white opacity-80"})}),i.jsx("div",{className:"absolute top-0 right-0 -mr-16 -mt-16 w-64 h-64 bg-white/10 rounded-full blur-3xl"})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:d.map(ee=>{var xe;return i.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-slate-200 shadow-sm flex flex-col justify-between group hover:border-emerald-300 transition-all",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex justify-between items-start mb-4",children:[i.jsx("div",{className:`p-3 rounded-2xl ${ee.status==="COMPLETED"?"bg-emerald-100 text-emerald-600":"bg-amber-100 text-amber-600 animate-pulse"}`,children:ee.status==="COMPLETED"?i.jsx(Jf,{size:24}):i.jsx(Rs,{size:24})}),i.jsx("span",{className:`text-[9px] font-black uppercase px-2.5 py-1 rounded-full border ${ee.status==="COMPLETED"?"bg-emerald-50 text-emerald-600 border-emerald-100":"bg-amber-50 text-amber-600 border-amber-100"}`,children:ee.status==="COMPLETED"?"Concluda":"Pendente"})]}),i.jsx("h4",{className:"font-bold text-slate-800 text-sm uppercase mb-1",children:((xe=ee.requestedData)==null?void 0:xe.sector)||"Assinatura"}),i.jsxs("p",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-widest flex items-center gap-1",children:[i.jsx(Gt,{size:12})," ",new Date(ee.createdAt).toLocaleDateString()]}),ee.status==="COMPLETED"&&ee.completedBy&&i.jsxs("p",{className:"text-[9px] text-emerald-600 font-black uppercase mt-2",children:["Gerada por: ",ee.completedBy]})]}),ee.status==="COMPLETED"&&i.jsxs("div",{className:"mt-6 flex gap-2",children:[i.jsxs("button",{onClick:()=>ve(ee),className:"flex-1 py-2.5 bg-slate-100 text-slate-600 rounded-xl text-xs font-bold hover:bg-slate-200 transition-all flex items-center justify-center gap-2",children:[i.jsx(Ks,{size:14})," Ver"]}),i.jsxs("button",{onClick:()=>z(ee),className:"flex-1 py-2.5 bg-emerald-600 text-white rounded-xl text-xs font-bold hover:bg-emerald-700 transition-all flex items-center justify-center gap-2 shadow-lg shadow-emerald-100",children:[i.jsx(yi,{size:14})," Baixar"]})]})]},ee.id)})}),d.length===0&&i.jsxs("div",{className:"py-20 text-center bg-white rounded-[3rem] border-2 border-dashed border-slate-200 text-slate-400",children:[i.jsx(Fy,{size:48,className:"mx-auto mb-4 opacity-10"}),i.jsx("p",{className:"font-black uppercase text-xs tracking-widest",children:"Nenhuma solicitao de assinatura"})]})]}),_&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/90 backdrop-blur-md z-[150] flex items-center justify-center p-4 overflow-y-auto animate-fade-in",children:i.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-2xl w-full max-w-[210mm] my-8 overflow-hidden flex flex-col h-full max-h-[95vh] relative",children:[i.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-slate-50 sticky top-0 z-20",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 bg-emerald-100 rounded-xl text-emerald-600",children:i.jsx(Bo,{size:20})}),i.jsx("h3",{className:"font-black text-slate-800 uppercase text-sm tracking-tight",children:"Visualizao do Documento Digital"})]}),i.jsxs("div",{className:"flex gap-2",children:[_.status==="ASSINADO"&&i.jsxs("button",{onClick:()=>window.print(),className:"bg-emerald-600 text-white px-5 py-2 rounded-xl text-xs font-black uppercase hover:bg-emerald-700 shadow-md flex items-center gap-2",children:[i.jsx(Yf,{size:16})," Imprimir / PDF"]}),i.jsx("button",{onClick:()=>{T(null),b(null),U("")},className:"p-2 hover:bg-slate-200 rounded-full text-slate-400 transition-colors",children:i.jsx(St,{size:24})})]})]}),i.jsx("div",{className:"flex-1 overflow-y-auto p-4 md:p-10 bg-slate-200/50 flex justify-center custom-scrollbar",children:i.jsxs("div",{className:"bg-white shadow-2xl w-full max-w-[210mm] min-h-[297mm] pt-[5mm] md:pt-[8mm] px-[10mm] md:px-[20mm] pb-[10mm] md:pb-[20mm] text-slate-900 print:shadow-none print:p-0 flex flex-col relative",children:[i.jsxs("div",{className:"flex justify-between items-start border-b-2 border-emerald-800 pb-4 mb-8",children:[i.jsx(Qs,{className:"h-14 w-auto"}),i.jsxs("div",{className:"text-right text-[9px] text-slate-500 font-bold uppercase leading-tight",children:[i.jsx("p",{className:"text-slate-800",children:"Intermartima Portos e Logstica S/A"}),i.jsx("p",{children:"Rua da Grcia, 08, Edf. Serra da Raiz, 3 andar."}),i.jsx("p",{children:"Comrcio - CEP. 40.010-010 - Salvador / BA"}),i.jsx("p",{className:"text-emerald-700",children:"www.intermaritima.com.br"})]})]}),i.jsx("h1",{className:"text-center font-black text-lg md:text-xl mb-10 uppercase tracking-tight",children:_.data.titulo_documento||"Termo de Responsabilidade"}),i.jsxs("div",{className:"space-y-1 mb-6 text-[10px] md:text-[11px] font-bold uppercase text-slate-900",children:[i.jsxs("p",{children:["COLABORADOR: ",i.jsx("span",{className:"font-medium",children:_.employeeName})]}),i.jsxs("p",{children:["SETOR: ",i.jsx("span",{className:"font-medium",children:_.data.departamento||"---"})]}),i.jsxs("p",{children:["CARGO: ",i.jsx("span",{className:"font-medium",children:_.data.cargo||"---"})]})]}),i.jsxs("table",{className:"w-full border-collapse mb-8 border border-emerald-800",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"bg-[#006c5b] text-white text-[9px] md:text-[10px] font-black uppercase",children:[i.jsx("th",{className:"border border-emerald-800 px-4 py-2 w-1/2 text-center",children:"DESCRIO"}),i.jsx("th",{className:"border border-emerald-800 px-4 py-2 w-1/2 text-center",children:"DADOS"})]})}),i.jsx("tbody",{className:"text-[10px] md:text-[11px] font-bold uppercase text-slate-800",children:(((be=l.find(ee=>ee.id===_.templateId))==null?void 0:be.tableFields)||[]).map((ee,xe)=>i.jsxs("tr",{children:[i.jsx("td",{className:"border border-emerald-800 px-4 py-1.5 bg-slate-50 text-slate-700 font-black",children:ee.label}),i.jsx("td",{className:"border border-emerald-800 px-4 py-1.5 font-medium text-slate-900 whitespace-pre-wrap",children:_.data[ee.variable]||"---"})]},xe))})]}),i.jsx("div",{className:"text-xs md:text-sm leading-relaxed text-justify whitespace-pre-wrap mb-16 font-serif flex-1 text-slate-900",children:R}),i.jsxs("div",{className:"mt-auto pt-4 space-y-8",children:[i.jsx("div",{className:"flex justify-center w-full",children:_.status==="ASSINADO"&&i.jsxs("div",{className:"text-center relative",children:[_.signatureImage&&i.jsx("img",{src:_.signatureImage,className:"h-10 md:h-12 object-contain mx-auto mix-blend-multiply mb-0 relative z-10"}),i.jsx("div",{className:"w-64 h-px bg-slate-400 mx-auto mt-1 mb-2"}),i.jsx("p",{className:"font-black uppercase text-xs md:text-sm text-slate-900",children:_.employeeName}),i.jsxs("p",{className:"text-[10px] text-slate-500 font-bold",children:["CPF: ",(qe=_.employeeCpf)==null?void 0:qe.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-**")]}),i.jsxs("p",{className:"text-[8px] text-emerald-600 font-black uppercase mt-1",children:["Assinado digitalmente em: ",new Date(_.signedAt).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})]}),i.jsxs("p",{className:"text-[8px] text-slate-400 font-mono mt-2 break-all max-w-[300px] mx-auto uppercase",children:["CDIGO DE VERIFICAO: ",_.token]})]})}),i.jsx("div",{className:"flex justify-end gap-3",children:(((Le=l.find(ee=>ee.id===_.templateId))==null?void 0:Le.certificationImages)||[]).map((ee,xe)=>i.jsx("div",{className:"bg-white border border-slate-200 p-1.5 rounded-lg flex items-center justify-center h-12 md:h-16 w-fit shadow-sm",children:i.jsx("img",{src:ee,className:"h-full object-contain mix-blend-multiply",alt:"Selo"})},xe))})]})]})}),w&&_.status==="PENDENTE"&&i.jsx("div",{className:"p-6 md:p-8 bg-slate-900 text-white shrink-0 border-t border-white/10 animate-slide-up relative z-30",children:i.jsxs("div",{className:"max-w-xl mx-auto space-y-6",children:[i.jsxs("div",{className:"flex items-center gap-3 text-emerald-400",children:[i.jsx(jt,{size:24}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-black uppercase text-sm tracking-widest",children:"Assinatura Digital"}),i.jsx("p",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-tight",children:"Valide sua identidade para concluir a assinatura"})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-[9px] font-black uppercase text-slate-500 ml-1",children:"Seu CPF"}),i.jsx("input",{type:"text",value:C,onChange:ee=>ge(le(ee.target.value)),className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm font-bold text-white focus:ring-2 focus:ring-emerald-500 outline-none",placeholder:"000.000.000-00"})]}),i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-[9px] font-black uppercase text-slate-500 ml-1",children:"Senha do iRamais"}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:Z?"text":"password",value:_e,onChange:ee=>P(ee.target.value),className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm font-bold text-white focus:ring-2 focus:ring-emerald-500 outline-none pr-10",placeholder:""}),i.jsx("button",{onClick:()=>B(!Z),className:"absolute right-3 top-3.5 text-slate-500 hover:text-white transition-colors",children:Z?i.jsx(ba,{size:16}):i.jsx(Ks,{size:16})})]})]})]}),$&&i.jsxs("div",{className:"p-3 bg-red-500/20 border border-red-500/50 rounded-xl text-red-200 text-[10px] font-bold flex items-center gap-2 animate-shake",children:[i.jsx(ms,{size:14})," ",$]}),i.jsxs("div",{className:"flex gap-4",children:[i.jsx("button",{onClick:()=>{T(null),b(null)},className:"flex-1 py-4 text-slate-400 font-black uppercase text-xs hover:bg-white/5 rounded-2xl transition-all",children:"Cancelar"}),i.jsxs("button",{onClick:se,disabled:k||!C||!_e,className:"flex-[2] py-4 bg-emerald-600 text-white rounded-2xl font-black uppercase text-xs hover:bg-emerald-500 transition-all shadow-xl shadow-emerald-900/40 flex items-center justify-center gap-2 disabled:opacity-50",children:[k?i.jsx(Ne,{className:"animate-spin",size:16}):i.jsx(Of,{size:18})," Confirmar Assinatura Digital"]})]}),i.jsx("p",{className:"text-[8px] text-center text-slate-500 font-medium uppercase leading-relaxed tracking-wider",children:"Ao clicar em confirmar, voc declara estar de acordo com os termos acima e autoriza a insero da sua assinatura digitalizada neste documento com validade jurdica interna."})]})})]})}),v&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:i.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh]",children:[i.jsxs("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50",children:[i.jsxs("h3",{className:"font-black text-slate-800 uppercase text-sm flex items-center gap-2",children:[i.jsx(Dr,{size:20,className:"text-emerald-600"})," Solicitar Assinatura Oficial"]}),i.jsx("button",{onClick:()=>A(!1),className:"p-2 hover:bg-slate-200 rounded-full text-slate-400",children:i.jsx(St,{size:24})})]}),i.jsxs("form",{onSubmit:K,className:"p-8 overflow-y-auto custom-scrollbar space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1 ml-1 block",children:"Nome p/ Exibio"}),i.jsx("input",{required:!0,value:j.name,onChange:ee=>F({...j,name:ee.target.value}),className:"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold text-slate-700 outline-none focus:ring-2 focus:ring-emerald-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1 ml-1 block",children:"Cargo ou Setor"}),i.jsx("input",{required:!0,value:j.sector,onChange:ee=>F({...j,sector:ee.target.value}),className:"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold text-slate-700 outline-none focus:ring-2 focus:ring-emerald-500"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1 ml-1 block",children:"Telefone Fixo"}),i.jsx("input",{value:j.phoneFixed,onChange:ee=>F({...j,phoneFixed:ee.target.value}),className:"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold text-slate-700 outline-none focus:ring-2 focus:ring-emerald-500",placeholder:"(71) 3879-XXXX"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1 ml-1 block",children:"WhatsApp / Celular"}),i.jsx("input",{value:j.phoneMobile,onChange:ee=>F({...j,phoneMobile:ee.target.value}),className:"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold text-slate-700 outline-none focus:ring-2 focus:ring-emerald-500",placeholder:"(71) 9XXXX-XXXX"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1 ml-1 block",children:"Observaes (Opcional)"}),i.jsx("textarea",{value:j.notes,onChange:ee=>F({...j,notes:ee.target.value}),className:"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold text-slate-700 outline-none focus:ring-2 focus:ring-emerald-500 min-h-[100px]",placeholder:"Ex: Adicionar selo comemorativo 50 anos."})]})]}),i.jsxs("div",{className:"bg-amber-50 p-4 rounded-2xl border border-amber-100 flex gap-3",children:[i.jsx(Bi,{size:20,className:"text-amber-500 shrink-0"}),i.jsx("p",{className:"text-[10px] text-amber-800 font-bold uppercase leading-relaxed",children:"Sua solicitao gerar um chamado automtico para a equipe de TI. Voc receber uma notificao assim que o download for liberado."})]}),i.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[i.jsx("button",{type:"button",onClick:()=>A(!1),className:"px-6 py-2 text-slate-400 font-black uppercase text-xs hover:bg-slate-100 rounded-xl",children:"Cancelar"}),i.jsxs("button",{type:"submit",disabled:k,className:"px-10 py-3 bg-emerald-600 text-white rounded-2xl font-black uppercase text-xs hover:bg-emerald-700 shadow-xl shadow-emerald-200 flex items-center gap-2",children:[k?i.jsx(Ne,{className:"animate-spin",size:16}):i.jsx(va,{size:16})," Enviar Solicitao"]})]})]})]})}),L&&i.jsx("div",{className:"fixed inset-0 bg-slate-900/70 backdrop-blur-sm z-[200] flex items-center justify-center p-4 animate-fade-in",children:i.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-2xl w-full max-w-2xl overflow-hidden p-8 flex flex-col items-center",children:[i.jsxs("div",{className:"w-full flex justify-between items-center mb-8",children:[i.jsx("h3",{className:"font-black text-slate-800 uppercase text-xs tracking-[0.3em]",children:"Assinatura Corporativa"}),i.jsx("button",{onClick:()=>D(null),className:"p-2 hover:bg-slate-100 rounded-full text-slate-400",children:i.jsx(St,{size:24})})]}),i.jsx("div",{className:"bg-white p-6 shadow-2xl border border-slate-100 rounded-xl overflow-hidden mb-10 w-full flex justify-center",children:i.jsx("img",{src:L,alt:"Signature Preview",className:"max-w-full"})}),i.jsx("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-widest text-center max-w-sm mb-10 leading-relaxed",children:"Voc pode salvar esta imagem e inseri-la nas configuraes de assinatura do seu Outlook ou Webmail."}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>D(null),className:"px-8 py-3 text-slate-400 font-black uppercase text-xs hover:bg-slate-100 rounded-xl",children:"Fechar"}),i.jsxs("a",{href:L,download:`assinatura_${t==null?void 0:t.name}.png`,className:"px-12 py-3 bg-emerald-600 text-white rounded-2xl font-black uppercase text-xs hover:bg-emerald-700 shadow-xl shadow-emerald-200 flex items-center gap-2",children:[i.jsx(yi,{size:18})," Baixar Imagem (PNG)"]})]})]})})]})},N2=({children:t})=>{const{user:e,loading:s}=Ut();return s?i.jsx("div",{className:"h-screen flex items-center justify-center bg-slate-50",children:i.jsx(Ne,{className:"animate-spin text-emerald-600",size:48})}):e?i.jsx(i.Fragment,{children:t}):i.jsx(ty,{to:"/login",replace:!0})},E2=()=>i.jsx(jI,{children:i.jsx(Z0,{children:i.jsxs(ey,{children:[i.jsx(zt,{path:"/",element:i.jsx(u2,{})}),i.jsx(zt,{path:"/login",element:i.jsx(h2,{})}),i.jsxs(zt,{element:i.jsx(N2,{children:i.jsx(RC,{})}),children:[i.jsx(zt,{path:"/dashboard",element:i.jsx(kC,{})}),i.jsx(zt,{path:"/directory",element:i.jsx(VC,{})}),i.jsx(zt,{path:"/systems",element:i.jsx(e2,{})}),i.jsx(zt,{path:"/meeting-rooms",element:i.jsx(n2,{})}),i.jsx(zt,{path:"/tasks",element:i.jsx(UC,{})}),i.jsx(zt,{path:"/news-editor",element:i.jsx(Zk,{})}),i.jsx(zt,{path:"/signatures",element:i.jsx(_2,{})}),i.jsx(zt,{path:"/admin-users",element:i.jsx(g2,{})}),i.jsx(zt,{path:"/admin-employees",element:i.jsx(m2,{})}),i.jsx(zt,{path:"/admin-systems",element:i.jsx(f2,{})}),i.jsx(zt,{path:"/admin-rooms",element:i.jsx(y2,{})}),i.jsx(zt,{path:"/admin-org",element:i.jsx(p2,{})}),i.jsx(zt,{path:"/admin-signatures",element:i.jsx(v2,{})}),i.jsx(zt,{path:"/admin-terms",element:i.jsx(w2,{})})]})]})})}),j0=document.getElementById("root");if(!j0)throw new Error("Failed to find the root element");const T2=Zf(j0);T2.render(i.jsx(sy.StrictMode,{children:i.jsx(E2,{})}));
